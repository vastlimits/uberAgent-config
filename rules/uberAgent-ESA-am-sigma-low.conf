#
# The rules are generated from the Sigma GitHub repository at https://github.com/SigmaHQ/sigma
# Follow these steps to get the latest rules from the repository with Python
#    1. Clone the repository locally
#    2. Using a commandline, change working directory to the just cloned repository
#    3. Run sigmac -I --target uberagent -r rules/
#
# The rules in this file are marked with sigma-level: low
#

[ActivityMonitoringRule]
# Detects macOS Gatekeeper bypass via xattr utility
# Author: Daniil Yugoslavskiy, oscd.community
RuleId = f5141b6d-9f42-41c6-a7bf-2a780678b29b
RuleName = Gatekeeper Bypass via Xattr
EventType = Process.Start
Tag = proc-start-gatekeeper-bypass-via-xattr
RiskScore = 25
Annotation = {"mitre_attack": ["T1553.001"]}
Query = (Process.Path like r"%/xattr" and Process.CommandLine like r"%-r%" and Process.CommandLine like r"%com.apple.quarantine%")

[ActivityMonitoringRule]
# Detection use of the command "split" to split files into parts and possible transfer.
# Author: Igor Fits, Mikhail Larin, oscd.community
RuleId = 7f2bb9d5-6395-4de5-969c-70c11fbe6b12
RuleName = Split A File Into Pieces
EventType = Process.Start
Tag = proc-start-split-a-file-into-pieces
RiskScore = 25
Annotation = {"mitre_attack": ["T1030"]}
Query = Process.Path like r"%/split"

[ActivityMonitoringRule]
# Detects attempts to use screencapture to collect macOS screenshots
# Author: remotephone, oscd.community
RuleId = 0877ed01-da46-4c49-8476-d49cdd80dfa7
RuleName = Screen Capture - macOS
EventType = Process.Start
Tag = proc-start-screen-capture-macos
RiskScore = 25
Annotation = {"mitre_attack": ["T1113"]}
Query = Process.Path == "/usr/sbin/screencapture"

[ActivityMonitoringRule]
# Detects enumeration of local systeam accounts on MacOS
# Author: Alejandro Ortuno, oscd.community
RuleId = ddf36b67-e872-4507-ab2e-46bda21b842c
RuleName = Local System Accounts Discovery - MacOs
EventType = Process.Start
Tag = proc-start-local-system-accounts-discovery-macos
RiskScore = 25
Annotation = {"mitre_attack": ["T1087.001"]}
Query = ((Process.Path like r"%/dscl" and Process.CommandLine like r"%list%" and Process.CommandLine like r"%/users%") or (Process.Path like r"%/dscacheutil" and Process.CommandLine like r"%-q%" and Process.CommandLine like r"%user%") or Process.CommandLine like r"%'x:0:'%" or (Process.Path like r"%/cat" and (Process.CommandLine like r"%/etc/passwd%" or Process.CommandLine like r"%/etc/sudoers%")) or Process.Path like r"%/id" or (Process.Path like r"%/lsof" and Process.CommandLine like r"%-u%"))

[ActivityMonitoringRule]
# Detects attempts to enable the guest account using the sysadminctl utility
# Author: Sohan G (D4rkCiph3r)
RuleId = d7329412-13bd-44ba-a072-3387f804a106
RuleName = Guest Account Enabled Via Sysadminctl
EventType = Process.Start
Tag = proc-start-guest-account-enabled-via-sysadminctl
RiskScore = 25
Annotation = {"mitre_attack": ["T1078", "T1078.001"]}
Query = (Process.Path like r"%/sysadminctl" and Process.CommandLine like r"% -guestAccount%" and Process.CommandLine like r"% on%")

[ActivityMonitoringRule]
# Detects enumeration of local or remote network services.
# Author: Alejandro Ortuno, oscd.community
RuleId = 84bae5d4-b518-4ae0-b331-6d4afd34d00f
RuleName = MacOS Network Service Scanning
EventType = Process.Start
Tag = proc-start-macos-network-service-scanning
RiskScore = 25
Annotation = {"mitre_attack": ["T1046"]}
Query = (((Process.Path like r"%/nc" or Process.Path like r"%/netcat") and not (Process.CommandLine like r"%l%")) or (Process.Path like r"%/nmap" or Process.Path like r"%/telnet"))

[ActivityMonitoringRule]
# Detects attempts to use system dialog prompts to capture user credentials
# Author: remotephone, oscd.community
RuleId = 60f1ce20-484e-41bd-85f4-ac4afec2c541
RuleName = GUI Input Capture - macOS
EventType = Process.Start
Tag = proc-start-gui-input-capture-macos
RiskScore = 25
Annotation = {"mitre_attack": ["T1056.002"]}
Query = (Process.Path == "/usr/sbin/osascript" and Process.CommandLine like r"%-e%" and Process.CommandLine like r"%display%" and Process.CommandLine like r"%dialog%" and Process.CommandLine like r"%answer%" and (Process.CommandLine like r"%admin%" or Process.CommandLine like r"%administrator%" or Process.CommandLine like r"%authenticate%" or Process.CommandLine like r"%authentication%" or Process.CommandLine like r"%credentials%" or Process.CommandLine like r"%pass%" or Process.CommandLine like r"%password%" or Process.CommandLine like r"%unlock%"))

[ActivityMonitoringRule]
# Detects the creation of a new user account. Such accounts may be used for persistence that do not require persistent remote access tools to be deployed on the system.
# Author: Alejandro Ortuno, oscd.community
RuleId = 51719bf5-e4fd-4e44-8ba8-b830e7ac0731
RuleName = Creation Of A Local User Account
EventType = Process.Start
Tag = proc-start-creation-of-a-local-user-account
RiskScore = 25
Annotation = {"mitre_attack": ["T1136.001"]}
Query = ((Process.Path like r"%/dscl" and Process.CommandLine like r"%create%") or (Process.Path like r"%/sysadminctl" and Process.CommandLine like r"%addUser%"))

[ActivityMonitoringRule]
# Detects attempts to masquerade as legitimate files by adding a space to the end of the filename.
# Author: remotephone
RuleId = b6e2a2e3-2d30-43b1-a4ea-071e36595690
RuleName = Space After Filename - macOS
EventType = Process.Start
Tag = proc-start-space-after-filename-macos
RiskScore = 25
Annotation = {"mitre_attack": ["T1036.006"]}
Query = (Process.CommandLine like r"% " or Process.Path like r"% ")

[ActivityMonitoringRule]
# Detects usage of base64 utility to decode arbitrary base64-encoded text
# Author: Daniil Yugoslavskiy, oscd.community
RuleId = 719c22d7-c11a-4f2c-93a6-2cfdd5412f68
RuleName = Decode Base64 Encoded Text -MacOs
EventType = Process.Start
Tag = proc-start-decode-base64-encoded-text-macos
RiskScore = 25
Annotation = {"mitre_attack": ["T1027"]}
Query = (Process.Path == "/usr/bin/base64" and Process.CommandLine like r"%-d%")

[ActivityMonitoringRule]
# Attackers can use explorer.exe for evading defense mechanisms
# Author: Furkan CALISKAN, @caliskanfurkan_, @oscd_initiative
RuleId = 9eb271b9-24ae-4cd4-9465-19cfc1047f3e
RuleName = Proxy Execution Via Explorer.exe
EventType = Process.Start
Tag = proc-start-proxy-execution-via-explorer.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1218"]}
Query = (Process.Path like r"%\\explorer.exe" and Parent.Path like r"%\\cmd.exe" and Process.CommandLine like r"%explorer.exe%")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the creation of a new service using the "sc.exe" utility.
# Author: Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community
RuleId = 85ff530b-261d-48c6-a441-facaa2e81e48
RuleName = New Service Creation Using Sc.EXE
EventType = Process.Start
Tag = proc-start-new-service-creation-using-sc.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1543.003"]}
Query = (Process.Path like r"%\\sc.exe" and Process.CommandLine like r"%create%" and Process.CommandLine like r"%binPath%")

[ActivityMonitoringRule]
# Detects execution of Net.exe, whether suspicious or benign.
# Author: Michael Haag, Mark Woan (improvements), James Pemberton / @4A616D6573 / oscd.community (improvements)
RuleId = 183e7ea8-ac4b-4c23-9aec-b3dac4e401ac
RuleName = Net.exe Execution
EventType = Process.Start
Tag = proc-start-net.exe-execution
RiskScore = 25
Annotation = {"mitre_attack": ["T1007", "T1049", "T1018", "T1135", "T1201", "T1069.001", "T1069.002", "T1087.001", "T1087.002", "T1021.002"]}
Query = (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") or Process.Name in ["net.exe", "net1.exe"]) and (Process.CommandLine like r"% group%" or Process.CommandLine like r"% localgroup%" or Process.CommandLine like r"% user%" or Process.CommandLine like r"% view%" or Process.CommandLine like r"% share%" or Process.CommandLine like r"% accounts%" or Process.CommandLine like r"% stop %" or Process.CommandLine like r"% start%"))

[ActivityMonitoringRule]
# Detects the execution of clip.exe in order to copy data to the clipboard. Adversaries may collect data stored in the clipboard from users copying information within or between applications.
# Author: frack113
RuleId = ddeff553-5233-4ae9-bbab-d64d2bd634be
RuleName = Data Copied To Clipboard Via Clip.EXE
EventType = Process.Start
Tag = proc-start-data-copied-to-clipboard-via-clip.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1115"]}
Query = (Process.Path like r"%\\clip.exe" or Process.Name == "clip.exe")

[ActivityMonitoringRule]
# Adversaries can carry out malicious operations using a virtual instance to avoid detection. This rule is built to detect the registration of the Virtualbox driver or start of a Virtualbox VM.
# Author: Janantha Marasinghe
RuleId = bab049ca-7471-4828-9024-38279a4c04da
RuleName = Detect Virtualbox Driver Installation OR Starting Of VMs
EventType = Process.Start
Tag = proc-start-detect-virtualbox-driver-installation-or-starting-of-vms
RiskScore = 25
Annotation = {"mitre_attack": ["T1564.006", "T1564"]}
Query = ((Process.CommandLine like r"%VBoxRT.dll,RTR3Init%" or Process.CommandLine like r"%VBoxC.dll%" or Process.CommandLine like r"%VBoxDrv.sys%") or (Process.CommandLine like r"%startvm%" or Process.CommandLine like r"%controlvm%"))

[ActivityMonitoringRule]
# Detects the usage of the "net.exe" command to start a service using the "start" flag
# Author: Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community
RuleId = 2a072a96-a086-49fa-bcb5-15cc5a619093
RuleName = Start Windows Service Via Net.EXE
EventType = Process.Start
Tag = proc-start-start-windows-service-via-net.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1569.002"]}
Query = (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") or Process.Name in ["net.exe", "net1.exe"]) and Process.CommandLine like r"% start %")

[ActivityMonitoringRule]
# Detects the export of the target Registry key to a file.
# Author: Oddvar Moe, Sander Wiebing, oscd.community
RuleId = f0e53e89-8d22-46ea-9db5-9d4796ee2f8a
RuleName = Exports Registry Key To a File
EventType = Process.Start
Tag = proc-start-exports-registry-key-to-a-file
RiskScore = 25
Annotation = {"mitre_attack": ["T1012"]}
Query = (((Process.Path like r"%\\regedit.exe" or Process.Name == "REGEDIT.EXE") and (Process.CommandLine like r"% /E %" or Process.CommandLine like r"% -E %")) and not (((Process.CommandLine like r"%hklm%" or Process.CommandLine like r"%hkey\_local\_machine%")) and ((Process.CommandLine like r"%\\system" or Process.CommandLine like r"%\\sam" or Process.CommandLine like r"%\\security"))))

[ActivityMonitoringRule]
# Detects nltest commands that can be used for information discovery
# Author: Arun Chauhan
RuleId = 903076ff-f442-475a-b667-4f246bcc203b
RuleName = Nltest.EXE Execution
EventType = Process.Start
Tag = proc-start-nltest.exe-execution
RiskScore = 25
Annotation = {"mitre_attack": ["T1016", "T1018", "T1482"]}
Query = (Process.Path like r"%\\nltest.exe" or Process.Name == "nltestrk.exe")

[ActivityMonitoringRule]
# Detects the creation of scheduled tasks in user session
# Author: Florian Roth (Nextron Systems)
RuleId = 92626ddd-662c-49e3-ac59-f6535f12d189
RuleName = Scheduled Task Creation
EventType = Process.Start
Tag = proc-start-scheduled-task-creation
RiskScore = 25
Annotation = {"mitre_attack": ["T1053.005"]}
Query = ((Process.Path like r"%\\schtasks.exe" and Process.CommandLine like r"% /create %") and not ((Process.User like r"%AUTHORI%" or Process.User like r"%AUTORI%")))
GenericProperty1 = Process.User

[ActivityMonitoringRule]
# Detects the stopping of a Windows service
# Author: Jakob Weinzettl, oscd.community, Nasreddine Bencherchali (Nextron Systems)
RuleId = c49c5062-0966-4170-9efd-9968c913a6cf
RuleName = Stop Windows Service Via PowerShell Stop-Service
EventType = Process.Start
Tag = proc-start-stop-windows-service-via-powershell-stop-service
RiskScore = 25
Annotation = {"mitre_attack": ["T1489"]}
Query = ((Process.Name in ["PowerShell.EXE", "pwsh.dll"] or (Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe")) and Process.CommandLine like r"%Stop-Service %")

[ActivityMonitoringRule]
# Detects non-interactive PowerShell activity by looking at powershell.exe with a non user process such as "explorer.exe" as a parent.
# Author: Roberto Rodriguez @Cyb3rWard0g (rule), oscd.community (improvements)
RuleId = f4bbd493-b796-416e-bbf2-121235348529
RuleName = Non Interactive PowerShell Process Spawned
EventType = Process.Start
Tag = proc-start-non-interactive-powershell-process-spawned
RiskScore = 25
Annotation = {"mitre_attack": ["T1059.001"]}
Query = (((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") or Process.Name in ["PowerShell.EXE", "pwsh.dll"]) and not (((Parent.Path like r"%\\explorer.exe" or Parent.Path like r"%\\CompatTelRunner.exe") or Parent.Path like r"C:\\$WINDOWS.~BT\\Sources\\SetupHost.exe") or (Parent.Path like r"C:\\Users\\%" and Parent.Path like r"%\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe" and Parent.CommandLine like r"% --ms-enable-electron-run-as-node %")))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects the creation of a new service using powershell.
# Author: Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community
RuleId = c02e96b7-c63a-4c47-bd83-4a9f74afcfb2
RuleName = New Service Creation Using PowerShell
EventType = Process.Start
Tag = proc-start-new-service-creation-using-powershell
RiskScore = 25
Annotation = {"mitre_attack": ["T1543.003"]}
Query = (Process.CommandLine like r"%New-Service%" and Process.CommandLine like r"%-BinaryPathName%")

[ActivityMonitoringRule]
# Marks a file as a system file using the attrib.exe utility
# Author: frack113
RuleId = bb19e94c-59ae-4c15-8c12-c563d23fe52b
RuleName = Set Windows System File with Attrib
EventType = Process.Start
Tag = proc-start-set-windows-system-file-with-attrib
RiskScore = 25
Annotation = {"mitre_attack": ["T1564.001"]}
Query = ((Process.Path like r"%\\attrib.exe" or Process.Name == "ATTRIB.EXE") and Process.CommandLine like r"% +s %")

[ActivityMonitoringRule]
# Detects attempts to enumerate file shares, printer shares and sessions using "net.exe" with the "view" flag.
# Author: Endgame, JHasenbusch (ported for oscd.community)
RuleId = 62510e69-616b-4078-b371-847da438cc03
RuleName = Share And Session Enumeration Using Net.EXE
EventType = Process.Start
Tag = proc-start-share-and-session-enumeration-using-net.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1018"]}
Query = ((((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") or Process.Name in ["net.exe", "net1.exe"]) and Process.CommandLine like r"%view%") and not (Process.CommandLine like r"%\\\\\*"))

[ActivityMonitoringRule]
# Local accounts, System Owner/User discovery using operating systems utilities
# Author: Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community
RuleId = 502b42de-4306-40b4-9596-6f590c81f073
RuleName = Local Accounts Discovery
EventType = Process.Start
Tag = proc-start-local-accounts-discovery
RiskScore = 25
Annotation = {"mitre_attack": ["T1033", "T1087.001"]}
Query = (((Process.Path like r"%\\cmd.exe" and Process.CommandLine like r"% /c%" and Process.CommandLine like r"%dir %" and Process.CommandLine like r"%\\Users\\%") and not (Process.CommandLine like r"% rmdir %")) or (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") and Process.CommandLine like r"%user%") and not ((Process.CommandLine like r"%/domain%" or Process.CommandLine like r"%/add%" or Process.CommandLine like r"%/delete%" or Process.CommandLine like r"%/active%" or Process.CommandLine like r"%/expires%" or Process.CommandLine like r"%/passwordreq%" or Process.CommandLine like r"%/scriptpath%" or Process.CommandLine like r"%/times%" or Process.CommandLine like r"%/workstations%"))) or (Process.Path like r"%\\whoami.exe" or Process.Path like r"%\\quser.exe" or Process.Path like r"%\\qwinsta.exe") or (Process.Path like r"%\\wmic.exe" and Process.CommandLine like r"%useraccount%" and Process.CommandLine like r"%get%") or (Process.Path like r"%\\cmdkey.exe" and Process.CommandLine like r"% /l%"))

[ActivityMonitoringRule]
# Detect the usage of "DirLister.exe" a utility for quickly listing folder or drive contents. It was seen used by BlackCat ransomware to create a list of accessible directories and files.
# Author: frack113
RuleId = b4dc61f5-6cce-468e-a608-b48b469feaa2
RuleName = DirLister Execution
EventType = Process.Start
Tag = proc-start-dirlister-execution
RiskScore = 25
Annotation = {"mitre_attack": ["T1083"]}
Query = (Process.Name == "DirLister.exe" or Process.Path like r"%\\dirlister.exe")

[ActivityMonitoringRule]
# Detects the execution of "wmic" with the "group" flag.
# Adversaries may attempt to find local system groups and permission settings.
# The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.
# Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.
# Author: frack113
RuleId = 164eda96-11b2-430b-85ff-6a265c15bf32
RuleName = Local Groups Reconnaissance Via Wmic.EXE
EventType = Process.Start
Tag = proc-start-local-groups-reconnaissance-via-wmic.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1069.001"]}
Query = ((Process.Path like r"%\\wmic.exe" or Process.Name == "wmic.exe") and Process.CommandLine like r"% group%")

[ActivityMonitoringRule]
# Detects commandline flags that contain the 'accepteula' flag which could be a sign of execution of one of the Sysinternals tools
# Author: Markus Neis
RuleId = 7cccd811-7ae9-4ebe-9afd-cb5c406b824b
RuleName = Potential Execution of Sysinternals Tools
EventType = Process.Start
Tag = proc-start-potential-execution-of-sysinternals-tools
RiskScore = 25
Annotation = {"mitre_attack": ["T1588.002"]}
Query = (Process.CommandLine like r"% -accepteula%" or Process.CommandLine like r"% /accepteula%")

[ActivityMonitoringRule]
# Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network.
# Author: frack113
RuleId = 1c67a717-32ba-409b-a45d-0fb704a73a81
RuleName = System Network Connections Discovery Via Net.EXE
EventType = Process.Start
Tag = proc-start-system-network-connections-discovery-via-net.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1049"]}
Query = (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") or Process.Name in ["net.exe", "net1.exe"]) and ((Process.CommandLine like r"% use" or Process.CommandLine like r"% sessions") or (Process.CommandLine like r"% use %" or Process.CommandLine like r"% sessions %")))

[ActivityMonitoringRule]
# Detects the creation of a process from Windows task manager
# Author: Florian Roth (Nextron Systems)
RuleId = 3d7679bd-0c00-440c-97b0-3f204273e6c7
RuleName = Taskmgr as Parent
EventType = Process.Start
Tag = proc-start-taskmgr-as-parent
RiskScore = 25
Annotation = {"mitre_attack": ["T1036"]}
Query = (Parent.Path like r"%\\taskmgr.exe" and not ((Process.Path like r"%\\resmon.exe" or Process.Path like r"%\\mmc.exe" or Process.Path like r"%\\taskmgr.exe")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects file association changes using the builtin "assoc" command.
# When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened.
# Author: Timur Zinniatullin, oscd.community
RuleId = 3d3aa6cd-6272-44d6-8afc-7e88dfef7061
RuleName = Change Default File Association Via Assoc
EventType = Process.Start
Tag = proc-start-change-default-file-association-via-assoc
RiskScore = 25
Annotation = {"mitre_attack": ["T1546.001"]}
Query = ((Process.Path like r"%\\cmd.exe" or Process.Name == "Cmd.Exe") and Process.CommandLine like r"%assoc%")

[ActivityMonitoringRule]
# Identifies use of various commands to query a systems time. This technique may be used before executing a scheduled task or to discover the time zone of a target system.
# Author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community
RuleId = b243b280-65fe-48df-ba07-6ddea7646427
RuleName = Discovery of a System Time
EventType = Process.Start
Tag = proc-start-discovery-of-a-system-time
RiskScore = 25
Annotation = {"mitre_attack": ["T1124"]}
Query = (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") and Process.CommandLine like r"%time%") or (Process.Path like r"%\\w32tm.exe" and Process.CommandLine like r"%tz%"))

[ActivityMonitoringRule]
# Detects when a share is mounted using the "net.exe" utility
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = f117933c-980c-4f78-b384-e3d838111165
RuleName = Windows Share Mount Via Net.EXE
EventType = Process.Start
Tag = proc-start-windows-share-mount-via-net.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1021.002"]}
Query = (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") or Process.Name in ["net.exe", "net1.exe"]) and (Process.CommandLine like r"% use %" or Process.CommandLine like r"% \\\\\*"))

[ActivityMonitoringRule]
# Detect indirect command execution via Program Compatibility Assistant pcwrun.exe
# Author: A. Sungurov , oscd.community
RuleId = b97cd4b1-30b8-4a9d-bd72-6293928d52bc
RuleName = Indirect Command Execution By Program Compatibility Wizard
EventType = Process.Start
Tag = proc-start-indirect-command-execution-by-program-compatibility-wizard
RiskScore = 25
Annotation = {"mitre_attack": ["T1218"]}
Query = Parent.Path like r"%\\pcwrun.exe"
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the use of the redirection character ">" to redicrect information in commandline
# Author: frack113
RuleId = 4f4eaa9f-5ad4-410c-a4be-bc6132b0175a
RuleName = CMD Shell Output Redirect
EventType = Process.Start
Tag = proc-start-cmd-shell-output-redirect
RiskScore = 25
Annotation = {"mitre_attack": ["T1082"]}
Query = (((Process.Name == "Cmd.Exe" or Process.Path like r"%\\cmd.exe") and Process.CommandLine like r"%>%") and not (((Process.CommandLine like r"%C:\\Program Files (x86)\\Internet Download Manager\\IDMMsgHost.exe%" or Process.CommandLine like r"%chrome-extension://%" or Process.CommandLine like r"%\\.\\pipe\\chrome.nativeMessaging%"))))

[ActivityMonitoringRule]
# Detects specific combinations of encoding methods in PowerShell via the commandline
# Author: Teymur Kheirkhabarov (idea), Vasiliy Burov (rule), oscd.community, Tim Shelton
RuleId = cdf05894-89e7-4ead-b2b0-0a5f97a90f2f
RuleName = Potential Encoded PowerShell Patterns In CommandLine
EventType = Process.Start
Tag = proc-start-potential-encoded-powershell-patterns-in-commandline
RiskScore = 25
Annotation = {"mitre_attack": ["T1027", "T1059.001"]}
Query = (((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") or Process.Name in ["PowerShell.EXE", "pwsh.dll"]) and (((Process.CommandLine like r"%ToInt%" or Process.CommandLine like r"%ToDecimal%" or Process.CommandLine like r"%ToByte%" or Process.CommandLine like r"%ToUint%" or Process.CommandLine like r"%ToSingle%" or Process.CommandLine like r"%ToSByte%") and (Process.CommandLine like r"%ToChar%" or Process.CommandLine like r"%ToString%" or Process.CommandLine like r"%String%")) or ((Process.CommandLine like r"%char%" and Process.CommandLine like r"%join%") or (Process.CommandLine like r"%split%" and Process.CommandLine like r"%join%"))))

[ActivityMonitoringRule]
# Detects execution of the builtin "rmdir" command in order to delete directories.
# Adversaries may delete files left behind by the actions of their intrusion activity.
# Malware, tools, or other non-native files dropped or created on a system by an adversary may leave traces to indicate to what was done within a network and how.
# Removal of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversary's footprint.
# Author: frack113
RuleId = 41ca393d-538c-408a-ac27-cf1e038be80c
RuleName = Directory Removal Via Rmdir
EventType = Process.Start
Tag = proc-start-directory-removal-via-rmdir
RiskScore = 25
Annotation = {"mitre_attack": ["T1070.004"]}
Query = ((Process.Path like r"%\\cmd.exe" or Process.Name == "Cmd.Exe") and Process.CommandLine like r"%rmdir%" and (Process.CommandLine like r"%/s%" or Process.CommandLine like r"%/q%"))

[ActivityMonitoringRule]
# Detects usage of the "systeminfo" command to retrieve information
# Author: frack113
RuleId = 0ef56343-059e-4cb6-adc1-4c3c967c5e46
RuleName = Suspicious Execution of Systeminfo
EventType = Process.Start
Tag = proc-start-suspicious-execution-of-systeminfo
RiskScore = 25
Annotation = {"mitre_attack": ["T1082"]}
Query = (Process.Path like r"%\\systeminfo.exe" or Process.Name == "sysinfo.exe")

[ActivityMonitoringRule]
# Detects usage of "rar" to add files to an archive for potential compression. An adversary may compress data (e.g. sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.
# Author: Timur Zinniatullin, E.M. Anhaus, oscd.community
RuleId = 6f3e2987-db24-4c78-a860-b4f4095a7095
RuleName = Files Added To An Archive Using Rar.EXE
EventType = Process.Start
Tag = proc-start-files-added-to-an-archive-using-rar.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1560.001"]}
Query = (Process.Path like r"%\\rar.exe" and Process.CommandLine like r"% a %")

[ActivityMonitoringRule]
# Detect suspicious parent processes of well-known Windows processes
# Author: vburov
RuleId = 96036718-71cc-4027-a538-d1587e0006a7
RuleName = Windows Processes Suspicious Parent Directory
EventType = Process.Start
Tag = proc-start-windows-processes-suspicious-parent-directory
RiskScore = 25
Annotation = {"mitre_attack": ["T1036.003", "T1036.005"]}
Query = ((Process.Path like r"%\\svchost.exe" or Process.Path like r"%\\taskhost.exe" or Process.Path like r"%\\lsm.exe" or Process.Path like r"%\\lsass.exe" or Process.Path like r"%\\services.exe" or Process.Path like r"%\\lsaiso.exe" or Process.Path like r"%\\csrss.exe" or Process.Path like r"%\\wininit.exe" or Process.Path like r"%\\winlogon.exe") and not (((Parent.Path like r"%\\SavService.exe" or Parent.Path like r"%\\ngen.exe") or (Parent.Path like r"%\\System32\\%" or Parent.Path like r"%\\SysWOW64\\%")) or ((Parent.Path like r"%\\Windows Defender\\%" or Parent.Path like r"%\\Microsoft Security Client\\%") and Parent.Path like r"%\\MsMpEng.exe") or (Parent.Path == '' or Parent.Path == "-")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the stopping of a Windows service
# Author: Jakob Weinzettl, oscd.community, Nasreddine Bencherchali (Nextron Systems)
RuleId = 88872991-7445-4a22-90b2-a3adadb0e827
RuleName = Stop Windows Service Via Net.EXE
EventType = Process.Start
Tag = proc-start-stop-windows-service-via-net.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1489"]}
Query = ((Process.Name in ["net.exe", "net1.exe"] or (Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe")) and Process.CommandLine like r"% stop %")

[ActivityMonitoringRule]
# Adversaries may enumerate browser bookmarks to learn more about compromised hosts.
# Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about
# internal network resources such as servers, tools/dashboards, or other related infrastructure.
# Author: frack113, Nasreddine Bencherchali
RuleId = 725a9768-0f5e-4cb3-aec2-bc5719c6831a
RuleName = Suspicious Where Execution
EventType = Process.Start
Tag = proc-start-suspicious-where-execution
RiskScore = 25
Annotation = {"mitre_attack": ["T1217"]}
Query = ((Process.Path like r"%\\where.exe" or Process.Name == "where.exe") and (Process.CommandLine like r"%places.sqlite%" or Process.CommandLine like r"%cookies.sqlite%" or Process.CommandLine like r"%formhistory.sqlite%" or Process.CommandLine like r"%logins.json%" or Process.CommandLine like r"%key4.db%" or Process.CommandLine like r"%key3.db%" or Process.CommandLine like r"%sessionstore.jsonlz4%" or Process.CommandLine like r"%History%" or Process.CommandLine like r"%Bookmarks%" or Process.CommandLine like r"%Cookies%" or Process.CommandLine like r"%Login Data%"))

[ActivityMonitoringRule]
# Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation
# Author: oscd.community, @redcanary, Zach Stanford @svch0st
RuleId = cb7c4a03-2871-43c0-9bbb-18bbdb079896
RuleName = Unmount Share Via Net.EXE
EventType = Process.Start
Tag = proc-start-unmount-share-via-net.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1070.005"]}
Query = (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") or Process.Name in ["net.exe", "net1.exe"]) and (Process.CommandLine like r"%share%" and Process.CommandLine like r"%/delete%"))

[ActivityMonitoringRule]
# Detects execution of the builtin "del"/"erase" commands in order to delete files.
# Adversaries may delete files left behind by the actions of their intrusion activity.
# Malware, tools, or other non-native files dropped or created on a system by an adversary may leave traces to indicate to what was done within a network and how.
# Removal of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversary's footprint.
# Author: frack113
RuleId = 379fa130-190e-4c3f-b7bc-6c8e834485f3
RuleName = File Deletion Via Del
EventType = Process.Start
Tag = proc-start-file-deletion-via-del
RiskScore = 25
Annotation = {"mitre_attack": ["T1070.004"]}
Query = ((Process.Path like r"%\\cmd.exe" or Process.Name == "Cmd.Exe") and (Process.CommandLine like r"%del %" or Process.CommandLine like r"%erase %") and (Process.CommandLine like r"% /f%" or Process.CommandLine like r"% /s%" or Process.CommandLine like r"% /q%"))

[ActivityMonitoringRule]
# Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems
# Author: frack113, Christopher Peacock '@securepeacock', SCYTHE '@scythe_io'
RuleId = a29c1813-ab1f-4dde-b489-330b952e91ae
RuleName = Suspicious Network Command
EventType = Process.Start
Tag = proc-start-suspicious-network-command
RiskScore = 25
Annotation = {"mitre_attack": ["T1016"]}
Query = (Process.CommandLine like r"%ipconfig /all%" or Process.CommandLine like r"%netsh interface show interface%" or Process.CommandLine like r"%arp -a%" or Process.CommandLine like r"%nbtstat -n%" or Process.CommandLine like r"%net config%" or Process.CommandLine like r"%route print%")

[ActivityMonitoringRule]
# Attackers may leverage fsutil to enumerated connected drives.
# Author: Christopher Peacock '@securepeacock', SCYTHE '@scythe_io'
RuleId = 63de06b9-a385-40b5-8b32-73f2b9ef84b6
RuleName = Fsutil Drive Enumeration
EventType = Process.Start
Tag = proc-start-fsutil-drive-enumeration
RiskScore = 25
Annotation = {"mitre_attack": ["T1120"]}
Query = ((Process.Path like r"%\\fsutil.exe" or Process.Name == "fsutil.exe") and Process.CommandLine like r"%drives%")

[ActivityMonitoringRule]
# Use of hostname to get information
# Author: frack113
RuleId = 7be5fb68-f9ef-476d-8b51-0256ebece19e
RuleName = Suspicious Execution of Hostname
EventType = Process.Start
Tag = proc-start-suspicious-execution-of-hostname
RiskScore = 25
Annotation = {"mitre_attack": ["T1082"]}
Query = Process.Path like r"%\\HOSTNAME.EXE"

[ActivityMonitoringRule]
# Windows Test Authoring and Execution Framework (TAEF) framework allows you to run automation by executing tests files written on different languages (C, C#, Microsoft COM Scripting interfaces
# Adversaries may execute malicious code (such as WSC file with VBScript, dll and so on) directly by running te.exe
# Author: Agro (@agro_sev) oscd.community
RuleId = 634b00d5-ccc3-4a06-ae3b-0ec8444dd51b
RuleName = Malicious Windows Script Components File Execution by TAEF Detection
EventType = Process.Start
Tag = proc-start-malicious-windows-script-components-file-execution-by-taef-detection
RiskScore = 25
Annotation = {"mitre_attack": ["T1218"]}
Query = (Process.Path like r"%\\te.exe" or Parent.Path like r"%\\te.exe" or Process.Name like r"\\te.exe")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# This tool enables enumeration and exporting of all DNS records in the zone for recon purposes of internal networks Python 3 and python.exe must be installed,
# Usee to Query/modify DNS records for Active Directory integrated DNS via LDAP
# Author: frack113
RuleId = 26d3f0a2-f514-4a3f-a8a7-e7e48a8d9160
RuleName = PUA - Adidnsdump Execution
EventType = Process.Start
Tag = proc-start-pua-adidnsdump-execution
RiskScore = 25
Annotation = {"mitre_attack": ["T1018"]}
Query = (Process.Path like r"%\\python.exe" and Process.CommandLine like r"%adidnsdump%")

[ActivityMonitoringRule]
# Detects usage of the "dir" command that's part of windows batch/cmd to collect information about directories
# Author: frack113
RuleId = 7c9340a9-e2ee-4e43-94c5-c54ebbea1006
RuleName = Files And Subdirectories Listing Using Dir
EventType = Process.Start
Tag = proc-start-files-and-subdirectories-listing-using-dir
RiskScore = 25
Annotation = {"mitre_attack": ["T1217"]}
Query = (Process.CommandLine like r"%dir %" and Process.CommandLine like r"% /s%" and Process.CommandLine like r"% /b%")

[ActivityMonitoringRule]
# Detects usage of attrib.exe to hide files from users.
# Author: Sami Ruohonen
RuleId = 4281cb20-2994-4580-aa63-c8b86d019934
RuleName = Hiding Files with Attrib.exe
EventType = Process.Start
Tag = proc-start-hiding-files-with-attrib.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1564.001"]}
Query = (((Process.Path like r"%\\attrib.exe" or Process.Name == "ATTRIB.EXE") and Process.CommandLine like r"% +h %") and not ((Process.CommandLine like r"%\\desktop.ini %") or (Parent.Path like r"%\\cmd.exe" and Process.CommandLine like r"+R +H +S +A \\\*.cui" and Parent.CommandLine like r"C:\\WINDOWS\\system32\\\*.bat")))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems
# Author: frack113, Christopher Peacock '@securepeacock', SCYTHE '@scythe_io'
RuleId = 0e4164da-94bc-450d-a7be-a4b176179f1f
RuleName = Suspicious Firewall Configuration Discovery Via Netsh.EXE
EventType = Process.Start
Tag = proc-start-suspicious-firewall-configuration-discovery-via-netsh.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1016"]}
Query = ((Process.Path like r"%\\netsh.exe" or Process.Name == "netsh.exe") and (Process.CommandLine like r"%netsh %" and Process.CommandLine like r"%show %" and Process.CommandLine like r"%firewall %" and (Process.CommandLine like r"%config %" or Process.CommandLine like r"%state %" or Process.CommandLine like r"%rule %" or Process.CommandLine like r"%name=all%")))

[ActivityMonitoringRule]
# Detects execution of "sc.exe" to query information about registered services on the system
# Author: frack113
RuleId = 57712d7a-679c-4a41-a913-87e7175ae429
RuleName = SC.EXE Query Execution
EventType = Process.Start
Tag = proc-start-sc.exe-query-execution
RiskScore = 25
Annotation = {"mitre_attack": ["T1007"]}
Query = (Process.Path like r"%\\sc.exe" and Process.Name like r"%sc.exe" and Process.CommandLine like r"% query%")

[ActivityMonitoringRule]
# Use of reg to get MachineGuid information
# Author: frack113
RuleId = f5240972-3938-4e56-8e4b-e33893176c1f
RuleName = Suspicious Query of MachineGUID
EventType = Process.Start
Tag = proc-start-suspicious-query-of-machineguid
RiskScore = 25
Annotation = {"mitre_attack": ["T1082"]}
Query = (Process.Path like r"%\\reg.exe" and Process.CommandLine like r"%SOFTWARE\\Microsoft\\Cryptography%" and Process.CommandLine like r"%/v %" and Process.CommandLine like r"%MachineGuid%")

[ActivityMonitoringRule]
# Adversaries may stop services or processes in order to conduct Data Destruction or Data Encrypted for Impact on the data stores of services like Exchange and SQL Server.
# Author: frack113
RuleId = 86085955-ea48-42a2-9dd3-85d4c36b167d
RuleName = Suspicious Execution of Taskkill
EventType = Process.Start
Tag = proc-start-suspicious-execution-of-taskkill
RiskScore = 25
Annotation = {"mitre_attack": ["T1489"]}
Query = ((Process.Path like r"%\\taskkill.exe" or Process.Name == "taskkill.exe") and (Process.CommandLine like r"% /f%" and Process.CommandLine like r"% /im %"))

[ActivityMonitoringRule]
# Detects the stopping of a Windows service
# Author: Jakob Weinzettl, oscd.community, Nasreddine Bencherchali (Nextron Systems)
RuleId = 81bcb81b-5b1f-474b-b373-52c871aaa7b1
RuleName = Stop Windows Service Via Sc.EXE
EventType = Process.Start
Tag = proc-start-stop-windows-service-via-sc.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1489"]}
Query = (((Process.Name == "sc.exe" or Process.Path like r"%\\sc.exe") and Process.CommandLine like r"% stop %") and not ((Process.CommandLine in ["sc  stop KSCWebConsoleMessageQueue", "sc  stop LGHUBUpdaterService"] and (Process.User like r"%AUTHORI%" or Process.User like r"%AUTORI%"))))
GenericProperty1 = Process.User

[ActivityMonitoringRule]
# Detects processes loading "System.Drawing.ni.dll". This could be an indicator of potential Screen Capture.
# Author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)
RuleId = 666ecfc7-229d-42b8-821e-1a8f8cb7057c
RuleName = System Drawing DLL Load
EventType = Image.Load
Tag = system-drawing-dll-load
RiskScore = 25
Annotation = {"mitre_attack": ["T1113"]}
Query = Image.Path like r"%\\System.Drawing.ni.dll"
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects an a non-browser process interacting with the Reddit API which could indicate use of a covert C2 such as RedditC2
# Author: Gavin Knapp
RuleId = d7b09985-95a3-44be-8450-b6eadf49833e
RuleName = Suspicious Non-Browser Network Communication With Reddit API
EventType = Net.Any
Tag = suspicious-non-browser-network-communication-with-reddit-api
RiskScore = 25
Annotation = {"mitre_attack": ["T1102"]}
Query = (Net.Target.Name like r"%reddit.com/api%" and not ((Process.Path like r"%\\brave.exe" or Process.Path like r"%\\chrome.exe" or Process.Path like r"%\\ExpressConnectNetworkService.exe" or Process.Path like r"%\\firefox.exe" or Process.Path like r"%\\iexplorer.exe" or Process.Path like r"%\\maxthon.exe" or Process.Path like r"%\\msedge.exe" or Process.Path like r"%\\opera.exe" or Process.Path like r"%\\safari.exe" or Process.Path like r"%\\seamonkey.exe" or Process.Path like r"%\\vivaldi.exe")))
GenericProperty1 = Net.Target.Name

