#
# The rules are generated from the Sigma GitHub repository at https://github.com/SigmaHQ/sigma
# Follow these steps to get the latest rules from the repository with Python
#    1. Clone the repository locally
#    2. Using a commandline, change working directory to the just cloned repository
#    3. Run sigmac -I --target uberagent -r rules/
#
# The rules in this file are marked with sigma-level: high
#

[ActivityMonitoringRule]
# Detects DLL sideloading of "dbghelp.dll"
# Author: Nasreddine Bencherchali (Nextron Systems), Wietze Beukema (project and research)
RuleName = DLL Sideloading Of DBGHELP.DLL
EventType = Image.Load
Tag = dll-sideloading-of-dbghelp.dll
RiskScore = 75
Query = (Image.Path like r"%\\dbghelp.dll" and not (((Image.Path like r"C:\\Windows\\System32\\%" or Image.Path like r"C:\\Windows\\SysWOW64\\%" or Image.Path like r"C:\\Windows\\WinSxS\\%" or Image.Path like r"C:\\Windows\\SoftwareDistribution\\%" or Image.Path like r"C:\\Windows\\SystemTemp\\%" or Image.Path like r"C:\\Program Files (x86)\\%" or Image.Path like r"C:\\Program Files\\%") or (Image.Path like r"%\\Epic Games\\Launcher\\Engine\\Binaries\\ThirdParty\\DbgHelp\\dbghelp.dll" or Image.Path like r"%\\Epic Games\\MagicLegends\\x86\\dbghelp.dll" or Image.Path like r"%\\Anaconda3\\Lib\\site-packages\\vtrace\\platforms\\windll\\amd64\\dbghelp.dll" or Image.Path like r"%\\Anaconda3\\Lib\\site-packages\\vtrace\\platforms\\windll\\i386\\dbghelp.dll"))))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects DLL sideloading of DLLs usually located in system locations (System32, SysWOW64...)
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential System DLL Sideloading From Non System Locations
EventType = Image.Load
Tag = potential-system-dll-sideloading-from-non-system-locations
RiskScore = 75
Query = ((Image.Path like r"%\\shfolder.dll" or Image.Path like r"%\\activeds.dll" or Image.Path like r"%\\adsldpc.dll" or Image.Path like r"%\\aepic.dll" or Image.Path like r"%\\apphelp.dll" or Image.Path like r"%\\applicationframe.dll" or Image.Path like r"%\\appxalluserstore.dll" or Image.Path like r"%\\appxdeploymentclient.dll" or Image.Path like r"%\\archiveint.dll" or Image.Path like r"%\\atl.dll" or Image.Path like r"%\\audioses.dll" or Image.Path like r"%\\auditpolcore.dll" or Image.Path like r"%\\authfwcfg.dll" or Image.Path like r"%\\authz.dll" or Image.Path like r"%\\avrt.dll" or Image.Path like r"%\\bcd.dll" or Image.Path like r"%\\bcp47langs.dll" or Image.Path like r"%\\bcp47mrm.dll" or Image.Path like r"%\\bcrypt.dll" or Image.Path like r"%\\cabinet.dll" or Image.Path like r"%\\cabview.dll" or Image.Path like r"%\\certenroll.dll" or Image.Path like r"%\\cldapi.dll" or Image.Path like r"%\\clipc.dll" or Image.Path like r"%\\clusapi.dll" or Image.Path like r"%\\cmpbk32.dll" or Image.Path like r"%\\coloradapterclient.dll" or Image.Path like r"%\\colorui.dll" or Image.Path like r"%\\comdlg32.dll" or Image.Path like r"%\\connect.dll" or Image.Path like r"%\\coremessaging.dll" or Image.Path like r"%\\credui.dll" or Image.Path like r"%\\cryptbase.dll" or Image.Path like r"%\\cryptdll.dll" or Image.Path like r"%\\cryptui.dll" or Image.Path like r"%\\cryptxml.dll" or Image.Path like r"%\\cscapi.dll" or Image.Path like r"%\\cscobj.dll" or Image.Path like r"%\\cscui.dll" or Image.Path like r"%\\d2d1.dll" or Image.Path like r"%\\d3d10.dll" or Image.Path like r"%\\d3d10\_1.dll" or Image.Path like r"%\\d3d10\_1core.dll" or Image.Path like r"%\\d3d10core.dll" or Image.Path like r"%\\d3d10warp.dll" or Image.Path like r"%\\d3d11.dll" or Image.Path like r"%\\d3d12.dll" or Image.Path like r"%\\d3d9.dll" or Image.Path like r"%\\dataexchange.dll" or Image.Path like r"%\\davclnt.dll" or Image.Path like r"%\\dcomp.dll" or Image.Path like r"%\\defragproxy.dll" or Image.Path like r"%\\desktopshellext.dll" or Image.Path like r"%\\deviceassociation.dll" or Image.Path like r"%\\devicecredential.dll" or Image.Path like r"%\\devicepairing.dll" or Image.Path like r"%\\devobj.dll" or Image.Path like r"%\\devrtl.dll" or Image.Path like r"%\\dhcpcmonitor.dll" or Image.Path like r"%\\dhcpcsvc.dll" or Image.Path like r"%\\dhcpcsvc6.dll" or Image.Path like r"%\\directmanipulation.dll" or Image.Path like r"%\\dismapi.dll" or Image.Path like r"%\\dismcore.dll" or Image.Path like r"%\\dmcfgutils.dll" or Image.Path like r"%\\dmcmnutils.dll" or Image.Path like r"%\\dmenrollengine.dll" or Image.Path like r"%\\dmenterprisediagnostics.dll" or Image.Path like r"%\\dmiso8601utils.dll" or Image.Path like r"%\\dmoleaututils.dll" or Image.Path like r"%\\dmprocessxmlfiltered.dll" or Image.Path like r"%\\dmpushproxy.dll" or Image.Path like r"%\\dmxmlhelputils.dll" or Image.Path like r"%\\dnsapi.dll" or Image.Path like r"%\\dot3api.dll" or Image.Path like r"%\\dot3cfg.dll" or Image.Path like r"%\\drprov.dll" or Image.Path like r"%\\dsclient.dll" or Image.Path like r"%\\dsparse.dll" or Image.Path like r"%\\dsreg.dll" or Image.Path like r"%\\dsrole.dll" or Image.Path like r"%\\dui70.dll" or Image.Path like r"%\\duser.dll" or Image.Path like r"%\\dusmapi.dll" or Image.Path like r"%\\dwmapi.dll" or Image.Path like r"%\\dwrite.dll" or Image.Path like r"%\\dxgi.dll" or Image.Path like r"%\\dxva2.dll" or Image.Path like r"%\\eappcfg.dll" or Image.Path like r"%\\eappprxy.dll" or Image.Path like r"%\\edputil.dll" or Image.Path like r"%\\efsadu.dll" or Image.Path like r"%\\efsutil.dll" or Image.Path like r"%\\esent.dll" or Image.Path like r"%\\execmodelproxy.dll" or Image.Path like r"%\\explorerframe.dll" or Image.Path like r"%\\fastprox.dll" or Image.Path like r"%\\faultrep.dll" or Image.Path like r"%\\fddevquery.dll" or Image.Path like r"%\\feclient.dll" or Image.Path like r"%\\fhcfg.dll" or Image.Path like r"%\\firewallapi.dll" or Image.Path like r"%\\flightsettings.dll" or Image.Path like r"%\\fltlib.dll" or Image.Path like r"%\\fveapi.dll" or Image.Path like r"%\\fwbase.dll" or Image.Path like r"%\\fwcfg.dll" or Image.Path like r"%\\fwpolicyiomgr.dll" or Image.Path like r"%\\fwpuclnt.dll" or Image.Path like r"%\\getuname.dll" or Image.Path like r"%\\hid.dll" or Image.Path like r"%\\hnetmon.dll" or Image.Path like r"%\\httpapi.dll" or Image.Path like r"%\\idstore.dll" or Image.Path like r"%\\ieadvpack.dll" or Image.Path like r"%\\iedkcs32.dll" or Image.Path like r"%\\iertutil.dll" or Image.Path like r"%\\ifmon.dll" or Image.Path like r"%\\iphlpapi.dll" or Image.Path like r"%\\iri.dll" or Image.Path like r"%\\iscsidsc.dll" or Image.Path like r"%\\iscsium.dll" or Image.Path like r"%\\isv.exe\_rsaenh.dll" or Image.Path like r"%\\joinutil.dll" or Image.Path like r"%\\ksuser.dll" or Image.Path like r"%\\ktmw32.dll" or Image.Path like r"%\\licensemanagerapi.dll" or Image.Path like r"%\\licensingdiagspp.dll" or Image.Path like r"%\\linkinfo.dll" or Image.Path like r"%\\loadperf.dll" or Image.Path like r"%\\logoncli.dll" or Image.Path like r"%\\logoncontroller.dll" or Image.Path like r"%\\lpksetupproxyserv.dll" or Image.Path like r"%\\magnification.dll" or Image.Path like r"%\\mapistub.dll" or Image.Path like r"%\\mfcore.dll" or Image.Path like r"%\\mfplat.dll" or Image.Path like r"%\\mi.dll" or Image.Path like r"%\\midimap.dll" or Image.Path like r"%\\miutils.dll" or Image.Path like r"%\\mlang.dll" or Image.Path like r"%\\mmdevapi.dll" or Image.Path like r"%\\mobilenetworking.dll" or Image.Path like r"%\\mpr.dll" or Image.Path like r"%\\mprapi.dll" or Image.Path like r"%\\mrmcorer.dll" or Image.Path like r"%\\msacm32.dll" or Image.Path like r"%\\mscms.dll" or Image.Path like r"%\\mscoree.dll" or Image.Path like r"%\\msctf.dll" or Image.Path like r"%\\msctfmonitor.dll" or Image.Path like r"%\\msdrm.dll" or Image.Path like r"%\\msftedit.dll" or Image.Path like r"%\\msi.dll" or Image.Path like r"%\\msutb.dll" or Image.Path like r"%\\mswb7.dll" or Image.Path like r"%\\mswsock.dll" or Image.Path like r"%\\msxml3.dll" or Image.Path like r"%\\mtxclu.dll" or Image.Path like r"%\\napinsp.dll" or Image.Path like r"%\\ncrypt.dll" or Image.Path like r"%\\ndfapi.dll" or Image.Path like r"%\\netid.dll" or Image.Path like r"%\\netiohlp.dll" or Image.Path like r"%\\netplwiz.dll" or Image.Path like r"%\\netprofm.dll" or Image.Path like r"%\\netsetupapi.dll" or Image.Path like r"%\\netshell.dll" or Image.Path like r"%\\netutils.dll" or Image.Path like r"%\\networkexplorer.dll" or Image.Path like r"%\\newdev.dll" or Image.Path like r"%\\ninput.dll" or Image.Path like r"%\\nlaapi.dll" or Image.Path like r"%\\nlansp\_c.dll" or Image.Path like r"%\\npmproxy.dll" or Image.Path like r"%\\nshhttp.dll" or Image.Path like r"%\\nshipsec.dll" or Image.Path like r"%\\nshwfp.dll" or Image.Path like r"%\\ntdsapi.dll" or Image.Path like r"%\\ntlanman.dll" or Image.Path like r"%\\ntlmshared.dll" or Image.Path like r"%\\ntmarta.dll" or Image.Path like r"%\\ntshrui.dll" or Image.Path like r"%\\oleacc.dll" or Image.Path like r"%\\omadmapi.dll" or Image.Path like r"%\\onex.dll" or Image.Path like r"%\\osbaseln.dll" or Image.Path like r"%\\osuninst.dll" or Image.Path like r"%\\p2p.dll" or Image.Path like r"%\\p2pnetsh.dll" or Image.Path like r"%\\p9np.dll" or Image.Path like r"%\\pcaui.dll" or Image.Path like r"%\\pdh.dll" or Image.Path like r"%\\peerdistsh.dll" or Image.Path like r"%\\pla.dll" or Image.Path like r"%\\pnrpnsp.dll" or Image.Path like r"%\\policymanager.dll" or Image.Path like r"%\\polstore.dll" or Image.Path like r"%\\printui.dll" or Image.Path like r"%\\propsys.dll" or Image.Path like r"%\\prvdmofcomp.dll" or Image.Path like r"%\\puiapi.dll" or Image.Path like r"%\\radcui.dll" or Image.Path like r"%\\rasapi32.dll" or Image.Path like r"%\\rasgcw.dll" or Image.Path like r"%\\rasman.dll" or Image.Path like r"%\\rasmontr.dll" or Image.Path like r"%\\reagent.dll" or Image.Path like r"%\\regapi.dll" or Image.Path like r"%\\resutils.dll" or Image.Path like r"%\\rmclient.dll" or Image.Path like r"%\\rpcnsh.dll" or Image.Path like r"%\\rsaenh.dll" or Image.Path like r"%\\rtutils.dll" or Image.Path like r"%\\rtworkq.dll" or Image.Path like r"%\\samcli.dll" or Image.Path like r"%\\samlib.dll" or Image.Path like r"%\\sapi\_onecore.dll" or Image.Path like r"%\\sas.dll" or Image.Path like r"%\\scansetting.dll" or Image.Path like r"%\\scecli.dll" or Image.Path like r"%\\schedcli.dll" or Image.Path like r"%\\secur32.dll" or Image.Path like r"%\\shell32.dll" or Image.Path like r"%\\slc.dll" or Image.Path like r"%\\snmpapi.dll" or Image.Path like r"%\\spp.dll" or Image.Path like r"%\\sppc.dll" or Image.Path like r"%\\srclient.dll" or Image.Path like r"%\\srpapi.dll" or Image.Path like r"%\\srvcli.dll" or Image.Path like r"%\\ssp.exe\_rsaenh.dll" or Image.Path like r"%\\ssp\_isv.exe\_rsaenh.dll" or Image.Path like r"%\\sspicli.dll" or Image.Path like r"%\\ssshim.dll" or Image.Path like r"%\\staterepository.core.dll" or Image.Path like r"%\\structuredquery.dll" or Image.Path like r"%\\sxshared.dll" or Image.Path like r"%\\tapi32.dll" or Image.Path like r"%\\tbs.dll" or Image.Path like r"%\\tdh.dll" or Image.Path like r"%\\tquery.dll" or Image.Path like r"%\\tsworkspace.dll" or Image.Path like r"%\\ttdrecord.dll" or Image.Path like r"%\\twext.dll" or Image.Path like r"%\\twinapi.dll" or Image.Path like r"%\\twinui.appcore.dll" or Image.Path like r"%\\uianimation.dll" or Image.Path like r"%\\uiautomationcore.dll" or Image.Path like r"%\\uireng.dll" or Image.Path like r"%\\uiribbon.dll" or Image.Path like r"%\\updatepolicy.dll" or Image.Path like r"%\\userenv.dll" or Image.Path like r"%\\utildll.dll" or Image.Path like r"%\\uxinit.dll" or Image.Path like r"%\\uxtheme.dll" or Image.Path like r"%\\vaultcli.dll" or Image.Path like r"%\\virtdisk.dll" or Image.Path like r"%\\vssapi.dll" or Image.Path like r"%\\vsstrace.dll" or Image.Path like r"%\\wbemprox.dll" or Image.Path like r"%\\wbemsvc.dll" or Image.Path like r"%\\wcmapi.dll" or Image.Path like r"%\\wcnnetsh.dll" or Image.Path like r"%\\wdi.dll" or Image.Path like r"%\\wdscore.dll" or Image.Path like r"%\\webservices.dll" or Image.Path like r"%\\wecapi.dll" or Image.Path like r"%\\wer.dll" or Image.Path like r"%\\wevtapi.dll" or Image.Path like r"%\\whhelper.dll" or Image.Path like r"%\\wimgapi.dll" or Image.Path like r"%\\winbrand.dll" or Image.Path like r"%\\windows.storage.dll" or Image.Path like r"%\\windows.storage.search.dll" or Image.Path like r"%\\windowscodecs.dll" or Image.Path like r"%\\windowscodecsext.dll" or Image.Path like r"%\\windowsudk.shellcommon.dll" or Image.Path like r"%\\winhttp.dll" or Image.Path like r"%\\wininet.dll" or Image.Path like r"%\\winipsec.dll" or Image.Path like r"%\\winmde.dll" or Image.Path like r"%\\winmm.dll" or Image.Path like r"%\\winnsi.dll" or Image.Path like r"%\\winrnr.dll" or Image.Path like r"%\\winsqlite3.dll" or Image.Path like r"%\\winsta.dll" or Image.Path like r"%\\wkscli.dll" or Image.Path like r"%\\wlanapi.dll" or Image.Path like r"%\\wlancfg.dll" or Image.Path like r"%\\wldp.dll" or Image.Path like r"%\\wlidprov.dll" or Image.Path like r"%\\wmiclnt.dll" or Image.Path like r"%\\wmidcom.dll" or Image.Path like r"%\\wmiutils.dll" or Image.Path like r"%\\wmsgapi.dll" or Image.Path like r"%\\wofutil.dll" or Image.Path like r"%\\wpdshext.dll" or Image.Path like r"%\\wshbth.dll" or Image.Path like r"%\\wshelper.dll" or Image.Path like r"%\\wtsapi32.dll" or Image.Path like r"%\\wwapi.dll" or Image.Path like r"%\\xmllite.dll" or Image.Path like r"%\\xolehlp.dll" or Image.Path like r"%\\xwizards.dll" or Image.Path like r"%\\xwtpw32.dll" or Image.Path like r"%\\aclui.dll" or Image.Path like r"%\\bderepair.dll" or Image.Path like r"%\\bootmenuux.dll" or Image.Path like r"%\\dcntel.dll" or Image.Path like r"%\\dwmcore.dll" or Image.Path like r"%\\dynamoapi.dll" or Image.Path like r"%\\fhsvcctl.dll" or Image.Path like r"%\\fxsst.dll" or Image.Path like r"%\\inproclogger.dll" or Image.Path like r"%\\iumbase.dll" or Image.Path like r"%\\kdstub.dll" or Image.Path like r"%\\maintenanceui.dll" or Image.Path like r"%\\mdmdiagnostics.dll" or Image.Path like r"%\\mintdh.dll" or Image.Path like r"%\\msdtctm.dll" or Image.Path like r"%\\nettrace.dll" or Image.Path like r"%\\osksupport.dll" or Image.Path like r"%\\reseteng.dll" or Image.Path like r"%\\resetengine.dll" or Image.Path like r"%\\spectrumsyncclient.dll" or Image.Path like r"%\\srcore.dll" or Image.Path like r"%\\systemsettingsthresholdadminflowui.dll" or Image.Path like r"%\\timesync.dll" or Image.Path like r"%\\upshared.dll" or Image.Path like r"%\\wmpdui.dll" or Image.Path like r"%\\wwancfg.dll" or Image.Path like r"%\\dpx.dll" or Image.Path like r"%\\fxsapi.dll" or Image.Path like r"%\\fxstiff.dll" or Image.Path like r"%\\xpsservices.dll" or Image.Path like r"%\\appvpolicy.dll" or Image.Path like r"%\\batmeter.dll" or Image.Path like r"%\\bootux.dll" or Image.Path like r"%\\cmutil.dll" or Image.Path like r"%\\configmanager2.dll" or Image.Path like r"%\\coredplus.dll" or Image.Path like r"%\\coreuicomponents.dll" or Image.Path like r"%\\cryptsp.dll" or Image.Path like r"%\\dmcommandlineutils.dll" or Image.Path like r"%\\drvstore.dll" or Image.Path like r"%\\dsprop.dll" or Image.Path like r"%\\dxcore.dll" or Image.Path like r"%\\edgeiso.dll" or Image.Path like r"%\\framedynos.dll" or Image.Path like r"%\\fveskybackup.dll" or Image.Path like r"%\\fvewiz.dll" or Image.Path like r"%\\gpapi.dll" or Image.Path like r"%\\icmp.dll" or Image.Path like r"%\\ifsutil.dll" or Image.Path like r"%\\iumsdk.dll" or Image.Path like r"%\\lockhostingframework.dll" or Image.Path like r"%\\lrwizdll.dll" or Image.Path like r"%\\mbaexmlparser.dll" or Image.Path like r"%\\mfc42u.dll" or Image.Path like r"%\\msiso.dll" or Image.Path like r"%\\msvcp110\_win.dll" or Image.Path like r"%\\netapi32.dll" or Image.Path like r"%\\netjoin.dll" or Image.Path like r"%\\netprovfw.dll" or Image.Path like r"%\\opcservices.dll" or Image.Path like r"%\\pkeyhelper.dll" or Image.Path like r"%\\playsndsrv.dll" or Image.Path like r"%\\powrprof.dll" or Image.Path like r"%\\prntvpt.dll" or Image.Path like r"%\\profapi.dll" or Image.Path like r"%\\proximitycommon.dll" or Image.Path like r"%\\proximityservicepal.dll" or Image.Path like r"%\\rasdlg.dll" or Image.Path like r"%\\security.dll" or Image.Path like r"%\\sppcext.dll" or Image.Path like r"%\\srmtrace.dll" or Image.Path like r"%\\tpmcoreprovisioning.dll" or Image.Path like r"%\\umpdc.dll" or Image.Path like r"%\\unattend.dll" or Image.Path like r"%\\urlmon.dll" or Image.Path like r"%\\vdsutil.dll" or Image.Path like r"%\\version.dll" or Image.Path like r"%\\winbio.dll" or Image.Path like r"%\\windows.ui.immersive.dll" or Image.Path like r"%\\winscard.dll" or Image.Path like r"%\\winsync.dll" or Image.Path like r"%\\wscapi.dll" or Image.Path like r"%\\wsmsvc.dll" or Image.Path like r"%\\FxsCompose.dll" or Image.Path like r"%\\WfsR.dll" or Image.Path like r"%\\rpchttp.dll" or Image.Path like r"%\\storageusage.dll" or Image.Path like r"%\\amsi.dll" or Image.Path like r"%\\PrintIsolationProxy.dll" or Image.Path like r"%\\msdtcVSp1res.dll" or Image.Path like r"%\\rdpendp.dll" or Image.Path like r"%\\dxilconv.dll" or Image.Path like r"%\\utcutil.dll" or Image.Path like r"%\\appraiser.dll" or Image.Path like r"%\\dsound.dll" or Image.Path like r"%\\DispBroker.dll" or Image.Path like r"%\\FXSRESM.DLL" or Image.Path like r"%\\cryptnet.dll" or Image.Path like r"%\\COMRES.DLL" or Image.Path like r"%\\igdumdim64.dll" or Image.Path like r"%\\igd10iumd64.dll" or Image.Path like r"%\\igd12umd64.dll" or Image.Path like r"%\\igdusc64.dll" or Image.Path like r"%\\WLBSCTRL.dll" or Image.Path like r"%\\TSMSISrv.dll" or Image.Path like r"%\\TSVIPSrv.dll" or Image.Path like r"%\\wow64log.dll" or Image.Path like r"%\\WptsExtensions.dll" or Image.Path like r"%\\wbemcomn.dll") and not (((Image.Path like r"C:\\Windows\\System32\\%" or Image.Path like r"C:\\Windows\\SysWOW64\\%" or Image.Path like r"C:\\Windows\\WinSxS\\%" or Image.Path like r"C:\\Windows\\SoftwareDistribution\\%" or Image.Path like r"C:\\Windows\\SystemTemp\\%")) or (Image.Path like r"C:\\Program Files\\Common Files\\microsoft shared\\ClickToRun\\AppVPolicy.dll" and Process.Path like r"C:\\Program Files\\Common Files\\microsoft shared\\ClickToRun\\OfficeClickToRun.exe") or (Image.Path like r"C:\\Packages\\Plugins\\Microsoft.GuestConfiguration.ConfigurationforWindows\\%") or ((Process.Path like r"C:\\Program Files\\WindowsApps\\DellInc.DellSupportAssistforPCs%" or Process.Path like r"C:\\Windows\\System32\\backgroundTaskHost.exe%") and Image.Path like r"C:\\Program Files\\WindowsApps\\DellInc.DellSupportAssistforPCs%") or (Process.Path like r"C:\\Windows\\System32\\cleanmgr.exe" and Image.Path like r"%\\ssshim.dll") or (Process.Path like r"C:\\$WINDOWS.~BT\\%") or (Process.Path like r"C:\\Program Files\\WindowsApps\\DellInc.DellSupportAssistforPCs%" and Process.Path like r"%\\wldp.dll")))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects processes loading modules related to PCRE.NET package
# Author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)
RuleName = PCRE.NET Package Image Load
EventType = Image.Load
Tag = pcre.net-package-image-load
RiskScore = 75
Query = Image.Path like r"%\\AppData\\Local\\Temp\\ba9ea7344a4a5f591d6e5dc32a13494b\\%"
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects the "iscsicpl.exe" UAC bypass technique that leverages a DLL Search Order hijacking technique to load a custom DLL's from temp or a any user controlled location in the users %PATH%
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = UAC Bypass Using Iscsicpl - ImageLoad
EventType = Image.Load
Tag = uac-bypass-using-iscsicpl-imageload
RiskScore = 75
Query = ((Process.Path like r"C:\\Windows\\SysWOW64\\iscsicpl.exe" and Image.Path like r"%\\iscsiexe.dll") and not (Image.Path like r"%C:\\Windows\\%" and Image.Path like r"%iscsiexe.dll%"))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects .NET CLR DLLs being loaded by scripting applications such as wscript or cscript. This could be an indication of potential suspicious execution.
# Author: omkar72, oscd.community
RuleName = DotNet CLR DLL Loaded By Scripting Applications
EventType = Image.Load
Tag = dotnet-clr-dll-loaded-by-scripting-applications
RiskScore = 75
Query = ((Process.Path like r"%\\cmstp.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\msxsl.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\wmic.exe" or Process.Path like r"%\\wscript.exe") and (Image.Path like r"%\\clr.dll" or Image.Path like r"%\\mscoree.dll" or Image.Path like r"%\\mscorlib.dll"))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects potential DLL sideloading of DLLs that are part of the Wazuh security platform
# Author: X__Junior
RuleName = Potential Wazuh Security Platform DLL Sideloading
EventType = Image.Load
Tag = potential-wazuh-security-platform-dll-sideloading
RiskScore = 75
Query = ((Image.Path like r"%\\libwazuhshared.dll" or Image.Path like r"%\\libwinpthread-1.dll") and not ((Image.Path like r"C:\\Program Files (x86)\\ossec-agent\\%" or Image.Path like r"C:\\Program Files\\Inkscape\\bin\\%" or Image.Path like r"C:\\Program Files (x86)\\Pidgin\\%")))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects an image load pattern as seen when a tool named PRIVATELOG is used and rarely observed under legitimate circumstances
# Author: Florian Roth (Nextron Systems)
RuleName = APT PRIVATELOG Image Load Pattern
EventType = Image.Load
Tag = apt-privatelog-image-load-pattern
RiskScore = 75
Query = (Process.Path like r"%\\svchost.exe" and Image.Path like r"%\\clfsw32.dll")
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects abusing Azure Browser SSO by requesting OAuth 2.0 refresh tokens for an Azure-AD-authenticated Windows user (i.e. the machine is joined to Azure AD and a user logs in with their Azure AD account)
# wanting to perform SSO authentication in the browser.
# An attacker can use this to authenticate to Azure AD in a browser as that user.
# Author: Den Iuzvyk
RuleName = Abusing Azure Browser SSO
EventType = Image.Load
Tag = abusing-azure-browser-sso
RiskScore = 75
Query = (Image.Path like r"%MicrosoftAccountTokenProvider.dll" and not ((Process.Path like r"%\\BackgroundTaskHost.exe" or Process.Path like r"%\\devenv.exe" or Process.Path like r"%\\iexplore.exe" or Process.Path like r"%\\MicrosoftEdge.exe" or Process.Path like r"%\\Microsoft\\Edge\\Application\\msedge.exe" or Process.Path like r"%\\AppData\\Local\\Microsoft\\OneDrive\\OneDrive.exe" or Process.Path like r"%\\msedgewebview2.exe" or Process.Path like r"%\\OneDrive.exe") or Process.Path like r"C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\%" or Process.Path == ''))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects cmstp loading "dll" or "ocx" files from suspicious locations
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = DLL Loaded From Suspicious Location Via Cmspt.EXE
EventType = Image.Load
Tag = dll-loaded-from-suspicious-location-via-cmspt.exe
RiskScore = 75
Query = (Process.Path like r"%\\cmstp.exe" and (Image.Path like r"%\\PerfLogs\\%" or Image.Path like r"%\\ProgramData\\%" or Image.Path like r"%\\Users\\%" or Image.Path like r"%\\Windows\\Temp\\%" or Image.Path like r"%C:\\Temp\\%") and (Image.Path like r"%.dll" or Image.Path like r"%.ocx"))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects both of CVE-2022-30190 (Follina) and DogWalk vulnerabilities exploiting msdt.exe binary to load the "sdiageng.dll" library
# Author: Greg (rule)
RuleName = Diagnostic Library Sdiageng.DLL Loaded By Msdt.EXE
EventType = Image.Load
Tag = diagnostic-library-sdiageng.dll-loaded-by-msdt.exe
RiskScore = 75
Query = (Process.Path like r"%\\msdt.exe" and Image.Path like r"%\\sdiageng.dll")
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects potential DLL sideloading of rcdll.dll
# Author: X__Junior
RuleName = Potential Rcdll.DLL Sideloading
EventType = Image.Load
Tag = potential-rcdll.dll-sideloading
RiskScore = 75
Query = (Image.Path like r"%\\rcdll.dll" and not ((Image.Path like r"C:\\Program Files (x86)\\Microsoft Visual Studio\\%" or Image.Path like r"C:\\Program Files (x86)\\Windows Kits\\%")))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects the load of dbghelp/dbgcore DLL (used to make memory dumps) by suspicious processes.
# Tools like ProcessHacker and some attacker tradecraft use MiniDumpWriteDump API found in dbghelp.dll or dbgcore.dll.
# As an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and transfer it over the network back to the attacker's machine.
# Author: Perez Diego (@darkquassar), oscd.community, Ecco
RuleName = Load Of Dbghelp/Dbgcore DLL From Suspicious Process
EventType = Image.Load
Tag = load-of-dbghelp/dbgcore-dll-from-suspicious-process
RiskScore = 75
Query = (((Image.Path like r"%\\dbghelp.dll" or Image.Path like r"%\\dbgcore.dll") and (Process.Path like r"%\\msbuild.exe" or Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\winword.exe" or Process.Path like r"%\\excel.exe" or Process.Path like r"%\\powerpnt.exe" or Process.Path like r"%\\outlook.exe" or Process.Path like r"%\\monitoringhost.exe" or Process.Path like r"%\\wmic.exe" or Process.Path like r"%\\bash.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\dnx.exe" or Process.Path like r"%\\regsvcs.exe" or Process.Path like r"%\\sc.exe" or Process.Path like r"%\\scriptrunner.exe")) and not ((Process.CommandLine like r"C:\\WINDOWS\\winsxs\\%" and Process.CommandLine like r"%\\TiWorker.exe -Embedding")))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects any assembly DLL being loaded by an Office Product
# Author: Antonlovesdnb
RuleName = DotNET DLL Loaded Via Office Applications
EventType = Image.Load
Tag = dotnet-dll-loaded-via-office-applications
RiskScore = 75
Query = ((Process.Path like r"%\\excel.exe" or Process.Path like r"%\\mspub.exe" or Process.Path like r"%\\onenote.exe" or Process.Path like r"%\\onenoteim.exe" or Process.Path like r"%\\outlook.exe" or Process.Path like r"%\\powerpnt.exe" or Process.Path like r"%\\winword.exe") and Image.Path like r"C:\\Windows\\assembly\\%")
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects rundll32 loading a renamed comsvcs.dll to dump process memory
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Renamed Comsvcs DLL Loaded By Rundll32
EventType = Image.Load
Tag = suspicious-renamed-comsvcs-dll-loaded-by-rundll32
RiskScore = 75
Query = ((Process.Path like r"%\\rundll32.exe" and (Image.Hashes like r"%IMPHASH=eed93054cb555f3de70eaa9787f32ebb%" or Image.Hashes like r"%IMPHASH=5e0dbdec1fce52daae251a110b4f309d%" or Image.Hashes like r"%IMPHASH=eadbccbb324829acb5f2bbe87e5549a8%" or Image.Hashes like r"%IMPHASH=407ca0f7b523319d758a40d7c0193699%" or Image.Hashes like r"%IMPHASH=281d618f4e6271e527e6386ea6f748de%")) and not (Image.Path like r"%\\comsvcs.dll"))
GenericProperty1 = Image.Hashes
GenericProperty2 = Image.Path

[ActivityMonitoringRule]
# Detects loading of Microsoft Defender's DLLs by its processes (MpCmdRun and NisSrv) from the non-default directory which may be an attempt to sideload arbitrary DLL
# Author: Bhabesh Raj
RuleName = Microsoft Defender Loading DLL from Nondefault Path
EventType = Image.Load
Tag = microsoft-defender-loading-dll-from-nondefault-path
RiskScore = 75
Query = (((Process.Path like r"%\\MpCmdRun.exe" or Process.Path like r"%\\NisSrv.exe") and Image.Path like r"%\\mpclient.dll") and not ((Image.Path like r"C:\\Program Files\\Windows Defender\\%" or Image.Path like r"C:\\Program Files (x86)\\Windows Defender\\%" or Image.Path like r"C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\%")))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe.
# Author: Ensar Åžamil, @sblmsrsn, @oscd_initiative
RuleName = Time Travel Debugging Utility Usage - Image
EventType = Image.Load
Tag = time-travel-debugging-utility-usage-image
RiskScore = 75
Query = (Image.Path like r"%\\ttdrecord.dll" or Image.Path like r"%\\ttdwriter.dll" or Image.Path like r"%\\ttdloader.dll")
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects Kerberos DLL being loaded by an Office Product
# Author: Antonlovesdnb
RuleName = Active Directory Kerberos DLL Loaded Via Office Applications
EventType = Image.Load
Tag = active-directory-kerberos-dll-loaded-via-office-applications
RiskScore = 75
Query = ((Process.Path like r"%\\excel.exe" or Process.Path like r"%\\mspub.exe" or Process.Path like r"%\\onenote.exe" or Process.Path like r"%\\onenoteim.exe" or Process.Path like r"%\\outlook.exe" or Process.Path like r"%\\powerpnt.exe" or Process.Path like r"%\\winword.exe") and Image.Path like r"%\\kerberos.dll")
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects DLL sideloading of "dbgcore.dll"
# Author: Nasreddine Bencherchali (Nextron Systems), Wietze Beukema (project and research)
RuleName = DLL Sideloading Of DBGCORE.DLL
EventType = Image.Load
Tag = dll-sideloading-of-dbgcore.dll
RiskScore = 75
Query = (Image.Path like r"%\\dbgcore.dll" and not (((Image.Path like r"C:\\Windows\\System32\\%" or Image.Path like r"C:\\Windows\\SysWOW64\\%" or Image.Path like r"C:\\Windows\\WinSxS\\%" or Image.Path like r"C:\\Windows\\SoftwareDistribution\\%" or Image.Path like r"C:\\Windows\\SystemTemp\\%" or Image.Path like r"C:\\Program Files (x86)\\%" or Image.Path like r"C:\\Program Files\\%"))))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects DSParse DLL being loaded by an Office Product
# Author: Antonlovesdnb
RuleName = Active Directory Parsing DLL Loaded Via Office Applications
EventType = Image.Load
Tag = active-directory-parsing-dll-loaded-via-office-applications
RiskScore = 75
Query = ((Process.Path like r"%\\excel.exe" or Process.Path like r"%\\mspub.exe" or Process.Path like r"%\\onenote.exe" or Process.Path like r"%\\onenoteim.exe" or Process.Path like r"%\\outlook.exe" or Process.Path like r"%\\powerpnt.exe" or Process.Path like r"%\\winword.exe") and Image.Path like r"%\\dsparse.dll%")
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects outlvba (Microsoft VBA for Outlook Addin) DLL being loaded by the outlook process
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Microsoft VBA For Outlook Addin Loaded Via Outlook
EventType = Image.Load
Tag = microsoft-vba-for-outlook-addin-loaded-via-outlook
RiskScore = 75
Query = (Process.Path like r"%\\outlook.exe" and Image.Path like r"\\outlvba.dll%")
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects CLR DLL being loaded by an Office Product
# Author: Antonlovesdnb
RuleName = CLR DLL Loaded Via Office Applications
EventType = Image.Load
Tag = clr-dll-loaded-via-office-applications
RiskScore = 75
Query = ((Process.Path like r"%\\excel.exe" or Process.Path like r"%\\mspub.exe" or Process.Path like r"%\\outlook.exe" or Process.Path like r"%\\onenote.exe" or Process.Path like r"%\\onenoteim.exe" or Process.Path like r"%\\powerpnt.exe" or Process.Path like r"%\\winword.exe") and Image.Path like r"%\\clr.dll%")
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects any GAC DLL being loaded by an Office Product
# Author: Antonlovesdnb
RuleName = GAC DLL Loaded Via Office Applications
EventType = Image.Load
Tag = gac-dll-loaded-via-office-applications
RiskScore = 75
Query = ((Process.Path like r"%\\excel.exe" or Process.Path like r"%\\mspub.exe" or Process.Path like r"%\\onenote.exe" or Process.Path like r"%\\onenoteim.exe" or Process.Path like r"%\\outlook.exe" or Process.Path like r"%\\powerpnt.exe" or Process.Path like r"%\\winword.exe") and Image.Path like r"C:\\Windows\\Microsoft.NET\\assembly\\GAC\_MSIL%")
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Attempts to load dismcore.dll after dropping it
# Author: oscd.community, Dmitry Uchakin
RuleName = UAC Bypass With Fake DLL
EventType = Image.Load
Tag = uac-bypass-with-fake-dll
RiskScore = 75
Query = ((Process.Path like r"%\\dism.exe" and Image.Path like r"%\\dismcore.dll") and not (Image.Path like r"C:\\Windows\\System32\\Dism\\dismcore.dll"))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# The Fax service attempts to load ualapi.dll, which is non-existent. An attacker can then (side)load their own malicious DLL using this service.
# Author: NVISO
RuleName = Fax Service DLL Search Order Hijack
EventType = Image.Load
Tag = fax-service-dll-search-order-hijack
RiskScore = 75
Query = ((Process.Path like r"%\\fxssvc.exe" and Image.Path like r"%ualapi.dll") and not (Image.Path like r"C:\\Windows\\WinSxS\\%"))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects DLL sideloading of DLLs that are part of Microsoft Office from non standard location
# Author: Nasreddine Bencherchali (Nextron Systems), Wietze Beukema (project and research)
RuleName = Microsoft Office DLL Sideload
EventType = Image.Load
Tag = microsoft-office-dll-sideload
RiskScore = 75
Query = (Image.Path like r"%\\outllib.dll" and not ((Image.Path like r"C:\\Program Files\\Microsoft Office\\OFFICE%" or Image.Path like r"C:\\Program Files (x86)\\Microsoft Office\\OFFICE%" or Image.Path like r"C:\\Program Files\\Microsoft Office\\Root\\OFFICE%" or Image.Path like r"C:\\Program Files (x86)\\Microsoft Office\\Root\\OFFICE%")))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects the image load of VSS DLL by uncommon executables
# Author: frack113
RuleName = Suspicious Volume Shadow Copy Vsstrace.dll Load
EventType = Image.Load
Tag = suspicious-volume-shadow-copy-vsstrace.dll-load
RiskScore = 75
Query = (Image.Path like r"%\\vsstrace.dll" and not ((Process.Path like r"C:\\Windows\\explorer.exe" or (Process.Path like r"C:\\Windows\\System32\\%" or Process.Path like r"C:\\Windows\\SysWOW64\\%" or Process.Path like r"C:\\Windows\\Temp\\{%" or Process.Path like r"C:\\Windows\\WinSxS\\%")) or ((Process.Path like r"C:\\Program Files\\%" or Process.Path like r"C:\\Program Files (x86)\\%"))))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report
# Author: Bhabesh Raj
RuleName = Pingback Backdoor DLL Loading Activity
EventType = Image.Load
Tag = pingback-backdoor-dll-loading-activity
RiskScore = 75
Query = (Process.Path like r"%\\msdtc.exe" and Image.Path like r"C:\\Windows\\oci.dll")
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects WMI command line event consumers
# Author: Thomas Patzke
RuleName = WMI Persistence - Command Line Event Consumer
EventType = Image.Load
Tag = wmi-persistence-command-line-event-consumer
RiskScore = 75
Query = (Process.Path like r"C:\\Windows\\System32\\wbem\\WmiPrvSE.exe" and Image.Path like r"%\\wbemcons.dll")
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects the image load of VSS DLL by uncommon executables
# Author: frack113
RuleName = Suspicious Volume Shadow Copy Vssapi.dll Load
EventType = Image.Load
Tag = suspicious-volume-shadow-copy-vssapi.dll-load
RiskScore = 75
Query = (Image.Path like r"%\\vssapi.dll" and not ((Process.Path like r"C:\\Windows\\explorer.exe" or (Process.Path like r"C:\\Windows\\System32\\%" or Process.Path like r"C:\\Windows\\SysWOW64\\%" or Process.Path like r"C:\\Windows\\Temp\\{%" or Process.Path like r"C:\\Windows\\WinSxS\\%")) or ((Process.Path like r"C:\\Program Files\\%" or Process.Path like r"C:\\Program Files (x86)\\%")) or (Process.Path like r"C:\\ProgramData\\Package Cache\\%")))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects loading of a DLL by the VMware Xfer utility from the non-default directory which may be an attempt to sideload arbitrary DLL
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential DLL Sideloading Via VMware Xfer
EventType = Image.Load
Tag = potential-dll-sideloading-via-vmware-xfer
RiskScore = 75
Query = ((Process.Path like r"%\\VMwareXferlogs.exe" and Image.Path like r"%\\glib-2.0.dll") and not (Image.Path like r"C:\\Program Files\\VMware\\%"))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects potential DLL sideloading activity via the Aruba Networks Virtual Intranet Access "arubanetsvc.exe" process using DLL Search Order Hijacking
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Aruba Network Service Potential DLL Sideloading
EventType = Image.Load
Tag = aruba-network-service-potential-dll-sideloading
RiskScore = 75
Query = ((Process.Path like r"%\\arubanetsvc.exe" and (Image.Path like r"%\\wtsapi32.dll" or Image.Path like r"%\\msvcr100.dll" or Image.Path like r"%\\msvcp100.dll" or Image.Path like r"%\\dbghelp.dll" or Image.Path like r"%\\dbgcore.dll" or Image.Path like r"%\\wininet.dll" or Image.Path like r"%\\iphlpapi.dll" or Image.Path like r"%\\version.dll" or Image.Path like r"%\\cryptsp.dll" or Image.Path like r"%\\cryptbase.dll" or Image.Path like r"%\\wldp.dll" or Image.Path like r"%\\profapi.dll" or Image.Path like r"%\\sspicli.dll" or Image.Path like r"%\\winsta.dll" or Image.Path like r"%\\dpapi.dll")) and not ((Image.Path like r"C:\\Windows\\System32\\%" or Image.Path like r"C:\\Windows\\SysWOW64\\%" or Image.Path like r"C:\\Windows\\WinSxS\\%")))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects the load of dbghelp/dbgcore DLL (used to make memory dumps) by suspicious processes.
# Tools like ProcessHacker and some attacker tradecract use MiniDumpWriteDump API found in dbghelp.dll or dbgcore.dll.
# As an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and transfer it over the network back to the attacker's machine.
# Author: Perez Diego (@darkquassar), oscd.community, Ecco
RuleName = Suspicious Unsigned Dbghelp/Dbgcore DLL Loaded
EventType = Image.Load
Tag = suspicious-unsigned-dbghelp/dbgcore-dll-loaded
RiskScore = 75
Query = ((Image.Path like r"%\\dbghelp.dll" or Image.Path like r"%\\dbgcore.dll") and Image.IsSigned == "false")
GenericProperty1 = Image.Path
GenericProperty2 = Image.IsSigned

[ActivityMonitoringRule]
# Detects when a system process (ie located in system32, syswow64...etc) loads a DLL from a suspicious location such as %temp%
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = DLL Load By System Process From Suspicious Locations
EventType = Image.Load
Tag = dll-load-by-system-process-from-suspicious-locations
RiskScore = 75
Query = ((Process.Path like r"C:\\Windows\\%" and (Image.Path like r"%\\Users\\Public\\%" or Image.Path like r"%\\Downloads\\%" or Image.Path like r"%\\AppData\\Local\\Temp\\%" or Image.Path like r"%C:\\PerfLogs\\%")) and not ((Process.Path like r"%\\msiexec.exe" or (Image.Path like r"C:\\Program Files\\%" or Image.Path like r"C:\\Program Files (x86)\\%") or (Process.Path like r"C:\\Windows\\SysWOW64\\rundll32.exe" or Process.Path like r"C:\\Windows\\System32\\rundll32.exe") or Process.CommandLine like r"%\\AppData\\Local\\Temp\\%" and Process.CommandLine like r"%\\setup.exe%") or (Process.Path like r"C:\\Windows\\System32\\cleanmgr.exe" and Image.Path like r"%\\ssshim.dll") or (Process.Path like r"C:\\Windows\\Microsoft.NET\\Framework\\v%" and Process.Path like r"%\\mscorsvw.exe" and Image.Path like r"%\\AppData\\Local\\Temp\\%")))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\Windows\System32\wbem\` directory over the network and loading it for a WMI DLL Hijack scenario.
# Author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)
RuleName = Wmiprvse Wbemcomn DLL Hijack
EventType = Image.Load
Tag = wmiprvse-wbemcomn-dll-hijack
RiskScore = 75
Query = (Process.Path like r"%\\wmiprvse.exe" and Image.Path like r"%\\wbem\\wbemcomn.dll")
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects the image load of vss_ps.dll by uncommon executables
# Author: Markus Neis, @markus_neis
RuleName = Suspicious Volume Shadow Copy VSS_PS.dll Load
EventType = Image.Load
Tag = suspicious-volume-shadow-copy-vss_ps.dll-load
RiskScore = 75
Query = (Image.Path like r"%\\vss\_ps.dll" and not ((Process.Path like r"C:\\Windows\\%" and (Process.Path like r"%\\clussvc.exe" or Process.Path like r"%\\dismhost.exe" or Process.Path like r"%\\dllhost.exe" or Process.Path like r"%\\inetsrv\\appcmd.exe" or Process.Path like r"%\\inetsrv\\iissetup.exe" or Process.Path like r"%\\msiexec.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\searchindexer.exe" or Process.Path like r"%\\srtasks.exe" or Process.Path like r"%\\svchost.exe" or Process.Path like r"%\\taskhostw.exe" or Process.Path like r"%\\thor.exe" or Process.Path like r"%\\thor64.exe" or Process.Path like r"%\\tiworker.exe" or Process.Path like r"%\\vssvc.exe" or Process.Path like r"%\\WmiPrvSE.exe")) or ((Process.Path like r"C:\\Program Files\\%" or Process.Path like r"C:\\Program Files (x86)\\%")) or (Process.CommandLine like r"C:\\$WinREAgent\\Scratch\\%" and Process.CommandLine like r"%\\dismhost.exe {%")))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects processes loading the non-existent DLL "ShellChromeAPI". One known example is the "DeviceEnroller" binary in combination with the "PhoneDeepLink" flag tries to load this DLL.
# Adversaries can drop their own renamed DLL and execute it via DeviceEnroller.exe using this parameter
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = DLL Sideloading Of ShellChromeAPI.DLL
EventType = Image.Load
Tag = dll-sideloading-of-shellchromeapi.dll
RiskScore = 75
Query = Image.Path like r"%\\ShellChromeAPI.dll"
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects potential DLL sideloading using comctl32.dll to obtain system privileges
# Author: Nasreddine Bencherchali (Nextron Systems), Subhash Popuri (@pbssubhash)
RuleName = Potential DLL Sideloading Via comctl32.dll
EventType = Image.Load
Tag = potential-dll-sideloading-via-comctl32.dll
RiskScore = 75
Query = ((Image.Path like r"C:\\Windows\\System32\\logonUI.exe.local\\%" or Image.Path like r"C:\\Windows\\System32\\werFault.exe.local\\%" or Image.Path like r"C:\\Windows\\System32\\consent.exe.local\\%" or Image.Path like r"C:\\Windows\\System32\\narrator.exe.local\\%" or Image.Path like r"C:\\windows\\system32\\wermgr.exe.local\\%") and Image.Path like r"%\\comctl32.dll")
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects DLL sideloading of DLLs that are loaded by the SCM for some services (IKE, IKEEXT, SessionEnv) which do not exists on a typical modern system
# IKEEXT and SessionEnv service, as they call LoadLibrary on files that do not exist within C:\Windows\System32\ by default.
# An attacker can place their malicious logic within the PROCESS_ATTACH block of their library and restart the aforementioned services "svchost.exe -k netsvcs" to gain code execution on a remote machine.
# Author: SBousseaden
RuleName = Svchost DLL Search Order Hijack
EventType = Image.Load
Tag = svchost-dll-search-order-hijack
RiskScore = 75
Query = ((Process.Path like r"%\\svchost.exe" and (Image.Path like r"%\\tsmsisrv.dll" or Image.Path like r"%\\tsvipsrv.dll" or Image.Path like r"%\\wlbsctrl.dll")) and not (Image.Path like r"C:\\Windows\\WinSxS\\%"))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects the load of EvtMuteHook.dll, a key component of SharpEvtHook, a tool that tampers with the Windows event logs
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - SharpEvtMute DLL Load
EventType = Image.Load
Tag = hacktool-sharpevtmute-dll-load
RiskScore = 75
Query = (Image.Hashes like r"%IMPHASH=330768A4F172E10ACB6287B87289D83B%" or Image.Hash.IMP == "330768a4f172e10acb6287b87289d83b")
GenericProperty1 = Image.Hashes
GenericProperty2 = Image.Hash.IMP

[ActivityMonitoringRule]
# Detects Loading of samlib.dll, WinSCard.dll from untypical process e.g. through process hollowing by Mimikatz
# Author: Markus Neis
RuleName = Possible Process Hollowing Image Loading
EventType = Image.Load
Tag = possible-process-hollowing-image-loading
RiskScore = 75
Query = (Process.Path like r"%\\notepad.exe" and (Image.Path like r"%\\samlib.dll" or Image.Path like r"%\\WinSCard.dll"))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects suspicious UltraVNC command line flag combination that indicate a auto reconnect upon execution, e.g. startup (as seen being used by Gamaredon threat group)
# Author: Bhabesh Raj
RuleName = Suspicious UltraVNC Execution
EventType = Process.Start
Tag = proc-start-suspicious-ultravnc-execution
RiskScore = 75
Query = (Process.CommandLine like r"%-autoreconnect %" and Process.CommandLine like r"%-connect %" and Process.CommandLine like r"%-id:%")

[ActivityMonitoringRule]
# Detects the execution of the "net use" command to mount a WebDAV server and then immediately execute some content in it. As seen being used in malicious LNK files
# Author: pH-T (Nextron Systems)
RuleName = Suspicious File Execution From Internet Hosted WebDav Share
EventType = Process.Start
Tag = proc-start-suspicious-file-execution-from-internet-hosted-webdav-share
RiskScore = 75
Query = ((Process.Path like r"%\\cmd.exe%" or Process.Name == "Cmd.EXE") and (Process.CommandLine like r"% net use http%" and Process.CommandLine like r"%& start /b %" and Process.CommandLine like r"%\\DavWWWRoot\\%") and (Process.CommandLine like r"%.exe %" or Process.CommandLine like r"%.dll %" or Process.CommandLine like r"%.bat %" or Process.CommandLine like r"%.vbs %" or Process.CommandLine like r"%.ps1 %"))

[ActivityMonitoringRule]
# Detects execution of "reg.exe" commands with the "delete" flag on safe boot registry keys. Often used by attacker to prevent safeboot execution of security products
# Author: Nasreddine Bencherchali (Nextron Systems), Tim Shelton
RuleName = SafeBoot Registry Key Deleted Via Reg.EXE
EventType = Process.Start
Tag = proc-start-safeboot-registry-key-deleted-via-reg.exe
RiskScore = 75
Query = ((Process.Path like r"%reg.exe" or Process.Name == "reg.exe") and (Process.CommandLine like r"% delete %" and Process.CommandLine like r"%\\SYSTEM\\CurrentControlSet\\Control\\SafeBoot%"))

[ActivityMonitoringRule]
# Detects potential psexec command that initiate execution on a remote systems via common commandline flags used by the utility
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential PsExec Remote Execution
EventType = Process.Start
Tag = proc-start-potential-psexec-remote-execution
RiskScore = 75
Query = (Process.CommandLine like r"%accepteula%" and Process.CommandLine like r"% -u %" and Process.CommandLine like r"% -p %" and Process.CommandLine like r"% \\\\\*")

[ActivityMonitoringRule]
# Detects various anomalies in relation to regsvr32.exe
# Author: Florian Roth (Nextron Systems), oscd.community, Tim Shelton
RuleName = Regsvr32 Anomaly
EventType = Process.Start
Tag = proc-start-regsvr32-anomaly
RiskScore = 75
Query = (((Process.Path like r"%\\regsvr32.exe" and Process.CommandLine like r"%\\Temp\\%") or (Process.Path like r"%\\regsvr32.exe" and (Parent.Path like r"%\\powershell.exe" or Parent.Path like r"%\\pwsh.exe" or Parent.Path like r"%\\powershell\_ise.exe")) or (Process.Path like r"%\\regsvr32.exe" and Parent.Path like r"%\\cmd.exe") or (Process.Path like r"%\\regsvr32.exe" and Process.CommandLine like r"%/i:%" and Process.CommandLine like r"%http%" and Process.CommandLine like r"%scrobj.dll") or (Process.Path like r"%\\regsvr32.exe" and Process.CommandLine like r"%/i:%" and Process.CommandLine like r"%ftp%" and Process.CommandLine like r"%scrobj.dll") or ((Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\wscript.exe") and Parent.Path like r"%\\regsvr32.exe") or (Process.Path like r"%\\EXCEL.EXE" and Process.CommandLine like r"%..\\..\\..\\Windows\\System32\\regsvr32.exe %") or (Parent.Path like r"%\\mshta.exe" and Process.Path like r"%\\regsvr32.exe") or (Process.Path like r"%\\regsvr32.exe" and (Process.CommandLine like r"%\\AppData\\Local%" or Process.CommandLine like r"%C:\\Users\\Public%")) or (Process.Path like r"%\\regsvr32.exe" and (Process.CommandLine like r"%.jpg" or Process.CommandLine like r"%.jpeg" or Process.CommandLine like r"%.png" or Process.CommandLine like r"%.gif" or Process.CommandLine like r"%.bin" or Process.CommandLine like r"%.tmp" or Process.CommandLine like r"%.temp" or Process.CommandLine like r"%.txt"))) and not (((Process.CommandLine like r"%\\AppData\\Local\\Microsoft\\Teams%" or Process.CommandLine like r"%\\AppData\\Local\\WebEx\\WebEx64\\Meetings\\atucfobj.dll%")) or (Parent.Path like r"C:\\Program Files\\Box\\Box\\FS\\streem.exe" and Process.CommandLine like r"%\\Program Files\\Box\\Box\\Temp\\%") or (Process.CommandLine like r"%/s C:\\Windows\\System32\\RpcProxy\\RpcProxy.dll")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the execution of the LocalPotato POC based on basic PE metadata information and default CLI examples
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = HackTool - LocalPotato Execution
EventType = Process.Start
Tag = proc-start-hacktool-localpotato-execution
RiskScore = 75
Query = (Process.Path like r"%\\LocalPotato.exe" or (Process.CommandLine like r"%.exe -i C:\\%" and Process.CommandLine like r"%-o Windows\\%") or (Process.Hashes like r"%IMPHASH=E1742EE971D6549E8D4D81115F88F1FC%" or Process.Hashes like r"%IMPHASH=DD82066EFBA94D7556EF582F247C8BB5%") or Process.Hash.IMP in ["E1742EE971D6549E8D4D81115F88F1FC", "DD82066EFBA94D7556EF582F247C8BB5"])
GenericProperty1 = Process.Hashes
GenericProperty2 = Process.Hash.IMP

[ActivityMonitoringRule]
# Detects the use of a renamed SysInternals Sdelete, which is something an administrator shouldn't do (the renaming)
# Author: Florian Roth (Nextron Systems)
RuleName = Renamed Sysinternals Sdelete Execution
EventType = Process.Start
Tag = proc-start-renamed-sysinternals-sdelete-execution
RiskScore = 75
Query = (Process.Name == "sdelete.exe" and not ((Process.Path like r"%\\sdelete.exe" or Process.Path like r"%\\sdelete64.exe")))

[ActivityMonitoringRule]
# Detects the creation of scheduled tasks that involves a temporary folder and runs only once
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Scheduled Task Creation Involving Temp Folder
EventType = Process.Start
Tag = proc-start-suspicious-scheduled-task-creation-involving-temp-folder
RiskScore = 75
Query = (Process.Path like r"%\\schtasks.exe" and Process.CommandLine like r"% /create %" and Process.CommandLine like r"% /sc once %" and Process.CommandLine like r"%\\Temp\\%")

[ActivityMonitoringRule]
# Detects potential process and execution activity related to APT10 Cloud Hopper operation
# Author: Florian Roth (Nextron Systems)
RuleName = Potential APT10 Cloud Hopper Activity
EventType = Process.Start
Tag = proc-start-potential-apt10-cloud-hopper-activity
RiskScore = 75
Query = ((Process.Path like r"%\\cscript.exe" and Process.CommandLine like r"%.vbs /shell %") or (Process.CommandLine like r"%csvde -f C:\\windows\\web\\%" and Process.CommandLine like r"%.log%"))

[ActivityMonitoringRule]
# Detects suspicious children of application launched from inside the WindowsApps directory. This could be a sign of a rogue ".appx" package installation/execution
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Windows App Activity
EventType = Process.Start
Tag = proc-start-suspicious-windows-app-activity
RiskScore = 75
Query = (Parent.Path like r"%C:\\Program Files\\WindowsApps\\%" and ((Process.Path like r"%\\poweshell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\wscript.exe") or (Process.CommandLine like r"%cmd /c%" or Process.CommandLine like r"%Invoke-%" or Process.CommandLine like r"%Base64%")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious starts of explorer.exe that use the /NOUACCHECK flag that allows to run all sub processes of that newly started explorer.exe without any UAC checks
# Author: Florian Roth (Nextron Systems)
RuleName = Explorer NOUACCHECK Flag
EventType = Process.Start
Tag = proc-start-explorer-nouaccheck-flag
RiskScore = 75
Query = ((Process.Path like r"%\\explorer.exe" and Process.CommandLine like r"%/NOUACCHECK%") and not ((Parent.CommandLine like r"C:\\Windows\\system32\\svchost.exe -k netsvcs -p -s Schedule" or Parent.Path like r"C:\\Windows\\System32\\svchost.exe")))
GenericProperty1 = Parent.CommandLine
GenericProperty2 = Parent.Path

[ActivityMonitoringRule]
# Detects AnyDesk Remote Desktop silent installation. Which can be used by attackers to gain remote access.
# Author: JÃ¡n TrenÄanskÃ½
RuleName = Remote Access Tool - AnyDesk Silent Installation
EventType = Process.Start
Tag = proc-start-remote-access-tool-anydesk-silent-installation
RiskScore = 75
Query = (Process.CommandLine like r"%--install%" and Process.CommandLine like r"%--start-with-win%" and Process.CommandLine like r"%--silent%")

[ActivityMonitoringRule]
# Detects Windows command lines that miss a space before or after the /c flag when running a command using the cmd.exe.
# This could be a sign of obfuscation of a fat finger problem (typo by the developer).
# Author: Florian Roth (Nextron Systems)
RuleName = Cmd.EXE Missing Space Characters Execution Anomaly
EventType = Process.Start
Tag = proc-start-cmd.exe-missing-space-characters-execution-anomaly
RiskScore = 75
Query = (((Process.CommandLine like r"%cmd.exe/c%" or Process.CommandLine like r"%\\cmd/c%" or Process.CommandLine like r"%\"cmd/c%" or Process.CommandLine like r"%cmd.exe/k%" or Process.CommandLine like r"%\\cmd/k%" or Process.CommandLine like r"%\"cmd/k%" or Process.CommandLine like r"%cmd.exe/r%" or Process.CommandLine like r"%\\cmd/r%" or Process.CommandLine like r"%\"cmd/r%") or (Process.CommandLine like r"%/cwhoami%" or Process.CommandLine like r"%/cpowershell%" or Process.CommandLine like r"%/cschtasks%" or Process.CommandLine like r"%/cbitsadmin%" or Process.CommandLine like r"%/ccertutil%" or Process.CommandLine like r"%/kwhoami%" or Process.CommandLine like r"%/kpowershell%" or Process.CommandLine like r"%/kschtasks%" or Process.CommandLine like r"%/kbitsadmin%" or Process.CommandLine like r"%/kcertutil%") or (Process.CommandLine like r"%cmd.exe /c%" or Process.CommandLine like r"%cmd /c%" or Process.CommandLine like r"%cmd.exe /k%" or Process.CommandLine like r"%cmd /k%" or Process.CommandLine like r"%cmd.exe /r%" or Process.CommandLine like r"%cmd /r%")) and not (((Process.CommandLine like r"%cmd.exe /c %" or Process.CommandLine like r"%cmd /c %" or Process.CommandLine like r"%cmd.exe /k %" or Process.CommandLine like r"%cmd /k %" or Process.CommandLine like r"%cmd.exe /r %" or Process.CommandLine like r"%cmd /r %")) or (Process.CommandLine like r"%AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\node\_modules%" or Process.CommandLine like r"%cmd.exe/c ." or Process.CommandLine == "cmd.exe /c")))

[ActivityMonitoringRule]
# Detects suspicious PowerShell scripts accessing SAM hives
# Author: Florian Roth (Nextron Systems)
RuleName = PowerShell SAM Copy
EventType = Process.Start
Tag = proc-start-powershell-sam-copy
RiskScore = 75
Query = (Process.CommandLine like r"%\\HarddiskVolumeShadowCopy%" and Process.CommandLine like r"%System32\\config\\sam%" and (Process.CommandLine like r"%Copy-Item%" or Process.CommandLine like r"%cp $\_.%" or Process.CommandLine like r"%cpi $\_.%" or Process.CommandLine like r"%copy $\_.%" or Process.CommandLine like r"%.File]::Copy(%"))

[ActivityMonitoringRule]
# Detects PowerShell process spawning a 'chrome.exe' process with the 'load-extension' flag to start a new chrome instance with custom extensions, as seen being used in 'ChromeLoader'
# Author: Aedan Russell, frack113 (sigma)
RuleName = Powershell ChromeLoader Browser Hijacker
EventType = Process.Start
Tag = proc-start-powershell-chromeloader-browser-hijacker
RiskScore = 75
Query = (Process.Path like r"%\\chrome.exe" and (Parent.Path like r"%\\powershell.exe" or Parent.Path like r"%\\pwsh.exe") and Process.CommandLine like r"%--load-extension=%" and Process.CommandLine like r"%\\AppData\\Local\\%")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious process executions in which Sysmon itself is the parent of a process, which could be a sign of exploitation (e.g. CVE-2022-41120)
# Author: Florian Roth (Nextron Systems), Tim Shelton (fp werfault)
RuleName = Suspicious Sysmon as Execution Parent
EventType = Process.Start
Tag = proc-start-suspicious-sysmon-as-execution-parent
RiskScore = 75
Query = ((Parent.Path like r"%\\Sysmon.exe" or Parent.Path like r"%\\Sysmon64.exe") and not ((Process.Path like r"C:\\Windows\\Sysmon.exe" or Process.Path like r"C:\\Windows\\Sysmon64.exe" or Process.Path like r"C:\\Windows\\System32\\conhost.exe" or Process.Path like r"wevtutil.exe" or Process.Path like r"C:\\WINDOWS\\system32\\wevtutil.exe" or Process.Path like r"C:\\Windows\\System32\\WerFault.exe") or Process.Path like r"%\\AppData\\Local\\Temp\\Sysmon.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects sdiagnhost.exe calling a suspicious child process (e.g. used in exploits for Follina / CVE-2022-30190)
# Author: Nextron Systems
RuleName = Sdiagnhost Calling Suspicious Child Process
EventType = Process.Start
Tag = proc-start-sdiagnhost-calling-suspicious-child-process
RiskScore = 75
Query = (Parent.Path like r"%\\sdiagnhost.exe" and (Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\taskkill.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\calc.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects ScreenConnect program starts that establish a remote access to that system (not meeting, not remote support)
# Author: Florian Roth (Nextron Systems)
RuleName = Remote Access Tool - ScreenConnect Suspicious Execution
EventType = Process.Start
Tag = proc-start-remote-access-tool-screenconnect-suspicious-execution
RiskScore = 75
Query = (Process.CommandLine like r"%e=Access&%" and Process.CommandLine like r"%y=Guest&%" and Process.CommandLine like r"%&p=%" and Process.CommandLine like r"%&c=%" and Process.CommandLine like r"%&k=%")

[ActivityMonitoringRule]
# Detects suspicious scheduled task creations with commands that are uncommon
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Add Scheduled Command Pattern
EventType = Process.Start
Tag = proc-start-suspicious-add-scheduled-command-pattern
RiskScore = 75
Query = ((Process.Path like r"%\\schtasks.exe" and Process.CommandLine like r"%/Create %") and (((Process.CommandLine like r"%/sc minute %" or Process.CommandLine like r"%/ru system %") and (Process.CommandLine like r"%cmd.exe /c %" or Process.CommandLine like r"%cmd /c%" or Process.CommandLine like r"%cmd.exe /k %" or Process.CommandLine like r"%cmd /k%" or Process.CommandLine like r"%cmd.exe /r %" or Process.CommandLine like r"%cmd /r%")) or (Process.CommandLine like r"% bypass %" or Process.CommandLine like r"%.DownloadString%" or Process.CommandLine like r"%.DownloadFile%" or Process.CommandLine like r"%FromBase64String%" or Process.CommandLine like r"% -w hidden %" or Process.CommandLine like r"% IEX%" or Process.CommandLine like r"% -enc %" or Process.CommandLine like r"% -decode %" or Process.CommandLine like r"%/c start /min %" or Process.CommandLine like r"% curl %") or (Process.CommandLine like r"%/xml C:\\Users\\%" and Process.CommandLine like r"%\\AppData\\Local\\%") or (Process.CommandLine like r"%wscript.exe%" and Process.CommandLine like r"%\\AppData\\%")))

[ActivityMonitoringRule]
# Detects a suspicious call to Invoke-WebRequest cmdlet where the and output is located in a suspicious location
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Invoke-WebRequest Usage
EventType = Process.Start
Tag = proc-start-suspicious-invoke-webrequest-usage
RiskScore = 75
Query = ((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\cmd.exe") and (Process.CommandLine like r"%Invoke-WebRequest%" or Process.CommandLine like r"%iwr %" or Process.CommandLine like r"%wget %" or Process.CommandLine like r"%curl %") and (Process.CommandLine like r"% -ur%" or Process.CommandLine like r"% -o%") and (Process.CommandLine like r"%\\AppData\\%" or Process.CommandLine like r"%\\Users\\Public\\%" or Process.CommandLine like r"%\\Temp\\%" or Process.CommandLine like r"%\%AppData\%%" or Process.CommandLine like r"%\%Temp\%%" or Process.CommandLine like r"%\%tmp\%%" or Process.CommandLine like r"%\%Public\%%" or Process.CommandLine like r"%\\Desktop\\%" or Process.CommandLine like r"%C:\\Windows\\%"))

[ActivityMonitoringRule]
# Detects suspicious SSH tunnel port forwarding to a local port
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Port Forwarding Attempt Via SSH
EventType = Process.Start
Tag = proc-start-port-forwarding-attempt-via-ssh
RiskScore = 75
Query = (Process.Path like r"%\\ssh.exe" and Process.CommandLine like r"% -R %")

[ActivityMonitoringRule]
# Detects the creation of taskmgr.exe process in context of LOCAL_SYSTEM
# Author: Florian Roth (Nextron Systems)
RuleName = Taskmgr as LOCAL_SYSTEM
EventType = Process.Start
Tag = proc-start-taskmgr-as-local_system
RiskScore = 75
Query = ((Process.User like r"%AUTHORI%" or Process.User like r"%AUTORI%") and Process.Path like r"%\\taskmgr.exe")
GenericProperty1 = Process.User

[ActivityMonitoringRule]
# Detects the execution of AdvancedRun utility in the context of the TrustedInstaller, SYSTEM, Local Service or Network Service accounts
# Author: Florian Roth (Nextron Systems)
RuleName = PUA - AdvancedRun Suspicious Execution
EventType = Process.Start
Tag = proc-start-pua-advancedrun-suspicious-execution
RiskScore = 75
Query = ((Process.CommandLine like r"%/EXEFilename%" or Process.CommandLine like r"%/CommandLine%") and ((Process.CommandLine like r"% /RunAs 8 %" or Process.CommandLine like r"% /RunAs 4 %" or Process.CommandLine like r"% /RunAs 10 %" or Process.CommandLine like r"% /RunAs 11 %") or (Process.CommandLine like r"%/RunAs 8" or Process.CommandLine like r"%/RunAs 4" or Process.CommandLine like r"%/RunAs 10" or Process.CommandLine like r"%/RunAs 11")))

[ActivityMonitoringRule]
# Detects a "Get-Process" cmdlet and it's aliases on lsass process, which is in almost all cases a sign of malicious activity
# Author: Florian Roth (Nextron Systems)
RuleName = PowerShell Get-Process LSASS
EventType = Process.Start
Tag = proc-start-powershell-get-process-lsass
RiskScore = 75
Query = (Process.CommandLine like r"%Get-Process lsas%" or Process.CommandLine like r"%ps lsas%" or Process.CommandLine like r"%gps lsas%")

[ActivityMonitoringRule]
# Detects the execution of certutil with certain flags that allow the utility to download files from file-sharing websites.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious File Downloaded From File-Sharing Website Via Certutil.EXE
EventType = Process.Start
Tag = proc-start-suspicious-file-downloaded-from-file-sharing-website-via-certutil.exe
RiskScore = 75
Query = ((Process.Path like r"%\\certutil.exe" or Process.Name == "CertUtil.exe") and (Process.CommandLine like r"%urlcache %" or Process.CommandLine like r"%verifyctl %") and (Process.CommandLine like r"%.ghostbin.co/%" or Process.CommandLine like r"%.hastebin.com%" or Process.CommandLine like r"%.paste.ee%" or Process.CommandLine like r"%anonfiles.com%" or Process.CommandLine like r"%cdn.discordapp.com/attachments/%" or Process.CommandLine like r"%ddns.net%" or Process.CommandLine like r"%gist.githubusercontent.com%" or Process.CommandLine like r"%mediafire.com%" or Process.CommandLine like r"%mega.nz%" or Process.CommandLine like r"%paste.ee%" or Process.CommandLine like r"%pastebin.com%" or Process.CommandLine like r"%pastebin.pl%" or Process.CommandLine like r"%pastetext.net%" or Process.CommandLine like r"%privatlab.com%" or Process.CommandLine like r"%privatlab.net%" or Process.CommandLine like r"%raw.githubusercontent.com%" or Process.CommandLine like r"%send.exploit.in%" or Process.CommandLine like r"%sendspace.com%" or Process.CommandLine like r"%storage.googleapis.com%" or Process.CommandLine like r"%transfer.sh%" or Process.CommandLine like r"%ufile.io%"))

[ActivityMonitoringRule]
# Detects the usage of binaries such as 'net', 'sc' or 'powershell' in order to stop, pause or delete critical or important Windows services such as AV, Backup, etc. As seen being used in some ransomware scripts
# Author: Nasreddine Bencherchali (Nextron Systems), frack113
RuleName = Suspicious Windows Service Tampering
EventType = Process.Start
Tag = proc-start-suspicious-windows-service-tampering
RiskScore = 75
Query = ((Process.CommandLine like r"%143Svc%" or Process.CommandLine like r"%Acronis VSS Provider%" or Process.CommandLine like r"%AcronisAgent%" or Process.CommandLine like r"%AcrSch2Svc%" or Process.CommandLine like r"%Antivirus%" or Process.CommandLine like r"%ARSM%" or Process.CommandLine like r"%aswBcc%" or Process.CommandLine like r"%Avast Business Console Client Antivirus Service%" or Process.CommandLine like r"%avast! Antivirus%" or Process.CommandLine like r"%AVG Antivirus%" or Process.CommandLine like r"%avgAdminClient%" or Process.CommandLine like r"%AvgAdminServer%" or Process.CommandLine like r"%AVP1%" or Process.CommandLine like r"%BackupExec%" or Process.CommandLine like r"%bedbg%" or Process.CommandLine like r"%BITS%" or Process.CommandLine like r"%BrokerInfrastructure%" or Process.CommandLine like r"%Client Agent 7.60%" or Process.CommandLine like r"%Core Browsing Protection%" or Process.CommandLine like r"%Core Mail Protection%" or Process.CommandLine like r"%Core Scanning Server%" or Process.CommandLine like r"%DCAgent%" or Process.CommandLine like r"%EhttpSr%" or Process.CommandLine like r"%ekrn%" or Process.CommandLine like r"%Enterprise Client Service%" or Process.CommandLine like r"%epag%" or Process.CommandLine like r"%EPIntegrationService%" or Process.CommandLine like r"%EPProtectedService%" or Process.CommandLine like r"%EPRedline%" or Process.CommandLine like r"%EPSecurityService%" or Process.CommandLine like r"%EPUpdateService%" or Process.CommandLine like r"%EraserSvc11710%" or Process.CommandLine like r"%EsgShKernel%" or Process.CommandLine like r"%ESHASRV%" or Process.CommandLine like r"%FA\_Scheduler%" or Process.CommandLine like r"%FirebirdGuardianDefaultInstance%" or Process.CommandLine like r"%FirebirdServerDefaultInstance%" or Process.CommandLine like r"%HealthTLService%" or Process.CommandLine like r"%HISSQLFDLauncherSSHAREPOINIT%" or Process.CommandLine like r"%hmpalertsvc%" or Process.CommandLine like r"%HMS%" or Process.CommandLine like r"%IISAdmin%" or Process.CommandLine like r"%IMANSVC%" or Process.CommandLine like r"%IMAP4Svc%" or Process.CommandLine like r"%KAVFS%" or Process.CommandLine like r"%KAVFSGT%" or Process.CommandLine like r"%kavfsslp%" or Process.CommandLine like r"%klbackupdisk%" or Process.CommandLine like r"%klbackupflt%" or Process.CommandLine like r"%klflt%" or Process.CommandLine like r"%klhk%" or Process.CommandLine like r"%KLIF%" or Process.CommandLine like r"%klim6%" or Process.CommandLine like r"%klkbdflt%" or Process.CommandLine like r"%klmouflt%" or Process.CommandLine like r"%klnagent%" or Process.CommandLine like r"%klpd%" or Process.CommandLine like r"%kltap%" or Process.CommandLine like r"%KSDE1.0.0%" or Process.CommandLine like r"%LogProcessorService%" or Process.CommandLine like r"%M8EndpointAgent%" or Process.CommandLine like r"%macmnsvc%" or Process.CommandLine like r"%masvc%" or Process.CommandLine like r"%MBAMService%" or Process.CommandLine like r"%MBCloudEA%" or Process.CommandLine like r"%MBEndpointAgent%" or Process.CommandLine like r"%McAfeeDLPAgentService%" or Process.CommandLine like r"%McAfeeEngineService%" or Process.CommandLine like r"%MCAFEEEVENTPARSERSRV%" or Process.CommandLine like r"%McAfeeFramework%" or Process.CommandLine like r"%MCAFEETOMCATSRV530%" or Process.CommandLine like r"%McShield%" or Process.CommandLine like r"%McTaskManager%" or Process.CommandLine like r"%mfefire%" or Process.CommandLine like r"%mfemms%" or Process.CommandLine like r"%mfevto%" or Process.CommandLine like r"%mfevtp%" or Process.CommandLine like r"%mfewc%" or Process.CommandLine like r"%MMS%" or Process.CommandLine like r"%mozyprobackup%" or Process.CommandLine like r"%MsDtsServer%" or Process.CommandLine like r"%MSExchange%" or Process.CommandLine like r"%msftesq1SPROO%" or Process.CommandLine like r"%msftesql$PROD%" or Process.CommandLine like r"%MSOLAP$SQL\_2008%" or Process.CommandLine like r"%MSOLAP$SYSTEM\_BGC%" or Process.CommandLine like r"%MSOLAP$TPS%" or Process.CommandLine like r"%MSOLAP$TPSAMA%" or Process.CommandLine like r"%MSOLAPSTPS%" or Process.CommandLine like r"%MSOLAPSTPSAMA%" or Process.CommandLine like r"%MSSQ!I.SPROFXENGAGEMEHT%" or Process.CommandLine like r"%MSSQ0SHAREPOINT%" or Process.CommandLine like r"%MSSQ0SOPHOS%" or Process.CommandLine like r"%MSSQL%" or Process.CommandLine like r"%MySQL%" or Process.CommandLine like r"%NanoServiceMain%" or Process.CommandLine like r"%NetMsmqActivator%" or Process.CommandLine like r"%ntrtscan%" or Process.CommandLine like r"%ofcservice%" or Process.CommandLine like r"%Online Protection System%" or Process.CommandLine like r"%OracleClientCache80%" or Process.CommandLine like r"%PandaAetherAgent%" or Process.CommandLine like r"%PccNTUpd%" or Process.CommandLine like r"%PDVFSService%" or Process.CommandLine like r"%POP3Svc%" or Process.CommandLine like r"%POVFSService%" or Process.CommandLine like r"%PSUAService%" or Process.CommandLine like r"%Quick Update Service%" or Process.CommandLine like r"%RepairService%" or Process.CommandLine like r"%ReportServer%" or Process.CommandLine like r"%ReportServer$%" or Process.CommandLine like r"%RESvc%" or Process.CommandLine like r"%RpcEptMapper%" or Process.CommandLine like r"%sacsvr%" or Process.CommandLine like r"%SamSs%" or Process.CommandLine like r"%SAVAdminService%" or Process.CommandLine like r"%SAVService%" or Process.CommandLine like r"%ScSecSvc%" or Process.CommandLine like r"%SDRSVC%" or Process.CommandLine like r"%SentinelAgent%" or Process.CommandLine like r"%SentinelHelperService%" or Process.CommandLine like r"%SepMasterService%" or Process.CommandLine like r"%ShMonitor%" or Process.CommandLine like r"%Smcinst%" or Process.CommandLine like r"%SmcService%" or Process.CommandLine like r"%SMTPSvc%" or Process.CommandLine like r"%SNAC%" or Process.CommandLine like r"%SntpService%" or Process.CommandLine like r"%Sophos%" or Process.CommandLine like r"%SQ1SafeOLRService%" or Process.CommandLine like r"%SQL Backups%" or Process.CommandLine like r"%SQL Server%" or Process.CommandLine like r"%SQLAgent%" or Process.CommandLine like r"%SQLBrowser%" or Process.CommandLine like r"%SQLsafe%" or Process.CommandLine like r"%SQLSERVERAGENT%" or Process.CommandLine like r"%SQLTELEMETRY%" or Process.CommandLine like r"%SQLWriter%" or Process.CommandLine like r"%SSISTELEMETRY130%" or Process.CommandLine like r"%SstpSvc%" or Process.CommandLine like r"%svcGenericHost%" or Process.CommandLine like r"%swc\_service%" or Process.CommandLine like r"%swi\_filter%" or Process.CommandLine like r"%swi\_service%" or Process.CommandLine like r"%swi\_update%" or Process.CommandLine like r"%Symantec%" or Process.CommandLine like r"%Telemetryserver%" or Process.CommandLine like r"%ThreatLockerService%" or Process.CommandLine like r"%TMBMServer%" or Process.CommandLine like r"%TmCCSF%" or Process.CommandLine like r"%TmFilter%" or Process.CommandLine like r"%TMiCRCScanService%" or Process.CommandLine like r"%tmlisten%" or Process.CommandLine like r"%TMLWCSService%" or Process.CommandLine like r"%TmPfw%" or Process.CommandLine like r"%TmPreFilter%" or Process.CommandLine like r"%TmProxy%" or Process.CommandLine like r"%TMSmartRelayService%" or Process.CommandLine like r"%tmusa%" or Process.CommandLine like r"%Trend Micro Deep Security Manager%" or Process.CommandLine like r"%TrueKey%" or Process.CommandLine like r"%UI0Detect%" or Process.CommandLine like r"%UTODetect%" or Process.CommandLine like r"%Veeam%" or Process.CommandLine like r"%VeemaDep/oySvc%" or Process.CommandLine like r"%Veritas System Recovery%" or Process.CommandLine like r"%VSApiNt%" or Process.CommandLine like r"%VSS%" or Process.CommandLine like r"%W3Svc%" or Process.CommandLine like r"%wbengine%" or Process.CommandLine like r"%WdNisSvc%" or Process.CommandLine like r"%WeanClOudSve%" or Process.CommandLine like r"%Weems JY%" or Process.CommandLine like r"%WinDefend%" or Process.CommandLine like r"%wozyprobackup%" or Process.CommandLine like r"%WRSVC%" or Process.CommandLine like r"%Zoolz 2 Service%") and ((((Process.Name in ["net.exe", "net1.exe"] or (Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe")) and Process.CommandLine like r"% stop %") or ((Process.Name in ["PowerShell.EXE", "pwsh.dll"] or (Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe")) and (Process.CommandLine like r"%Stop-Service %" or Process.CommandLine like r"%Remove-Service %"))) or ((Process.Name == "sc.exe" or Process.Path like r"%\\sc.exe") and (Process.CommandLine like r"% stop %" or Process.CommandLine like r"% delete %" or Process.CommandLine like r"% pause %"))))

[ActivityMonitoringRule]
# Detects when the Console Window Host (conhost.exe) process is spawned by a suspicious parent process, which could be indicative of code injection.
# Author: Tim Rauch
RuleName = Conhost Spawned By Suspicious Parent Process
EventType = Process.Start
Tag = proc-start-conhost-spawned-by-suspicious-parent-process
RiskScore = 75
Query = ((Process.Path like r"%\\conhost.exe" and (Parent.Path like r"%\\svchost.exe" or Parent.Path like r"%\\lsass.exe" or Parent.Path like r"%\\services.exe" or Parent.Path like r"%\\smss.exe" or Parent.Path like r"%\\winlogon.exe" or Parent.Path like r"%\\explorer.exe" or Parent.Path like r"%\\rundll32.exe" or Parent.Path like r"%\\regsvr32.exe" or Parent.Path like r"%\\userinit.exe" or Parent.Path like r"%\\wininit.exe" or Parent.Path like r"%\\spoolsv.exe")) and not ((Parent.CommandLine like r"%-k apphost -s AppHostSvc%" or Parent.CommandLine like r"%-k imgsvc%" or Parent.CommandLine like r"%-k localService -p -s RemoteRegistry%" or Parent.CommandLine like r"%-k LocalSystemNetworkRestricted -p -s NgcSvc%" or Parent.CommandLine like r"%-k NetSvcs -p -s NcaSvc%" or Parent.CommandLine like r"%-k netsvcs -p -s NetSetupSvc%" or Parent.CommandLine like r"%-k netsvcs -p -s wlidsvc%" or Parent.CommandLine like r"%-k NetworkService -p -s DoSvc%" or Parent.CommandLine like r"%-k wsappx -p -s AppXSvc%" or Parent.CommandLine like r"%-k wsappx -p -s ClipSVC%" or Parent.CommandLine like r"%C:\\Program Files (x86)\\Dropbox\\Client\\%" or Parent.CommandLine like r"%C:\\Program Files\\Dropbox\\Client\\%")))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects the execution of a renamed "Msdt.exe" binary
# Author: pH-T (Nextron Systems)
RuleName = Renamed Msdt.EXE Execution
EventType = Process.Start
Tag = proc-start-renamed-msdt.exe-execution
RiskScore = 75
Query = (Process.Name == "msdt.exe" and not (Process.Path like r"%\\msdt.exe"))

[ActivityMonitoringRule]
# Detects potential tampering with Windows Defender settings such as adding exclusion using wmic
# Author: frack113
RuleName = Potential Windows Defender Tampering Via Wmic.EXE
EventType = Process.Start
Tag = proc-start-potential-windows-defender-tampering-via-wmic.exe
RiskScore = 75
Query = ((Process.Name == "wmic.exe" or Process.Path like r"%\\WMIC.exe") and Process.CommandLine like r"%/Namespace:\\\\root\\Microsoft\\Windows\\Defender%")

[ActivityMonitoringRule]
# Detects the execution of Sysinternals ADExplorer with the "-snapshot" flag in order to save a local copy of the active directory database to a suspicious directory.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Active Directory Database Snapshot Via ADExplorer
EventType = Process.Start
Tag = proc-start-suspicious-active-directory-database-snapshot-via-adexplorer
RiskScore = 75
Query = ((Process.Path like r"%\\ADExplorer.exe" or Process.Name == "AdExp") and Process.CommandLine like r"%snapshot%" and (Process.CommandLine like r"%\\Downloads\\%" or Process.CommandLine like r"%\\Users\\Public\\%" or Process.CommandLine like r"%\\AppData\\%" or Process.CommandLine like r"%\\Windows\\Temp\\%"))

[ActivityMonitoringRule]
# Detects suspicious DACL modifications via the "Set-Service" cmdlet using the "SecurityDescriptorSddl" flag (Only available with PowerShell 7) that can be used to hide services or make them unstopable
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Service DACL Modification Via Set-Service Cmdlet
EventType = Process.Start
Tag = proc-start-suspicious-service-dacl-modification-via-set-service-cmdlet
RiskScore = 75
Query = ((Process.Path like r"%\\pwsh.exe" or Process.Name == "pwsh.dll") and (Process.CommandLine like r"%-SecurityDescriptorSddl %" or Process.CommandLine like r"%-sd %") and (Process.CommandLine like r"%Set-Service %" and Process.CommandLine like r"%D;;%" and (Process.CommandLine like r"%;;;IU%" or Process.CommandLine like r"%;;;SU%" or Process.CommandLine like r"%;;;BA%" or Process.CommandLine like r"%;;;SY%" or Process.CommandLine like r"%;;;WD%")))

[ActivityMonitoringRule]
# Detects the export of a crital Registry key to a file.
# Author: Oddvar Moe, Sander Wiebing, oscd.community
RuleName = Exports Critical Registry Keys To a File
EventType = Process.Start
Tag = proc-start-exports-critical-registry-keys-to-a-file
RiskScore = 75
Query = ((Process.Path like r"%\\regedit.exe" or Process.Name == "REGEDIT.EXE") and (Process.CommandLine like r"% /E %" or Process.CommandLine like r"% -E %") and (Process.CommandLine like r"%hklm%" or Process.CommandLine like r"%hkey\_local\_machine%") and (Process.CommandLine like r"%\\system" or Process.CommandLine like r"%\\sam" or Process.CommandLine like r"%\\security"))

[ActivityMonitoringRule]
# Detects active directory enumeration activity using known AdFind CLI flags
# Author: frack113
RuleName = PUA - Suspicious ActiveDirectory Enumeration Via AdFind.EXE
EventType = Process.Start
Tag = proc-start-pua-suspicious-activedirectory-enumeration-via-adfind.exe
RiskScore = 75
Query = ((Process.CommandLine like r"%lockoutduration%" or Process.CommandLine like r"%lockoutthreshold%" or Process.CommandLine like r"%lockoutobservationwindow%" or Process.CommandLine like r"%maxpwdage%" or Process.CommandLine like r"%minpwdage%" or Process.CommandLine like r"%minpwdlength%" or Process.CommandLine like r"%pwdhistorylength%" or Process.CommandLine like r"%pwdproperties%") or Process.CommandLine like r"%-sc admincountdmp%" or Process.CommandLine like r"%-sc exchaddresses%")

[ActivityMonitoringRule]
# Detects usage of the "FromBase64String" function in the commandline which is used to decode a base64 encoded string
# Author: Florian Roth (Nextron Systems)
RuleName = Base64 Encoded PowerShell Command Detected
EventType = Process.Start
Tag = proc-start-base64-encoded-powershell-command-detected
RiskScore = 75
Query = Process.CommandLine like r"%::FromBase64String(%"

[ActivityMonitoringRule]
# Detects suspicious shell spawn from Java utility keytool process (e.g. adselfservice plus exploitation)
# Author: Andreas Hunkeler (@Karneades)
RuleName = Suspicious Shells Spawn by Java Utility Keytool
EventType = Process.Start
Tag = proc-start-suspicious-shells-spawn-by-java-utility-keytool
RiskScore = 75
Query = (Parent.Path like r"%\\keytool.exe" and (Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\sh.exe" or Process.Path like r"%\\bash.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\certutil.exe" or Process.Path like r"%\\whoami.exe" or Process.Path like r"%\\bitsadmin.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\scrcons.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\hh.exe" or Process.Path like r"%\\wmic.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\forfiles.exe" or Process.Path like r"%\\scriptrunner.exe" or Process.Path like r"%\\mftrace.exe" or Process.Path like r"%\\AppVLP.exe" or Process.Path like r"%\\systeminfo.exe" or Process.Path like r"%\\reg.exe" or Process.Path like r"%\\query.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the use of NirCmd tool for command execution as SYSTEM user
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleName = PUA - NirCmd Execution As LOCAL SYSTEM
EventType = Process.Start
Tag = proc-start-pua-nircmd-execution-as-local-system
RiskScore = 75
Query = Process.CommandLine like r"% runassystem %"

[ActivityMonitoringRule]
# Detects actions caused by the RedMimicry Winnti playbook a automated breach emulations utility
# Author: Alexander Rausch
RuleName = HackTool - RedMimicry Winnti Playbook Execution
EventType = Process.Start
Tag = proc-start-hacktool-redmimicry-winnti-playbook-execution
RiskScore = 75
Query = ((Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\cmd.exe") and (Process.CommandLine like r"%gthread-3.6.dll%" or Process.CommandLine like r"%\\Windows\\Temp\\tmp.bat%" or Process.CommandLine like r"%sigcmm-2.4.dll%"))

[ActivityMonitoringRule]
# Detects Ryuk ransomware activity
# Author: Florian Roth (Nextron Systems), Vasiliy Burov, Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential Ryuk Ransomware Activity
EventType = Process.Start
Tag = proc-start-potential-ryuk-ransomware-activity
RiskScore = 75
Query = ((Process.CommandLine like r"%Microsoft\\Windows\\CurrentVersion\\Run%" and Process.CommandLine like r"%C:\\users\\Public\\%") or (Process.CommandLine like r"%del /s /f /q c:\\%" and Process.CommandLine like r"%\*.bac%" and Process.CommandLine like r"%\*.bak%" and Process.CommandLine like r"%\*.bkf%") or ((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") and Process.CommandLine like r"% stop %" and Process.CommandLine like r"% /y%" and (Process.CommandLine like r"%samss%" or Process.CommandLine like r"%audioendpointbuilder%" or Process.CommandLine like r"%unistoresvc\_%" or Process.CommandLine like r"%AcrSch2Svc%")))

[ActivityMonitoringRule]
# Detects activity that could be related to Baby Shark malware
# Author: Florian Roth (Nextron Systems)
RuleName = Potential Baby Shark Malware Activity
EventType = Process.Start
Tag = proc-start-potential-baby-shark-malware-activity
RiskScore = 75
Query = ((Process.CommandLine like r"%powershell.exe mshta.exe http%" and Process.CommandLine like r"%.hta%") or (Process.CommandLine like r"%reg query \"HKEY\_CURRENT\_USER\\Software\\Microsoft\\Terminal Server Client\\Default\"%" or Process.CommandLine like r"%cmd.exe /c taskkill /im cmd.exe%" or Process.CommandLine like r"%(New-Object System.Net.WebClient).UploadFile('http%"))

[ActivityMonitoringRule]
# Threat actors can use auditpol binary to change audit policy configuration to impair detection capability.
# This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.
# Author: Janantha Marasinghe (https://github.com/blueteam0ps)
RuleName = Audit Policy Tampering Via Auditpol
EventType = Process.Start
Tag = proc-start-audit-policy-tampering-via-auditpol
RiskScore = 75
Query = ((Process.Path like r"%\\auditpol.exe" or Process.Name == "AUDITPOL.EXE") and (Process.CommandLine like r"%disable%" or Process.CommandLine like r"%clear%" or Process.CommandLine like r"%remove%" or Process.CommandLine like r"%restore%"))

[ActivityMonitoringRule]
# Detects execution of "reg.exe" commands with the "add" or "copy" flags on safe boot registry keys. Often used by attacker to allow the ransomware to work in safe mode as some security products do not
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Add SafeBoot Keys Via Reg Utility
EventType = Process.Start
Tag = proc-start-add-safeboot-keys-via-reg-utility
RiskScore = 75
Query = ((Process.Path like r"%reg.exe" or Process.Name == "reg.exe") and Process.CommandLine like r"%\\SYSTEM\\CurrentControlSet\\Control\\SafeBoot%" and (Process.CommandLine like r"% copy %" or Process.CommandLine like r"% add %"))

[ActivityMonitoringRule]
# Detects TropicTrooper activity, an actor who targeted high-profile organizations in the energy and food and beverage sectors in Asia
# Author: @41thexplorer, Microsoft Defender ATP
RuleName = TropicTrooper Campaign November 2018
EventType = Process.Start
Tag = proc-start-tropictrooper-campaign-november-2018
RiskScore = 75
Query = Process.CommandLine like r"%abCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCc%"

[ActivityMonitoringRule]
# Detects the registration of a debugger for a program that is available in the logon screen (sticky key backdoor).
# Author: Florian Roth (Nextron Systems), oscd.community, Jonhnathan Ribeiro
RuleName = Suspicious Debugger Registration Cmdline
EventType = Process.Start
Tag = proc-start-suspicious-debugger-registration-cmdline
RiskScore = 75
Query = (Process.CommandLine like r"%\\CurrentVersion\\Image File Execution Options\\%" and (Process.CommandLine like r"%sethc.exe%" or Process.CommandLine like r"%utilman.exe%" or Process.CommandLine like r"%osk.exe%" or Process.CommandLine like r"%magnify.exe%" or Process.CommandLine like r"%narrator.exe%" or Process.CommandLine like r"%displayswitch.exe%" or Process.CommandLine like r"%atbroker.exe%" or Process.CommandLine like r"%HelpPane.exe%"))

[ActivityMonitoringRule]
# Detects potential exploitation of CVE-2021-40444 via suspicious process patterns seen in in-the-wild exploitations
# Author: Florian Roth (Nextron Systems), @neonprimetime
RuleName = Potential CVE-2021-40444 Exploitation Attempt
EventType = Process.Start
Tag = proc-start-potential-cve-2021-40444-exploitation-attempt
RiskScore = 75
Query = ((Process.Path like r"%\\control.exe" and (Parent.Path like r"%\\winword.exe" or Parent.Path like r"%\\powerpnt.exe" or Parent.Path like r"%\\excel.exe")) and not ((Process.CommandLine like r"%\\control.exe input.dll" or Process.CommandLine like r"%\\control.exe\" input.dll")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious shell spawned from Java host process (e.g. log4j exploitation)
# Author: Andreas Hunkeler (@Karneades), Florian Roth
RuleName = Suspicious Shells Spawned by Java
EventType = Process.Start
Tag = proc-start-suspicious-shells-spawned-by-java
RiskScore = 75
Query = (Parent.Path like r"%\\java.exe" and (Process.Path like r"%\\sh.exe" or Process.Path like r"%\\bash.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\certutil.exe" or Process.Path like r"%\\whoami.exe" or Process.Path like r"%\\bitsadmin.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\scrcons.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\hh.exe" or Process.Path like r"%\\wmic.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\forfiles.exe" or Process.Path like r"%\\scriptrunner.exe" or Process.Path like r"%\\mftrace.exe" or Process.Path like r"%\\AppVLP.exe" or Process.Path like r"%\\curl.exe" or Process.Path like r"%\\systeminfo.exe" or Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe" or Process.Path like r"%\\reg.exe" or Process.Path like r"%\\query.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects a suspicious process pattern which could be a sign of an exploited Serv-U service
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Serv-U Process Pattern
EventType = Process.Start
Tag = proc-start-suspicious-serv-u-process-pattern
RiskScore = 75
Query = (Parent.Path like r"%\\Serv-U.exe" and (Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\sh.exe" or Process.Path like r"%\\bash.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\wmic.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\msiexec.exe" or Process.Path like r"%\\forfiles.exe" or Process.Path like r"%\\scriptrunner.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects potential PowerShell execution from a DLL instead of the usual PowerShell process as seen used in PowerShdll
# Author: Markus Neis, Nasreddine Bencherchali
RuleName = Potential PowerShell Execution Via DLL
EventType = Process.Start
Tag = proc-start-potential-powershell-execution-via-dll
RiskScore = 75
Query = (((Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\regsvcs.exe" or Process.Path like r"%\\InstallUtil.exe" or Process.Path like r"%\\regasm.exe") or Process.Name in ["RUNDLL32.EXE", "RegSvcs.exe", "InstallUtil.exe", "RegAsm.exe"]) and (Process.CommandLine like r"%Default.GetString%" or Process.CommandLine like r"%FromBase64String%" or Process.CommandLine like r"%Invoke-Expression%" or Process.CommandLine like r"%IEX %" or Process.CommandLine like r"%Invoke-Command%" or Process.CommandLine like r"%ICM %" or Process.CommandLine like r"%DownloadString%"))

[ActivityMonitoringRule]
# Detects spawning of suspicious child processes by Atlassian Confluence server which may indicate successful exploitation of CVE-2021-26084
# Author: Bhabesh Raj
RuleName = Potential Atlassian Confluence CVE-2021-26084 Exploitation Attempt
EventType = Process.Start
Tag = proc-start-potential-atlassian-confluence-cve-2021-26084-exploitation-attempt
RiskScore = 75
Query = (Parent.Path like r"%\\Atlassian\\Confluence\\jre\\bin\\java.exe" and (Process.CommandLine like r"%certutil%" or Process.CommandLine like r"%cmd /c%" or Process.CommandLine like r"%cmd /k%" or Process.CommandLine like r"%cscript%" or Process.CommandLine like r"%curl%" or Process.CommandLine like r"%ipconfig%" or Process.CommandLine like r"%powershell%" or Process.CommandLine like r"%pwsh%" or Process.CommandLine like r"%regsvr32%" or Process.CommandLine like r"%rundll32%" or Process.CommandLine like r"%whoami%" or Process.CommandLine like r"%wscript%"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the use of WinAPI Functions via the commandline. As seen used by threat actors via the tool winapiexec
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential WinAPI Calls Via CommandLine
EventType = Process.Start
Tag = proc-start-potential-winapi-calls-via-commandline
RiskScore = 75
Query = ((Process.CommandLine like r"%AddSecurityPackage%" or Process.CommandLine like r"%AdjustTokenPrivileges%" or Process.CommandLine like r"%Advapi32%" or Process.CommandLine like r"%CloseHandle%" or Process.CommandLine like r"%CreateProcessWithToken%" or Process.CommandLine like r"%CreatePseudoConsole%" or Process.CommandLine like r"%CreateRemoteThread%" or Process.CommandLine like r"%CreateThread%" or Process.CommandLine like r"%CreateUserThread%" or Process.CommandLine like r"%DangerousGetHandle%" or Process.CommandLine like r"%DuplicateTokenEx%" or Process.CommandLine like r"%EnumerateSecurityPackages%" or Process.CommandLine like r"%FreeHGlobal%" or Process.CommandLine like r"%FreeLibrary%" or Process.CommandLine like r"%GetDelegateForFunctionPointer%" or Process.CommandLine like r"%GetLogonSessionData%" or Process.CommandLine like r"%GetModuleHandle%" or Process.CommandLine like r"%GetProcAddress%" or Process.CommandLine like r"%GetProcessHandle%" or Process.CommandLine like r"%GetTokenInformation%" or Process.CommandLine like r"%ImpersonateLoggedOnUser%" or Process.CommandLine like r"%kernel32%" or Process.CommandLine like r"%LoadLibrary%" or Process.CommandLine like r"%memcpy%" or Process.CommandLine like r"%MiniDumpWriteDump%" or Process.CommandLine like r"%ntdll%" or Process.CommandLine like r"%OpenDesktop%" or Process.CommandLine like r"%OpenProcess%" or Process.CommandLine like r"%OpenProcessToken%" or Process.CommandLine like r"%OpenThreadToken%" or Process.CommandLine like r"%OpenWindowStation%" or Process.CommandLine like r"%PtrToString%" or Process.CommandLine like r"%QueueUserApc%" or Process.CommandLine like r"%ReadProcessMemory%" or Process.CommandLine like r"%RevertToSelf%" or Process.CommandLine like r"%RtlCreateUserThread%" or Process.CommandLine like r"%secur32%" or Process.CommandLine like r"%SetThreadToken%" or Process.CommandLine like r"%VirtualAlloc%" or Process.CommandLine like r"%VirtualFree%" or Process.CommandLine like r"%VirtualProtect%" or Process.CommandLine like r"%WaitForSingleObject%" or Process.CommandLine like r"%WriteInt32%" or Process.CommandLine like r"%WriteProcessMemory%" or Process.CommandLine like r"%ZeroFreeGlobalAllocUnicode%") and not ((Process.Path like r"%\\MpCmdRun.exe" and Process.CommandLine like r"%GetLoadLibraryWAddress32%")))

[ActivityMonitoringRule]
# Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Control Panel DLL Load
EventType = Process.Start
Tag = proc-start-suspicious-control-panel-dll-load
RiskScore = 75
Query = ((Parent.Path like r"%\\System32\\control.exe" and (Process.Path like r"%\\rundll32.exe" or Process.Name == "RUNDLL32.EXE")) and not (Process.CommandLine like r"%Shell32.dll%"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects AdFind execution with common flags seen used during attacks
# Author: Janantha Marasinghe (https://github.com/blueteam0ps), FPT.EagleEye Team, omkar72, oscd.community
RuleName = PUA - AdFind Suspicious Execution
EventType = Process.Start
Tag = proc-start-pua-adfind-suspicious-execution
RiskScore = 75
Query = (Process.CommandLine like r"%domainlist%" or Process.CommandLine like r"%trustdmp%" or Process.CommandLine like r"%dcmodes%" or Process.CommandLine like r"%adinfo%" or Process.CommandLine like r"% dclist %" or Process.CommandLine like r"%computer\_pwdnotreqd%" or Process.CommandLine like r"%objectcategory=%" or Process.CommandLine like r"%-subnets -f%" or Process.CommandLine like r"%name=\"Domain Admins\"%" or Process.CommandLine like r"%-sc u:%" or Process.CommandLine like r"%domainncs%" or Process.CommandLine like r"%dompol%" or Process.CommandLine like r"% oudmp %" or Process.CommandLine like r"%subnetdmp%" or Process.CommandLine like r"%gpodmp%" or Process.CommandLine like r"%fspdmp%" or Process.CommandLine like r"%users\_noexpire%" or Process.CommandLine like r"%computers\_active%" or Process.CommandLine like r"%computers\_pwdnotreqd%")

[ActivityMonitoringRule]
# Detects python spawning a pretty tty
# Author: Nextron Systems
RuleName = Python Spawning Pretty TTY on Windows
EventType = Process.Start
Tag = proc-start-python-spawning-pretty-tty-on-windows
RiskScore = 75
Query = ((Process.Path like r"%python.exe" or Process.Path like r"%python3.exe" or Process.Path like r"%python2.exe") and ((Process.CommandLine like r"%import pty%" and Process.CommandLine like r"%.spawn(%") or Process.CommandLine like r"%from pty import spawn%"))

[ActivityMonitoringRule]
# Detects suspicious aged finger.exe tool execution often used in malware attacks nowadays
# Author: Florian Roth (Nextron Systems), omkar72, oscd.community
RuleName = Finger.exe Suspicious Invocation
EventType = Process.Start
Tag = proc-start-finger.exe-suspicious-invocation
RiskScore = 75
Query = (Process.Name == "finger.exe" or Process.Path like r"%\\finger.exe")

[ActivityMonitoringRule]
# Detects Obfuscated Powershell via use MSHTA in Scripts
# Author: Nikita Nazarov, oscd.community
RuleName = Invoke-Obfuscation Via Use MSHTA
EventType = Process.Start
Tag = proc-start-invoke-obfuscation-via-use-mshta
RiskScore = 75
Query = (Process.CommandLine like r"%set%" and Process.CommandLine like r"%&&%" and Process.CommandLine like r"%mshta%" and Process.CommandLine like r"%vbscript:createobject%" and Process.CommandLine like r"%.run%" and Process.CommandLine like r"%(window.close)%")

[ActivityMonitoringRule]
# Detects use of aspnet_regiis to decrypt Microsoft IIS connection strings. An attacker with Microsoft IIS web server access via a webshell or alike can decrypt and dump any hardcoded connection strings, such as the MSSQL service account password using aspnet_regiis command.
# Author: Tim Rauch
RuleName = Microsoft IIS Connection Strings Decryption
EventType = Process.Start
Tag = proc-start-microsoft-iis-connection-strings-decryption
RiskScore = 75
Query = ((Process.Path like r"%\\aspnet\_regiis.exe" or Process.Name like r"aspnet\_regiis.exe") and (Process.CommandLine like r"%connectionStrings%" and Process.CommandLine like r"% -pdf%"))

[ActivityMonitoringRule]
# Detects various indicators of Microsoft Connection Manager Profile Installer execution
# Author: Nik Seetharaman
RuleName = CMSTP Execution Process Creation
EventType = Process.Start
Tag = proc-start-cmstp-execution-process-creation
RiskScore = 75
Query = Parent.Path like r"%\\cmstp.exe"
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the execution of msiexec.exe from an uncommon directory
# Author: Florian Roth (Nextron Systems)
RuleName = Potential MsiExec Masquerading
EventType = Process.Start
Tag = proc-start-potential-msiexec-masquerading
RiskScore = 75
Query = ((Process.Path like r"%\\msiexec.exe" or Process.Name like r"\\msiexec.exe") and not ((Process.Path like r"C:\\Windows\\System32\\%" or Process.Path like r"C:\\Windows\\SysWOW64\\%" or Process.Path like r"C:\\Windows\\WinSxS\\%")))

[ActivityMonitoringRule]
# Detects when a user installs certificates by using CertOC.exe to load the target DLL file.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious DLL Loaded via CertOC.EXE
EventType = Process.Start
Tag = proc-start-suspicious-dll-loaded-via-certoc.exe
RiskScore = 75
Query = ((Process.Path like r"%\\certoc.exe" or Process.Name == "CertOC.exe") and (Process.CommandLine like r"% -LoadDLL %" or Process.CommandLine like r"% /LoadDLL %") and (Process.CommandLine like r"%\\Appdata\\Local\\Temp\\%" or Process.CommandLine like r"%\\Desktop\\%" or Process.CommandLine like r"%\\Downloads\\%" or Process.CommandLine like r"%\\Users\\Public\\%" or Process.CommandLine like r"%C:\\Windows\\Tasks\\%" or Process.CommandLine like r"%C:\\Windows\\Temp\\%"))

[ActivityMonitoringRule]
# Detects findstring commands that include the keyword lsass, which indicates recon actviity for the LSASS process PID
# Author: Florian Roth (Nextron Systems)
RuleName = Findstr LSASS
EventType = Process.Start
Tag = proc-start-findstr-lsass
RiskScore = 75
Query = (((Process.Path like r"%\\findstr.exe" or Process.Name == "FINDSTR.EXE") and Process.CommandLine like r"%lsass%") or (Process.CommandLine like r"% /i lsass.exe%" or Process.CommandLine like r"% /i \"lsass%" or Process.CommandLine like r"%findstr lsass%" or Process.CommandLine like r"%findstr.exe lsass%" or Process.CommandLine like r"%findstr \"lsass%" or Process.CommandLine like r"%findstr.exe \"lsass%"))

[ActivityMonitoringRule]
# Detects the installation of a DNS plugin DLL via ServerLevelPluginDll parameter in registry, which can be used to execute code in context of the DNS server (restart required)
# Author: Florian Roth (Nextron Systems)
RuleName = New DNS ServerLevelPluginDll Installed Via Dnscmd.EXE
EventType = Process.Start
Tag = proc-start-new-dns-serverlevelplugindll-installed-via-dnscmd.exe
RiskScore = 75
Query = (Process.Path like r"%\\dnscmd.exe" and Process.CommandLine like r"%/config%" and Process.CommandLine like r"%/serverlevelplugindll%")

[ActivityMonitoringRule]
# Detects usage of a base64 encoded "FromBase64String" cmdlet in a process command line
# Author: Florian Roth (Nextron Systems)
RuleName = PowerShell Base64 Encoded FromBase64String Keyword
EventType = Process.Start
Tag = proc-start-powershell-base64-encoded-frombase64string-keyword
RiskScore = 75
Query = ((Process.CommandLine like r"%OjpGcm9tQmFzZTY0U3RyaW5n%" or Process.CommandLine like r"%o6RnJvbUJhc2U2NFN0cmluZ%" or Process.CommandLine like r"%6OkZyb21CYXNlNjRTdHJpbm%") or (Process.CommandLine like r"%OgA6AEYAcgBvAG0AQgBhAHMAZQA2ADQAUwB0AHIAaQBuAGcA%" or Process.CommandLine like r"%oAOgBGAHIAbwBtAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnA%" or Process.CommandLine like r"%6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZw%"))

[ActivityMonitoringRule]
# Detects processes spawned from web servers (php, tomcat, iis...etc) that perform reconnaissance looking for the existence of popular scripting tools (perl, python, wget) on the system via the help commands
# Author: Cian Heasley, Florian Roth
RuleName = Webshell Recon Detection Via CommandLine & Processes
EventType = Process.Start
Tag = proc-start-webshell-recon-detection-via-commandline-&-processes
RiskScore = 75
Query = (((Parent.Path like r"%\\w3wp.exe" or Parent.Path like r"%\\php-cgi.exe" or Parent.Path like r"%\\nginx.exe" or Parent.Path like r"%\\httpd.exe" or Parent.Path like r"%\\caddy.exe" or Parent.Path like r"%\\ws\_tomcatservice.exe") or ((Parent.Path like r"%\\java.exe" or Parent.Path like r"%\\javaw.exe") and (Parent.Path like r"%-tomcat-%" or Parent.Path like r"%\\tomcat%")) or ((Parent.Path like r"%\\java.exe" or Parent.Path like r"%\\javaw.exe") and (Process.CommandLine like r"%catalina.jar%" or Process.CommandLine like r"%CATALINA\_HOME%"))) and (Process.CommandLine like r"%perl --help%" or Process.CommandLine like r"%python --help%" or Process.CommandLine like r"%python -h%" or Process.CommandLine like r"%python3 --help%" or Process.CommandLine like r"%python3 -h%" or Process.CommandLine like r"%wget --help%" or Process.CommandLine like r"%perl -h%"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects possible successful exploitation for vulnerability described in CVE-2021-26857 by looking for | abnormal subprocesses spawning by Exchange Server's Unified Messaging service
# Author: Bhabesh Raj
RuleName = Potential CVE-2021-26857 Exploitation Attempt
EventType = Process.Start
Tag = proc-start-potential-cve-2021-26857-exploitation-attempt
RiskScore = 75
Query = (Parent.Path like r"%\\UMWorkerProcess.exe" and not ((Process.Path like r"%wermgr.exe" or Process.Path like r"%WerFault.exe")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects command that type the content of ntdll.dll to a different file or a pipe in order to evade AV / EDR detection. As seen being used in the POC NtdllPipe
# Author: Florian Roth (Nextron Systems)
RuleName = NtdllPipe Like Activity Execution
EventType = Process.Start
Tag = proc-start-ntdllpipe-like-activity-execution
RiskScore = 75
Query = (Process.CommandLine like r"%type \%windir\%\\system32\\ntdll.dll%" or Process.CommandLine like r"%type \%systemroot\%\\system32\\ntdll.dll%" or Process.CommandLine like r"%type c:\\windows\\system32\\ntdll.dll%" or Process.CommandLine like r"%\\ntdll.dll > \\\\.\\pipe\\\*")

[ActivityMonitoringRule]
# Detects actions that clear the local ShimCache and remove forensic evidence
# Author: Florian Roth (Nextron Systems)
RuleName = ShimCache Flush
EventType = Process.Start
Tag = proc-start-shimcache-flush
RiskScore = 75
Query = ((Process.CommandLine like r"%rundll32%" and Process.CommandLine like r"%apphelp.dll%" and (Process.CommandLine like r"%ShimFlushCache%" or Process.CommandLine like r"%#250%")) or (Process.CommandLine like r"%rundll32%" and Process.CommandLine like r"%kernel32.dll%" and (Process.CommandLine like r"%BaseFlushAppcompatCache%" or Process.CommandLine like r"%#46%")))

[ActivityMonitoringRule]
# Detects renamed vmnat.exe or portable version that can be used for DLL side-loading
# Author: elhoim
RuleName = Renamed Vmnat.exe Execution
EventType = Process.Start
Tag = proc-start-renamed-vmnat.exe-execution
RiskScore = 75
Query = (Process.Name == "vmnat.exe" and not ((Process.Path like r"%vmnat.exe")))

[ActivityMonitoringRule]
# Detects the usage of "reg.exe" in order to dump sensitive registry hives, which includes SAM, SYSTEM and SECURITY
# Author: Teymur Kheirkhabarov, Endgame, JHasenbusch, Daniil Yugoslavskiy, oscd.community, frack113
RuleName = Dumping of Sensitive Hives Via Reg.EXE
EventType = Process.Start
Tag = proc-start-dumping-of-sensitive-hives-via-reg.exe
RiskScore = 75
Query = ((Process.Path like r"%\\reg.exe" or Process.Name == "reg.exe") and (Process.CommandLine like r"%save%" or Process.CommandLine like r"%export%" or Process.CommandLine like r"%Ë¢ave%" or Process.CommandLine like r"%eË£port%") and (Process.CommandLine like r"%hklm%" or Process.CommandLine like r"%hkËªm%" or Process.CommandLine like r"%hkey\_local\_machine%" or Process.CommandLine like r"%hkey\_Ëªocal\_machine%" or Process.CommandLine like r"%hkey\_locaËª\_machine%" or Process.CommandLine like r"%hkey\_ËªocaËª\_machine%") and (Process.CommandLine like r"%\\system%" or Process.CommandLine like r"%\\sam%" or Process.CommandLine like r"%\\security%" or Process.CommandLine like r"%\\Ë¢ystem%" or Process.CommandLine like r"%\\syË¢tem%" or Process.CommandLine like r"%\\Ë¢yË¢tem%" or Process.CommandLine like r"%\\Ë¢am%" or Process.CommandLine like r"%\\Ë¢ecurity%"))

[ActivityMonitoringRule]
# Detects binaries used by the Lazarus group which use system names but are executed and launched from non-default location
# Author: Trent Liffick (@tliffick), Bartlomiej Czyz (@bczyz1)
RuleName = Lazarus System Binary Masquerading
EventType = Process.Start
Tag = proc-start-lazarus-system-binary-masquerading
RiskScore = 75
Query = ((Process.Path like r"%\\msdtc.exe" or Process.Path like r"%\\gpsvc.exe") and not ((Process.Path like r"C:\\Windows\\System32\\%" or Process.Path like r"C:\\Windows\\SysWOW64\\%")))

[ActivityMonitoringRule]
# Detects execution of Netcat. Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network
# Author: frack113, Florian Roth (Nextron Systems)
RuleName = PUA - Netcat Suspicious Execution
EventType = Process.Start
Tag = proc-start-pua-netcat-suspicious-execution
RiskScore = 75
Query = ((Process.Path like r"%\\nc.exe" or Process.Path like r"%\\ncat.exe" or Process.Path like r"%\\netcat.exe") or (Process.CommandLine like r"% -lvp %" or Process.CommandLine like r"% -lvnp%" or Process.CommandLine like r"% -l -v -p %" or Process.CommandLine like r"% -lv -p %" or Process.CommandLine like r"% -l --proxy-type http %" or Process.CommandLine like r"% -vnl --exec %" or Process.CommandLine like r"% -vnl -e %" or Process.CommandLine like r"% --lua-exec %" or Process.CommandLine like r"% --sh-exec %"))

[ActivityMonitoringRule]
# Detects creation of local users via the net.exe command with the option "never expire"
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = New User Created Via Net.EXE With Never Expire Option
EventType = Process.Start
Tag = proc-start-new-user-created-via-net.exe-with-never-expire-option
RiskScore = 75
Query = (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") or Process.Name in ["net.exe", "net1.exe"]) and (Process.CommandLine like r"%user%" and Process.CommandLine like r"%add%" and Process.CommandLine like r"%expires:never%"))

[ActivityMonitoringRule]
# Detects the invocation of the Stored User Names and Passwords dialogue (Key Manager)
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Key Manager Access
EventType = Process.Start
Tag = proc-start-suspicious-key-manager-access
RiskScore = 75
Query = ((Process.Path like r"%\\rundll32.exe" or Process.Name == "RUNDLL32.EXE") and (Process.CommandLine like r"%keymgr%" and Process.CommandLine like r"%KRShowKeyMgr%"))

[ActivityMonitoringRule]
# Detects a command that clears or disables any ETW trace log which could indicate a logging evasion.
# Author: @neu5ron, Florian Roth (Nextron Systems), Jonhnathan Ribeiro, oscd.community
RuleName = Disable of ETW Trace
EventType = Process.Start
Tag = proc-start-disable-of-etw-trace
RiskScore = 75
Query = ((Process.CommandLine like r"%cl%" and Process.CommandLine like r"%/Trace%") or (Process.CommandLine like r"%clear-log%" and Process.CommandLine like r"%/Trace%") or (Process.CommandLine like r"%sl%" and Process.CommandLine like r"%/e:false%") or (Process.CommandLine like r"%set-log%" and Process.CommandLine like r"%/e:false%") or (Process.CommandLine like r"%logman%" and Process.CommandLine like r"%update%" and Process.CommandLine like r"%trace%" and Process.CommandLine like r"%--p%" and Process.CommandLine like r"%-ets%") or Process.CommandLine like r"%Remove-EtwTraceProvider%" or (Process.CommandLine like r"%Set-EtwTraceProvider%" and Process.CommandLine like r"%0x11%"))

[ActivityMonitoringRule]
# Detects specific process characteristics of Chinese TAIDOOR RAT malware load
# Author: Florian Roth (Nextron Systems)
RuleName = TAIDOOR RAT DLL Load
EventType = Process.Start
Tag = proc-start-taidoor-rat-dll-load
RiskScore = 75
Query = ((Process.CommandLine like r"%dll,MyStart%" or Process.CommandLine like r"%dll MyStart%") or (Process.CommandLine like r"% MyStart" and Process.CommandLine like r"%rundll32.exe%"))

[ActivityMonitoringRule]
# Detects potential exploitation of the BearLPE exploit using Task Scheduler ".job" import arbitrary DACL write\par
# Author: Olaf Hartong
RuleName = Potential BearLPE Exploitation
EventType = Process.Start
Tag = proc-start-potential-bearlpe-exploitation
RiskScore = 75
Query = ((Process.Path like r"%\\schtasks.exe" or Process.Name == "schtasks.exe") and (Process.CommandLine like r"%/change%" and Process.CommandLine like r"%/TN%" and Process.CommandLine like r"%/RU%" and Process.CommandLine like r"%/RP%"))

[ActivityMonitoringRule]
# Detects RunDLL32.exe spawning explorer.exe as child, which is very uncommon, often observes Gamarue spawning the explorer.exe process in an unusual way
# Author: elhoim, CD_ROM_
RuleName = RunDLL32 Spawning Explorer
EventType = Process.Start
Tag = proc-start-rundll32-spawning-explorer
RiskScore = 75
Query = ((Parent.Path like r"%\\rundll32.exe" and Process.Path like r"%\\explorer.exe") and not (Parent.CommandLine like r"%\\shell32.dll,Control\_RunDLL%"))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects potential exploitation attempts of CVE-2022-29072, a 7-Zip privilege escalation and command execution vulnerability.
# 7-Zip version 21.07 and earlier on Windows allows privilege escalation (CVE-2022-29072) and command execution when a file with the .7z extension is dragged to the Help>Contents area. This is caused by misconfiguration of 7z.dll and a heap overflow.
# The command runs in a child process under the 7zFM.exe process.
# Author: frack113
RuleName = Potential CVE-2022-29072 Exploitation Attempt
EventType = Process.Start
Tag = proc-start-potential-cve-2022-29072-exploitation-attempt
RiskScore = 75
Query = (((Process.Path like r"%\\cmd.exe" or Process.Name == "Cmd.Exe") and Parent.Path like r"%\\7zFM.exe") and not (((Process.CommandLine like r"% /c %" or Process.CommandLine like r"% /k %" or Process.CommandLine like r"% /r %")) or (Process.CommandLine == '')))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects a suspicious process spawning from an Outlook process.
# Author: Michael Haag, Florian Roth (Nextron Systems), Markus Neis, Elastic, FPT.EagleEye Team
RuleName = Suspicious Outlook Child Process
EventType = Process.Start
Tag = proc-start-suspicious-outlook-child-process
RiskScore = 75
Query = (Parent.Path like r"%\\OUTLOOK.EXE" and (Process.Path like r"%\\AppVLP.exe" or Process.Path like r"%\\bash.exe" or Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\forfiles.exe" or Process.Path like r"%\\hh.exe" or Process.Path like r"%\\mftrace.exe" or Process.Path like r"%\\msbuild.exe" or Process.Path like r"%\\msdt.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\msiexec.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\scrcons.exe" or Process.Path like r"%\\scriptrunner.exe" or Process.Path like r"%\\sh.exe" or Process.Path like r"%\\svchost.exe" or Process.Path like r"%\\wmic.exe" or Process.Path like r"%\\wscript.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# This rule detects suspicious processes with parent images located in the C:\Users\Public folder
# Author: Florian Roth (Nextron Systems)
RuleName = Parent in Public Folder Suspicious Process
EventType = Process.Start
Tag = proc-start-parent-in-public-folder-suspicious-process
RiskScore = 75
Query = (Parent.Path like r"C:\\Users\\Public\\%" and (Process.CommandLine like r"%powershell%" or Process.CommandLine like r"%cmd.exe /c %" or Process.CommandLine like r"%cmd.exe /r %" or Process.CommandLine like r"%cmd.exe /k %" or Process.CommandLine like r"%cmd /c %" or Process.CommandLine like r"%cmd /r %" or Process.CommandLine like r"%cmd /k %" or Process.CommandLine like r"%wscript.exe%" or Process.CommandLine like r"%cscript.exe%" or Process.CommandLine like r"%bitsadmin%" or Process.CommandLine like r"%certutil%" or Process.CommandLine like r"%mshta.exe%"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious patterns in program names or folders that are often found in malicious samples or hacktools
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Program Names
EventType = Process.Start
Tag = proc-start-suspicious-program-names
RiskScore = 75
Query = ((Process.Path like r"%\\CVE-202%" or Process.Path like r"%\\CVE202%") or (Process.Path like r"%\\poc.exe" or Process.Path like r"%\\artifact.exe" or Process.Path like r"%\\artifact64.exe" or Process.Path like r"%\\artifact\_protected.exe" or Process.Path like r"%\\artifact32.exe" or Process.Path like r"%\\artifact32big.exe" or Process.Path like r"%obfuscated.exe" or Process.Path like r"%obfusc.exe" or Process.Path like r"%\\meterpreter") or (Process.CommandLine like r"%inject.ps1%" or Process.CommandLine like r"%Invoke-CVE%" or Process.CommandLine like r"%pupy.ps1%" or Process.CommandLine like r"%payload.ps1%" or Process.CommandLine like r"%beacon.ps1%" or Process.CommandLine like r"%PowerView.ps1%" or Process.CommandLine like r"%bypass.ps1%" or Process.CommandLine like r"%obfuscated.ps1%" or Process.CommandLine like r"%obfusc.ps1%" or Process.CommandLine like r"%obfus.ps1%" or Process.CommandLine like r"%obfs.ps1%" or Process.CommandLine like r"%evil.ps1%" or Process.CommandLine like r"%MiniDogz.ps1%" or Process.CommandLine like r"%\_enc.ps1%" or Process.CommandLine like r"%\\shell.ps1%" or Process.CommandLine like r"%\\rshell.ps1%" or Process.CommandLine like r"%revshell.ps1%" or Process.CommandLine like r"%\\av.ps1%" or Process.CommandLine like r"%\\av\_test.ps1%" or Process.CommandLine like r"%adrecon.ps1%" or Process.CommandLine like r"%mimikatz.ps1%" or Process.CommandLine like r"%\\PowerUp\_%" or Process.CommandLine like r"%powerup.ps1%" or Process.CommandLine like r"%\\Temp\\a.ps1%" or Process.CommandLine like r"%\\Temp\\p.ps1%" or Process.CommandLine like r"%\\Temp\\1.ps1%" or Process.CommandLine like r"%Hound.ps1%" or Process.CommandLine like r"%encode.ps1%" or Process.CommandLine like r"%powercat.ps1%"))

[ActivityMonitoringRule]
# Detects a command used by conti to dump database
# Author: frack113
RuleName = Potential Conti Ransomware Database Dumping Activity
EventType = Process.Start
Tag = proc-start-potential-conti-ransomware-database-dumping-activity
RiskScore = 75
Query = ((Process.Path like r"%\\sqlcmd.exe" or (Process.CommandLine like r"%sqlcmd %" or Process.CommandLine like r"%sqlcmd.exe%")) and Process.CommandLine like r"% -S localhost %" and (Process.CommandLine like r"%sys.sysprocesses%" or Process.CommandLine like r"%master.dbo.sysdatabases%" or Process.CommandLine like r"%BACKUP DATABASE%"))

[ActivityMonitoringRule]
# Detects the use of NSudo tool for command execution
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali
RuleName = PUA - NSudo Execution
EventType = Process.Start
Tag = proc-start-pua-nsudo-execution
RiskScore = 75
Query = (((Process.Path like r"%\\NSudo.exe" or Process.Path like r"%\\NSudoLC.exe" or Process.Path like r"%\\NSudoLG.exe") or Process.Name in ["NSudo.exe", "NSudoLC.exe", "NSudoLG.exe"]) and (Process.CommandLine like r"%-U:S %" or Process.CommandLine like r"%-U:T %" or Process.CommandLine like r"%-U:E %" or Process.CommandLine like r"%-P:E %" or Process.CommandLine like r"%-M:S %" or Process.CommandLine like r"%-M:H %" or Process.CommandLine like r"%-U=S %" or Process.CommandLine like r"%-U=T %" or Process.CommandLine like r"%-U=E %" or Process.CommandLine like r"%-P=E %" or Process.CommandLine like r"%-M=S %" or Process.CommandLine like r"%-M=H %" or Process.CommandLine like r"%-ShowWindowMode:Hide%"))

[ActivityMonitoringRule]
# Detects execution of Microsoft Defender's CLI process (MpCmdRun.exe) from the non-default directory which may be an attempt to sideload arbitrary DLL
# Author: Bhabesh Raj
RuleName = DLL Sideloading by Microsoft Defender
EventType = Process.Start
Tag = proc-start-dll-sideloading-by-microsoft-defender
RiskScore = 75
Query = (Process.Path like r"%\\MpCmdRun.exe" and not ((Process.Path like r"C:\\Program Files\\Windows Defender\\%" or Process.Path like r"C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\%" or Process.Path like r"C:\\Windows\\winsxs\\%" or Process.Path like r"C:\\Program Files\\Microsoft Security Client\\MpCmdRun.exe%")))

[ActivityMonitoringRule]
# Detects the suspicious minimized start of MsEdge browser, which can be used to download files from the Internet
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Minimized MSEdge Start
EventType = Process.Start
Tag = proc-start-suspicious-minimized-msedge-start
RiskScore = 75
Query = Process.CommandLine like r"%start /min msedge%"

[ActivityMonitoringRule]
# Atbroker executing non-deafualt Assistive Technology applications
# Author: Mateusz Wydra, oscd.community
RuleName = Suspicious Atbroker Execution
EventType = Process.Start
Tag = proc-start-suspicious-atbroker-execution
RiskScore = 75
Query = ((Process.Path like r"%AtBroker.exe" and Process.CommandLine like r"%start%") and not ((Process.CommandLine like r"%animations%" or Process.CommandLine like r"%audiodescription%" or Process.CommandLine like r"%caretbrowsing%" or Process.CommandLine like r"%caretwidth%" or Process.CommandLine like r"%colorfiltering%" or Process.CommandLine like r"%cursorscheme%" or Process.CommandLine like r"%filterkeys%" or Process.CommandLine like r"%focusborderheight%" or Process.CommandLine like r"%focusborderwidth%" or Process.CommandLine like r"%highcontrast%" or Process.CommandLine like r"%keyboardcues%" or Process.CommandLine like r"%keyboardpref%" or Process.CommandLine like r"%magnifierpane%" or Process.CommandLine like r"%messageduration%" or Process.CommandLine like r"%minimumhitradius%" or Process.CommandLine like r"%mousekeys%" or Process.CommandLine like r"%Narrator%" or Process.CommandLine like r"%osk%" or Process.CommandLine like r"%overlappedcontent%" or Process.CommandLine like r"%showsounds%" or Process.CommandLine like r"%soundsentry%" or Process.CommandLine like r"%stickykeys%" or Process.CommandLine like r"%togglekeys%" or Process.CommandLine like r"%windowarranging%" or Process.CommandLine like r"%windowtracking%" or Process.CommandLine like r"%windowtrackingtimeout%" or Process.CommandLine like r"%windowtrackingzorder%")))

[ActivityMonitoringRule]
# Detects exeuctable names or flags used by Htran or Htran-like tools (e.g. NATBypass)
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - Htran/NATBypass Execution
EventType = Process.Start
Tag = proc-start-hacktool-htran/natbypass-execution
RiskScore = 75
Query = ((Process.Path like r"%\\htran.exe" or Process.Path like r"%\\lcx.exe") or (Process.CommandLine like r"%.exe -tran %" or Process.CommandLine like r"%.exe -slave %"))

[ActivityMonitoringRule]
# Detect usage of the "driverquery" utility to perform reconnaissance on installed drivers
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential Recon Activity Using DriverQuery.EXE
EventType = Process.Start
Tag = proc-start-potential-recon-activity-using-driverquery.exe
RiskScore = 75
Query = ((Process.Path like r"%driverquery.exe" or Process.Name == "drvqry.exe") and ((Parent.Path like r"%\\cmd.exe" or Parent.Path like r"%\\powershell.exe" or Parent.Path like r"%\\pwsh.exe" or Parent.Path like r"%\\wscript.exe" or Parent.Path like r"%\\cscript.exe" or Parent.Path like r"%\\mshta.exe") or (Parent.Path like r"%\\AppData\\Local\\%" or Parent.Path like r"%\\Users\\Public\\%" or Parent.Path like r"%\\Windows\\Temp\\%")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious launch of a renamed version of the PSEXESVC service with, which is not often used by legitimate administrators
# Author: Florian Roth (Nextron Systems)
RuleName = Renamed PsExec Service Execution
EventType = Process.Start
Tag = proc-start-renamed-psexec-service-execution
RiskScore = 75
Query = (Process.Name == "psexesvc.exe" and not (Process.Path like r"C:\\Windows\\PSEXESVC.exe"))

[ActivityMonitoringRule]
# Detects a regsvr.exe execution that doesn't contain a DLL in the command line
# Author: Florian Roth (Nextron Systems)
RuleName = Regsvr32 Command Line Without DLL
EventType = Process.Start
Tag = proc-start-regsvr32-command-line-without-dll
RiskScore = 75
Query = (((Process.Path like r"%\\regsvr32.exe" and not ((Process.CommandLine like r"%.dll%" or Process.CommandLine like r"%.ocx%" or Process.CommandLine like r"%.cpl%" or Process.CommandLine like r"%.ax%" or Process.CommandLine like r"%.bav%" or Process.CommandLine like r"%.ppl%"))) and not (Process.CommandLine == '')) and not (Process.CommandLine == ""))

[ActivityMonitoringRule]
# Shadow Copies deletion using operating systems utilities
# Author: Florian Roth (Nextron Systems), Michael Haag, Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community, Andreas Hunkeler (@Karneades)
RuleName = Shadow Copies Deletion Using Operating Systems Utilities
EventType = Process.Start
Tag = proc-start-shadow-copies-deletion-using-operating-systems-utilities
RiskScore = 75
Query = (((((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\wmic.exe" or Process.Path like r"%\\vssadmin.exe" or Process.Path like r"%\\diskshadow.exe") or Process.Name in ["PowerShell.EXE", "pwsh.dll", "wmic.exe", "VSSADMIN.EXE", "diskshadow.exe"]) and (Process.CommandLine like r"%shadow%" and Process.CommandLine like r"%delete%")) or ((Process.Path like r"%\\wbadmin.exe" or Process.Name == "WBADMIN.EXE") and (Process.CommandLine like r"%delete%" and Process.CommandLine like r"%catalog%" and Process.CommandLine like r"%quiet%"))) or ((Process.Path like r"%\\vssadmin.exe" or Process.Name == "VSSADMIN.EXE") and (Process.CommandLine like r"%resize%" and Process.CommandLine like r"%shadowstorage%" and (Process.CommandLine like r"%unbounded%" or Process.CommandLine like r"%/MaxSize=%"))))

[ActivityMonitoringRule]
# Detects a suspicious output redirection to the local admins share, this technique is often found in malicious scripts or hacktool stagers
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Redirection to Local Admin Share
EventType = Process.Start
Tag = proc-start-suspicious-redirection-to-local-admin-share
RiskScore = 75
Query = (Process.CommandLine like r"%>%" and ("\\\\127.0.0.1\\admin$\\" or "\\\\localhost\\admin$\\"))

[ActivityMonitoringRule]
# Detects the usage of attrib with the "+s" option to set scripts or executables located in suspicious locations as system files to hide them from users and make them unable to be deleted with simple rights. The rule limits the search to specific extensions and directories to avoid FPs
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Set Suspicious Files as System Files Using Attrib.EXE
EventType = Process.Start
Tag = proc-start-set-suspicious-files-as-system-files-using-attrib.exe
RiskScore = 75
Query = (((Process.Path like r"%\\attrib.exe" or Process.Name == "ATTRIB.EXE") and Process.CommandLine like r"% +s%" and (Process.CommandLine like r"% \%%" or Process.CommandLine like r"%\\Users\\Public\\%" or Process.CommandLine like r"%\\AppData\\Local\\%" or Process.CommandLine like r"%\\ProgramData\\%" or Process.CommandLine like r"%\\Downloads\\%" or Process.CommandLine like r"%\\Windows\\Temp\\%") and (Process.CommandLine like r"%.bat%" or Process.CommandLine like r"%.dll%" or Process.CommandLine like r"%.exe%" or Process.CommandLine like r"%.hta%" or Process.CommandLine like r"%.ps1%" or Process.CommandLine like r"%.vbe%" or Process.CommandLine like r"%.vbs%")) and not (Process.CommandLine like r"%\\Windows\\TEMP\\%" and Process.CommandLine like r"%.exe%"))

[ActivityMonitoringRule]
# Detects "regsvr32.exe" spawning "explorer.exe", which is very uncommon.
# Author: elhoim
RuleName = Regsvr32 Spawning Explorer
EventType = Process.Start
Tag = proc-start-regsvr32-spawning-explorer
RiskScore = 75
Query = (Parent.Path like r"%\\regsvr32.exe" and Process.Path like r"%\\explorer.exe")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects Trickbot malware process tree pattern in which "rundll32.exe" is a parent of "wermgr.exe"
# Author: Florian Roth (Nextron Systems)
RuleName = Trickbot Malware Activity
EventType = Process.Start
Tag = proc-start-trickbot-malware-activity
RiskScore = 75
Query = (Process.Path like r"%\\wermgr.exe" and Parent.Path like r"%\\rundll32.exe" and Parent.CommandLine like r"%DllRegisterServer%")
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects a specific process creation patterns as seen used by UNC2452 and provided by Microsoft as Microsoft Defender ATP queries
# Author: Florian Roth (Nextron Systems)
RuleName = UNC2452 Process Creation Patterns
EventType = Process.Start
Tag = proc-start-unc2452-process-creation-patterns
RiskScore = 75
Query = ((Process.CommandLine like r"%7z.exe a -v500m -mx9 -r0 -p%" or (Parent.CommandLine like r"%wscript.exe%" and Parent.CommandLine like r"%.vbs%" and Process.CommandLine like r"%rundll32.exe%" and Process.CommandLine like r"%C:\\Windows%" and Process.CommandLine like r"%.dll,Tk\_%") or (Parent.Path like r"%\\rundll32.exe" and Parent.CommandLine like r"%C:\\Windows%" and Process.CommandLine like r"%cmd.exe /C %") or (Process.CommandLine like r"%rundll32 c:\\windows\\%" and Process.CommandLine like r"%.dll %")) or ((Parent.Path like r"%\\rundll32.exe" and Process.Path like r"%\\dllhost.exe") and not (Process.CommandLine in [" ", ""])))
GenericProperty1 = Parent.CommandLine
GenericProperty2 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious and uncommon child processes of WmiPrvSE
# Author: Vadim Khrykov (ThreatIntel), Cyb3rEng
RuleName = Suspicious WmiPrvse Child Process Spawned
EventType = Process.Start
Tag = proc-start-suspicious-wmiprvse-child-process-spawned
RiskScore = 75
Query = (Parent.Path like r"%\\wbem\\WmiPrvSE.exe" and ((Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\msiexec.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\verclsid.exe") or (Process.Path like r"%\\cmd.exe" and (Process.CommandLine like r"%powershell%" or Process.CommandLine like r"%pwsh%" or Process.CommandLine like r"%mshta%" or Process.CommandLine like r"%rundll32%" or Process.CommandLine like r"%regsvr32%" or Process.CommandLine like r"%wscript%" or Process.CommandLine like r"%cscript%"))))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the execution of netsh to configure a port forwarding of port 3389 (RDP) rule
# Author: Florian Roth (Nextron Systems), oscd.community
RuleName = RDP Port Forwarding Rule Added Via Netsh.EXE
EventType = Process.Start
Tag = proc-start-rdp-port-forwarding-rule-added-via-netsh.exe
RiskScore = 75
Query = ((Process.Path like r"%\\netsh.exe" or Process.Name == "netsh.exe") and (Process.CommandLine like r"% i%" and Process.CommandLine like r"% p%" and Process.CommandLine like r"%=3389%" and Process.CommandLine like r"% c%"))

[ActivityMonitoringRule]
# Detects a suspicious process spawning from one of the Microsoft Office suite products (Word, Excel, PowerPoint, Publisher, Visio, etc.)
# Author: Michael Haag, Florian Roth, Markus Neis, Elastic, FPT.EagleEye Team, Vadim Khrykov, Cyb3rEng, Michael Haag, Christopher Peacock @securepeacock, SCYTHE @scythe_io
RuleName = Suspicious Microsoft Office Child Process
EventType = Process.Start
Tag = proc-start-suspicious-microsoft-office-child-process
RiskScore = 75
Query = ((Parent.Path like r"%\\EQNEDT32.EXE" or Parent.Path like r"%\\EXCEL.EXE" or Parent.Path like r"%\\MSACCESS.EXE" or Parent.Path like r"%\\MSPUB.exe" or Parent.Path like r"%\\ONENOTE.EXE" or Parent.Path like r"%\\POWERPNT.exe" or Parent.Path like r"%\\VISIO.exe" or Parent.Path like r"%\\WINWORD.EXE" or Parent.Path like r"%\\wordpad.exe" or Parent.Path like r"%\\wordview.exe") and (Process.Name in ["bitsadmin.exe", "CertOC.exe", "CertUtil.exe", "Cmd.Exe", "CMSTP.EXE", "cscript.exe", "curl.exe", "HH.exe", "IEExec.exe", "InstallUtil.exe", "javaw.exe", "Microsoft.Workflow.Compiler.exe", "msdt.exe", "MSHTA.EXE", "msiexec.exe", "Msxsl.exe", "odbcconf.exe", "pcalua.exe", "PowerShell.EXE", "RegAsm.exe", "RegSvcs.exe", "REGSVR32.exe", "RUNDLL32.exe", "schtasks.exe", "ScriptRunner.exe", "wmic.exe", "WorkFolders.exe", "wscript.exe"] or (Process.Path like r"%\\AppVLP.exe" or Process.Path like r"%\\bash.exe" or Process.Path like r"%\\bitsadmin.exe" or Process.Path like r"%\\certoc.exe" or Process.Path like r"%\\certutil.exe" or Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\cmstp.exe" or Process.Path like r"%\\control.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\curl.exe" or Process.Path like r"%\\forfiles.exe" or Process.Path like r"%\\hh.exe" or Process.Path like r"%\\ieexec.exe" or Process.Path like r"%\\installutil.exe" or Process.Path like r"%\\javaw.exe" or Process.Path like r"%\\mftrace.exe" or Process.Path like r"%\\Microsoft.Workflow.Compiler.exe" or Process.Path like r"%\\msbuild.exe" or Process.Path like r"%\\msdt.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\msidb.exe" or Process.Path like r"%\\msiexec.exe" or Process.Path like r"%\\msxsl.exe" or Process.Path like r"%\\odbcconf.exe" or Process.Path like r"%\\pcalua.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\regasm.exe" or Process.Path like r"%\\regsvcs.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\scrcons.exe" or Process.Path like r"%\\scriptrunner.exe" or Process.Path like r"%\\sh.exe" or Process.Path like r"%\\svchost.exe" or Process.Path like r"%\\verclsid.exe" or Process.Path like r"%\\wmic.exe" or Process.Path like r"%\\workfolders.exe" or Process.Path like r"%\\wscript.exe")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the creation or update of a scheduled task to run with "NT AUTHORITY\SYSTEM" privileges
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Schtasks Creation Or Modification With SYSTEM Privileges
EventType = Process.Start
Tag = proc-start-schtasks-creation-or-modification-with-system-privileges
RiskScore = 75
Query = ((Process.Path like r"%\\schtasks.exe" and (Process.CommandLine like r"% /change %" or Process.CommandLine like r"% /create %") and Process.CommandLine like r"%/ru %" and (Process.CommandLine like r"%NT AUT%" or Process.CommandLine like r"% SYSTEM %")) and not ((Parent.Path like r"%\\AppData\\Local\\Temp\\%" and Parent.Path like r"%TeamViewer\_.exe%" and Process.Path like r"%\\schtasks.exe" and Process.CommandLine like r"%/TN TVInstallRestore%") or ((Process.CommandLine like r"%/Create /F /RU System /SC WEEKLY /TN AviraSystemSpeedupVerify /TR %" or Process.CommandLine like r"%C:\\Program Files (x86)\\Avira\\System Speedup\\setup\\avira\_speedup\_setup.exe%" or Process.CommandLine like r"%/VERIFY /VERYSILENT /NOSTART /NODOTNET /NORESTART\" /RL HIGHEST%"))))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the use of a renamed Adfind.exe. AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain.
# Author: Florian Roth (Nextron Systems)
RuleName = Renamed AdFind Execution
EventType = Process.Start
Tag = proc-start-renamed-adfind-execution
RiskScore = 75
Query = (((Process.CommandLine like r"%domainlist%" or Process.CommandLine like r"%trustdmp%" or Process.CommandLine like r"%dcmodes%" or Process.CommandLine like r"%adinfo%" or Process.CommandLine like r"% dclist %" or Process.CommandLine like r"%computer\_pwdnotreqd%" or Process.CommandLine like r"%objectcategory=%" or Process.CommandLine like r"%-subnets -f%" or Process.CommandLine like r"%name=\"Domain Admins\"%" or Process.CommandLine like r"%-sc u:%" or Process.CommandLine like r"%domainncs%" or Process.CommandLine like r"%dompol%" or Process.CommandLine like r"% oudmp %" or Process.CommandLine like r"%subnetdmp%" or Process.CommandLine like r"%gpodmp%" or Process.CommandLine like r"%fspdmp%" or Process.CommandLine like r"%users\_noexpire%" or Process.CommandLine like r"%computers\_active%" or Process.CommandLine like r"%computers\_pwdnotreqd%") or Process.Hash.IMP in ["bca5675746d13a1f246e2da3c2217492", "53e117a96057eaf19c41380d0e87f1c2"] or (Process.Hashes like r"%IMPHASH=BCA5675746D13A1F246E2DA3C2217492%" or Process.Hashes like r"%IMPHASH=53E117A96057EAF19C41380D0E87F1C2%") or Process.Name == "AdFind.exe") and not (Process.Path like r"%\\AdFind.exe"))
GenericProperty1 = Process.Hash.IMP
GenericProperty2 = Process.Hashes

[ActivityMonitoringRule]
# Look for the encrypted cpassword value within Group Policy Preference files on the Domain Controller. This value can be decrypted with gpp-decrypt.
# Author: frack113
RuleName = Findstr GPP Passwords
EventType = Process.Start
Tag = proc-start-findstr-gpp-passwords
RiskScore = 75
Query = ((Process.Path like r"%\\findstr.exe" or Process.Name == "FINDSTR.EXE") and (Process.CommandLine like r"%cpassword%" and Process.CommandLine like r"%\\sysvol\\%" and Process.CommandLine like r"%.xml%"))

[ActivityMonitoringRule]
# Detects execution of the "mshta" utility with an argument containing the "http" keyword, which could indicate that an attacker is executing a remotely hosted malicious hta file
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Remotely Hosted HTA File Executed Via Mshta.EXE
EventType = Process.Start
Tag = proc-start-remotely-hosted-hta-file-executed-via-mshta.exe
RiskScore = 75
Query = ((Process.Path like r"%\\mshta.exe" or Process.Name == "MSHTA.EXE") and (Process.CommandLine like r"%http://%" or Process.CommandLine like r"%https://%" or Process.CommandLine like r"%ftp://%"))

[ActivityMonitoringRule]
# Detects the attempt to evade or obfuscate the executed command on the CommandLine using bogus path traversal
# Author: Christian Burkard (Nextron Systems)
RuleName = Command Line Path Traversal Evasion
EventType = Process.Start
Tag = proc-start-command-line-path-traversal-evasion
RiskScore = 75
Query = (((Process.Path like r"%\\Windows\\%" and (Process.CommandLine like r"%\\..\\Windows\\%" or Process.CommandLine like r"%\\..\\System32\\%" or Process.CommandLine like r"%\\..\\..\\%")) or Process.CommandLine like r"%.exe\\..\\%") and not ((Process.CommandLine like r"%\\Google\\Drive\\googledrivesync.exe\\..\\%" or Process.CommandLine like r"%\\Citrix\\Virtual Smart Card\\Citrix.Authentication.VirtualSmartcard.Launcher.exe\\..\\%")))

[ActivityMonitoringRule]
# Detects chromium based browsers starting in headless and debugging mode and pointing to a user profile. This could be a sign of data stealing or remote control
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential Data Stealing Via Chromium Headless Debugging
EventType = Process.Start
Tag = proc-start-potential-data-stealing-via-chromium-headless-debugging
RiskScore = 75
Query = (Process.CommandLine like r"%--remote-debugging-%" and Process.CommandLine like r"%--user-data-dir%" and Process.CommandLine like r"%--headless%")

[ActivityMonitoringRule]
# Detects msdt.exe executed by a suspicious parent as seen in CVE-2022-30190 / Follina exploitation
# Author: Nextron Systems
RuleName = Suspicious MSDT Parent Process
EventType = Process.Start
Tag = proc-start-suspicious-msdt-parent-process
RiskScore = 75
Query = ((Parent.Path like r"%\\cmd.exe" or Parent.Path like r"%\\cscript.exe" or Parent.Path like r"%\\mshta.exe" or Parent.Path like r"%\\powershell.exe" or Parent.Path like r"%\\pwsh.exe" or Parent.Path like r"%\\regsvr32.exe" or Parent.Path like r"%\\rundll32.exe" or Parent.Path like r"%\\schtasks.exe" or Parent.Path like r"%\\wmic.exe" or Parent.Path like r"%\\wscript.exe" or Parent.Path like r"%\\wsl.exe") and (Process.Path like r"%\\msdt.exe" or Process.Name == "msdt.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious ways to run Invoke-Execution using IEX alias
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious PowerShell IEX Execution Patterns
EventType = Process.Start
Tag = proc-start-suspicious-powershell-iex-execution-patterns
RiskScore = 75
Query = (((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") and (Process.CommandLine like r"% | iex;%" or Process.CommandLine like r"% | iex %" or Process.CommandLine like r"% | iex}%" or Process.CommandLine like r"% | IEX ;%" or Process.CommandLine like r"% | IEX -Error%" or Process.CommandLine like r"% | IEX (new%" or Process.CommandLine like r"%);IEX %") and (Process.CommandLine like r"%::FromBase64String%" or Process.CommandLine like r"%.GetString([System.Convert]::%")) or (Process.CommandLine like r"%)|iex;$%" or Process.CommandLine like r"%);iex($%" or Process.CommandLine like r"%);iex $%" or Process.CommandLine like r"% | IEX | %"))

[ActivityMonitoringRule]
# Detects an attacker trying to enable the outlook security setting "EnableUnsafeClientMailRules" which allows outlook to run applications or execute macros
# Author: Markus Neis, Nasreddine Bencherchali (Nextron Systems)
RuleName = Outlook EnableUnsafeClientMailRules Setting Enabled
EventType = Process.Start
Tag = proc-start-outlook-enableunsafeclientmailrules-setting-enabled
RiskScore = 75
Query = Process.CommandLine like r"%\\Outlook\\Security\\EnableUnsafeClientMailRules%"

[ActivityMonitoringRule]
# Detects the presence of reversed PowerShell commands in the CommandLine. This is often used as a method of obfuscation by attackers
# Author: Teymur Kheirkhabarov (idea), Vasiliy Burov (rule), oscd.community, Tim Shelton
RuleName = Potential PowerShell Obfuscation Via Reversed Commands
EventType = Process.Start
Tag = proc-start-potential-powershell-obfuscation-via-reversed-commands
RiskScore = 75
Query = ((((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") or Process.Name in ["PowerShell.EXE", "pwsh.dll"]) and (Process.CommandLine like r"%hctac%" or Process.CommandLine like r"%kaerb%" or Process.CommandLine like r"%dnammoc%" or Process.CommandLine like r"%ekovn%" or Process.CommandLine like r"%eliFd%" or Process.CommandLine like r"%rahc%" or Process.CommandLine like r"%etirw%" or Process.CommandLine like r"%golon%" or Process.CommandLine like r"%tninon%" or Process.CommandLine like r"%eddih%" or Process.CommandLine like r"%tpircS%" or Process.CommandLine like r"%ssecorp%" or Process.CommandLine like r"%llehsrewop%" or Process.CommandLine like r"%esnopser%" or Process.CommandLine like r"%daolnwod%" or Process.CommandLine like r"%tneilCbeW%" or Process.CommandLine like r"%tneilc%" or Process.CommandLine like r"%ptth%" or Process.CommandLine like r"%elifotevas%" or Process.CommandLine like r"%46esab%" or Process.CommandLine like r"%htaPpmeTteG%" or Process.CommandLine like r"%tcejbO%" or Process.CommandLine like r"%maerts%" or Process.CommandLine like r"%hcaerof%" or Process.CommandLine like r"%retupmoc%")) and not ((Parent.Path like r"C:\\Windows\\System32\\cmd.exe" and Process.CommandLine like r"%-EncodedCommand%" and Process.CommandLine like r"%rahc%")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects scheduled task creations that have suspicious action command and folder combinations
# Author: Florian Roth (Nextron Systems)
RuleName = Schtasks From Suspicious Folders
EventType = Process.Start
Tag = proc-start-schtasks-from-suspicious-folders
RiskScore = 75
Query = ((Process.Path like r"%\\schtasks.exe" or Process.Name == "schtasks.exe") and Process.CommandLine like r"% /create %" and (Process.CommandLine like r"%powershell%" or Process.CommandLine like r"%pwsh%" or Process.CommandLine like r"%cmd /c %" or Process.CommandLine like r"%cmd /k %" or Process.CommandLine like r"%cmd /r %" or Process.CommandLine like r"%cmd.exe /c %" or Process.CommandLine like r"%cmd.exe /k %" or Process.CommandLine like r"%cmd.exe /r %") and (Process.CommandLine like r"%C:\\ProgramData\\%" or Process.CommandLine like r"%\%ProgramData\%%"))

[ActivityMonitoringRule]
# Detects potential EmpireMonkey APT activity
# Author: Markus Neis, Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential EmpireMonkey Activity
EventType = Process.Start
Tag = proc-start-potential-empiremonkey-activity
RiskScore = 75
Query = (Process.CommandLine like r"%/e:jscript%" and Process.CommandLine like r"%\\Local\\Temp\\Errors.bat%")

[ActivityMonitoringRule]
# Detects potential Muddywater APT activity
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential MuddyWater APT Activity
EventType = Process.Start
Tag = proc-start-potential-muddywater-apt-activity
RiskScore = 75
Query = ((Process.CommandLine like r"%vbscript:Close(Execute(\"CreateObject(%" and Process.CommandLine like r"%powershell%" and Process.CommandLine like r"%-w 1 -exec Bypass%" and Process.CommandLine like r"%\\ProgramData\\%") or (Process.CommandLine like r"%Win32\_OperatingSystem%" and Process.CommandLine like r"%Win32\_NetworkAdapterConfiguration%" and Process.CommandLine like r"%root\\SecurityCenter2%" and Process.CommandLine like r"%[System.Net.DNS]%") or (Process.CommandLine like r"%[Convert]::ToBase64String%" and Process.CommandLine like r"%[System.Text.Encoding]::UTF8.GetString]%" and Process.CommandLine like r"%GetResponse().GetResponseStream()%" and Process.CommandLine like r"%[System.Net.HttpWebRequest]::Create(%" and Process.CommandLine like r"%-bxor %"))

[ActivityMonitoringRule]
# Detects the execution of whoami.exe with suspicious parent processes.
# Author: Florian Roth (Nextron Systems)
RuleName = Whoami.EXE Execution Anomaly
EventType = Process.Start
Tag = proc-start-whoami.exe-execution-anomaly
RiskScore = 75
Query = ((Process.Path like r"%\\whoami.exe" or Process.Name == "whoami.exe") and not (((Parent.Path like r"%\\cmd.exe" or Parent.Path like r"%\\powershell.exe" or Parent.Path like r"%\\pwsh.exe" or Parent.Path like r"%\\powershell\_ise.exe")) or (Parent.Path like r"C:\\Program Files\\Microsoft Monitoring Agent\\Agent\\MonitoringHost.exe") or (Parent.Path == '') or (Parent.Path == "")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects potential commandline obfuscation using unicode characters.
# Adversaries may attempt to make an executable or file difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit.
# Author: frack113, Florian Roth (Nextron Systems)
RuleName = Potential Commandline Obfuscation Using Unicode Characters
EventType = Process.Start
Tag = proc-start-potential-commandline-obfuscation-using-unicode-characters
RiskScore = 75
Query = ((Process.CommandLine like r"%Ë£%" or Process.CommandLine like r"%Ëª%" or Process.CommandLine like r"%Ë¢%") or (Process.CommandLine like r"%âˆ•%" or Process.CommandLine like r"%â„%") or (Process.CommandLine like r"%â€•%" or Process.CommandLine like r"%â€”%") or (Process.CommandLine like r"%Ã¢%" or Process.CommandLine like r"%â‚¬%" or Process.CommandLine like r"%Â£%" or Process.CommandLine like r"%Â¯%" or Process.CommandLine like r"%Â®%" or Process.CommandLine like r"%Âµ%" or Process.CommandLine like r"%Â¶%"))

[ActivityMonitoringRule]
# Detects a suspicious script executions in temporary folders or folders accessible by environment variables
# Author: Florian Roth (Nextron Systems)
RuleName = Script Interpreter Execution From Suspicious Folder
EventType = Process.Start
Tag = proc-start-script-interpreter-execution-from-suspicious-folder
RiskScore = 75
Query = (((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\cmd.exe") or (Process.CommandLine like r"% -w hidden %" or Process.CommandLine like r"% -ep bypass %" or Process.CommandLine like r"%/e:vbscript %" or Process.CommandLine like r"%/e:javascript %") or Process.Name in ["powershell.exe", "pwsh.dll", "mshta.exe", "wscript.exe", "cscript.exe", "cmd.exe"]) and (Process.Path like r"%\\Windows\\Temp%" or Process.Path like r"%\\Temporary Internet%" or Process.Path like r"%\\AppData\\Local\\Temp%" or Process.Path like r"%\\AppData\\Roaming\\Temp%" or Process.Path like r"%C:\\Users\\Public\\%" or Process.Path like r"%C:\\Perflogs\\%"))

[ActivityMonitoringRule]
# Detects command line parameters used by Koadic hack tool
# Author: wagga, Jonhnathan Ribeiro, oscd.community
RuleName = HackTool - Koadic Execution
EventType = Process.Start
Tag = proc-start-hacktool-koadic-execution
RiskScore = 75
Query = ((Process.Path like r"%\\cmd.exe" or Process.Name == "Cmd.Exe") and (Process.CommandLine like r"%/q%" and Process.CommandLine like r"%/c%" and Process.CommandLine like r"%chcp%"))

[ActivityMonitoringRule]
# Detects unusual parent or children of the ImagingDevices.exe (Windows Contacts) process as seen being used with Bumblebee activity
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = ImagingDevices Unusual Parent/Child Processes
EventType = Process.Start
Tag = proc-start-imagingdevices-unusual-parent/child-processes
RiskScore = 75
Query = (((Parent.Path like r"%\\WmiPrvSE.exe" or Parent.Path like r"%\\svchost.exe" or Parent.Path like r"%\\dllhost.exe") and Process.Path like r"%\\ImagingDevices.exe") or Parent.Path like r"%\\ImagingDevices.exe")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects usage of the Quarks PwDump tool via commandline arguments
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = HackTool - Quarks PwDump Execution
EventType = Process.Start
Tag = proc-start-hacktool-quarks-pwdump-execution
RiskScore = 75
Query = (Process.Path like r"%\\QuarksPwDump.exe" or Process.CommandLine in [" -dhl", " --dump-hash-local", " -dhdc", " --dump-hash-domain-cached", " --dump-bitlocker", " -dhd ", " --dump-hash-domain ", "--ntds-file"])

[ActivityMonitoringRule]
# Detects when 'DllRegisterServer' is called in the commandline and the image is not rundll32. This could mean that the 'rundll32' utility has been renamed in order to avoid detection
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential Renamed Rundll32 Execution
EventType = Process.Start
Tag = proc-start-potential-renamed-rundll32-execution
RiskScore = 75
Query = (Process.CommandLine like r"%DllRegisterServer%" and not (Process.Path like r"%\\rundll32.exe"))

[ActivityMonitoringRule]
# Detects activity mentioned in Operation Wocao report
# Author: Florian Roth (Nextron Systems), frack113
RuleName = Operation Wocao Activity
EventType = Process.Start
Tag = proc-start-operation-wocao-activity
RiskScore = 75
Query = (Process.CommandLine like r"%checkadmin.exe 127.0.0.1 -all%" or Process.CommandLine like r"%netsh advfirewall firewall add rule name=powershell dir=in%" or Process.CommandLine like r"%cmd /c powershell.exe -ep bypass -file c:\\s.ps1%" or Process.CommandLine like r"%/tn win32times /f%" or Process.CommandLine like r"%create win32times binPath=%" or Process.CommandLine like r"%\\c$\\windows\\system32\\devmgr.dll%" or Process.CommandLine like r"% -exec bypass -enc JgAg%" or Process.CommandLine like r"%type %keepass\\KeePass.config.xml%" or Process.CommandLine like r"%iie.exe iie.txt%" or Process.CommandLine like r"%reg query HKEY\_CURRENT\_USER\\Software\\%\\PuTTY\\Sessions\\%")

[ActivityMonitoringRule]
# Detects the Internet Information Services (IIS) command-line tool, AppCmd, being used to list passwords
# Author: Tim Rauch, Janantha Marasinghe
RuleName = Microsoft IIS Service Account Password Dumped
EventType = Process.Start
Tag = proc-start-microsoft-iis-service-account-password-dumped
RiskScore = 75
Query = (((Process.Path like r"%\\appcmd.exe" or Process.Name == "appcmd.exe") and Process.CommandLine like r"%list %") and ((Process.CommandLine like r"% /config%" or Process.CommandLine like r"% /xml%" or Process.CommandLine like r"% -config%" or Process.CommandLine like r"% -xml%") or ((Process.CommandLine like r"% /@t%" or Process.CommandLine like r"% /text%" or Process.CommandLine like r"% /show%" or Process.CommandLine like r"% -@t%" or Process.CommandLine like r"% -text%" or Process.CommandLine like r"% -show%") and (Process.CommandLine like r"%:\*" or Process.CommandLine like r"%password%"))))

[ActivityMonitoringRule]
# Detects suspicious powershell process starts with base64 encoded commands (e.g. Emotet)
# Author: Florian Roth (Nextron Systems), Markus Neis, Jonhnathan Ribeiro, Daniil Yugoslavskiy, Anton Kutepov, oscd.community
RuleName = Suspicious Encoded PowerShell Command Line
EventType = Process.Start
Tag = proc-start-suspicious-encoded-powershell-command-line
RiskScore = 75
Query = ((((Process.CommandLine like r"% -e%" and Process.CommandLine like r"% JAB%") or (Process.CommandLine like r"% -e%" and Process.CommandLine like r"% JAB%" and Process.CommandLine like r"% -w%" and Process.CommandLine like r"% hidden %")) or (Process.CommandLine like r"% -e%" and (Process.CommandLine like r"% BA^J%" or Process.CommandLine like r"% SUVYI%" or Process.CommandLine like r"% SQBFAFgA%" or Process.CommandLine like r"% aQBlAHgA%" or Process.CommandLine like r"% aWV4I%" or Process.CommandLine like r"% IAA%" or Process.CommandLine like r"% IAB%" or Process.CommandLine like r"% UwB%" or Process.CommandLine like r"% cwB%")) or Process.CommandLine like r"%.exe -ENCOD %") and not (Process.CommandLine like r"% -ExecutionPolicy%" and Process.CommandLine like r"%remotesigned %"))

[ActivityMonitoringRule]
# Detects Netsh command execution that whitelists a program located in a suspicious location in the Windows Firewall
# Author: Sander Wiebing, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community
RuleName = Suspicious Program Location Whitelisted In Firewall Via Netsh.EXE
EventType = Process.Start
Tag = proc-start-suspicious-program-location-whitelisted-in-firewall-via-netsh.exe
RiskScore = 75
Query = ((Process.Path like r"%\\netsh.exe" or Process.Name == "netsh.exe") and ((Process.CommandLine like r"%firewall%" and Process.CommandLine like r"%add%" and Process.CommandLine like r"%allowedprogram%") or (Process.CommandLine like r"%advfirewall%" and Process.CommandLine like r"%firewall%" and Process.CommandLine like r"%add%" and Process.CommandLine like r"%rule%" and Process.CommandLine like r"%action=allow%" and Process.CommandLine like r"%program=%")) and (Process.CommandLine like r"%\%Public\%\\%" or Process.CommandLine like r"%\%TEMP\%%" or Process.CommandLine like r"%\%TMP\%%" or Process.CommandLine like r"%:\\$Recycle.bin\\%" or Process.CommandLine like r"%:\\RECYCLER\\%" or Process.CommandLine like r"%:\\SystemVolumeInformation\\%" or Process.CommandLine like r"%:\\Temp\\%" or Process.CommandLine like r"%:\\Users\\Default\\%" or Process.CommandLine like r"%:\\Users\\Desktop\\%" or Process.CommandLine like r"%:\\Users\\Public\\%" or Process.CommandLine like r"%:\\Windows\\addins\\%" or Process.CommandLine like r"%:\\Windows\\cursors\\%" or Process.CommandLine like r"%:\\Windows\\debug\\%" or Process.CommandLine like r"%:\\Windows\\drivers\\%" or Process.CommandLine like r"%:\\Windows\\fonts\\%" or Process.CommandLine like r"%:\\Windows\\help\\%" or Process.CommandLine like r"%:\\Windows\\system32\\tasks\\%" or Process.CommandLine like r"%:\\Windows\\Tasks\\%" or Process.CommandLine like r"%:\\Windows\\Temp\\%" or Process.CommandLine like r"%\\Downloads\\%" or Process.CommandLine like r"%\\Local Settings\\Temporary Internet Files\\%" or Process.CommandLine like r"%\\Temporary Internet Files\\Content.Outlook\\%"))

[ActivityMonitoringRule]
# Detects execution of the IEExec utility to download payloads
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Abusing IEExec To Download Payloads
EventType = Process.Start
Tag = proc-start-abusing-ieexec-to-download-payloads
RiskScore = 75
Query = ((Process.Path like r"%\\IEExec.exe" or Process.Name == "IEExec.exe") and (Process.CommandLine like r"%https://%" or Process.CommandLine like r"%http://%"))

[ActivityMonitoringRule]
# This is an unusual method to download files. It starts a browser headless and downloads a file from a location. This can be used by threat actors to download files.
# Author: Sreeman, Florian Roth
RuleName = File Download with Headless Browser
EventType = Process.Start
Tag = proc-start-file-download-with-headless-browser
RiskScore = 75
Query = ((Process.Path like r"%\\msedge.exe" or Process.Path like r"%\\chrome.exe") and Process.CommandLine like r"%--headless%" and Process.CommandLine like r"%dump-dom%" and Process.CommandLine like r"%http%")

[ActivityMonitoringRule]
# Detect use of the Windows 8.3 short name. Which could be used as a method to avoid Image based detection
# Author: frack113, Nasreddine Bencherchali (Nextron Systems)
RuleName = Use NTFS Short Name in Image
EventType = Process.Start
Tag = proc-start-use-ntfs-short-name-in-image
RiskScore = 75
Query = ((Process.Path like r"%~1.exe%" or Process.Path like r"%~1.bat%" or Process.Path like r"%~1.msi%" or Process.Path like r"%~1.vbe%" or Process.Path like r"%~1.vbs%" or Process.Path like r"%~1.dll%" or Process.Path like r"%~1.ps1%" or Process.Path like r"%~1.js%" or Process.Path like r"%~1.hta%" or Process.Path like r"%~2.exe%" or Process.Path like r"%~2.bat%" or Process.Path like r"%~2.msi%" or Process.Path like r"%~2.vbe%" or Process.Path like r"%~2.vbs%" or Process.Path like r"%~2.dll%" or Process.Path like r"%~2.ps1%" or Process.Path like r"%~2.js%" or Process.Path like r"%~2.hta%") and not ((Parent.Path like r"%\\WebEx\\WebexHost.exe" or Parent.Path like r"%\\thor\\thor64.exe" or Parent.Path like r"%-installer.exe") or Process.Path like r"%\\vcredi%" or Parent.Path like r"C:\\Windows\\explorer.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects patterns found in process executions cause by China Chopper like tiny (ASPX) webshells
# Author: Florian Roth (Nextron Systems), MSTI (query)
RuleName = Chopper Webshell Process Pattern
EventType = Process.Start
Tag = proc-start-chopper-webshell-process-pattern
RiskScore = 75
Query = ((Process.Path like r"%\\w3wp.exe" or Parent.Path like r"%\\w3wp.exe") and (Process.CommandLine like r"%&ipconfig&echo%" or Process.CommandLine like r"%&quser&echo%" or Process.CommandLine like r"%&whoami&echo%" or Process.CommandLine like r"%&c:&echo%" or Process.CommandLine like r"%&cd&echo%" or Process.CommandLine like r"%&dir&echo%" or Process.CommandLine like r"%&echo [E]%" or Process.CommandLine like r"%&echo [S]%"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the use of Tor or Tor-Browser to connect to onion routing networks
# Author: frack113
RuleName = Tor Client/Browser Execution
EventType = Process.Start
Tag = proc-start-tor-client/browser-execution
RiskScore = 75
Query = (Process.Path like r"%\\tor.exe" or Process.Path like r"%\\Tor Browser\\Browser\\firefox.exe")

[ActivityMonitoringRule]
# Detects a certain command line flag combination used by Microsoft.NodejsTools.PressAnyKey.exe that can be used to execute any other binary
# Author: Florian Roth (Nextron Systems)
RuleName = NodejsTools PressAnyKey Lolbin
EventType = Process.Start
Tag = proc-start-nodejstools-pressanykey-lolbin
RiskScore = 75
Query = ((Process.CommandLine like r"%Microsoft.NodejsTools.PressAnyKey.exe normal %" or (Process.CommandLine like r"%.exe normal %" and Process.CommandLine like r"%.exe")) and not ((Process.Path like r"%\\Microsoft\\NodeJsTools\\NodeJsTools%")))

[ActivityMonitoringRule]
# Detects suspicious sub processes started by the ScreenConnect client service, which indicates the use of the so-called Backstage mode
# Author: Florian Roth (Nextron Systems)
RuleName = Remote Access Tool - ScreenConnect Backstage Mode Anomaly
EventType = Process.Start
Tag = proc-start-remote-access-tool-screenconnect-backstage-mode-anomaly
RiskScore = 75
Query = (Parent.Path like r"%ScreenConnect.ClientService.exe" and (Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects changes to environment variables related to ETW logging. This could indicate potential adversaries stopping ETW providers recording loaded .NET assemblies.
# Author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)
RuleName = ETW Logging Tamper In .NET Processes
EventType = Process.Start
Tag = proc-start-etw-logging-tamper-in-.net-processes
RiskScore = 75
Query = (Process.CommandLine like r"%COMPlus\_ETWEnabled%" or Process.CommandLine like r"%COMPlus\_ETWFlags%")

[ActivityMonitoringRule]
# Detects suspicious DACL modifications to deny access to a service that affects critical trustees. This can be used to hide services or make them unstoppable.
# Author: Jonhnathan Ribeiro, oscd.community
RuleName = Deny Service Access Using Security Descriptor Tampering Via Sc.EXE
EventType = Process.Start
Tag = proc-start-deny-service-access-using-security-descriptor-tampering-via-sc.exe
RiskScore = 75
Query = ((Process.Path like r"%\\sc.exe" or Process.Name == "sc.exe") and (Process.CommandLine like r"%sdset%" and Process.CommandLine like r"%D;%") and (Process.CommandLine like r"%;IU%" or Process.CommandLine like r"%;SU%" or Process.CommandLine like r"%;BA%" or Process.CommandLine like r"%;SY%" or Process.CommandLine like r"%;WD%"))

[ActivityMonitoringRule]
# Detects a set of suspicious network related commands often used in recon stages
# Author: Florian Roth (Nextron Systems)
RuleName = Network Reconnaissance Activity
EventType = Process.Start
Tag = proc-start-network-reconnaissance-activity
RiskScore = 75
Query = (Process.CommandLine like r"%nslookup%" and Process.CommandLine like r"%\_ldap.\_tcp.dc.\_msdcs.%")

[ActivityMonitoringRule]
# Detects the execution of "whoami.exe" with the "/all" flag or with redirection options to export the results to a file for later use.
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Whoami.EXE Execution
EventType = Process.Start
Tag = proc-start-suspicious-whoami.exe-execution
RiskScore = 75
Query = (((Process.Path like r"%\\whoami.exe" or Process.Name == "whoami.exe") and (Process.CommandLine like r"% -all%" or Process.CommandLine like r"% /all%" or Process.CommandLine like r"% /FO CSV%" or Process.CommandLine like r"% -FO CSV%")) or (Process.CommandLine like r"%whoami%" and Process.CommandLine like r"%>%"))

[ActivityMonitoringRule]
# Detects usage of the Chisel tunneling tool via the commandline arguments
# Author: Florian Roth (Nextron Systems)
RuleName = PUA - Chisel Tunneling Tool Execution
EventType = Process.Start
Tag = proc-start-pua-chisel-tunneling-tool-execution
RiskScore = 75
Query = (Process.Path like r"%\\chisel.exe" or ((Process.CommandLine like r"%exe client %" or Process.CommandLine like r"%exe server %") and (Process.CommandLine like r"%-socks5%" or Process.CommandLine like r"%-reverse%" or Process.CommandLine like r"% r:%" or Process.CommandLine like r"%:127.0.0.1:%" or Process.CommandLine like r"%-tls-skip-verify %" or Process.CommandLine like r"%:socks%")))

[ActivityMonitoringRule]
# Detects the execution of an executable that is typically used by PlugX for DLL side loading starting from an uncommon location
# Author: Florian Roth (Nextron Systems)
RuleName = Potential PlugX Activity
EventType = Process.Start
Tag = proc-start-potential-plugx-activity
RiskScore = 75
Query = ((((((((((((Process.Path like r"%\\CamMute.exe" and not ((Process.Path like r"%\\Lenovo\\Communication Utility\\%" or Process.Path like r"%\\Lenovo\\Communications Utility\\%"))) or (Process.Path like r"%\\chrome\_frame\_helper.exe" and not (Process.Path like r"%\\Google\\Chrome\\application\\%"))) or (Process.Path like r"%\\dvcemumanager.exe" and not (Process.Path like r"%\\Microsoft Device Emulator\\%"))) or (Process.Path like r"%\\Gadget.exe" and not (Process.Path like r"%\\Windows Media Player\\%"))) or (Process.Path like r"%\\hcc.exe" and not (Process.Path like r"%\\HTML Help Workshop\\%"))) or (Process.Path like r"%\\hkcmd.exe" and not ((Process.Path like r"%\\System32\\%" or Process.Path like r"%\\SysNative\\%" or Process.Path like r"%\\SysWow64\\%")))) or (Process.Path like r"%\\Mc.exe" and not ((Process.Path like r"%\\Microsoft Visual Studio%" or Process.Path like r"%\\Microsoft SDK%" or Process.Path like r"%\\Windows Kit%")))) or (Process.Path like r"%\\MsMpEng.exe" and not ((Process.Path like r"%\\Microsoft Security Client\\%" or Process.Path like r"%\\Windows Defender\\%" or Process.Path like r"%\\AntiMalware\\%")))) or (Process.Path like r"%\\msseces.exe" and not ((Process.Path like r"%\\Microsoft Security Center\\%" or Process.Path like r"%\\Microsoft Security Client\\%" or Process.Path like r"%\\Microsoft Security Essentials\\%")))) or (Process.Path like r"%\\OInfoP11.exe" and not (Process.Path like r"%\\Common Files\\Microsoft Shared\\%"))) or (Process.Path like r"%\\OleView.exe" and not ((Process.Path like r"%\\Microsoft Visual Studio%" or Process.Path like r"%\\Microsoft SDK%" or Process.Path like r"%\\Windows Kit%" or Process.Path like r"%\\Windows Resource Kit\\%")))) or (Process.Path like r"%\\rc.exe" and not ((Process.Path like r"%\\Microsoft Visual Studio%" or Process.Path like r"%\\Microsoft SDK%" or Process.Path like r"%\\Windows Kit%" or Process.Path like r"%\\Windows Resource Kit\\%" or Process.Path like r"%\\Microsoft.NET\\%"))))

[ActivityMonitoringRule]
# The Tasks folder in system32 and syswow64 are globally writable paths.
# Adversaries can take advantage of this and load or influence any script hosts or ANY .NET Application 
# in Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr
# Author: Sreeman
RuleName = Tasks Folder Evasion
EventType = Process.Start
Tag = proc-start-tasks-folder-evasion
RiskScore = 75
Query = ((Process.CommandLine like r"%echo %" or Process.CommandLine like r"%copy %" or Process.CommandLine like r"%type %" or Process.CommandLine like r"%file createnew%") and (Process.CommandLine like r"% C:\\Windows\\System32\\Tasks\\%" or Process.CommandLine like r"% C:\\Windows\\SysWow64\\Tasks\\%"))

[ActivityMonitoringRule]
# Detects Trojan loader activity as used by APT28
# Author: Florian Roth (Nextron Systems), Jonhnathan Ribeiro, oscd.community
RuleName = Sofacy Trojan Loader Activity
EventType = Process.Start
Tag = proc-start-sofacy-trojan-loader-activity
RiskScore = 75
Query = ((Process.CommandLine like r"%rundll32.exe%" and Process.CommandLine like r"%\%APPDATA\%\\%") and (Process.CommandLine like r"%.dat\",%" or (Process.CommandLine like r"%.dll\",#1" or Process.CommandLine like r"%.dll #1" or Process.CommandLine like r"%.dll\" #1")))

[ActivityMonitoringRule]
# Detects potential exploitation attempt of undocumented Windows Server Pre Auth Remote Code Execution (RCE)
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali
RuleName = Potential Exploitation Attempt Of Undocumented WindowsServer RCE
EventType = Process.Start
Tag = proc-start-potential-exploitation-attempt-of-undocumented-windowsserver-rce
RiskScore = 75
Query = (Parent.Path like r"%\\svchost.exe" and Process.Path like r"%\\svchost.exe" and Parent.CommandLine like r"%-k DHCPServer%" and Process.CommandLine like r"%-k DHCPServer%" and (Process.User like r"%NETWORK SERVICE%" or Process.User like r"%NETZWERKDIENST%" or Process.User like r"%SERVIZIO DI RETE%" or Process.User like r"%SERVICIO DE RED%"))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine
GenericProperty3 = Process.User

[ActivityMonitoringRule]
# Detects WMIC executions in which an event consumer gets created. This could be used to establish persistence
# Author: Florian Roth (Nextron Systems)
RuleName = New ActiveScriptEventConsumer Created Via Wmic.EXE
EventType = Process.Start
Tag = proc-start-new-activescripteventconsumer-created-via-wmic.exe
RiskScore = 75
Query = (Process.CommandLine like r"%ActiveScriptEventConsumer%" and Process.CommandLine like r"% CREATE %")

[ActivityMonitoringRule]
# Detects registry modifications potentially related to the Ke3chang/TidePool malware as seen in campaigns running in 2019 and 2020
# Author: Markus Neis, Swisscom
RuleName = Potential Ke3chang/TidePool Malware Activity
EventType = Process.Start
Tag = proc-start-potential-ke3chang/tidepool-malware-activity
RiskScore = 75
Query = (Process.CommandLine like r"%-Property DWORD -name DisableFirstRunCustomize -value 2 -Force%" or Process.CommandLine like r"%-Property String -name Check\_Associations -value%" or Process.CommandLine like r"%-Property DWORD -name IEHarden -value 0 -Force%")

[ActivityMonitoringRule]
# Detects possible NTLM coercion via certutil using the 'syncwithWU' flag
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential NTLM Coercion Via Certutil.EXE
EventType = Process.Start
Tag = proc-start-potential-ntlm-coercion-via-certutil.exe
RiskScore = 75
Query = ((Process.Path like r"%\\certutil.exe" or Process.Name == "CertUtil.exe") and (Process.CommandLine like r"% -syncwithWU %" and Process.CommandLine like r"% \\\\\*"))

[ActivityMonitoringRule]
# WinPEAS is a script that search for possible paths to escalate privileges on Windows hosts. The checks are explained on book.hacktricks.xyz
# Author: Georg Lauenstein
RuleName = HackTool - winPEAS Execution
EventType = Process.Start
Tag = proc-start-hacktool-winpeas-execution
RiskScore = 75
Query = ((Process.Path like r"%\\winPEASany.exe" or Process.Path like r"%\\winPEASany\_ofs.exe" or Process.Path like r"%\\winPEASx64.exe" or Process.Path like r"%\\winPEASx64\_ofs.exe" or Process.Path like r"%\\winPEASx86.exe" or Process.Path like r"%\\winPEASx86\_ofs.exe") or Process.Name == "winPEAS.exe" or (Process.CommandLine like r"%serviceinfo" or Process.CommandLine like r"%applicationsinfo" or Process.CommandLine like r"%windowscreds" or Process.CommandLine like r"%browserinfo " or Process.CommandLine like r"%fileanalysis") or Process.CommandLine like r"%.exe browserinfo %")

[ActivityMonitoringRule]
# Detects the usage of schtasks with the delete flag and the asterisk symbole to delete all tasks from the schedule of the local computer, including tasks scheduled by other users.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Delete All Scheduled Tasks
EventType = Process.Start
Tag = proc-start-delete-all-scheduled-tasks
RiskScore = 75
Query = (Process.Path like r"%\\schtasks.exe" and Process.CommandLine like r"% /delete %" and Process.CommandLine like r"%/tn \*" and Process.CommandLine like r"% /f%")

[ActivityMonitoringRule]
# Detects process execution patterns found in intrusions related to the Hermetic Wiper malware attacks against Ukraine in February 2022
# Author: Florian Roth (Nextron Systems)
RuleName = Hermetic Wiper TG Process Patterns
EventType = Process.Start
Tag = proc-start-hermetic-wiper-tg-process-patterns
RiskScore = 75
Query = (Process.Path like r"%\\policydefinitions\\postgresql.exe" or (Process.CommandLine like r"%CSIDL\_SYSTEM\_DRIVE\\temp\\sys.tmp%" or Process.CommandLine like r"% 1> \\\\127.0.0.1\\ADMIN$\\\_\_16%") or (Process.CommandLine like r"%powershell -c %" and Process.CommandLine like r"%\\comsvcs.dll MiniDump %" and Process.CommandLine like r"%\\winupd.log full%"))

[ActivityMonitoringRule]
# Detects Archer malware invocation via rundll32
# Author: Florian Roth (Nextron Systems)
RuleName = Fireball Archer Install
EventType = Process.Start
Tag = proc-start-fireball-archer-install
RiskScore = 75
Query = (Process.CommandLine like r"%rundll32.exe%" and Process.CommandLine like r"%InstallArcherSvc%")

[ActivityMonitoringRule]
# Detects the exploitation of Zoho ManageEngine Desktop Central Java Deserialization vulnerability reported as CVE-2020-10189
# Author: Florian Roth (Nextron Systems)
RuleName = Exploited CVE-2020-10189 Zoho ManageEngine
EventType = Process.Start
Tag = proc-start-exploited-cve-2020-10189-zoho-manageengine
RiskScore = 75
Query = (Parent.Path like r"%DesktopCentral\_Server\\jre\\bin\\java.exe" and (Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\bitsadmin.exe" or Process.Path like r"%\\systeminfo.exe" or Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe" or Process.Path like r"%\\reg.exe" or Process.Path like r"%\\query.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter in combination with the lsass.exe process. This way we're also able to catch cases in which the attacker has renamed the procdump executable.
# Author: Florian Roth (Nextron Systems)
RuleName = Potential LSASS Process Dump Via Procdump
EventType = Process.Start
Tag = proc-start-potential-lsass-process-dump-via-procdump
RiskScore = 75
Query = ((Process.CommandLine like r"% -ma %" or Process.CommandLine like r"% /ma %") and Process.CommandLine like r"% ls%")

[ActivityMonitoringRule]
# Detects using Diskshadow.exe to execute arbitrary code in text file
# Author: Ivan Dyachkov, oscd.community
RuleName = Execution via Diskshadow.exe
EventType = Process.Start
Tag = proc-start-execution-via-diskshadow.exe
RiskScore = 75
Query = (Process.Path like r"%\\diskshadow.exe" and (Process.CommandLine like r"%/s%" or Process.CommandLine like r"%-s%"))

[ActivityMonitoringRule]
# Detects suspicious process injection using ZOHO's dctask64.exe
# Author: Florian Roth (Nextron Systems)
RuleName = ZOHO Dctask64 Process Injection
EventType = Process.Start
Tag = proc-start-zoho-dctask64-process-injection
RiskScore = 75
Query = (Process.Path like r"%\\dctask64.exe" and not (Process.CommandLine like r"%DesktopCentral\_Agent\\agent%"))

[ActivityMonitoringRule]
# Detects all Emotet like process executions that are not covered by the more generic rules
# Author: Florian Roth (Nextron Systems)
RuleName = Potential Emotet Activity
EventType = Process.Start
Tag = proc-start-potential-emotet-activity
RiskScore = 75
Query = ((Process.CommandLine like r"% -e% PAA%" or Process.CommandLine like r"%JABlAG4AdgA6AHUAcwBlAHIAcAByAG8AZgBpAGwAZQ%" or Process.CommandLine like r"%QAZQBuAHYAOgB1AHMAZQByAHAAcgBvAGYAaQBsAGUA%" or Process.CommandLine like r"%kAGUAbgB2ADoAdQBzAGUAcgBwAHIAbwBmAGkAbABlA%" or Process.CommandLine like r"%IgAoACcAKgAnACkAOwAkA%" or Process.CommandLine like r"%IAKAAnACoAJwApADsAJA%" or Process.CommandLine like r"%iACgAJwAqACcAKQA7ACQA%" or Process.CommandLine like r"%JABGAGwAeAByAGgAYwBmAGQ%" or Process.CommandLine like r"%PQAkAGUAbgB2ADoAdABlAG0AcAArACgA%" or Process.CommandLine like r"%0AJABlAG4AdgA6AHQAZQBtAHAAKwAoA%" or Process.CommandLine like r"%9ACQAZQBuAHYAOgB0AGUAbQBwACsAKA%") and not ((Process.CommandLine like r"%fAAgAEMAbwBuAHYAZQByAHQAVABvAC0ASgBzAG8AbgAgAC0ARQByAHIAbwByAEEAYwB0AGkAbwBuACAAUwBpAGwAZQBuAHQAbAB5AEMAbwBuAHQAaQBuAHUAZQ%" or Process.CommandLine like r"%wAIABDAG8AbgB2AGUAcgB0AFQAbwAtAEoAcwBvAG4AIAAtAEUAcgByAG8AcgBBAGMAdABpAG8AbgAgAFMAaQBsAGUAbgB0AGwAeQBDAG8AbgB0AGkAbgB1AGUA%" or Process.CommandLine like r"%8ACAAQwBvAG4AdgBlAHIAdABUAG8ALQBKAHMAbwBuACAALQBFAHIAcgBvAHIAQQBjAHQAaQBvAG4AIABTAGkAbABlAG4AdABsAHkAQwBvAG4AdABpAG4AdQBlA%")))

[ActivityMonitoringRule]
# Detects usage of bitsadmin downloading a file to a suspicious target folder
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleName = File Download Via Bitsadmin To A Suspicious Target Folder
EventType = Process.Start
Tag = proc-start-file-download-via-bitsadmin-to-a-suspicious-target-folder
RiskScore = 75
Query = ((Process.Path like r"%\\bitsadmin.exe" or Process.Name == "bitsadmin.exe") and (Process.CommandLine like r"% /transfer %" or Process.CommandLine like r"% /create %" or Process.CommandLine like r"% /addfile %") and (Process.CommandLine like r"%\%ProgramData\%%" or Process.CommandLine like r"%\%public\%%" or Process.CommandLine like r"%\\Desktop\\%" or Process.CommandLine like r"%C:\\Perflogs%" or Process.CommandLine like r"%C:\\ProgramData\\%" or Process.CommandLine like r"%C:\\Temp%" or Process.CommandLine like r"%C:\\Users\\Public\\%" or Process.CommandLine like r"%C:\\Windows\\%"))

[ActivityMonitoringRule]
# Detects new commands that add new printer port which point to suspicious file
# Author: EagleEye Team, Florian Roth
RuleName = Suspicious PrinterPorts Creation (CVE-2020-1048)
EventType = Process.Start
Tag = proc-start-suspicious-printerports-creation-(cve-2020-1048)
RiskScore = 75
Query = ((Process.CommandLine like r"%Add-PrinterPort -Name%" and (Process.CommandLine like r"%.exe%" or Process.CommandLine like r"%.dll%" or Process.CommandLine like r"%.bat%")) or Process.CommandLine like r"%Generic / Text Only%")

[ActivityMonitoringRule]
# Detects a suspicious program execution in Outlook temp folder
# Author: Florian Roth (Nextron Systems)
RuleName = Execution in Outlook Temp Folder
EventType = Process.Start
Tag = proc-start-execution-in-outlook-temp-folder
RiskScore = 75
Query = Process.Path like r"%\\Temporary Internet Files\\Content.Outlook\\%"

[ActivityMonitoringRule]
# Detects the execution of format.com with a suspicious filesystem selection that could indicate a defense evasion activity in which format.com is used to load malicious DLL files or other programs
# Author: Florian Roth (Nextron Systems)
RuleName = Format.com FileSystem LOLBIN
EventType = Process.Start
Tag = proc-start-format.com-filesystem-lolbin
RiskScore = 75
Query = ((Process.Path like r"%\\format.com" and Process.CommandLine like r"%/fs:%") and not (((Process.CommandLine like r"%/fs:FAT%" or Process.CommandLine like r"%/fs:exFAT%" or Process.CommandLine like r"%/fs:NTFS%" or Process.CommandLine like r"%/fs:UDF%" or Process.CommandLine like r"%/fs:ReFS%"))))

[ActivityMonitoringRule]
# Detects PowerShell command line patterns in combincation with encoded commands that often appear in malware infection chains
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious PowerShell Encoded Command Patterns
EventType = Process.Start
Tag = proc-start-suspicious-powershell-encoded-command-patterns
RiskScore = 75
Query = ((((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") or Process.Name in ["PowerShell.Exe", "pwsh.dll"]) and (Process.CommandLine like r"% -e %" or Process.CommandLine like r"% -en %" or Process.CommandLine like r"% -enc %" or Process.CommandLine like r"% -enco%") and (Process.CommandLine like r"% JAB%" or Process.CommandLine like r"% SUVYI%" or Process.CommandLine like r"% SQBFAFgA%" or Process.CommandLine like r"% aWV4I%" or Process.CommandLine like r"% IAB%" or Process.CommandLine like r"% PAA%" or Process.CommandLine like r"% aQBlAHgA%")) and not (((Parent.Path like r"%C:\\Packages\\Plugins\\Microsoft.GuestConfiguration.ConfigurationforWindows\\%" or Parent.Path like r"%\\gc\_worker.exe%"))))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects rundll32 execution without parameters as observed when running Metasploit windows/smb/psexec exploit module
# Author: Bartlomiej Czyz, Relativity
RuleName = Rundll32 Execution Without Parameters
EventType = Process.Start
Tag = proc-start-rundll32-execution-without-parameters
RiskScore = 75
Query = Process.CommandLine in ["rundll32.exe", "rundll32"]

[ActivityMonitoringRule]
# Detects cases in which an ISO files is opend within an archiver like 7Zip or Winrar, which is a sign of phishing as threat actors put small ISO files in archives as email attachments to bypass certain filters and protective measures (mark of web)
# Author: Florian Roth (Nextron Systems)
RuleName = Phishing Pattern ISO in Archive
EventType = Process.Start
Tag = proc-start-phishing-pattern-iso-in-archive
RiskScore = 75
Query = ((Parent.Path like r"%\\Winrar.exe" or Parent.Path like r"%\\7zFM.exe" or Parent.Path like r"%\\peazip.exe") and (Process.Path like r"%\\isoburn.exe" or Process.Path like r"%\\PowerISO.exe" or Process.Path like r"%\\ImgBurn.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Execute Hashcat.exe with provided SAM file from registry of Windows and Password list to crack against
# Author: frack113
RuleName = HackTool - Hashcat Password Cracker Execution
EventType = Process.Start
Tag = proc-start-hacktool-hashcat-password-cracker-execution
RiskScore = 75
Query = (Process.Path like r"%\\hashcat.exe" or (Process.CommandLine like r"%-a %" and Process.CommandLine like r"%-m 1000 %" and Process.CommandLine like r"%-r %"))

[ActivityMonitoringRule]
# Detects the usage of the "reg.exe" utility to disable PPL protection on the LSA process
# Author: Florian Roth (Nextron Systems)
RuleName = LSA PPL Protection Disabled Via Reg.EXE
EventType = Process.Start
Tag = proc-start-lsa-ppl-protection-disabled-via-reg.exe
RiskScore = 75
Query = ((Process.Path like r"%\\reg.exe" or Process.Name == "reg.exe") and (Process.CommandLine like r"%SYSTEM\\CurrentControlSet\\Control\\Lsa%" and Process.CommandLine like r"% add %" and Process.CommandLine like r"% /d 0%" and Process.CommandLine like r"% /v RunAsPPL %") and (Process.CommandLine like r"%Real-Time Protection%" or Process.CommandLine like r"%TamperProtection%"))

[ActivityMonitoringRule]
# Detects unusual parent or children of the wab.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) processes as seen being used with bumblebee activity
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Wab/Wabmig Unusual Parent Or Child Processes
EventType = Process.Start
Tag = proc-start-wab/wabmig-unusual-parent-or-child-processes
RiskScore = 75
Query = (((Parent.Path like r"%\\WmiPrvSE.exe" or Parent.Path like r"%\\svchost.exe" or Parent.Path like r"%\\dllhost.exe") and (Process.Path like r"%\\wab.exe" or Process.Path like r"%\\wabmig.exe")) or (Parent.Path like r"%\\wab.exe" or Parent.Path like r"%\\wabmig.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Disables HTTP logging on a Windows IIS web server as seen by Threat Group 3390 (Bronze Union)
# Author: frack113
RuleName = Disable Windows IIS HTTP Logging
EventType = Process.Start
Tag = proc-start-disable-windows-iis-http-logging
RiskScore = 75
Query = ((Process.Path like r"%\\appcmd.exe" or Process.Name == "appcmd.exe") and (Process.CommandLine like r"%set%" and Process.CommandLine like r"%config%" and Process.CommandLine like r"%section:httplogging%" and Process.CommandLine like r"%dontLog:true%"))

[ActivityMonitoringRule]
# Detects potential LethalHTA technique where the "mshta.exe" is spwaned by an "svchost.exe" process
# Author: Markus Neis
RuleName = Potential LethalHTA Technique Execution
EventType = Process.Start
Tag = proc-start-potential-lethalhta-technique-execution
RiskScore = 75
Query = (Parent.Path like r"%\\svchost.exe" and Process.Path like r"%\\mshta.exe")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects scheduled task creations or modification on a suspicious schedule type
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Schtasks Schedule Types
EventType = Process.Start
Tag = proc-start-suspicious-schtasks-schedule-types
RiskScore = 75
Query = (((Process.Path like r"%\\schtasks.exe" or Process.Name == "schtasks.exe") and (Process.CommandLine like r"% ONLOGON %" or Process.CommandLine like r"% ONSTART %" or Process.CommandLine like r"% ONCE %" or Process.CommandLine like r"% ONIDLE %")) and not (((Process.CommandLine like r"%NT AUT%" or Process.CommandLine like r"% SYSTEM%" or Process.CommandLine like r"%HIGHEST%"))))

[ActivityMonitoringRule]
# Well-known DNS Exfiltration tools execution
# Author: Daniil Yugoslavskiy, oscd.community
RuleName = DNS Exfiltration and Tunneling Tools Execution
EventType = Process.Start
Tag = proc-start-dns-exfiltration-and-tunneling-tools-execution
RiskScore = 75
Query = (Process.Path like r"%\\iodine.exe" or Process.Path like r"%\\dnscat2%")

[ActivityMonitoringRule]
# Detects usage of bitsadmin downloading a file with a suspicious extension
# Author: Florian Roth (Nextron Systems)
RuleName = File With Suspicious Extension Downloaded Via Bitsadmin
EventType = Process.Start
Tag = proc-start-file-with-suspicious-extension-downloaded-via-bitsadmin
RiskScore = 75
Query = ((Process.Path like r"%\\bitsadmin.exe" or Process.Name == "bitsadmin.exe") and (Process.CommandLine like r"% /transfer %" or Process.CommandLine like r"% /create %" or Process.CommandLine like r"% /addfile %") and (Process.CommandLine like r"%.asax%" or Process.CommandLine like r"%.ashx%" or Process.CommandLine like r"%.asmx%" or Process.CommandLine like r"%.asp%" or Process.CommandLine like r"%.aspx%" or Process.CommandLine like r"%.bat%" or Process.CommandLine like r"%.cfm%" or Process.CommandLine like r"%.cgi%" or Process.CommandLine like r"%.chm%" or Process.CommandLine like r"%.cmd%" or Process.CommandLine like r"%.gif%" or Process.CommandLine like r"%.jpeg%" or Process.CommandLine like r"%.jpg%" or Process.CommandLine like r"%.jsp%" or Process.CommandLine like r"%.jspx%" or Process.CommandLine like r"%.png%" or Process.CommandLine like r"%.ps1%" or Process.CommandLine like r"%.psm1%" or Process.CommandLine like r"%.scf%" or Process.CommandLine like r"%.sct%" or Process.CommandLine like r"%.txt%" or Process.CommandLine like r"%.vbe%" or Process.CommandLine like r"%.vbs%" or Process.CommandLine like r"%.war%" or Process.CommandLine like r"%.wsf%" or Process.CommandLine like r"%.wsh%" or Process.CommandLine like r"%.zip%" or Process.CommandLine like r"%.rar%" or Process.CommandLine like r"%.dll%"))

[ActivityMonitoringRule]
# Detects creation or execution of UserInitMprLogonScript persistence method
# Author: Tom Ueltschi (@c_APT_ure), Tim Shelton
RuleName = Logon Scripts (UserInitMprLogonScript)
EventType = Process.Start
Tag = proc-start-logon-scripts-(userinitmprlogonscript)
RiskScore = 75
Query = (Process.CommandLine like r"%UserInitMprLogonScript%" or (Parent.Path like r"%\\userinit.exe" and not ((Process.CommandLine like r"%netlogon%.bat%" or Process.CommandLine like r"%UsrLogon.cmd%" or Process.CommandLine like r"%C:\\WINDOWS\\Explorer.EXE%") or (Process.Path like r"%\\explorer.exe" or Process.Path like r"%\\proquota.exe" or Process.Path like r"%\\Citrix\\System32\\icast.exe"))))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious child process creations of VMware Tools process which may indicate persistence setup
# Author: behops, Bhabesh Raj
RuleName = VMToolsd Suspicious Child Process
EventType = Process.Start
Tag = proc-start-vmtoolsd-suspicious-child-process
RiskScore = 75
Query = ((Parent.Path like r"%\\vmtoolsd.exe" and ((Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\cscript.exe") or Process.Name in ["Cmd.Exe", "PowerShell.EXE", "pwsh.dll", "RUNDLL32.EXE", "REGSVR32.EXE", "wscript.exe", "cscript.exe"])) and not ((Process.CommandLine like r"%\\VMware\\VMware Tools\\poweron-vm-default.bat%" or Process.CommandLine like r"%\\VMware\\VMware Tools\\poweroff-vm-default.bat%" or Process.CommandLine like r"%\\VMware\\VMware Tools\\resume-vm-default.bat%" or Process.CommandLine like r"%\\VMware\\VMware Tools\\suspend-vm-default.bat%")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects usage of the "wusa.exe" (Windows Update Standalone Installer) utility to extract cab using the "/extract" argument from suspicious paths
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Wusa Extracting Cab Files From Suspicious Paths
EventType = Process.Start
Tag = proc-start-wusa-extracting-cab-files-from-suspicious-paths
RiskScore = 75
Query = (Process.Path like r"%\\wusa.exe" and Process.CommandLine like r"%/extract:%" and (Process.CommandLine like r"%C:\\Users\\Public\\%" or Process.CommandLine like r"%\\Desktop\\%" or Process.CommandLine like r"%\\Downloads\\%" or Process.CommandLine like r"%\\Appdata\\Local\\Temp\\%" or Process.CommandLine like r"%\\Windows\\Temp\\%" or Process.CommandLine like r"%\\PerfLogs\\%"))

[ActivityMonitoringRule]
# Detects usage of the "sc.exe" utility adding a new service with special permission seen used by threat actors which makes the service hidden and unremovable.
# Author: Andreas Hunkeler (@Karneades)
RuleName = Service DACL Abuse To Hide Services Via Sc.EXE
EventType = Process.Start
Tag = proc-start-service-dacl-abuse-to-hide-services-via-sc.exe
RiskScore = 75
Query = ((Process.Path like r"%\\sc.exe" or Process.Name == "sc.exe") and (Process.CommandLine like r"%sdset%" and Process.CommandLine like r"%DCLCWPDTSD%"))

[ActivityMonitoringRule]
# Detects suspicious use of XORDump process memory dumping utility
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - XORDump Execution
EventType = Process.Start
Tag = proc-start-hacktool-xordump-execution
RiskScore = 75
Query = (Process.Path like r"%\\xordump.exe" or (Process.CommandLine like r"% -process lsass.exe %" or Process.CommandLine like r"% -m comsvcs %" or Process.CommandLine like r"% -m dbghelp %" or Process.CommandLine like r"% -m dbgcore %"))

[ActivityMonitoringRule]
# Execution of ssh.exe to perform data exfiltration and tunneling through RDP
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential RDP Tunneling Via SSH
EventType = Process.Start
Tag = proc-start-potential-rdp-tunneling-via-ssh
RiskScore = 75
Query = (Process.Path like r"%\\ssh.exe" and Process.CommandLine like r"%:3389%")

[ActivityMonitoringRule]
# Detects successful code compilation via Visual Basic Command Line Compiler that utilizes Windows Resource to Object Converter.
# Author: Ensar Åžamil, @sblmsrsn, @oscd_initiative
RuleName = Visual Basic Command Line Compiler Usage
EventType = Process.Start
Tag = proc-start-visual-basic-command-line-compiler-usage
RiskScore = 75
Query = (Parent.Path like r"%\\vbc.exe" and Process.Path like r"%\\cvtres.exe")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects a command used by conti to find volume shadow backups
# Author: Max Altgelt (Nextron Systems), Tobias Michalski (Nextron Systems)
RuleName = Conti Volume Shadow Listing
EventType = Process.Start
Tag = proc-start-conti-volume-shadow-listing
RiskScore = 75
Query = (Process.CommandLine like r"%vssadmin list shadows%" and Process.CommandLine like r"%log.txt%")

[ActivityMonitoringRule]
# Checks whether the image specified in a process creation event doesn't refer to an .exe file (caused by process ghosting or other unorthodox methods to start a process)
# Author: Max Altgelt (Nextron Systems)
RuleName = Execution of Suspicious File Type Extension
EventType = Process.Start
Tag = proc-start-execution-of-suspicious-file-type-extension
RiskScore = 75
Query = (not ((Process.Path like r"%.exe" or Process.Path like r"%.tmp")) and not ((Process.Path == '') or (Process.Path in ["System", "Registry", "MemCompression", "vmmem"]) or (Process.Path in ["-", ""]) or (Process.Path like r"C:\\Windows\\Installer\\MSI%") or ((Parent.Path like r"C:\\ProgramData\\Avira\\%" or Parent.Path like r"C:\\Windows\\System32\\DriverStore\\FileRepository\\%")) or (Process.Path like r"%.scr") or (Process.Path like r"%NVIDIA\\NvBackend\\%" and Process.Path like r"%.dat") or ((Process.Path like r"C:\\Windows\\System32\\%" or Process.Path like r"C:\\Windows\\SysWOW64\\%") and Process.Path like r"%.com") or (Process.Path like r"%\\WinSCP.com") or (Process.Path like r"%C:\\Users\\%" and Process.Path like r"%\\AppData\\%" and Process.Path like r"%.tmp%" and Process.Path like r"%CodeSetup%") or (Process.Path like r"%\\program\\soffice.bin") or ((Process.Path like r"C:\\Program Files\\EMC NetWorker\\Management\\GST\\apache\\cgi-bin\\update\_jnlp.cgi" or Process.Path like r"C:\\Program Files (x86)\\EMC NetWorker\\Management\\GST\\apache\\cgi-bin\\update\_jnlp.cgi")) or ((Process.Path like r"C:\\Program Files (x86)\\WINPAKPRO\\%" or Process.Path like r"C:\\Program Files\\WINPAKPRO\\%") and Process.Path like r"%.ngn") or ((Process.Path like r"C:\\Program Files (x86)\\MyQ\\Server\\pcltool.dll" or Process.Path like r"C:\\Program Files\\MyQ\\Server\\pcltool.dll")) or ((Process.Path like r"C:\\Program Files\\Microsoft Visual Studio\\%" or Process.Path like r"C:\\Program Files (x86)\\Microsoft Visual Studio%") and Process.Path like r"%.com") or (Process.Path like r"C:\\Config.Msi\\%" and (Process.Path like r"%.rbf" or Process.Path like r"%.rbs")) or (Process.Path like r"%\\AppData\\Local\\Packages\\%" and Process.Path like r"%\\LocalState\\rootfs\\%") or (Process.Path like r"%\\LZMA\_EXE") or (Parent.Path like r"C:\\Windows\\Temp\\%" and Process.Path like r"C:\\Windows\\Temp\\Helper\\%") or (Parent.Path like r"C:\\Windows\\Temp\\%" and Parent.Path like r"%\\TBT\_Dock\_Firmware\\GetDockVer32W.exe") or (Process.Path like r"C:\\Program Files\\Mozilla Firefox\\tobedeleted\\%")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects a "dllhost" process spawning with no commandline arguments which is very rare to happen and could indicate process injection activity or malware mimicking similar system processes.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Dllhost.EXE Execution Anomaly
EventType = Process.Start
Tag = proc-start-dllhost.exe-execution-anomaly
RiskScore = 75
Query = (Process.CommandLine like r"%dllhost.exe" and Process.Path like r"%\\dllhost.exe")

[ActivityMonitoringRule]
# Detects suspicious process related to rundll32 based on command line that invokes inline VBScript as seen being used by UNC2452
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Rundll32 Invoking Inline VBScript
EventType = Process.Start
Tag = proc-start-suspicious-rundll32-invoking-inline-vbscript
RiskScore = 75
Query = (Process.CommandLine like r"%rundll32.exe%" and Process.CommandLine like r"%Execute%" and Process.CommandLine like r"%RegRead%" and Process.CommandLine like r"%window.close%")

[ActivityMonitoringRule]
# detects the usage of path traversal in conhost.exe indicating possible command/argument confusion/hijacking
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Conhost.exe CommandLine Path Traversal
EventType = Process.Start
Tag = proc-start-conhost.exe-commandline-path-traversal
RiskScore = 75
Query = (Parent.CommandLine like r"%conhost%" and Process.CommandLine like r"%/../../%")
GenericProperty1 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects a regedit started with TrustedInstaller privileges or by ProcessHacker.exe
# Author: Florian Roth (Nextron Systems)
RuleName = Regedit as Trusted Installer
EventType = Process.Start
Tag = proc-start-regedit-as-trusted-installer
RiskScore = 75
Query = (Process.Path like r"%\\regedit.exe" and (Parent.Path like r"%\\TrustedInstaller.exe" or Parent.Path like r"%\\ProcessHacker.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects use of Cobalt Strike commands accidentally entered in the CMD shell
# Author: _pete_0, TheDFIRReport
RuleName = Operator Bloopers Cobalt Strike Commands
EventType = Process.Start
Tag = proc-start-operator-bloopers-cobalt-strike-commands
RiskScore = 75
Query = ((Process.Name == "Cmd.Exe" or Process.Path like r"%\\cmd.exe") and ((Process.CommandLine like r"cmd %" or Process.CommandLine like r"cmd.exe%" or Process.CommandLine like r"c:\\windows\\system32\\cmd.exe%") and (Process.CommandLine like r"%psinject%" or Process.CommandLine like r"%spawnas%" or Process.CommandLine like r"%make\_token%" or Process.CommandLine like r"%remote-exec%" or Process.CommandLine like r"%rev2self%" or Process.CommandLine like r"%dcsync%" or Process.CommandLine like r"%logonpasswords%" or Process.CommandLine like r"%execute-assembly%" or Process.CommandLine like r"%getsystem%")))

[ActivityMonitoringRule]
# Detects commands that indicate a Raccine removal from an end system. Raccine is a free ransomware protection tool.
# Author: Florian Roth (Nextron Systems)
RuleName = Raccine Uninstall
EventType = Process.Start
Tag = proc-start-raccine-uninstall
RiskScore = 75
Query = ((Process.CommandLine like r"%taskkill %" and Process.CommandLine like r"%RaccineSettings.exe%") or (Process.CommandLine like r"%reg.exe%" and Process.CommandLine like r"%delete%" and Process.CommandLine like r"%Raccine Tray%") or (Process.CommandLine like r"%schtasks%" and Process.CommandLine like r"%/DELETE%" and Process.CommandLine like r"%Raccine Rules Updater%"))

[ActivityMonitoringRule]
# Detects the presence of the "u202+E" character, which causes a terminal, browser, or operating system to render text in a right-to-left sequence.
# This is used as an obfuscation and masquerading techniques.
# Author: Micah Babinski, @micahbabinski
RuleName = Potential Defense Evasion Via Right-to-Left Override
EventType = Process.Start
Tag = proc-start-potential-defense-evasion-via-right-to-left-override
RiskScore = 75
Query = Process.CommandLine like r"%â€®%"

[ActivityMonitoringRule]
# Detects the execution of powershell, a WebClient object creation and the invocation of DownloadFile in a single command line
# Author: Florian Roth (Nextron Systems)
RuleName = PowerShell DownloadFile
EventType = Process.Start
Tag = proc-start-powershell-downloadfile
RiskScore = 75
Query = (Process.CommandLine like r"%powershell%" and Process.CommandLine like r"%.DownloadFile%" and Process.CommandLine like r"%System.Net.WebClient%")

[ActivityMonitoringRule]
# Detects Formbook like process executions that inject code into a set of files in the System32 folder, which executes a special command command line to delete the dropper from the AppData Temp folder. We avoid false positives by excluding all parent process with command line parameters.
# Author: Florian Roth (Nextron Systems), oscd.community, Jonhnathan Ribeiro
RuleName = Formbook Process Creation
EventType = Process.Start
Tag = proc-start-formbook-process-creation
RiskScore = 75
Query = (((Parent.CommandLine like r"C:\\Windows\\System32\\%" or Parent.CommandLine like r"C:\\Windows\\SysWOW64\\%") and Parent.CommandLine like r"%.exe") and ((Process.CommandLine like r"%/c%" and Process.CommandLine like r"%del%" and Process.CommandLine like r"%C:\\Users\\%" and Process.CommandLine like r"%\\AppData\\Local\\Temp\\%") or (Process.CommandLine like r"%/c%" and Process.CommandLine like r"%del%" and Process.CommandLine like r"%C:\\Users\\%" and Process.CommandLine like r"%\\Desktop\\%") or (Process.CommandLine like r"%/C%" and Process.CommandLine like r"%type nul >%" and Process.CommandLine like r"%C:\\Users\\%" and Process.CommandLine like r"%\\Desktop\\%")) and Process.CommandLine like r"%.exe")
GenericProperty1 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects suspicious Windows Update Agent activity in which a wuauclt.exe process command line doesn't contain any command line flags
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Windows Update Agent Empty Cmdline
EventType = Process.Start
Tag = proc-start-suspicious-windows-update-agent-empty-cmdline
RiskScore = 75
Query = ((Process.Path like r"%\\Wuauclt.exe" or Process.Name == "Wuauclt.exe") and Process.CommandLine like r"%\\Wuauclt.exe")

[ActivityMonitoringRule]
# Detect filter driver unloading activity via fltmc.exe
# Author: Nasreddine Bencherchali
RuleName = Filter Driver Unloaded Via Fltmc.EXE
EventType = Process.Start
Tag = proc-start-filter-driver-unloaded-via-fltmc.exe
RiskScore = 75
Query = (((Process.Path like r"%\\fltMC.exe" or Process.Name == "fltMC.exe") and Process.CommandLine like r"%unload%") and not ((Process.CommandLine like r"%unload rtp\_filesystem\_filter")))

[ActivityMonitoringRule]
# Detects a suspicious process command line that uses whoami as first parameter (as e.g. used by EfsPotato)
# Author: Florian Roth (Nextron Systems)
RuleName = WhoAmI as Parameter
EventType = Process.Start
Tag = proc-start-whoami-as-parameter
RiskScore = 75
Query = Process.CommandLine like r"%.exe whoami%"

[ActivityMonitoringRule]
# Detects suspicious addition to BitLocker related registry keys via the reg.exe utility
# Author: frack113
RuleName = Suspicious Reg Add BitLocker
EventType = Process.Start
Tag = proc-start-suspicious-reg-add-bitlocker
RiskScore = 75
Query = (Process.CommandLine like r"%REG%" and Process.CommandLine like r"%ADD%" and Process.CommandLine like r"%\\SOFTWARE\\Policies\\Microsoft\\FVE%" and Process.CommandLine like r"%/v%" and Process.CommandLine like r"%/f%" and (Process.CommandLine like r"%EnableBDEWithNoTPM%" or Process.CommandLine like r"%UseAdvancedStartup%" or Process.CommandLine like r"%UseTPM%" or Process.CommandLine like r"%UseTPMKey%" or Process.CommandLine like r"%UseTPMKeyPIN%" or Process.CommandLine like r"%RecoveryKeyMessageSource%" or Process.CommandLine like r"%UseTPMPIN%" or Process.CommandLine like r"%RecoveryKeyMessage%"))

[ActivityMonitoringRule]
# Detects an unexpected process spawning from dns.exe which may indicate activity related to remote code execution or other forms of exploitation as seen in CVE-2020-1350 (SigRed)
# Author: Tim Rauch
RuleName = Unusual Child Process of dns.exe
EventType = Process.Start
Tag = proc-start-unusual-child-process-of-dns.exe
RiskScore = 75
Query = (Parent.Path like r"%\\dns.exe" and not (Process.Path like r"%\\conhost.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects command line patterns used by BlackByte ransomware in different operations
# Author: Florian Roth (Nextron Systems)
RuleName = Potential BlackByte Ransomware Activity
EventType = Process.Start
Tag = proc-start-potential-blackbyte-ransomware-activity
RiskScore = 75
Query = ((Process.Path like r"C:\\Users\\Public\\%" and Process.CommandLine like r"% -single %") or (Process.CommandLine like r"%del C:\\Windows\\System32\\Taskmgr.exe%" or Process.CommandLine like r"%;Set-Service -StartupType Disabled $%" or Process.CommandLine like r"%powershell -command \"$x =[System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String(%" or Process.CommandLine like r"% do start wordpad.exe /p %"))

[ActivityMonitoringRule]
# Detects suspicious Hangul Word Processor (Hanword) sub processes that could indicate an exploitation
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious HWP Sub Processes
EventType = Process.Start
Tag = proc-start-suspicious-hwp-sub-processes
RiskScore = 75
Query = (Parent.Path like r"%\\Hwp.exe" and Process.Path like r"%\\gbb.exe")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the creation of a schtask that executes a base64 encoded payload stored in the Windows Registry using PowerShell.
# Author: pH-T (Nextron Systems), @Kostastsale, @TheDFIRReport
RuleName = Scheduled Task Executing Powershell Encoded Payload from Registry
EventType = Process.Start
Tag = proc-start-scheduled-task-executing-powershell-encoded-payload-from-registry
RiskScore = 75
Query = ((Process.Path like r"%\\schtasks.exe" or Process.Name == "schtasks.exe") and (Process.CommandLine like r"%/Create%" and Process.CommandLine like r"%FromBase64String%" and Process.CommandLine like r"%Get-ItemProperty%" and (Process.CommandLine like r"%HKCU:%" or Process.CommandLine like r"%HKLM:%" or Process.CommandLine like r"%registry::%" or Process.CommandLine like r"%HKEY\_%")))

[ActivityMonitoringRule]
# Detects one of the possible scenarios for disabling Symantec Endpoint Protection.
# Symantec Endpoint Protection antivirus software services incorrectly implement the protected service mechanism.
# As a result, the NT AUTHORITY/SYSTEM user can execute the taskkill /im command several times ccSvcHst.exe /f, thereby killing the process belonging to the service, and thus shutting down the service.
# Author: Ilya Krestinichev, Florian Roth (Nextron Systems)
RuleName = Taskkill Symantec Endpoint Protection
EventType = Process.Start
Tag = proc-start-taskkill-symantec-endpoint-protection
RiskScore = 75
Query = (Process.CommandLine like r"%taskkill%" and Process.CommandLine like r"% /F %" and Process.CommandLine like r"% /IM %" and Process.CommandLine like r"%ccSvcHst.exe%")

[ActivityMonitoringRule]
# Detects usage of bitsadmin downloading a file from a suspicious domain
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Download From File-Sharing Website Via Bitsadmin
EventType = Process.Start
Tag = proc-start-suspicious-download-from-file-sharing-website-via-bitsadmin
RiskScore = 75
Query = ((Process.Path like r"%\\bitsadmin.exe" or Process.Name == "bitsadmin.exe") and (Process.CommandLine like r"% /transfer %" or Process.CommandLine like r"% /create %" or Process.CommandLine like r"% /addfile %") and (Process.CommandLine like r"%.ghostbin.co/%" or Process.CommandLine like r"%.hastebin.com%" or Process.CommandLine like r"%.paste.ee%" or Process.CommandLine like r"%anonfiles.com%" or Process.CommandLine like r"%cdn.discordapp.com/attachments/%" or Process.CommandLine like r"%ddns.net%" or Process.CommandLine like r"%gist.githubusercontent.com%" or Process.CommandLine like r"%mediafire.com%" or Process.CommandLine like r"%mega.nz%" or Process.CommandLine like r"%paste.ee%" or Process.CommandLine like r"%pastebin.com%" or Process.CommandLine like r"%pastebin.pl%" or Process.CommandLine like r"%pastetext.net%" or Process.CommandLine like r"%privatlab.com%" or Process.CommandLine like r"%privatlab.net%" or Process.CommandLine like r"%raw.githubusercontent.com%" or Process.CommandLine like r"%send.exploit.in%" or Process.CommandLine like r"%sendspace.com%" or Process.CommandLine like r"%storage.googleapis.com%" or Process.CommandLine like r"%transfer.sh%" or Process.CommandLine like r"%ufile.io%"))

[ActivityMonitoringRule]
# Detection of unusual child processes by different system processes
# Author: Semanur Guneysu @semanurtg, oscd.community
RuleName = Abused Debug Privilege by Arbitrary Parent Processes
EventType = Process.Start
Tag = proc-start-abused-debug-privilege-by-arbitrary-parent-processes
RiskScore = 75
Query = ((((Parent.Path like r"%\\winlogon.exe" or Parent.Path like r"%\\services.exe" or Parent.Path like r"%\\lsass.exe" or Parent.Path like r"%\\csrss.exe" or Parent.Path like r"%\\smss.exe" or Parent.Path like r"%\\wininit.exe" or Parent.Path like r"%\\spoolsv.exe" or Parent.Path like r"%\\searchindexer.exe") and (Process.User like r"%AUTHORI%" or Process.User like r"%AUTORI%")) and ((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\cmd.exe") or Process.Name in ["PowerShell.EXE", "pwsh.dll", "Cmd.Exe"])) and not (Process.CommandLine like r"% route %" and Process.CommandLine like r"% ADD %"))
GenericProperty1 = Parent.Path
GenericProperty2 = Process.User

[ActivityMonitoringRule]
# Detects the use of HandleKatz, a tool that demonstrates the usage of cloned handles to Lsass in order to create an obfuscated memory dump of the same
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - HandleKatz LSASS Dumper Execution
EventType = Process.Start
Tag = proc-start-hacktool-handlekatz-lsass-dumper-execution
RiskScore = 75
Query = ((Process.Path like r"%\\loader.exe" and Process.CommandLine like r"%--pid:%") or (Process.Hash.IMP in ["38d9e015591bbfd4929e0d0f47fa0055", "0e2216679ca6e1094d63322e3412d650"] or Process.Hashes in ["IMPHASH=38D9E015591BBFD4929E0D0F47FA0055", "IMPHASH=0E2216679CA6E1094D63322E3412D650"]) or (Process.CommandLine like r"%--pid:%" and Process.CommandLine like r"%--outfile:%" and (Process.CommandLine like r"%.dmp%" or Process.CommandLine like r"%lsass%" or Process.CommandLine like r"%.obf%" or Process.CommandLine like r"%dump%")))
GenericProperty1 = Process.Hash.IMP
GenericProperty2 = Process.Hashes

[ActivityMonitoringRule]
# Detects a remote file copy attempt to a hidden network share. This may indicate lateral movement or data staging activity.
# Author: Tim Rauch
RuleName = Privilege Escalation via Named Pipe Impersonation
EventType = Process.Start
Tag = proc-start-privilege-escalation-via-named-pipe-impersonation
RiskScore = 75
Query = (((Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\powershell.exe") or Process.Name in ["Cmd.Exe", "PowerShell.EXE"]) and (Process.CommandLine like r"%echo%" and Process.CommandLine like r"%>%" and Process.CommandLine like r"%\\\\.\\pipe\\\*"))

[ActivityMonitoringRule]
# Detects processes leveraging the "ms-msdt" handler or the "msdt.exe" binary to execute arbitrary commands as seen in the follina (CVE-2022-30190) vulnerability
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential Arbitrary Command Execution Using Msdt.EXE
EventType = Process.Start
Tag = proc-start-potential-arbitrary-command-execution-using-msdt.exe
RiskScore = 75
Query = ((Process.Path like r"%\\msdt.exe" or Process.Name == "msdt.exe") and (Process.CommandLine like r"%IT\_BrowseForFile=%" or (Process.CommandLine like r"% PCWDiagnostic%" and (Process.CommandLine like r"% /af %" or Process.CommandLine like r"% -af %"))))

[ActivityMonitoringRule]
# Detects suspicious command lines used in Covenant luanchers
# Author: Florian Roth (Nextron Systems), Jonhnathan Ribeiro, oscd.community
RuleName = HackTool - Covenant PowerShell Launcher
EventType = Process.Start
Tag = proc-start-hacktool-covenant-powershell-launcher
RiskScore = 75
Query = ((Process.CommandLine like r"%-Sta%" and Process.CommandLine like r"%-Nop%" and Process.CommandLine like r"%-Window%" and Process.CommandLine like r"%Hidden%" and (Process.CommandLine like r"%-Command%" or Process.CommandLine like r"%-EncodedCommand%")) or (Process.CommandLine like r"%sv o (New-Object IO.MemorySteam);sv d %" or Process.CommandLine like r"%mshta file.hta%" or Process.CommandLine like r"%GruntHTTP%" or Process.CommandLine like r"%-EncodedCommand cwB2ACAAbwAgA%"))

[ActivityMonitoringRule]
# Detects a Windows program executable started from a suspicious folder
# Author: Florian Roth (Nextron Systems), Patrick Bareiss, Anton Kutepov, oscd.community, Nasreddine Bencherchali
RuleName = System File Execution Location Anomaly
EventType = Process.Start
Tag = proc-start-system-file-execution-location-anomaly
RiskScore = 75
Query = ((Process.Path like r"%\\svchost.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\services.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\powershell\_ise.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\spoolsv.exe" or Process.Path like r"%\\lsass.exe" or Process.Path like r"%\\smss.exe" or Process.Path like r"%\\csrss.exe" or Process.Path like r"%\\conhost.exe" or Process.Path like r"%\\wininit.exe" or Process.Path like r"%\\lsm.exe" or Process.Path like r"%\\winlogon.exe" or Process.Path like r"%\\explorer.exe" or Process.Path like r"%\\taskhost.exe" or Process.Path like r"%\\Taskmgr.exe" or Process.Path like r"%\\sihost.exe" or Process.Path like r"%\\RuntimeBroker.exe" or Process.Path like r"%\\smartscreen.exe" or Process.Path like r"%\\dllhost.exe" or Process.Path like r"%\\audiodg.exe" or Process.Path like r"%\\wlanext.exe" or Process.Path like r"%\\dashost.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\wsl.exe" or Process.Path like r"%\\bitsadmin.exe" or Process.Path like r"%\\atbroker.exe" or Process.Path like r"%\\bcdedit.exe" or Process.Path like r"%\\certutil.exe" or Process.Path like r"%\\certreq.exe" or Process.Path like r"%\\cmstp.exe" or Process.Path like r"%\\consent.exe" or Process.Path like r"%\\defrag.exe" or Process.Path like r"%\\dism.exe" or Process.Path like r"%\\dllhst3g.exe" or Process.Path like r"%\\eventvwr.exe" or Process.Path like r"%\\msiexec.exe" or Process.Path like r"%\\runonce.exe" or Process.Path like r"%\\winver.exe" or Process.Path like r"%\\logonui.exe" or Process.Path like r"%\\userinit.exe" or Process.Path like r"%\\dwm.exe" or Process.Path like r"%\\LsaIso.exe" or Process.Path like r"%\\ntoskrnl.exe" or Process.Path like r"%\\wsmprovhost.exe" or Process.Path like r"%\\dfrgui.exe") and not (((Process.Path like r"C:\\Windows\\System32\\%" or Process.Path like r"C:\\Windows\\SysWOW64\\%" or Process.Path like r"C:\\Windows\\WinSxS\\%") or Process.Path like r"%\\SystemRoot\\System32\\%" or (Process.Path like r"C:\\Windows\\explorer.exe" or Process.Path like r"C:\\Program Files\\PowerShell\\7\\pwsh.exe")) or (Process.Path like r"C:\\Program Files\\WindowsApps\\MicrosoftCorporationII.WindowsSubsystemForLinux%" and Process.Path like r"%\\wsl.exe")))

[ActivityMonitoringRule]
# Detects when a user bypasses Defender by renaming a tool to dump64.exe and placing it in a Visual Studio folder
# Author: Austin Songer @austinsonger, Florian Roth
RuleName = Suspicious Dump64.exe Execution
EventType = Process.Start
Tag = proc-start-suspicious-dump64.exe-execution
RiskScore = 75
Query = ((Process.Path like r"%\\dump64.exe" and not (Process.Path like r"%\\Installer\\Feedback\\dump64.exe%")) or (Process.Path like r"%\\dump64.exe" and (Process.CommandLine like r"% -ma %" or Process.CommandLine like r"%accpeteula%")))

[ActivityMonitoringRule]
# Detects usage of the netsh command to open and allow connections to port 3389 (RDP). As seen used by Sarwent Malware
# Author: Sander Wiebing
RuleName = RDP Connection Allowed Via Netsh.EXE
EventType = Process.Start
Tag = proc-start-rdp-connection-allowed-via-netsh.exe
RiskScore = 75
Query = ((Process.Path like r"%\\netsh.exe" or Process.Name == "netsh.exe") and (Process.CommandLine like r"%firewall %" and Process.CommandLine like r"%add %" and Process.CommandLine like r"%tcp %" and Process.CommandLine like r"%3389%") and (Process.CommandLine like r"%portopening%" or (Process.CommandLine like r"%advfirewall%" and Process.CommandLine like r"%rule%" and Process.CommandLine like r"%allow%")))

[ActivityMonitoringRule]
# Detects the use of the bcdedit command to tamper with the boot configuration data. This technique is often times used by malware or attackers as a destructive way before launching ransomware.
# Author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community
RuleName = Boot Configuration Tampering Via Bcdedit.EXE
EventType = Process.Start
Tag = proc-start-boot-configuration-tampering-via-bcdedit.exe
RiskScore = 75
Query = ((Process.Path like r"%\\bcdedit.exe" or Process.Name == "bcdedit.exe") and Process.CommandLine like r"%set%" and ((Process.CommandLine like r"%bootstatuspolicy%" and Process.CommandLine like r"%ignoreallfailures%") or (Process.CommandLine like r"%recoveryenabled%" and Process.CommandLine like r"%no%")))

[ActivityMonitoringRule]
# Detects dump of credentials in VeeamBackup dbo
# Author: frack113
RuleName = VeeamBackup Database Credentials Dump Via Sqlcmd.EXE
EventType = Process.Start
Tag = proc-start-veeambackup-database-credentials-dump-via-sqlcmd.exe
RiskScore = 75
Query = (Process.Path like r"%\\sqlcmd.exe" and Process.CommandLine like r"%SELECT%" and Process.CommandLine like r"%TOP%" and Process.CommandLine like r"%[VeeamBackup].[dbo].[Credentials]%")

[ActivityMonitoringRule]
# Detects attempts to remove windows defender configuration using the 'MpPreference' cmdlet
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Tamper Windows Defender Remove-MpPreference
EventType = Process.Start
Tag = proc-start-tamper-windows-defender-remove-mppreference
RiskScore = 75
Query = (Process.CommandLine like r"%Remove-MpPreference%" and (Process.CommandLine like r"%-ControlledFolderAccessProtectedFolders %" or Process.CommandLine like r"%-AttackSurfaceReductionRules\_Ids %" or Process.CommandLine like r"%-AttackSurfaceReductionRules\_Actions %" or Process.CommandLine like r"%-CheckForSignaturesBeforeRunningScan %"))

[ActivityMonitoringRule]
# Detects the execution node.exe which is shipped with multiple software such as VMware, Adobe...etc. In order to execute arbitrary code. For example to establish reverse shell as seen in Log4j attacks...etc
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential Arbitrary Code Execution Via Node.EXE
EventType = Process.Start
Tag = proc-start-potential-arbitrary-code-execution-via-node.exe
RiskScore = 75
Query = (Process.Path like r"%\\node.exe" and (Process.CommandLine like r"% -e %" or Process.CommandLine like r"% --eval %") and Process.CommandLine like r"%.exec(%" and Process.CommandLine like r"%net.socket%" and Process.CommandLine like r"%.connect%" and Process.CommandLine like r"%child\_process%")

[ActivityMonitoringRule]
# Detects a suspicious Microsoft desktopimgdownldr execution with parameters used to download files from the Internet
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Desktopimgdownldr Command
EventType = Process.Start
Tag = proc-start-suspicious-desktopimgdownldr-command
RiskScore = 75
Query = ((Process.CommandLine like r"% /lockscreenurl:%" and not ((Process.CommandLine like r"%.jpg%" or Process.CommandLine like r"%.jpeg%" or Process.CommandLine like r"%.png%"))) or (Process.CommandLine like r"%reg delete%" and Process.CommandLine like r"%\\PersonalizationCSP%"))

[ActivityMonitoringRule]
# Detects web servers that spawn shell processes which could be the result of a successfully placed web shell or another attack
# Author: Thomas Patzke, Florian Roth (Nextron Systems), Zach Stanford @svch0st, Tim Shelton, Nasreddine Bencherchali (Nextron Systems)
RuleName = Shells Spawned by Web Servers
EventType = Process.Start
Tag = proc-start-shells-spawned-by-web-servers
RiskScore = 75
Query = ((((Parent.Path like r"%\\w3wp.exe" or Parent.Path like r"%\\php.exe" or Parent.Path like r"%\\php-cgi.exe" or Parent.Path like r"%\\nginx.exe" or Parent.Path like r"%\\httpd.exe" or Parent.Path like r"%\\caddy.exe" or Parent.Path like r"%\\ws\_TomcatService.exe" or Parent.Path like r"%\\tomcat.exe" or Parent.Path like r"%\\UMWorkerProcess.exe") or ((Parent.Path like r"%\\java.exe" or Parent.Path like r"%\\javaw.exe") and (Parent.Path like r"%-tomcat-%" or Parent.Path like r"%\\tomcat%")) or ((Parent.Path like r"%\\java.exe" or Parent.Path like r"%\\javaw.exe") and (Parent.CommandLine like r"%catalina.jar%" or Parent.CommandLine like r"%CATALINA\_HOME%" or Parent.CommandLine like r"%catalina.home%"))) and (Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\sh.exe" or Process.Path like r"%\\bash.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\powershell\_ise.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\bitsadmin.exe" or Process.Path like r"%\\arp.exe" or Process.Path like r"%\\at.exe" or Process.Path like r"%\\certutil.exe" or Process.Path like r"%\\dsget.exe" or Process.Path like r"%\\dsquery.exe" or Process.Path like r"%\\find.exe" or Process.Path like r"%\\findstr.exe" or Process.Path like r"%\\fsutil.exe" or Process.Path like r"%\\hostname.exe" or Process.Path like r"%\\ipconfig.exe" or Process.Path like r"%\\nbtstat.exe" or Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe" or Process.Path like r"%\\netdom.exe" or Process.Path like r"%\\netsh.exe" or Process.Path like r"%\\netstat.exe" or Process.Path like r"%\\nltest.exe" or Process.Path like r"%\\nslookup.exe" or Process.Path like r"%\\ntdutil.exe" or Process.Path like r"%\\pathping.exe" or Process.Path like r"%\\ping.exe" or Process.Path like r"%\\qprocess.exe" or Process.Path like r"%\\query.exe" or Process.Path like r"%\\qwinsta.exe" or Process.Path like r"%\\reg.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\sc.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\systeminfo.exe" or Process.Path like r"%\\tasklist.exe" or Process.Path like r"%\\tracert.exe" or Process.Path like r"%\\ver.exe" or Process.Path like r"%\\vssadmin.exe" or Process.Path like r"%\\wevtutil.exe" or Process.Path like r"%\\whoami.exe" or Process.Path like r"%\\wmic.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\wusa.exe")) and not ((Process.CommandLine like r"%Windows\\system32\\cmd.exe /c C:\\ManageEngine\\ADManager \"Plus\\ES\\bin\\elasticsearch.bat -Enode.name=RMP-NODE1 -pelasticsearch-pid.txt") or (Process.CommandLine like r"%sc query%" and Process.CommandLine like r"%ADManager Plus%")))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects certain parent child patterns found in cases in which a webshell is used to perform certain credential dumping or exfiltration activities on a compromised system
# Author: Florian Roth (Nextron Systems)
RuleName = Webshell Hacking Activity Patterns
EventType = Process.Start
Tag = proc-start-webshell-hacking-activity-patterns
RiskScore = 75
Query = (((Parent.Path like r"%\\w3wp.exe" or Parent.Path like r"%\\php-cgi.exe" or Parent.Path like r"%\\nginx.exe" or Parent.Path like r"%\\httpd.exe" or Parent.Path like r"%\\caddy.exe" or Parent.Path like r"%\\ws\_tomcatservice.exe") or ((Parent.Path like r"%\\java.exe" or Parent.Path like r"%\\javaw.exe") and (Parent.Path like r"%-tomcat-%" or Parent.Path like r"%\\tomcat%")) or ((Parent.Path like r"%\\java.exe" or Parent.Path like r"%\\javaw.exe") and (Process.CommandLine like r"%catalina.jar%" or Process.CommandLine like r"%CATALINA\_HOME%"))) and ((Process.CommandLine like r"%rundll32%" and Process.CommandLine like r"%comsvcs%") or (Process.CommandLine like r"% -hp%" and Process.CommandLine like r"% a %" and Process.CommandLine like r"% -m%") or (Process.CommandLine like r"%net%" and Process.CommandLine like r"% user %" and Process.CommandLine like r"% /add%") or (Process.CommandLine like r"%net%" and Process.CommandLine like r"% localgroup %" and Process.CommandLine like r"% administrators %" and Process.CommandLine like r"%/add%") or (Process.Path like r"%\\ntdsutil.exe" or Process.Path like r"%\\ldifde.exe" or Process.Path like r"%\\adfind.exe" or Process.Path like r"%\\procdump.exe" or Process.Path like r"%\\Nanodump.exe" or Process.Path like r"%\\vssadmin.exe" or Process.Path like r"%\\fsutil.exe") or (Process.CommandLine like r"% -NoP %" or Process.CommandLine like r"% -W Hidden %" or Process.CommandLine like r"% -decode %" or Process.CommandLine like r"% /decode %" or Process.CommandLine like r"%reg save %" or Process.CommandLine like r"%.downloadstring(%" or Process.CommandLine like r"%.downloadfile(%" or Process.CommandLine like r"%FromBase64String%" or Process.CommandLine like r"% /ticket:%" or Process.CommandLine like r"% sekurlsa%" or Process.CommandLine like r"%.dmp full%" or Process.CommandLine like r"%process call create%" or Process.CommandLine like r"%whoami /priv%")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects when adversaries stop services or processes by disabling their respective scheduled tasks in order to conduct data destructive activities
# Author: frack113, Nasreddine Bencherchali (Nextron Systems)
RuleName = Disable Important Scheduled Task
EventType = Process.Start
Tag = proc-start-disable-important-scheduled-task
RiskScore = 75
Query = (Process.Path like r"%\\schtasks.exe" and Process.CommandLine like r"%/Change%" and Process.CommandLine like r"%/TN%" and Process.CommandLine like r"%/disable%" and (Process.CommandLine like r"%\\Windows\\SystemRestore\\SR%" or Process.CommandLine like r"%\\Windows\\Windows Defender\\%" or Process.CommandLine like r"%\\Windows\\BitLocker%" or Process.CommandLine like r"%\\Windows\\WindowsBackup\\%" or Process.CommandLine like r"%\\Windows\\WindowsUpdate\\%" or Process.CommandLine like r"%\\Windows\\UpdateOrchestrator\\%" or Process.CommandLine like r"%\\Windows\\ExploitGuard%"))

[ActivityMonitoringRule]
# Detects usage of cmdkey to look for cached credentials on the system
# Author: jmallette, Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential Reconnaissance For Cached Credentials Via Cmdkey.EXE
EventType = Process.Start
Tag = proc-start-potential-reconnaissance-for-cached-credentials-via-cmdkey.exe
RiskScore = 75
Query = ((Process.Path like r"%\\cmdkey.exe" or Process.Name == "cmdkey.exe") and (Process.CommandLine like r"% /l%" or Process.CommandLine like r"% -l%"))

[ActivityMonitoringRule]
# Detects the execution of netsh with "add helper" flag in order to add a custom helper DLL. This technique can be abused to add a malicious helper DLL that can be used as a persistence proxy that gets called when netsh.exe is executed.
# Author: Victor Sergeev, oscd.community
RuleName = Potential Persistence Via Netsh Helper DLL
EventType = Process.Start
Tag = proc-start-potential-persistence-via-netsh-helper-dll
RiskScore = 75
Query = (Process.Path like r"%\\netsh.exe" and Process.CommandLine like r"%add%" and Process.CommandLine like r"%helper%")

[ActivityMonitoringRule]
# Detects the use of TruffleSnout.exe an iterative AD discovery toolkit for offensive operators, situational awareness and targeted low noise enumeration.
# Author: frack113
RuleName = HackTool - TruffleSnout Execution
EventType = Process.Start
Tag = proc-start-hacktool-trufflesnout-execution
RiskScore = 75
Query = (Process.Name == "TruffleSnout.exe" or Process.Path like r"%\\TruffleSnout.exe")

[ActivityMonitoringRule]
# Detects suspicious shell spawn from MSSQL process, this might be sight of RCE or SQL Injection
# Author: FPT.EagleEye Team, wagga
RuleName = Suspicious Shells Spawn by SQL Server
EventType = Process.Start
Tag = proc-start-suspicious-shells-spawn-by-sql-server
RiskScore = 75
Query = ((Parent.Path like r"%\\sqlservr.exe" and (Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\sh.exe" or Process.Path like r"%\\bash.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\bitsadmin.exe" or Process.Path like r"%\\systeminfo.exe")) and not ((Parent.Path like r"C:\\Program Files\\Microsoft SQL Server\\%" and Parent.Path like r"%DATEV\_DBENGINE\\MSSQL\\Binn\\sqlservr.exe" and Process.Path like r"C:\\Windows\\System32\\cmd.exe" and Process.CommandLine like r"\"C:\\Windows\\system32\\cmd.exe\" %")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the creation of a schtask that executes a file from C:\Users\<USER>\AppData\Local
# Author: pH-T (Nextron Systems), Nasreddine Bencherchali
RuleName = Suspicious Schtasks Execution AppData Folder
EventType = Process.Start
Tag = proc-start-suspicious-schtasks-execution-appdata-folder
RiskScore = 75
Query = ((Process.Path like r"%\\schtasks.exe" and Process.CommandLine like r"%/Create%" and Process.CommandLine like r"%/RU%" and Process.CommandLine like r"%/TR%" and Process.CommandLine like r"%C:\\Users\\%" and Process.CommandLine like r"%\\AppData\\Local\\%" and (Process.CommandLine like r"%NT AUT%" or Process.CommandLine like r"% SYSTEM %")) and not (Parent.Path like r"%\\AppData\\Local\\Temp\\%" and Parent.Path like r"%TeamViewer\_.exe%" and Process.Path like r"%\\schtasks.exe" and Process.CommandLine like r"%/TN TVInstallRestore%"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detect activation of DisableRestrictedAdmin to desable RestrictedAdmin mode.
# RestrictedAdmin mode prevents the transmission of reusable credentials to the remote system to which you connect using Remote Desktop.
# This prevents your credentials from being harvested during the initial connection process if the remote server has been compromise
# Author: frack113
RuleName = Disabled RestrictedAdminMode For RDS - ProcCreation
EventType = Process.Start
Tag = proc-start-disabled-restrictedadminmode-for-rds-proccreation
RiskScore = 75
Query = (Process.CommandLine like r"%\\System\\CurrentControlSet\\Control\\Lsa\\%" and Process.CommandLine like r"%DisableRestrictedAdmin%" and Process.CommandLine like r"% 1%")

[ActivityMonitoringRule]
# Detects the execution of rundll32 with a command line that doesn't contain a .dll file
# Author: Tim Shelton, Florian Roth (Nextron Systems), Yassine Oukessou (fix + fp)
RuleName = Rundll32 Execution Without DLL File
EventType = Process.Start
Tag = proc-start-rundll32-execution-without-dll-file
RiskScore = 75
Query = ((Process.Path like r"%\\rundll32.exe" or Process.Name == "RUNDLL32.EXE") and not ((Process.CommandLine == '') or (Process.CommandLine like r"%.dll%" or Process.CommandLine == "") or (Process.CommandLine like r"C:\\Windows\\system32\\rundll32.exe C:\\Windows\\system32\\inetcpl.cpl,ClearMyTracksByProcess") or (Parent.Path like r"%:\\Program Files\\Internet Explorer\\iexplore.exe" and Process.CommandLine like r"%.cpl%") or (Parent.Path like r"%:\\Windows\\SysWOW64\\msiexec.exe" and Parent.CommandLine like r"C:\\Windows\\syswow64\\MsiExec.exe -Embedding%") or (Parent.Path like r"%:\\Windows\\System32\\msiexec.exe" and Parent.CommandLine like r"C:\\Windows\\system32\\MsiExec.exe -Embedding%") or (Parent.Path like r"%:\\Windows\\System32\\cmd.exe" and Parent.CommandLine like r"% C:\\Program Files\\SplunkUniversalForwarder\\%") or (Process.CommandLine like r"% -localserver %") or (Parent.CommandLine like r"C:\\Windows\\system32\\rundll32.exe\" \"C:\\Program Files\\McAfee\\MSC\\mcmscins.dll\",DllUninstallFunction %" or Process.CommandLine like r"C:\\Windows\\system32\\rundll32.exe\" /uninstall /longpath \"C:\\Program Files\\McAfee\\MSC\\mscrem.inf%") or (Parent.Path like r"C:\\Users\\%" and Parent.Path like r"%\\AppData\\Local\\Microsoft\\EdgeUpdate\\Install\\{%" and Parent.Path like r"%\\setup.exe" and Parent.CommandLine like r"%\\setup.exe\" --install-archive=\"C:\\Users\\%") or (Process.CommandLine like r"%C:\\Windows\\Installer\\MSI%" and Process.CommandLine like r"%.tmp%" and Process.CommandLine like r"%zzzzInvokeManagedCustomActionOutOfProc%" and Process.CommandLine like r"%Avira.OE.Setup%")))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# The OpenWith.exe executes other binary
# Author: Beyu Denis, oscd.community (rule), @harr0ey (idea)
RuleName = OpenWith.exe Executes Specified Binary
EventType = Process.Start
Tag = proc-start-openwith.exe-executes-specified-binary
RiskScore = 75
Query = (Process.Path like r"%\\OpenWith.exe" and Process.CommandLine like r"%/c%")

[ActivityMonitoringRule]
# Detects when a user enable developer features such as "Developer Mode" or "Application Sideloading". Which allows the user to install untrusted packages.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential Signing Bypass Via Windows Developer Features
EventType = Process.Start
Tag = proc-start-potential-signing-bypass-via-windows-developer-features
RiskScore = 75
Query = ((Process.Path like r"%\\SystemSettingsAdminFlows.exe" or Process.Name == "SystemSettingsAdminFlows.EXE") and Process.CommandLine like r"%TurnOnDeveloperFeatures%" and (Process.CommandLine like r"%DeveloperUnlock%" or Process.CommandLine like r"%EnableSideloading%"))

[ActivityMonitoringRule]
# Detects execution of REGSVR32.exe with DLL masquerading as image files
# Author: frack113
RuleName = Suspicious Regsvr32 Execution With Image Extension
EventType = Process.Start
Tag = proc-start-suspicious-regsvr32-execution-with-image-extension
RiskScore = 75
Query = ((Process.Path like r"%\\regsvr32.exe" or Process.Name like r"\\REGSVR32.EXE") and (Process.CommandLine like r"%.jpg" or Process.CommandLine like r"%.jpeg" or Process.CommandLine like r"%.gif" or Process.CommandLine like r"%.png" or Process.CommandLine like r"%.ico" or Process.CommandLine like r"%.bmp" or Process.CommandLine like r"%.tif" or Process.CommandLine like r"%.tiff" or Process.CommandLine like r"%.eps" or Process.CommandLine like r"%.raw" or Process.CommandLine like r"%.cr2" or Process.CommandLine like r"%.nef" or Process.CommandLine like r"%.orf" or Process.CommandLine like r"%.sr2"))

[ActivityMonitoringRule]
# Adversaries can use curl to download payloads remotely and execute them. Curl is included by default in Windows 10 build 17063 and later.
# Author: Sreeman, Nasreddine Bencherchali (Nextron Systems)
RuleName = Curl Download And Execute Combination
EventType = Process.Start
Tag = proc-start-curl-download-and-execute-combination
RiskScore = 75
Query = (Process.CommandLine like r"% /c %" and Process.CommandLine like r"%curl %" and Process.CommandLine like r"%http%" and Process.CommandLine like r"%-o%" and Process.CommandLine like r"%&%")

[ActivityMonitoringRule]
# Detects a command used by conti to exfiltrate NTDS
# Author: Max Altgelt (Nextron Systems), Tobias Michalski (Nextron Systems)
RuleName = Conti NTDS Exfiltration Command
EventType = Process.Start
Tag = proc-start-conti-ntds-exfiltration-command
RiskScore = 75
Query = (Process.CommandLine like r"%7za.exe%" and Process.CommandLine like r"%\\C$\\temp\\log.zip%")

[ActivityMonitoringRule]
# Detects the use of CleanWipe a tool usually used to delete Symantec antivirus.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = PUA - CleanWipe Execution
EventType = Process.Start
Tag = proc-start-pua-cleanwipe-execution
RiskScore = 75
Query = (Process.Path like r"%\\SepRemovalToolNative\_x64.exe" or (Process.Path like r"%\\CATClean.exe" and Process.CommandLine like r"%--uninstall%") or (Process.Path like r"%\\NetInstaller.exe" and Process.CommandLine like r"%-r%") or (Process.Path like r"%\\WFPUnins.exe" and Process.CommandLine like r"%/uninstall%" and Process.CommandLine like r"%/enterprise%"))

[ActivityMonitoringRule]
# Detects uses of a renamed legitimate createdump.exe LOLOBIN utility to dump process memory
# Author: Florian Roth (Nextron Systems)
RuleName = Renamed CreateDump Utility Execution
EventType = Process.Start
Tag = proc-start-renamed-createdump-utility-execution
RiskScore = 75
Query = ((Process.Name like r"FX\_VER\_INTERNALNAME\_STR" or (Process.CommandLine like r"% -u %" and Process.CommandLine like r"% -f %" and Process.CommandLine like r"%.dmp%") or (Process.CommandLine like r"% --full %" and Process.CommandLine like r"% --name %" and Process.CommandLine like r"%.dmp%")) and not (Process.Path like r"%\\createdump.exe"))

[ActivityMonitoringRule]
# Detects using SettingSyncHost.exe to run hijacked binary
# Author: Anton Kutepov, oscd.community
RuleName = Using SettingSyncHost.exe as LOLBin
EventType = Process.Start
Tag = proc-start-using-settingsynchost.exe-as-lolbin
RiskScore = 75
Query = (not ((Process.Path like r"C:\\Windows\\System32\\%" or Process.Path like r"C:\\Windows\\SysWOW64\\%")) and (Parent.CommandLine like r"%cmd.exe /c%" and Parent.CommandLine like r"%RoamDiag.cmd%" and Parent.CommandLine like r"%-outputpath%"))
GenericProperty1 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects when an adversary uses the reg.exe utility to add or modify new keys or subkeys
# Author: frack113, Nasreddine Bencherchali
RuleName = Reg Add Suspicious Paths
EventType = Process.Start
Tag = proc-start-reg-add-suspicious-paths
RiskScore = 75
Query = ((Process.Path like r"%\\reg.exe" or Process.Name == "reg.exe") and (Process.CommandLine like r"%\\AppDataLow\\Software\\Microsoft\\%" or Process.CommandLine like r"%\\Policies\\Microsoft\\Windows\\OOBE%" or Process.CommandLine like r"%\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon%" or Process.CommandLine like r"%\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon%" or Process.CommandLine like r"%\\CurrentControlSet\\Control\\SecurityProviders\\WDigest%" or Process.CommandLine like r"%\\Microsoft\\Windows Defender\\%"))

[ActivityMonitoringRule]
# Detects email exfiltration via powershell cmdlets
# Author: Nasreddine Bencherchali (Nextron Systems),  Azure-Sentinel (idea)
RuleName = Email Exifiltration Via Powershell
EventType = Process.Start
Tag = proc-start-email-exifiltration-via-powershell
RiskScore = 75
Query = ((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") and Process.CommandLine like r"%Add-PSSnapin%" and Process.CommandLine like r"%Get-Recipient%" and Process.CommandLine like r"%-ExpandProperty%" and Process.CommandLine like r"%EmailAddresses%" and Process.CommandLine like r"%SmtpAddress%" and Process.CommandLine like r"%-hidetableheaders%")

[ActivityMonitoringRule]
# Detect commandline usage of Microsoft Connection Manager Profile Installer (cmstp.exe) to install specially formatted local .INF files
# Author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community
RuleName = Bypass UAC via CMSTP
EventType = Process.Start
Tag = proc-start-bypass-uac-via-cmstp
RiskScore = 75
Query = ((Process.Path like r"%\\cmstp.exe" or Process.Name == "CMSTP.EXE") and (Process.CommandLine like r"%/s%" or Process.CommandLine like r"%-s%" or Process.CommandLine like r"%/au%" or Process.CommandLine like r"%-au%" or Process.CommandLine like r"%/ni%" or Process.CommandLine like r"%-ni%"))

[ActivityMonitoringRule]
# Detects a command that accesses password storing registry hives via volume shadow backups
# Author: Max Altgelt (Nextron Systems), Tobias Michalski (Nextron Systems)
RuleName = Sensitive Registry Access via Volume Shadow Copy
EventType = Process.Start
Tag = proc-start-sensitive-registry-access-via-volume-shadow-copy
RiskScore = 75
Query = (Process.CommandLine like r"%\\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy%" and (Process.CommandLine like r"%\\NTDS.dit%" or Process.CommandLine like r"%\\SYSTEM%" or Process.CommandLine like r"%\\SECURITY%" or Process.CommandLine like r"%C:\\tmp\\log%"))

[ActivityMonitoringRule]
# Detects adding and using Exchange PowerShell snap-ins to export mailbox data. As seen used by HAFNIUM and APT27
# Author: FPT.EagleEye, Nasreddine Bencherchali (Nextron Systems)
RuleName = Exchange PowerShell Snap-Ins Usage
EventType = Process.Start
Tag = proc-start-exchange-powershell-snap-ins-usage
RiskScore = 75
Query = ((((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") or Process.Name in ["PowerShell.EXE", "pwsh.dll"]) and Process.CommandLine like r"%Add-PSSnapin%" and (Process.CommandLine like r"%Microsoft.Exchange.Powershell.Snapin%" or Process.CommandLine like r"%Microsoft.Exchange.Management.PowerShell.SnapIn%")) and not ((Parent.Path like r"C:\\Windows\\System32\\msiexec.exe" and Process.CommandLine like r"%$exitcode=0 $exserver=Get-ExchangeServer ([Environment]::MachineName) -ErrorVariable exerr%")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects Winword process loading custmom dlls via the '/l' switch.
# Winword can be abused as a LOLBIN to download arbitrary file or load arbitrary DLLs.
# Author: Nasreddine Bencherchali (Nextron Systems), Victor Sergeev, oscd.community
RuleName = Winword LOLBIN Usage
EventType = Process.Start
Tag = proc-start-winword-lolbin-usage
RiskScore = 75
Query = ((Process.Path like r"%\\WINWORD.exe" or Process.Name == "WinWord.exe") and (Process.CommandLine like r"%/l %" or Process.CommandLine like r"%.dll%" or Process.CommandLine like r"%http://%" or Process.CommandLine like r"%https://%"))

[ActivityMonitoringRule]
# Detects suspicious command line arguments of common data compression tools
# Author: Florian Roth (Nextron Systems), Samir Bousseaden
RuleName = Suspicious Compression Tool Parameters
EventType = Process.Start
Tag = proc-start-suspicious-compression-tool-parameters
RiskScore = 75
Query = (((Process.Name like r"7z%.exe" or Process.Name like r"%rar.exe" or Process.Name like r"%Command%Line%RAR%") and (Process.CommandLine like r"% -p%" or Process.CommandLine like r"% -ta%" or Process.CommandLine like r"% -tb%" or Process.CommandLine like r"% -sdel%" or Process.CommandLine like r"% -dw%" or Process.CommandLine like r"% -hp%")) and not (Parent.Path like r"C:\\Program%"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# load malicious registered COM objects
# Author: frack113
RuleName = Rundll32 Registered COM Objects
EventType = Process.Start
Tag = proc-start-rundll32-registered-com-objects
RiskScore = 75
Query = ((Process.Path like r"%\\rundll32.exe" or Process.Name == "RUNDLL32.EXE") and ((Process.CommandLine like r"%-sta %" or Process.CommandLine like r"%-localserver %") and Process.CommandLine like r"%{%" and Process.CommandLine like r"%}%"))

[ActivityMonitoringRule]
# Detects a certain command line flag combination used by devinit.exe lolbin to download arbitrary MSI packages on a Windows system
# Author: Florian Roth (Nextron Systems)
RuleName = DevInit Lolbin Download
EventType = Process.Start
Tag = proc-start-devinit-lolbin-download
RiskScore = 75
Query = (Process.CommandLine like r"% -t msi-install %" and Process.CommandLine like r"% -i http%")

[ActivityMonitoringRule]
# Detects a process memory dump performed by RdrLeakDiag.exe
# Author: Cedric MAURUGEON
RuleName = Process Dump via RdrLeakDiag.exe
EventType = Process.Start
Tag = proc-start-process-dump-via-rdrleakdiag.exe
RiskScore = 75
Query = (Process.Name == "RdrLeakDiag.exe" and Process.CommandLine like r"%fullmemdmp%")

[ActivityMonitoringRule]
# Detects when a program changes the default file association of any extension to an executable.
# When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Change Default File Association To Executable Via Assoc
EventType = Process.Start
Tag = proc-start-change-default-file-association-to-executable-via-assoc
RiskScore = 75
Query = (((Process.Path like r"%\\cmd.exe" or Process.Name == "Cmd.Exe") and (Process.CommandLine like r"%assoc %" and Process.CommandLine like r"%exefile%")) and not (Process.CommandLine like r"%.exe=exefile%"))

[ActivityMonitoringRule]
# Detects the usage of "reg.exe" to tamper with different Windows defender registry keys in order to disable some important features related to protection and detection
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Windows Defender Registry Key Tampering Via Reg.EXE
EventType = Process.Start
Tag = proc-start-suspicious-windows-defender-registry-key-tampering-via-reg.exe
RiskScore = 75
Query = (((Process.Path like r"%\\reg.exe" or Process.Name == "reg.exe") and (Process.CommandLine like r"%SOFTWARE\\Microsoft\\Windows Defender\\%" or Process.CommandLine like r"%SOFTWARE\\Policies\\Microsoft\\Windows Defender\\%")) and ((Process.CommandLine like r"% add %" and Process.CommandLine like r"% /d 0%" and (Process.CommandLine like r"%Real-Time Protection%" or Process.CommandLine like r"%TamperProtection%")) or (Process.CommandLine like r"% add %" and Process.CommandLine like r"% /d 1%" and Process.CommandLine like r"%Notification\_Suppress%")))

[ActivityMonitoringRule]
# Detects execution of "msdt.exe" using an answer file which is simulating the legitimate way of calling msdt via "pcwrun.exe" (For example from the compatibility tab)
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Execute MSDT Via Answer File
EventType = Process.Start
Tag = proc-start-execute-msdt-via-answer-file
RiskScore = 75
Query = ((Process.Path like r"%\\msdt.exe" and Process.CommandLine like r"%\\WINDOWS\\diagnostics\\index\\PCWDiagnostic.xml%" and (Process.CommandLine like r"% -af %" or Process.CommandLine like r"% /af %")) and not (Parent.Path like r"%\\pcwrun.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the execution of different Windows based hacktools via PE metadata (company, product, etc.) even if the files have been renamed
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Hacktool Execution - PE Metadata
EventType = Process.Start
Tag = proc-start-suspicious-hacktool-execution-pe-metadata
RiskScore = 75
Query = Process.Company == "Cube0x0"
GenericProperty1 = Process.Company

[ActivityMonitoringRule]
# Detects an executable in the users directory started from one of the Microsoft Office suite applications (Word, Excel, PowerPoint, Publisher, Visio)
# Author: Jason Lynch
RuleName = Suspicious Binary In User Directory Spawned From Office Application
EventType = Process.Start
Tag = proc-start-suspicious-binary-in-user-directory-spawned-from-office-application
RiskScore = 75
Query = (((Parent.Path like r"%\\WINWORD.EXE" or Parent.Path like r"%\\EXCEL.EXE" or Parent.Path like r"%\\POWERPNT.exe" or Parent.Path like r"%\\MSPUB.exe" or Parent.Path like r"%\\VISIO.exe" or Parent.Path like r"%\\MSACCESS.exe" or Parent.Path like r"%\\EQNEDT32.exe") and Process.Path like r"C:\\users\\%" and Process.Path like r"%.exe") and not (Process.Path like r"%\\Teams.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects Execution via SyncInvoke in CL_Invocation.ps1 module
# Author: oscd.community, Natalia Shornikova
RuleName = Execution via CL_Invocation.ps1
EventType = Process.Start
Tag = proc-start-execution-via-cl_invocation.ps1
RiskScore = 75
Query = (Process.CommandLine like r"%CL\_Invocation.ps1%" and Process.CommandLine like r"%SyncInvoke%")

[ActivityMonitoringRule]
# Detects use of WSReset.exe to bypass User Account Control (UAC). Adversaries use this technique to execute privileged processes.
# Author: E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community, Florian Roth
RuleName = Bypass UAC via WSReset.exe
EventType = Process.Start
Tag = proc-start-bypass-uac-via-wsreset.exe
RiskScore = 75
Query = (Parent.Path like r"%\\wsreset.exe" and not (Process.Path like r"%\\conhost.exe" or Process.Name == "CONHOST.EXE"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects deletion of Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil
# Author: Tim Rauch
RuleName = Deletion of Volume Shadow Copies via WMI with PowerShell
EventType = Process.Start
Tag = proc-start-deletion-of-volume-shadow-copies-via-wmi-with-powershell
RiskScore = 75
Query = ((Process.CommandLine like r"%Get-WmiObject%" or Process.CommandLine like r"%gwmi%" or Process.CommandLine like r"%Get-CimInstance%" or Process.CommandLine like r"%gcim%") and Process.CommandLine like r"%Win32\_Shadowcopy%" and (Process.CommandLine like r"%.Delete()%" or Process.CommandLine like r"%Remove-WmiObject%" or Process.CommandLine like r"%rwmi%" or Process.CommandLine like r"%Remove-CimInstance%" or Process.CommandLine like r"%rcim%"))

[ActivityMonitoringRule]
# Detects uses of the SysInternals Procdump utility in which procdump or its output get renamed or a dump file is moved ot copied to a different name
# Author: Florian Roth (Nextron Systems)
RuleName = Potential Procdump Evasion
EventType = Process.Start
Tag = proc-start-potential-procdump-evasion
RiskScore = 75
Query = ((Process.CommandLine like r"%copy procdump%" or Process.CommandLine like r"%move procdump%") or (Process.CommandLine like r"%copy %" and Process.CommandLine like r"%.dmp %" and (Process.CommandLine like r"%2.dmp%" or Process.CommandLine like r"%lsass%" or Process.CommandLine like r"%out.dmp%")) or (Process.CommandLine like r"%copy lsass.exe\_%" or Process.CommandLine like r"%move lsass.exe\_%"))

[ActivityMonitoringRule]
# Detects Obfuscated use of Environment Variables to execute PowerShell
# Author: Jonathan Cheong, oscd.community
RuleName = Invoke-Obfuscation VAR+ Launcher
EventType = Process.Start
Tag = proc-start-invoke-obfuscation-var+-launcher
RiskScore = 75
Query = (Process.CommandLine like r"%cmd%" and Process.CommandLine like r"%\"set%" and Process.CommandLine like r"%-f%" and (Process.CommandLine like r"%/c%" or Process.CommandLine like r"%/r%"))

[ActivityMonitoringRule]
# Detects rundll32 execution where the DLL is located on a remote location (share)
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Rundll32 UNC Path Execution
EventType = Process.Start
Tag = proc-start-rundll32-unc-path-execution
RiskScore = 75
Query = ((Process.Path like r"%\\rundll32.exe" or Process.Name == "RUNDLL32.EXE" or Process.CommandLine like r"%rundll32%") and Process.CommandLine like r"% \\\\\*")

[ActivityMonitoringRule]
# Detects the execution of "logman" utility in order to disable or delete Windows trace sessions
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Windows Trace ETW Session Tamper Via Logman.EXE
EventType = Process.Start
Tag = proc-start-suspicious-windows-trace-etw-session-tamper-via-logman.exe
RiskScore = 75
Query = ((Process.Path like r"%\\logman.exe" or Process.Name == "Logman.exe") and (Process.CommandLine like r"%stop %" or Process.CommandLine like r"%delete %") and (Process.CommandLine like r"%Circular Kernel Context Logger%" or Process.CommandLine like r"%EventLog-%" or Process.CommandLine like r"%SYSMON TRACE%" or Process.CommandLine like r"%SysmonDnsEtwSession%"))

[ActivityMonitoringRule]
# Detects suspicious mshta process execution patterns
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Mshta.EXE Execution Patterns
EventType = Process.Start
Tag = proc-start-suspicious-mshta.exe-execution-patterns
RiskScore = 75
Query = (((Process.Path like r"%\\mshta.exe" or Process.Name == "MSHTA.EXE") and ((Parent.Path like r"%\\cmd.exe" or Parent.Path like r"%\\cscript.exe" or Parent.Path like r"%\\powershell.exe" or Parent.Path like r"%\\pwsh.exe" or Parent.Path like r"%\\regsvr32.exe" or Parent.Path like r"%\\rundll32.exe" or Parent.Path like r"%\\wscript.exe") and (Process.CommandLine like r"%\\AppData\\Local\\%" or Process.CommandLine like r"%C:\\ProgramData\\%" or Process.CommandLine like r"%C:\\Users\\Public\\%" or Process.CommandLine like r"%C:\\Windows\\Temp\\%"))) or ((Process.Path like r"%\\mshta.exe" or Process.Name == "MSHTA.EXE") and not ((Process.Path like r"C:\\Windows\\System32\\%" or Process.Path like r"C:\\Windows\\SysWOW64\\%") or (Process.CommandLine like r"%.htm%" or Process.CommandLine like r"%.hta%") or (Process.CommandLine like r"%mshta.exe" or Process.CommandLine like r"%mshta"))))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the execution of a renamed ProcDump executable often used by attackers or malware
# Author: Florian Roth (Nextron Systems)
RuleName = Renamed ProcDump Execution
EventType = Process.Start
Tag = proc-start-renamed-procdump-execution
RiskScore = 75
Query = ((Process.Name == "procdump" or ((Process.CommandLine like r"% -ma %" or Process.CommandLine like r"% /ma %") and (Process.CommandLine like r"% -accepteula %" or Process.CommandLine like r"% /accepteula %"))) and not ((Process.Path like r"%\\procdump.exe" or Process.Path like r"%\\procdump64.exe")))

[ActivityMonitoringRule]
# Detects when an internet hosted webdav share is mounted using the "net.exe" utility
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Windows Internet Hosted WebDav Share Mount Via Net.EXE
EventType = Process.Start
Tag = proc-start-windows-internet-hosted-webdav-share-mount-via-net.exe
RiskScore = 75
Query = (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") or Process.Name in ["net.exe", "net1.exe"]) and (Process.CommandLine like r"% use %" or Process.CommandLine like r"% http%"))

[ActivityMonitoringRule]
# Detects a method often used by ransomware. Which combines the "ping" to wait a couple of seconds and then "del" to delete the file in question. Its used to hide the file responsible for the initial infection for example
# Author: Ilya Krestinichev
RuleName = Suspicious Ping/Del Command Combination
EventType = Process.Start
Tag = proc-start-suspicious-ping/del-command-combination
RiskScore = 75
Query = ((Process.CommandLine like r"% -n %" or Process.CommandLine like r"% /n %") and Process.CommandLine like r"%Nul%" and (Process.CommandLine like r"% /f %" or Process.CommandLine like r"% -f %" or Process.CommandLine like r"% /q %" or Process.CommandLine like r"% -q %") and Process.CommandLine like r"%ping%" and Process.CommandLine like r"%del %")

[ActivityMonitoringRule]
# Execution of plink to perform data exfiltration and tunneling
# Author: Florian Roth (Nextron Systems)
RuleName = Potential RDP Tunneling Via SSH Plink
EventType = Process.Start
Tag = proc-start-potential-rdp-tunneling-via-ssh-plink
RiskScore = 75
Query = ((Process.Path like r"%\\plink.exe" and Process.CommandLine like r"%:127.0.0.1:3389%") or (Process.Path like r"%\\plink.exe" and Process.CommandLine like r"%:3389%" and (Process.CommandLine like r"% -P 443%" or Process.CommandLine like r"% -P 22%")))

[ActivityMonitoringRule]
# Detects suspicious commandline flags used by PsExec and PAExec to escalate a command line to LOCAL_SYSTEM rights
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleName = PsExec/PAExec Escalation to LOCAL SYSTEM
EventType = Process.Start
Tag = proc-start-psexec/paexec-escalation-to-local-system
RiskScore = 75
Query = ((Process.CommandLine like r"% -s cmd%" or Process.CommandLine like r"% /s cmd%" or Process.CommandLine like r"% -s -i cmd%" or Process.CommandLine like r"% /s /i cmd%" or Process.CommandLine like r"% /s -i cmd%" or Process.CommandLine like r"% -s /i cmd%" or Process.CommandLine like r"% -i -s cmd%" or Process.CommandLine like r"% /i /s cmd%" or Process.CommandLine like r"% -i /s cmd%" or Process.CommandLine like r"% /i -s cmd%" or Process.CommandLine like r"% -s pwsh%" or Process.CommandLine like r"% /s pwsh%" or Process.CommandLine like r"% -s -i pwsh%" or Process.CommandLine like r"% /s /i pwsh%" or Process.CommandLine like r"% /s -i pwsh%" or Process.CommandLine like r"% -s /i pwsh%" or Process.CommandLine like r"% -i -s pwsh%" or Process.CommandLine like r"% /i /s pwsh%" or Process.CommandLine like r"% -i /s pwsh%" or Process.CommandLine like r"% /i -s pwsh%" or Process.CommandLine like r"% -s powershell%" or Process.CommandLine like r"% /s powershell%" or Process.CommandLine like r"% -s -i powershell%" or Process.CommandLine like r"% /s /i powershell%" or Process.CommandLine like r"% /s -i powershell%" or Process.CommandLine like r"% -s /i powershell%" or Process.CommandLine like r"% -i -s powershell%" or Process.CommandLine like r"% /i /s powershell%" or Process.CommandLine like r"% -i /s powershell%" or Process.CommandLine like r"% /i -s powershell%") and (Process.CommandLine like r"%psexec%" or Process.CommandLine like r"%paexec%" or Process.CommandLine like r"%accepteula%"))

[ActivityMonitoringRule]
# Threat actors can use an older version of the auditpol binary available inside the NT resource kit to change audit policy configuration to impair detection capability.
# This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Audit Policy Tampering Via NT Resource Kit Auditpol
EventType = Process.Start
Tag = proc-start-audit-policy-tampering-via-nt-resource-kit-auditpol
RiskScore = 75
Query = (Process.CommandLine like r"%/logon:none%" or Process.CommandLine like r"%/system:none%" or Process.CommandLine like r"%/sam:none%" or Process.CommandLine like r"%/privilege:none%" or Process.CommandLine like r"%/object:none%" or Process.CommandLine like r"%/process:none%" or Process.CommandLine like r"%/policy:none%")

[ActivityMonitoringRule]
# Detects a service binary running in a suspicious directory
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Service Binary Directory
EventType = Process.Start
Tag = proc-start-suspicious-service-binary-directory
RiskScore = 75
Query = ((Process.Path like r"%\\Users\\Public\\%" or Process.Path like r"%\\$Recycle.bin%" or Process.Path like r"%\\Users\\All Users\\%" or Process.Path like r"%\\Users\\Default\\%" or Process.Path like r"%\\Users\\Contacts\\%" or Process.Path like r"%\\Users\\Searches\\%" or Process.Path like r"%C:\\Perflogs\\%" or Process.Path like r"%\\config\\systemprofile\\%" or Process.Path like r"%\\Windows\\Fonts\\%" or Process.Path like r"%\\Windows\\IME\\%" or Process.Path like r"%\\Windows\\addins\\%") and (Parent.Path like r"%\\services.exe" or Parent.Path like r"%\\svchost.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious processes including shells spawnd from WinRM host process
# Author: Andreas Hunkeler (@Karneades), Markus Neis
RuleName = Suspicious Processes Spawned by WinRM
EventType = Process.Start
Tag = proc-start-suspicious-processes-spawned-by-winrm
RiskScore = 75
Query = (Parent.Path like r"%\\wsmprovhost.exe" and (Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\sh.exe" or Process.Path like r"%\\bash.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\wsl.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\certutil.exe" or Process.Path like r"%\\whoami.exe" or Process.Path like r"%\\bitsadmin.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects command line parameters or strings often used by crypto miners
# Author: Florian Roth (Nextron Systems)
RuleName = Potential Crypto Mining Activity
EventType = Process.Start
Tag = proc-start-potential-crypto-mining-activity
RiskScore = 75
Query = ((Process.CommandLine like r"% --cpu-priority=%" or Process.CommandLine like r"%--donate-level=0%" or Process.CommandLine like r"% -o pool.%" or Process.CommandLine like r"% --nicehash%" or Process.CommandLine like r"% --algo=rx/0 %" or Process.CommandLine like r"%stratum+tcp://%" or Process.CommandLine like r"%stratum+udp://%" or Process.CommandLine like r"%LS1kb25hdGUtbGV2ZWw9%" or Process.CommandLine like r"%0tZG9uYXRlLWxldmVsP%" or Process.CommandLine like r"%tLWRvbmF0ZS1sZXZlbD%" or Process.CommandLine like r"%c3RyYXR1bSt0Y3A6Ly%" or Process.CommandLine like r"%N0cmF0dW0rdGNwOi8v%" or Process.CommandLine like r"%zdHJhdHVtK3RjcDovL%" or Process.CommandLine like r"%c3RyYXR1bSt1ZHA6Ly%" or Process.CommandLine like r"%N0cmF0dW0rdWRwOi8v%" or Process.CommandLine like r"%zdHJhdHVtK3VkcDovL%") and not ((Process.CommandLine like r"% pool.c %" or Process.CommandLine like r"% pool.o %" or Process.CommandLine like r"%gcc -%")))

[ActivityMonitoringRule]
# Detects potential path traversal attempt via cmd.exe. Could indicate possible command/argument confusion/hijacking
# Author: xknow @xknow_infosec, Tim Shelton
RuleName = Potential CommandLine Path Traversal Via Cmd.EXE
EventType = Process.Start
Tag = proc-start-potential-commandline-path-traversal-via-cmd.exe
RiskScore = 75
Query = (((Parent.Path like r"%\\cmd.exe" or Process.Path like r"%\\cmd.exe" or Process.Name == "cmd.exe") and ((Parent.CommandLine like r"%/c%" or Parent.CommandLine like r"%/k%" or Parent.CommandLine like r"%/r%") or (Process.CommandLine like r"%/c%" or Process.CommandLine like r"%/k%" or Process.CommandLine like r"%/r%")) and (Parent.CommandLine == "/../../" or Process.CommandLine like r"%/../../%")) and not ((Process.CommandLine like r"%\\Tasktop\\keycloak\\bin\\/../../jre\\bin\\java%")))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects a ping command that uses a hex encoded IP address
# Author: Florian Roth (Nextron Systems)
RuleName = Ping Hex IP
EventType = Process.Start
Tag = proc-start-ping-hex-ip
RiskScore = 75
Query = (Process.Path like r"%\\ping.exe" and Process.CommandLine like r"%0x%")

[ActivityMonitoringRule]
# Detects specific process parameters as used by ACTINIUM scheduled task persistence creation.
# Author: Andreas Hunkeler (@Karneades)
RuleName = Potential ACTINIUM Persistence Activiy
EventType = Process.Start
Tag = proc-start-potential-actinium-persistence-activiy
RiskScore = 75
Query = (Process.CommandLine like r"%schtasks%" and Process.CommandLine like r"%create%" and Process.CommandLine like r"%wscript%" and Process.CommandLine like r"% /e:vbscript%")

[ActivityMonitoringRule]
# Detects clearing or configuration of eventlogs using wevtutil, powershell and wmic. Might be used by ransomwares during the attack (seen by NotPetya and others).
# Author: Ecco, Daniil Yugoslavskiy, oscd.community, D3F7A5105
RuleName = Suspicious Eventlog Clear or Configuration Change
EventType = Process.Start
Tag = proc-start-suspicious-eventlog-clear-or-configuration-change
RiskScore = 75
Query = (((Process.Path like r"%\\wevtutil.exe" and (Process.CommandLine like r"%clear-log %" or Process.CommandLine like r"% cl %" or Process.CommandLine like r"%set-log %" or Process.CommandLine like r"% sl %" or Process.CommandLine like r"%lfn:%")) or ((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") and (Process.CommandLine like r"%Clear-EventLog %" or Process.CommandLine like r"%Remove-EventLog %" or Process.CommandLine like r"%Limit-EventLog %" or Process.CommandLine like r"%Clear-WinEvent %")) or (Process.Path like r"%\\wmic.exe" and Process.CommandLine like r"% ClearEventLog %")) and not (((Parent.Path like r"C:\\Windows\\SysWOW64\\msiexec.exe" or Parent.Path like r"C:\\Windows\\System32\\msiexec.exe") and Process.CommandLine like r"% sl %")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects Request to "amsiInitFailed" that can be used to disable AMSI Scanning
# Author: Markus Neis, @Kostastsale
RuleName = Potential AMSI Bypass Via .NET Reflection
EventType = Process.Start
Tag = proc-start-potential-amsi-bypass-via-.net-reflection
RiskScore = 75
Query = ((Process.CommandLine like r"%System.Management.Automation.AmsiUtils%" or Process.CommandLine like r"%amsiInitFailed%") or (Process.CommandLine like r"%[Ref].Assembly.GetType%" and Process.CommandLine like r"%SetValue($null,$true)%" and Process.CommandLine like r"%NonPublic,Static%"))

[ActivityMonitoringRule]
# Detects the execution of different compiled Windows binaries of the impacket toolset (based on names or part of their names - could lead to false positives)
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - Impacket Tools Execution
EventType = Process.Start
Tag = proc-start-hacktool-impacket-tools-execution
RiskScore = 75
Query = ((Process.Path like r"%\\goldenPac%" or Process.Path like r"%\\karmaSMB%" or Process.Path like r"%\\kintercept%" or Process.Path like r"%\\ntlmrelayx%" or Process.Path like r"%\\rpcdump%" or Process.Path like r"%\\samrdump%" or Process.Path like r"%\\secretsdump%" or Process.Path like r"%\\smbexec%" or Process.Path like r"%\\smbrelayx%" or Process.Path like r"%\\wmiexec%" or Process.Path like r"%\\wmipersist%") or (Process.Path like r"%\\atexec\_windows.exe" or Process.Path like r"%\\dcomexec\_windows.exe" or Process.Path like r"%\\dpapi\_windows.exe" or Process.Path like r"%\\findDelegation\_windows.exe" or Process.Path like r"%\\GetADUsers\_windows.exe" or Process.Path like r"%\\GetNPUsers\_windows.exe" or Process.Path like r"%\\getPac\_windows.exe" or Process.Path like r"%\\getST\_windows.exe" or Process.Path like r"%\\getTGT\_windows.exe" or Process.Path like r"%\\GetUserSPNs\_windows.exe" or Process.Path like r"%\\ifmap\_windows.exe" or Process.Path like r"%\\mimikatz\_windows.exe" or Process.Path like r"%\\netview\_windows.exe" or Process.Path like r"%\\nmapAnswerMachine\_windows.exe" or Process.Path like r"%\\opdump\_windows.exe" or Process.Path like r"%\\psexec\_windows.exe" or Process.Path like r"%\\rdp\_check\_windows.exe" or Process.Path like r"%\\sambaPipe\_windows.exe" or Process.Path like r"%\\smbclient\_windows.exe" or Process.Path like r"%\\smbserver\_windows.exe" or Process.Path like r"%\\sniffer\_windows.exe" or Process.Path like r"%\\sniff\_windows.exe" or Process.Path like r"%\\split\_windows.exe" or Process.Path like r"%\\ticketer\_windows.exe"))

[ActivityMonitoringRule]
# Detects an interactive AT job, which may be used as a form of privilege escalation.
# Author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community
RuleName = Interactive AT Job
EventType = Process.Start
Tag = proc-start-interactive-at-job
RiskScore = 75
Query = (Process.Path like r"%\\at.exe" and Process.CommandLine like r"%interactive%")

[ActivityMonitoringRule]
# Detects the usage of "pypykatz" to obtain stored credentials. Adversaries may attempt to extract credential material from the Security Account Manager (SAM) database through Windows registry where the SAM database is stored
# Author: frack113
RuleName = HackTool - Pypykatz Credentials Dumping Activity
EventType = Process.Start
Tag = proc-start-hacktool-pypykatz-credentials-dumping-activity
RiskScore = 75
Query = ((Process.Path like r"%\\pypykatz.exe" or Process.Path like r"%\\python.exe") and Process.CommandLine like r"%live%" and Process.CommandLine like r"%registry%")

[ActivityMonitoringRule]
# Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Root Certificate Installed From Susp Locations
EventType = Process.Start
Tag = proc-start-root-certificate-installed-from-susp-locations
RiskScore = 75
Query = (Process.CommandLine like r"%Import-Certificate%" and Process.CommandLine like r"% -FilePath %" and Process.CommandLine like r"%Cert:\\LocalMachine\\Root%" and (Process.CommandLine like r"%\\AppData\\Local\\Temp\\%" or Process.CommandLine like r"%:\\Windows\\TEMP\\%" or Process.CommandLine like r"%\\Desktop\\%" or Process.CommandLine like r"%\\Downloads\\%" or Process.CommandLine like r"%\\Perflogs\\%" or Process.CommandLine like r"%:\\Users\\Public\\%"))

[ActivityMonitoringRule]
# Detects suspicious Windows Error Reporting manager (wermgr.exe) process patterns - suspicious parents / children, execution folders, command lines etc.
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious WERMGR Process Patterns
EventType = Process.Start
Tag = proc-start-suspicious-wermgr-process-patterns
RiskScore = 75
Query = ((Parent.Path like r"%\\wermgr.exe" and (Process.Path like r"%\\nslookup.exe" or Process.Path like r"%\\ipconfig.exe" or Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe" or Process.Path like r"%\\whoami.exe" or Process.Path like r"%\\netstat.exe" or Process.Path like r"%\\systeminfo.exe" or Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\powershell.exe")) or (Process.Path like r"%\\wermgr.exe" and not ((Process.Path like r"C:\\Windows\\System32\\%" or Process.Path like r"C:\\Windows\\SysWOW64\\%" or Process.Path like r"C:\\Windows\\WinSxS\\%"))))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects command lines that indicate unwanted modifications to registry keys that disable important Internet Explorer security features
# Author: Florian Roth (Nextron Systems)
RuleName = Disabled IE Security Features
EventType = Process.Start
Tag = proc-start-disabled-ie-security-features
RiskScore = 75
Query = ((Process.CommandLine like r"% -name IEHarden %" and Process.CommandLine like r"% -value 0 %") or (Process.CommandLine like r"% -name DEPOff %" and Process.CommandLine like r"% -value 1 %") or (Process.CommandLine like r"% -name DisableFirstRunCustomize %" and Process.CommandLine like r"% -value 2 %"))

[ActivityMonitoringRule]
# Detects suspicious command line patterns seen being used by MERCURY APT
# Author: Florian Roth (Nextron Systems)
RuleName = MERCURY APT Activity
EventType = Process.Start
Tag = proc-start-mercury-apt-activity
RiskScore = 75
Query = (Process.CommandLine like r"%-exec bypass -w 1 -enc%" and Process.CommandLine like r"%UwB0AGEAcgB0AC0ASgBvAGIAIAAtAFMAYwByAGkAcAB0AEIAbABvAGMAawAgAHsAKABzAGEAcABzACAAKAAiAHAA%")

[ActivityMonitoringRule]
# Detects ADDInternals Cmdlet execution. A tool for administering Azure AD and Office 365. Which can be abused by threat actors to attack Azure AD or Office 365.
# Author: Austin Songer (@austinsonger), Nasreddine Bencherchali (Nextron Systems)
RuleName = AADInternals PowerShell Cmdlets Execution - ProccessCreation
EventType = Process.Start
Tag = proc-start-aadinternals-powershell-cmdlets-execution-proccesscreation
RiskScore = 75
Query = (((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") or Process.Name in ["PowerShell.Exe", "pwsh.dll"]) and (Process.CommandLine like r"%Add-AADInt%" or Process.CommandLine like r"%ConvertTo-AADInt%" or Process.CommandLine like r"%Disable-AADInt%" or Process.CommandLine like r"%Enable-AADInt%" or Process.CommandLine like r"%Export-AADInt%" or Process.CommandLine like r"%Get-AADInt%" or Process.CommandLine like r"%Grant-AADInt%" or Process.CommandLine like r"%Install-AADInt%" or Process.CommandLine like r"%Invoke-AADInt%" or Process.CommandLine like r"%Join-AADInt%" or Process.CommandLine like r"%New-AADInt%" or Process.CommandLine like r"%Open-AADInt%" or Process.CommandLine like r"%Read-AADInt%" or Process.CommandLine like r"%Register-AADInt%" or Process.CommandLine like r"%Remove-AADInt%" or Process.CommandLine like r"%Restore-AADInt%" or Process.CommandLine like r"%Search-AADInt%" or Process.CommandLine like r"%Send-AADInt%" or Process.CommandLine like r"%Set-AADInt%" or Process.CommandLine like r"%Start-AADInt%" or Process.CommandLine like r"%Update-AADInt%"))

[ActivityMonitoringRule]
# Detects suspicious usage of the ShellExec_RunDLL function to launch other commands as seen in the the raspberry-robin attack
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Usage Of ShellExec_RunDLL
EventType = Process.Start
Tag = proc-start-suspicious-usage-of-shellexec_rundll
RiskScore = 75
Query = (Process.CommandLine like r"%ShellExec\_RunDLL%" and (Process.CommandLine like r"%regsvr32%" or Process.CommandLine like r"%msiexec%" or Process.CommandLine like r"%\\Users\\Public\\%" or Process.CommandLine like r"%odbcconf%" or Process.CommandLine like r"%\\Desktop\\%" or Process.CommandLine like r"%\\Temp\\%" or Process.CommandLine like r"%Invoke-%" or Process.CommandLine like r"%iex%" or Process.CommandLine like r"%comspec%"))

[ActivityMonitoringRule]
# Detects the use of SDelete to erase a file not the free space
# Author: frack113
RuleName = Potential File Overwrite Via Sysinternals SDelete
EventType = Process.Start
Tag = proc-start-potential-file-overwrite-via-sysinternals-sdelete
RiskScore = 75
Query = (Process.Name == "sdelete.exe" and not ((Process.CommandLine like r"% -h%" or Process.CommandLine like r"% -c%" or Process.CommandLine like r"% -z%" or Process.CommandLine like r"% /\?%")))

[ActivityMonitoringRule]
# Deletes the Windows systemstatebackup using wbadmin.exe.
# This technique is used by numerous ransomware families.
# This may only be successful on server platforms that have Windows Backup enabled.
# Author: frack113
RuleName = SystemStateBackup Deleted Using Wbadmin.EXE
EventType = Process.Start
Tag = proc-start-systemstatebackup-deleted-using-wbadmin.exe
RiskScore = 75
Query = ((Process.Path like r"%\\wbadmin.exe" or Process.Name == "WBADMIN.EXE") and (Process.CommandLine like r"%delete %" and Process.CommandLine like r"%systemstatebackup %" and Process.CommandLine like r"%-keepVersions:0%"))

[ActivityMonitoringRule]
# Detects an access to authentication tokens and accounts of Microsoft Teams desktop application.
# Author: @SerkinValery
RuleName = Suspicious Command With Teams Objects Paths
EventType = Process.Start
Tag = proc-start-suspicious-command-with-teams-objects-paths
RiskScore = 75
Query = ((Process.CommandLine like r"%\\Microsoft\\Teams\\Cookies%" or Process.CommandLine like r"%\\Microsoft\\Teams\\Local Storage\\leveldb%") and not (Process.Path like r"%\\Microsoft\\Teams\\current\\Teams.exe"))

[ActivityMonitoringRule]
# Detects execution of VMware Xfer utility (VMwareXferlogs.exe) from the non-default directory which may be an attempt to sideload arbitrary DLL
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = DLL Sideloading by VMware Xfer Utility
EventType = Process.Start
Tag = proc-start-dll-sideloading-by-vmware-xfer-utility
RiskScore = 75
Query = (Process.Path like r"%\\VMwareXferlogs.exe" and not (Process.Path like r"C:\\Program Files\\VMware\\%"))

[ActivityMonitoringRule]
# Detects a suspicious process spawning from an "mshta.exe" process, which could be indicative of a malicious HTA script execution
# Author: Michael Haag
RuleName = Suspicious MSHTA Child Process
EventType = Process.Start
Tag = proc-start-suspicious-mshta-child-process
RiskScore = 75
Query = (Parent.Path like r"%\\mshta.exe" and ((Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\sh.exe" or Process.Path like r"%\\bash.exe" or Process.Path like r"%\\reg.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\bitsadmin.exe") or Process.Name in ["Cmd.Exe", "PowerShell.EXE", "pwsh.dll", "wscript.exe", "cscript.exe", "Bash.exe", "reg.exe", "REGSVR32.EXE", "bitsadmin.exe"]))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects installation of a new shim using sdbinst.exe. A shim can be used to load malicious DLLs into applications.
# Author: Markus Neis
RuleName = Possible Shim Database Persistence via sdbinst.exe
EventType = Process.Start
Tag = proc-start-possible-shim-database-persistence-via-sdbinst.exe
RiskScore = 75
Query = ((Process.Path like r"%\\sdbinst.exe" and Process.CommandLine like r"%.sdb%") and not (Process.CommandLine like r"%iisexpressshim.sdb%"))

[ActivityMonitoringRule]
# Detects Obfuscated Powershell via use Clip.exe in Scripts
# Author: Nikita Nazarov, oscd.community
RuleName = Invoke-Obfuscation Via Use Clip
EventType = Process.Start
Tag = proc-start-invoke-obfuscation-via-use-clip
RiskScore = 75
Query = (Process.CommandLine like r"%echo%" and Process.CommandLine like r"%clip%" and Process.CommandLine like r"%&&%" and (Process.CommandLine like r"%clipboard%" or Process.CommandLine like r"%invoke%" or Process.CommandLine like r"%i`%" or Process.CommandLine like r"%n`%" or Process.CommandLine like r"%v`%" or Process.CommandLine like r"%o`%" or Process.CommandLine like r"%k`%" or Process.CommandLine like r"%e`%"))

[ActivityMonitoringRule]
# Detects uninstallation or termination of security products using the WMIC utility
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential Tampering With Security Products Via WMIC
EventType = Process.Start
Tag = proc-start-potential-tampering-with-security-products-via-wmic
RiskScore = 75
Query = (((Process.CommandLine like r"%wmic%" and Process.CommandLine like r"%product where %" and Process.CommandLine like r"%call%" and Process.CommandLine like r"%uninstall%" and Process.CommandLine like r"%/nointeractive%") or (Process.CommandLine like r"%wmic%" and Process.CommandLine like r"%caption like %" and (Process.CommandLine like r"%call delete%" or Process.CommandLine like r"%call terminate%")) or (Process.CommandLine like r"%process %" and Process.CommandLine like r"%where %" and Process.CommandLine like r"%delete%")) and (Process.CommandLine like r"%\%carbon\%%" or Process.CommandLine like r"%\%cylance\%%" or Process.CommandLine like r"%\%endpoint\%%" or Process.CommandLine like r"%\%eset\%%" or Process.CommandLine like r"%\%malware\%%" or Process.CommandLine like r"%\%Sophos\%%" or Process.CommandLine like r"%\%symantec\%%" or Process.CommandLine like r"%Antivirus%" or Process.CommandLine like r"%AVG %" or Process.CommandLine like r"%Carbon Black%" or Process.CommandLine like r"%CarbonBlack%" or Process.CommandLine like r"%Cb Defense Sensor 64-bit%" or Process.CommandLine like r"%Crowdstrike Sensor%" or Process.CommandLine like r"%Cylance %" or Process.CommandLine like r"%Dell Threat Defense%" or Process.CommandLine like r"%DLP Endpoint%" or Process.CommandLine like r"%Endpoint Detection%" or Process.CommandLine like r"%Endpoint Protection%" or Process.CommandLine like r"%Endpoint Security%" or Process.CommandLine like r"%Endpoint Sensor%" or Process.CommandLine like r"%ESET File Security%" or Process.CommandLine like r"%LogRhythm System Monitor Service%" or Process.CommandLine like r"%Malwarebytes%" or Process.CommandLine like r"%McAfee Agent%" or Process.CommandLine like r"%Microsoft Security Client%" or Process.CommandLine like r"%Sophos Anti-Virus%" or Process.CommandLine like r"%Sophos AutoUpdate%" or Process.CommandLine like r"%Sophos Credential Store%" or Process.CommandLine like r"%Sophos Management Console%" or Process.CommandLine like r"%Sophos Management Database%" or Process.CommandLine like r"%Sophos Management Server%" or Process.CommandLine like r"%Sophos Remote Management System%" or Process.CommandLine like r"%Sophos Update Manager%" or Process.CommandLine like r"%Threat Protection%" or Process.CommandLine like r"%VirusScan%" or Process.CommandLine like r"%Webroot SecureAnywhere%" or Process.CommandLine like r"%Windows Defender%"))

[ActivityMonitoringRule]
# Detects attackers attempting to disable Windows Defender using Powershell
# Author: ok @securonix invrep-de, oscd.community, frack113
RuleName = Disable Windows Defender AV Security Monitoring
EventType = Process.Start
Tag = proc-start-disable-windows-defender-av-security-monitoring
RiskScore = 75
Query = ((((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") or Process.Name in ["PowerShell.EXE", "pwsh.dll"]) and (Process.CommandLine like r"%-DisableBehaviorMonitoring $true%" or Process.CommandLine like r"%-DisableRuntimeMonitoring $true%")) or ((Process.Path like r"%\\sc.exe" or Process.Name == "sc.exe") and ((Process.CommandLine like r"%stop%" and Process.CommandLine like r"%WinDefend%") or (Process.CommandLine like r"%delete%" and Process.CommandLine like r"%WinDefend%") or (Process.CommandLine like r"%config%" and Process.CommandLine like r"%WinDefend%" and Process.CommandLine like r"%start=disabled%"))))

[ActivityMonitoringRule]
# Adversaries may disable security tools to avoid possible detection of their tools and activities by uninstalling Crowdstrike Falcon
# Author: frack113
RuleName = Uninstall Crowdstrike Falcon Sensor
EventType = Process.Start
Tag = proc-start-uninstall-crowdstrike-falcon-sensor
RiskScore = 75
Query = (Process.CommandLine like r"%\\WindowsSensor.exe%" and Process.CommandLine like r"% /uninstall%" and Process.CommandLine like r"% /quiet%")

[ActivityMonitoringRule]
# Detects a suspicious child process of a Microsoft HTML Help system when executing compiled HTML files (.chm)
# Author: Maxim Pavlunin
RuleName = HTML Help Shell Spawn
EventType = Process.Start
Tag = proc-start-html-help-shell-spawn
RiskScore = 75
Query = (((Parent.Path like r"C:\\Windows\\hh.exe" or Parent.Path like r"C:\\Windows\\SysWOW64\\hh.exe") and (Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\wmic.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\MSHTA.EXE" or Process.Path like r"%\\CertUtil.exe" or Process.Path like r"%\\CertReq.exe" or Process.Path like r"%\\MSbuild.exe" or Process.Path like r"%\\installutil.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\msiexec.exe")) or ((Process.Path like r"%\\Windows\\hh.exe" or Process.Path like r"%\\Windows\\SysWOW64\\hh.exe") and (Process.CommandLine like r"%.application%" or Process.CommandLine like r"%\\Downloads\\%" or Process.CommandLine like r"%\\Content.Outlook\\%" or Process.CommandLine like r"%\\AppData\\Local\\Temp\\%")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects a process spawned by the terminal service server process (this could be an indicator for an exploitation of CVE-2019-0708)
# Author: Florian Roth (Nextron Systems)
RuleName = Terminal Service Process Spawn
EventType = Process.Start
Tag = proc-start-terminal-service-process-spawn
RiskScore = 75
Query = ((Parent.CommandLine like r"%\\svchost.exe%" and Parent.CommandLine like r"%termsvcs%") and not (((Process.Path like r"%\\rdpclip.exe" or Process.Path like r"%:\\Windows\\System32\\csrss.exe" or Process.Path like r"%:\\Windows\\System32\\wininit.exe" or Process.Path like r"%:\\Windows\\System32\\winlogon.exe")) or (Process.Path == '')))
GenericProperty1 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects potential process injection via Microsoft Remote Asssistance (Msra.exe) by looking at suspicious child processes spawned from the aforementioned process. It has been a target used by many threat actors and used for discovery and persistence tactics
# Author: Alexander McDonald
RuleName = Potential Process Injection Via Msra.EXE
EventType = Process.Start
Tag = proc-start-potential-process-injection-via-msra.exe
RiskScore = 75
Query = (Parent.Path like r"%\\msra.exe" and Parent.CommandLine like r"%msra.exe" and (Process.Path like r"%\\arp.exe" or Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\net.exe" or Process.Path like r"%\\netstat.exe" or Process.Path like r"%\\nslookup.exe" or Process.Path like r"%\\route.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\whoami.exe"))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects the execution of certutil with certain flags that allow the utility to download files from direct IPs.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious File Downloaded From Direct IP Via Certutil.EXE
EventType = Process.Start
Tag = proc-start-suspicious-file-downloaded-from-direct-ip-via-certutil.exe
RiskScore = 75
Query = (((Process.Path like r"%\\certutil.exe" or Process.Name == "CertUtil.exe") and (Process.CommandLine like r"%urlcache %" or Process.CommandLine like r"%verifyctl %") and (Process.CommandLine like r"%://1%" or Process.CommandLine like r"%://2%" or Process.CommandLine like r"%://3%" or Process.CommandLine like r"%://4%" or Process.CommandLine like r"%://5%" or Process.CommandLine like r"%://6%" or Process.CommandLine like r"%://7%" or Process.CommandLine like r"%://8%" or Process.CommandLine like r"%://9%")) and not ((Process.CommandLine like r"%://7-%")))

[ActivityMonitoringRule]
# Detects suspicious remote procedure call (RPC) service anomalies based on the spawned sub processes (long shot to detect the exploitation of vulnerabilities like CVE-2022-26809)
# Author: Florian Roth (Nextron Systems)
RuleName = Potential CVE-2022-26809 Exploitation Attempt
EventType = Process.Start
Tag = proc-start-potential-cve-2022-26809-exploitation-attempt
RiskScore = 75
Query = (Parent.Path like r"C:\\Windows\\System32\\svchost.exe" and Parent.CommandLine like r"%-k RPCSS%")
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects usage of the "TcpClient" class. Which can be abused to establish remote connections and reverse-shells. As seen used by the Nishang "Invoke-PowerShellTcpOneLine" reverse shell.
# Author: FPT.EagleEye, wagga
RuleName = Potential Powershell ReverseShell Connection
EventType = Process.Start
Tag = proc-start-potential-powershell-reverseshell-connection
RiskScore = 75
Query = ((Process.Name in ["PowerShell.EXE", "pwsh.dll"] or (Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe")) and (Process.CommandLine like r"% System.Net.Sockets.TCPClient%" and Process.CommandLine like r"%.GetBytes%" and Process.CommandLine like r"%.Write%"))

[ActivityMonitoringRule]
# Detects shell32.dll executing a DLL in a suspicious directory
# Author: Christian Burkard (Nextron Systems)
RuleName = Shell32 DLL Execution in Suspicious Directory
EventType = Process.Start
Tag = proc-start-shell32-dll-execution-in-suspicious-directory
RiskScore = 75
Query = ((Process.Path like r"%\\rundll32.exe" or Process.Name == "RUNDLL32.EXE") and (Process.CommandLine like r"%shell32.dll%" and Process.CommandLine like r"%Control\_RunDLL%" and (Process.CommandLine like r"%\%AppData\%%" or Process.CommandLine like r"%\%LocalAppData\%%" or Process.CommandLine like r"%\%Temp\%%" or Process.CommandLine like r"%\%tmp\%%" or Process.CommandLine like r"%\\AppData\\%" or Process.CommandLine like r"%\\Temp\\%" or Process.CommandLine like r"%\\Users\\Public\\%")))

[ActivityMonitoringRule]
# Detects specific process characteristics of Snatch ransomware word document droppers
# Author: Florian Roth (Nextron Systems)
RuleName = Potential Snatch Ransomware Activity
EventType = Process.Start
Tag = proc-start-potential-snatch-ransomware-activity
RiskScore = 75
Query = (Process.CommandLine like r"%shutdown /r /f /t 00%" or Process.CommandLine like r"%net stop SuperBackupMan%")

[ActivityMonitoringRule]
# Detects UAC bypass method using Windows event viewer
# Author: Florian Roth (Nextron Systems)
RuleName = UAC Bypass via Event Viewer
EventType = Process.Start
Tag = proc-start-uac-bypass-via-event-viewer
RiskScore = 75
Query = (Parent.Path like r"%\\eventvwr.exe" and not ((Process.Path like r"%\\mmc.exe" or Process.Path like r"%:\\Windows\\SysWOW64\\WerFault.exe" or Process.Path like r"%:\\Windows\\System32\\WerFault.exe")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious command line in which a user gets added to the local Remote Desktop Users group
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Add User to Remote Desktop Users Group
EventType = Process.Start
Tag = proc-start-suspicious-add-user-to-remote-desktop-users-group
RiskScore = 75
Query = (((Process.CommandLine like r"%localgroup %" and Process.CommandLine like r"% /add%") or (Process.CommandLine like r"%Add-LocalGroupMember %" and Process.CommandLine like r"% -Group %")) and (Process.CommandLine like r"%Remote Desktop Users%" or Process.CommandLine like r"%Utilisateurs du Bureau Ã  distance%" or Process.CommandLine like r"%Usuarios de escritorio remoto%"))

[ActivityMonitoringRule]
# Detects execution of "reg.exe" commands with the "delete" flag on services registry key. Often used by attacker to remove AV software services
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Service Registry Key Deleted Via Reg.EXE
EventType = Process.Start
Tag = proc-start-service-registry-key-deleted-via-reg.exe
RiskScore = 75
Query = ((Process.Path like r"%reg.exe" or Process.Name == "reg.exe") and Process.CommandLine like r"% delete %" and Process.CommandLine like r"%\\SYSTEM\\CurrentControlSet\\services\\%")

[ActivityMonitoringRule]
# Detects Office applications executing a child process that includes directory traversal patterns. This could be an attempt to exploit CVE-2022-30190 (MSDT RCE) or CVE-2021-40444 (MSHTML RCE)
# Author: Christian Burkard (Nextron Systems), @SBousseaden (idea)
RuleName = Potential Exploitation Attempt From Office Application
EventType = Process.Start
Tag = proc-start-potential-exploitation-attempt-from-office-application
RiskScore = 75
Query = ((Parent.Path like r"%\\winword.exe" or Parent.Path like r"%\\excel.exe" or Parent.Path like r"%\\powerpnt.exe" or Parent.Path like r"%\\msaccess.exe" or Parent.Path like r"%\\mspub.exe" or Parent.Path like r"%\\eqnedt32.exe" or Parent.Path like r"%\\visio.exe") and (Process.CommandLine like r"%../../../..%" or Process.CommandLine like r"%..\\..\\..\\..%" or Process.CommandLine like r"%..//..//..//..%"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious use of 'calc.exe' with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Calculator Usage
EventType = Process.Start
Tag = proc-start-suspicious-calculator-usage
RiskScore = 75
Query = (Process.CommandLine like r"%\\calc.exe %" or (Process.Path like r"%\\calc.exe" and not ((Process.Path like r"C:\\Windows\\System32\\%" or Process.Path like r"C:\\Windows\\SysWOW64\\%" or Process.Path like r"C:\\Windows\\WinSxS\\%"))))

[ActivityMonitoringRule]
# Detects suspicious inline VBScript keywords as used by UNC2452
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious VBScript UN2452 Pattern
EventType = Process.Start
Tag = proc-start-suspicious-vbscript-un2452-pattern
RiskScore = 75
Query = ((Process.CommandLine like r"%Execute%" and Process.CommandLine like r"%CreateObject%" and Process.CommandLine like r"%RegRead%" and Process.CommandLine like r"%window.close%" and Process.CommandLine like r"%\\Microsoft\\Windows\\CurrentVersion%") and not (Process.CommandLine like r"%\\Software\\Microsoft\\Windows\\CurrentVersion\\Run%"))

[ActivityMonitoringRule]
# Detects when adversaries stop services or processes by deleting their respective scheduled tasks in order to conduct data destructive activities
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Delete Important Scheduled Task
EventType = Process.Start
Tag = proc-start-delete-important-scheduled-task
RiskScore = 75
Query = (Process.Path like r"%\\schtasks.exe" and Process.CommandLine like r"%/delete%" and Process.CommandLine like r"%/tn%" and (Process.CommandLine like r"%\\Windows\\SystemRestore\\SR%" or Process.CommandLine like r"%\\Windows\\Windows Defender\\%" or Process.CommandLine like r"%\\Windows\\BitLocker%" or Process.CommandLine like r"%\\Windows\\WindowsBackup\\%" or Process.CommandLine like r"%\\Windows\\WindowsUpdate\\%" or Process.CommandLine like r"%\\Windows\\UpdateOrchestrator\\%" or Process.CommandLine like r"%\\Windows\\ExploitGuard%"))

[ActivityMonitoringRule]
# Detects a process memory dump via "comsvcs.dll" using rundll32, covering multiple different techniques (ordinal, minidump function, etc.)
# Author: Florian Roth (Nextron Systems), Modexp, Nasreddine Bencherchali (Nextron Systems)
RuleName = Process Dumping Via Comsvcs.DLL
EventType = Process.Start
Tag = proc-start-process-dumping-via-comsvcs.dll
RiskScore = 75
Query = (((Process.Path like r"%\\rundll32.exe" or Process.Name == "RUNDLL32.EXE" or Process.CommandLine like r"%rundll32%") and (Process.CommandLine like r"%comsvcs%" and Process.CommandLine like r"%full%" and (Process.CommandLine like r"%24 %" or Process.CommandLine like r"%#24%" or Process.CommandLine like r"%#+24%" or Process.CommandLine like r"%MiniDump%"))) or Process.CommandLine like r"%#-4294967272%")

[ActivityMonitoringRule]
# Checks whether the image specified in a process creation event is not a full, absolute path (caused by process ghosting or other unorthodox methods to start a process)
# Author: Max Altgelt (Nextron Systems)
RuleName = Execution Of Non-Existing File
EventType = Process.Start
Tag = proc-start-execution-of-non-existing-file
RiskScore = 75
Query = (not (Process.Path like r"%\\%") and not ((Process.Path == '') or (Process.Path in ["-", ""]) or (Process.Path in ["System", "Registry", "MemCompression", "vmmem"] or Process.CommandLine in ["Registry", "MemCompression", "vmmem"])))

[ActivityMonitoringRule]
# Detects the usage of "hh.exe" executing recently modified .chm files.
# Author: E.M. Anhaus (originally from Atomic Blue Detections, Dan Beavin), oscd.community
RuleName = HH.EXE Execution
EventType = Process.Start
Tag = proc-start-hh.exe-execution
RiskScore = 75
Query = (Process.Path like r"%\\hh.exe" and Process.CommandLine like r"%.chm%")

[ActivityMonitoringRule]
# Detects a certain command line flag combination used by regsvr32 when used to download and register a DLL from a remote address which uses HTTP (not HTTPS) and a IP address and not FQDN
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Regsvr32 HTTP IP Pattern
EventType = Process.Start
Tag = proc-start-suspicious-regsvr32-http-ip-pattern
RiskScore = 75
Query = (Process.CommandLine like r"% /s%" and Process.CommandLine like r"% /u%" and (Process.CommandLine like r"% /i:http://1%" or Process.CommandLine like r"% /i:http://2%" or Process.CommandLine like r"% /i:http://3%" or Process.CommandLine like r"% /i:http://4%" or Process.CommandLine like r"% /i:http://5%" or Process.CommandLine like r"% /i:http://6%" or Process.CommandLine like r"% /i:http://7%" or Process.CommandLine like r"% /i:http://8%" or Process.CommandLine like r"% /i:http://9%" or Process.CommandLine like r"% /i:https://1%" or Process.CommandLine like r"% /i:https://2%" or Process.CommandLine like r"% /i:https://3%" or Process.CommandLine like r"% /i:https://4%" or Process.CommandLine like r"% /i:https://5%" or Process.CommandLine like r"% /i:https://6%" or Process.CommandLine like r"% /i:https://7%" or Process.CommandLine like r"% /i:https://8%" or Process.CommandLine like r"% /i:https://9%"))

[ActivityMonitoringRule]
# Detects known WMI recon method to look for unquoted service paths using wmic. Often used by pentester and attacker enumeration scripts
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential Unquoted Service Path Reconnaissance Via Wmic.EXE
EventType = Process.Start
Tag = proc-start-potential-unquoted-service-path-reconnaissance-via-wmic.exe
RiskScore = 75
Query = ((Process.Name == "wmic.exe" or Process.Path like r"%\\WMIC.exe") and (Process.CommandLine like r"% service get %" and Process.CommandLine like r"%name,displayname,pathname,startmode%"))

[ActivityMonitoringRule]
# Detects possible Sysmon filter driver unloaded via fltmc.exe
# Author: Kirill Kiryanov, oscd.community
RuleName = Sysmon Driver Unloaded Via Fltmc.EXE
EventType = Process.Start
Tag = proc-start-sysmon-driver-unloaded-via-fltmc.exe
RiskScore = 75
Query = ((Process.Path like r"%\\fltMC.exe" or Process.Name == "fltMC.exe") and (Process.CommandLine like r"%unload%" and Process.CommandLine like r"%sysmon%"))

[ActivityMonitoringRule]
# Detects a flag anomaly in which regsvr32.exe uses a /i flag without using a /n flag at the same time
# Author: Florian Roth (Nextron Systems)
RuleName = Regsvr32 Flags Anomaly
EventType = Process.Start
Tag = proc-start-regsvr32-flags-anomaly
RiskScore = 75
Query = ((Process.Path like r"%\\regsvr32.exe" and Process.CommandLine like r"% /i:%") and not (Process.CommandLine like r"% /n %"))

[ActivityMonitoringRule]
# Detects suspicious PowerShell invocation with a parameter substring
# Author: Florian Roth (Nextron Systems), Daniel Bohannon (idea), Roberto Rodriguez (Fix)
RuleName = Suspicious PowerShell Parameter Substring
EventType = Process.Start
Tag = proc-start-suspicious-powershell-parameter-substring
RiskScore = 75
Query = ((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") and (Process.CommandLine like r"% -windowstyle h %" or Process.CommandLine like r"% -windowstyl h%" or Process.CommandLine like r"% -windowsty h%" or Process.CommandLine like r"% -windowst h%" or Process.CommandLine like r"% -windows h%" or Process.CommandLine like r"% -windo h%" or Process.CommandLine like r"% -wind h%" or Process.CommandLine like r"% -win h%" or Process.CommandLine like r"% -wi h%" or Process.CommandLine like r"% -win h %" or Process.CommandLine like r"% -win hi %" or Process.CommandLine like r"% -win hid %" or Process.CommandLine like r"% -win hidd %" or Process.CommandLine like r"% -win hidde %" or Process.CommandLine like r"% -NoPr %" or Process.CommandLine like r"% -NoPro %" or Process.CommandLine like r"% -NoProf %" or Process.CommandLine like r"% -NoProfi %" or Process.CommandLine like r"% -NoProfil %" or Process.CommandLine like r"% -nonin %" or Process.CommandLine like r"% -nonint %" or Process.CommandLine like r"% -noninte %" or Process.CommandLine like r"% -noninter %" or Process.CommandLine like r"% -nonintera %" or Process.CommandLine like r"% -noninterac %" or Process.CommandLine like r"% -noninteract %" or Process.CommandLine like r"% -noninteracti %" or Process.CommandLine like r"% -noninteractiv %" or Process.CommandLine like r"% -ec %" or Process.CommandLine like r"% -encodedComman %" or Process.CommandLine like r"% -encodedComma %" or Process.CommandLine like r"% -encodedComm %" or Process.CommandLine like r"% -encodedCom %" or Process.CommandLine like r"% -encodedCo %" or Process.CommandLine like r"% -encodedC %" or Process.CommandLine like r"% -encoded %" or Process.CommandLine like r"% -encode %" or Process.CommandLine like r"% -encod %" or Process.CommandLine like r"% -enco %" or Process.CommandLine like r"% -en %" or Process.CommandLine like r"% -executionpolic %" or Process.CommandLine like r"% -executionpoli %" or Process.CommandLine like r"% -executionpol %" or Process.CommandLine like r"% -executionpo %" or Process.CommandLine like r"% -executionp %" or Process.CommandLine like r"% -execution bypass%" or Process.CommandLine like r"% -executio bypass%" or Process.CommandLine like r"% -executi bypass%" or Process.CommandLine like r"% -execut bypass%" or Process.CommandLine like r"% -execu bypass%" or Process.CommandLine like r"% -exec bypass%" or Process.CommandLine like r"% -exe bypass%" or Process.CommandLine like r"% -ex bypass%" or Process.CommandLine like r"% -ep bypass%" or Process.CommandLine like r"% /windowstyle h %" or Process.CommandLine like r"% /windowstyl h%" or Process.CommandLine like r"% /windowsty h%" or Process.CommandLine like r"% /windowst h%" or Process.CommandLine like r"% /windows h%" or Process.CommandLine like r"% /windo h%" or Process.CommandLine like r"% /wind h%" or Process.CommandLine like r"% /win h%" or Process.CommandLine like r"% /wi h%" or Process.CommandLine like r"% /win h %" or Process.CommandLine like r"% /win hi %" or Process.CommandLine like r"% /win hid %" or Process.CommandLine like r"% /win hidd %" or Process.CommandLine like r"% /win hidde %" or Process.CommandLine like r"% /NoPr %" or Process.CommandLine like r"% /NoPro %" or Process.CommandLine like r"% /NoProf %" or Process.CommandLine like r"% /NoProfi %" or Process.CommandLine like r"% /NoProfil %" or Process.CommandLine like r"% /nonin %" or Process.CommandLine like r"% /nonint %" or Process.CommandLine like r"% /noninte %" or Process.CommandLine like r"% /noninter %" or Process.CommandLine like r"% /nonintera %" or Process.CommandLine like r"% /noninterac %" or Process.CommandLine like r"% /noninteract %" or Process.CommandLine like r"% /noninteracti %" or Process.CommandLine like r"% /noninteractiv %" or Process.CommandLine like r"% /ec %" or Process.CommandLine like r"% /encodedComman %" or Process.CommandLine like r"% /encodedComma %" or Process.CommandLine like r"% /encodedComm %" or Process.CommandLine like r"% /encodedCom %" or Process.CommandLine like r"% /encodedCo %" or Process.CommandLine like r"% /encodedC %" or Process.CommandLine like r"% /encoded %" or Process.CommandLine like r"% /encode %" or Process.CommandLine like r"% /encod %" or Process.CommandLine like r"% /enco %" or Process.CommandLine like r"% /en %" or Process.CommandLine like r"% /executionpolic %" or Process.CommandLine like r"% /executionpoli %" or Process.CommandLine like r"% /executionpol %" or Process.CommandLine like r"% /executionpo %" or Process.CommandLine like r"% /executionp %" or Process.CommandLine like r"% /execution bypass%" or Process.CommandLine like r"% /executio bypass%" or Process.CommandLine like r"% /executi bypass%" or Process.CommandLine like r"% /execut bypass%" or Process.CommandLine like r"% /execu bypass%" or Process.CommandLine like r"% /exec bypass%" or Process.CommandLine like r"% /exe bypass%" or Process.CommandLine like r"% /ex bypass%" or Process.CommandLine like r"% /ep bypass%"))

[ActivityMonitoringRule]
# Detects when a user downloads file by using CertOC.exe
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious File Download via CertOC.exe
EventType = Process.Start
Tag = proc-start-suspicious-file-download-via-certoc.exe
RiskScore = 75
Query = ((Process.Path like r"%\\certoc.exe" or Process.Name == "CertOC.exe") and Process.CommandLine like r"%-GetCACAPS%")

[ActivityMonitoringRule]
# Detects Schtask creations that point to a suspicious folder or an environment variable often used by malware
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Schtasks From Env Var Folder
EventType = Process.Start
Tag = proc-start-suspicious-schtasks-from-env-var-folder
RiskScore = 75
Query = (((Process.Path like r"%\\schtasks.exe" and Process.CommandLine like r"% /create %" and (Process.CommandLine like r"%\%AppData\%%" or Process.CommandLine like r"%\\AppData\\Local\\%" or Process.CommandLine like r"%\\AppData\\Roaming\\%" or Process.CommandLine like r"%\%Public\%%" or Process.CommandLine like r"%\\Users\\Public%" or Process.CommandLine like r"%C:\\Windows\\Temp%" or Process.CommandLine like r"%C:\\Perflogs%")) or (Parent.CommandLine like r"%\\svchost.exe -k netsvcs -p -s Schedule" and (Process.CommandLine like r"%\%Public\%%" or Process.CommandLine like r"%\\Users\\Public%" or Process.CommandLine like r"%C:\\Windows\\Temp%" or Process.CommandLine like r"%C:\\Perflogs%"))) and not (((Process.CommandLine like r"%update\_task.xml%" or Process.CommandLine like r"%/Create /TN TVInstallRestore /TR%") or Parent.CommandLine like r"%unattended.ini%") or (Process.CommandLine like r"%/Create /Xml \"C:\\Users\\%" and Process.CommandLine like r"%\\AppData\\Local\\Temp\\.CR.%" and Process.CommandLine like r"%Avira\_Security\_Installation.xml%") or (Process.CommandLine like r"%/Create /F /TN%" and Process.CommandLine like r"%/Xml %" and Process.CommandLine like r"%\\AppData\\Local\\Temp\\is-%" and Process.CommandLine like r"%Avira\_%" and (Process.CommandLine like r"%.tmp\\UpdateFallbackTask.xml%" or Process.CommandLine like r"%.tmp\\WatchdogServiceControlManagerTimeout.xml%" or Process.CommandLine like r"%.tmp\\SystrayAutostart.xml%" or Process.CommandLine like r"%.tmp\\MaintenanceTask.xml%")) or (Process.CommandLine like r"%\\AppData\\Local\\Temp\\%" and Process.CommandLine like r"%/Create /TN \"klcp\_update\" /XML %" and Process.CommandLine like r"%\\klcp\_update\_task.xml%")))
GenericProperty1 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects execution of the built-in script located in "C:\Windows\System32\gatherNetworkInfo.vbs". Which can be used to gather information about the target machine
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Reconnaissance Activity Via GatherNetworkInfo.VBS
EventType = Process.Start
Tag = proc-start-suspicious-reconnaissance-activity-via-gathernetworkinfo.vbs
RiskScore = 75
Query = (Process.CommandLine like r"%gatherNetworkInfo.vbs%" and not ((Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\wscript.exe")))

[ActivityMonitoringRule]
# Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service starting
# Author: Teymur Kheirkhabarov, Ecco, Florian Roth
RuleName = Potential Meterpreter/CobaltStrike Activity
EventType = Process.Start
Tag = proc-start-potential-meterpreter/cobaltstrike-activity
RiskScore = 75
Query = ((Parent.Path like r"%\\services.exe" and ((Process.CommandLine like r"%/c%" and Process.CommandLine like r"%echo%" and Process.CommandLine like r"%\\pipe\\%" and (Process.CommandLine like r"%cmd%" or Process.CommandLine like r"%\%COMSPEC\%%")) or (Process.CommandLine like r"%rundll32%" and Process.CommandLine like r"%.dll,a%" and Process.CommandLine like r"%/p:%"))) and not ((Process.CommandLine like r"%MpCmdRun%")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Rundll32 can be use by Cobalt Strike with StartW function to load DLLs from the command line.
# Author: Wojciech Lesicki
RuleName = CobaltStrike Load by Rundll32
EventType = Process.Start
Tag = proc-start-cobaltstrike-load-by-rundll32
RiskScore = 75
Query = ((Process.Path like r"%\\rundll32.exe" or Process.Name == "RUNDLL32.EXE" or (Process.CommandLine like r"%rundll32.exe%" or Process.CommandLine like r"%rundll32 %")) and (Process.CommandLine like r"%.dll%" and (Process.CommandLine like r"% StartW" or Process.CommandLine like r"%,StartW")))

[ActivityMonitoringRule]
# Detection for mshta.exe suspicious execution patterns sometimes involving file polyglotism
# Author: Diego Perez (@darkquassar), Markus Neis, Swisscom (Improve Rule)
RuleName = MSHTA Suspicious Execution 01
EventType = Process.Start
Tag = proc-start-mshta-suspicious-execution-01
RiskScore = 75
Query = (Process.Path like r"%\\mshta.exe" and (Process.CommandLine like r"%vbscript%" or Process.CommandLine like r"%.jpg%" or Process.CommandLine like r"%.png%" or Process.CommandLine like r"%.lnk%" or Process.CommandLine like r"%.xls%" or Process.CommandLine like r"%.doc%" or Process.CommandLine like r"%.zip%" or Process.CommandLine like r"%.dll%"))

[ActivityMonitoringRule]
# Detects PowerShell script execution from Alternate Data Stream (ADS)
# Author: Sergey Soldatov, Kaspersky Lab, oscd.community
RuleName = Run PowerShell Script from ADS
EventType = Process.Start
Tag = proc-start-run-powershell-script-from-ads
RiskScore = 75
Query = ((Parent.Path like r"%\\powershell.exe" or Parent.Path like r"%\\pwsh.exe") and (Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") and Process.CommandLine like r"%Get-Content%" and Process.CommandLine like r"%-Stream%")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the execution of CSharp interactive console by PowerShell
# Author: Michael R. (@nahamike01)
RuleName = Suspicious Use of CSharp Interactive Console
EventType = Process.Start
Tag = proc-start-suspicious-use-of-csharp-interactive-console
RiskScore = 75
Query = (Process.Path like r"%\\csi.exe" and (Parent.Path like r"%\\powershell.exe" or Parent.Path like r"%\\pwsh.exe" or Parent.Path like r"%\\powershell\_ise.exe") and Process.Name == "csi.exe")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects renamed SysInternals tool execution with a binary named ps.exe as used by Dragonfly APT group and documented in TA17-293A report
# Author: Florian Roth (Nextron Systems)
RuleName = Ps.exe Renamed SysInternals Tool
EventType = Process.Start
Tag = proc-start-ps.exe-renamed-sysinternals-tool
RiskScore = 75
Query = Process.CommandLine == "ps.exe -accepteula"

[ActivityMonitoringRule]
# Detects base64 encoded strings used in hidden malicious PowerShell command lines
# Author: John Lambert (rule)
RuleName = Malicious Base64 Encoded PowerShell Keywords in Command Lines
EventType = Process.Start
Tag = proc-start-malicious-base64-encoded-powershell-keywords-in-command-lines
RiskScore = 75
Query = (((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") or Process.Name in ["PowerShell.EXE", "pwsh.dll"]) and Process.CommandLine like r"% hidden %" and (Process.CommandLine like r"%AGkAdABzAGEAZABtAGkAbgAgAC8AdAByAGEAbgBzAGYAZQByA%" or Process.CommandLine like r"%aXRzYWRtaW4gL3RyYW5zZmVy%" or Process.CommandLine like r"%IAaQB0AHMAYQBkAG0AaQBuACAALwB0AHIAYQBuAHMAZgBlAHIA%" or Process.CommandLine like r"%JpdHNhZG1pbiAvdHJhbnNmZX%" or Process.CommandLine like r"%YgBpAHQAcwBhAGQAbQBpAG4AIAAvAHQAcgBhAG4AcwBmAGUAcg%" or Process.CommandLine like r"%Yml0c2FkbWluIC90cmFuc2Zlc%" or Process.CommandLine like r"%AGMAaAB1AG4AawBfAHMAaQB6AGUA%" or Process.CommandLine like r"%JABjAGgAdQBuAGsAXwBzAGkAegBlA%" or Process.CommandLine like r"%JGNodW5rX3Npem%" or Process.CommandLine like r"%QAYwBoAHUAbgBrAF8AcwBpAHoAZQ%" or Process.CommandLine like r"%RjaHVua19zaXpl%" or Process.CommandLine like r"%Y2h1bmtfc2l6Z%" or Process.CommandLine like r"%AE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4A%" or Process.CommandLine like r"%kATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8Abg%" or Process.CommandLine like r"%lPLkNvbXByZXNzaW9u%" or Process.CommandLine like r"%SQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuA%" or Process.CommandLine like r"%SU8uQ29tcHJlc3Npb2%" or Process.CommandLine like r"%Ty5Db21wcmVzc2lvb%" or Process.CommandLine like r"%AE8ALgBNAGUAbQBvAHIAeQBTAHQAcgBlAGEAbQ%" or Process.CommandLine like r"%kATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtA%" or Process.CommandLine like r"%lPLk1lbW9yeVN0cmVhb%" or Process.CommandLine like r"%SQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0A%" or Process.CommandLine like r"%SU8uTWVtb3J5U3RyZWFt%" or Process.CommandLine like r"%Ty5NZW1vcnlTdHJlYW%" or Process.CommandLine like r"%4ARwBlAHQAQwBoAHUAbgBrA%" or Process.CommandLine like r"%5HZXRDaHVua%" or Process.CommandLine like r"%AEcAZQB0AEMAaAB1AG4Aaw%" or Process.CommandLine like r"%LgBHAGUAdABDAGgAdQBuAGsA%" or Process.CommandLine like r"%LkdldENodW5r%" or Process.CommandLine like r"%R2V0Q2h1bm%" or Process.CommandLine like r"%AEgAUgBFAEEARABfAEkATgBGAE8ANgA0A%" or Process.CommandLine like r"%QASABSAEUAQQBEAF8ASQBOAEYATwA2ADQA%" or Process.CommandLine like r"%RIUkVBRF9JTkZPNj%" or Process.CommandLine like r"%SFJFQURfSU5GTzY0%" or Process.CommandLine like r"%VABIAFIARQBBAEQAXwBJAE4ARgBPADYANA%" or Process.CommandLine like r"%VEhSRUFEX0lORk82N%" or Process.CommandLine like r"%AHIAZQBhAHQAZQBSAGUAbQBvAHQAZQBUAGgAcgBlAGEAZA%" or Process.CommandLine like r"%cmVhdGVSZW1vdGVUaHJlYW%" or Process.CommandLine like r"%MAcgBlAGEAdABlAFIAZQBtAG8AdABlAFQAaAByAGUAYQBkA%" or Process.CommandLine like r"%NyZWF0ZVJlbW90ZVRocmVhZ%" or Process.CommandLine like r"%Q3JlYXRlUmVtb3RlVGhyZWFk%" or Process.CommandLine like r"%QwByAGUAYQB0AGUAUgBlAG0AbwB0AGUAVABoAHIAZQBhAGQA%" or Process.CommandLine like r"%0AZQBtAG0AbwB2AGUA%" or Process.CommandLine like r"%1lbW1vdm%" or Process.CommandLine like r"%AGUAbQBtAG8AdgBlA%" or Process.CommandLine like r"%bQBlAG0AbQBvAHYAZQ%" or Process.CommandLine like r"%bWVtbW92Z%" or Process.CommandLine like r"%ZW1tb3Zl%"))

[ActivityMonitoringRule]
# Detects when an attacker tries to add a new network provider in order to dump clear text credentials, similar to how the NPPSpy tool does it
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential Credential Dumping Attempt Using New NetworkProvider - CLI
EventType = Process.Start
Tag = proc-start-potential-credential-dumping-attempt-using-new-networkprovider-cli
RiskScore = 75
Query = (Process.CommandLine like r"%\\System\\CurrentControlSet\\Services\\%" and Process.CommandLine like r"%\\NetworkProvider%")

[ActivityMonitoringRule]
# Detects the usage of one of three Microsoft office applications (Word, Excel, PowerPoint) to download arbitrary files
# Author: Beyu Denis, oscd.community
RuleName = Suspicious File Download Using Office Application
EventType = Process.Start
Tag = proc-start-suspicious-file-download-using-office-application
RiskScore = 75
Query = ((Process.Path like r"%\\powerpnt.exe" or Process.Path like r"%\\winword.exe" or Process.Path like r"%\\excel.exe") and Process.CommandLine like r"%http%")

[ActivityMonitoringRule]
# Detects potential abuse of the "manage-bde.wsf" script as a LOLBIN to proxy execution
# Author: oscd.community, Natalia Shornikova, Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential Manage-bde.wsf Abuse To Proxy Execution
EventType = Process.Start
Tag = proc-start-potential-manage-bde.wsf-abuse-to-proxy-execution
RiskScore = 75
Query = (((Process.Path like r"%\\wscript.exe" or Process.Name == "wscript.exe") and Process.CommandLine like r"%manage-bde.wsf%") or (((Parent.Path like r"%\\cscript.exe" or Parent.Path like r"%\\wscript.exe") and Parent.CommandLine like r"%manage-bde.wsf%") and not (Process.Path like r"%\\cmd.exe")))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects RDP session hijacking by using MSTSC shadowing
# Author: Florian Roth (Nextron Systems)
RuleName = Potential MSTSC Shadowing Activity
EventType = Process.Start
Tag = proc-start-potential-mstsc-shadowing-activity
RiskScore = 75
Query = (Process.CommandLine like r"%noconsentprompt%" and Process.CommandLine like r"%shadow:%")

[ActivityMonitoringRule]
# Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe.
# Author: Ensar Åžamil, @sblmsrsn, @oscd_initiative
RuleName = Time Travel Debugging Utility Usage
EventType = Process.Start
Tag = proc-start-time-travel-debugging-utility-usage
RiskScore = 75
Query = Parent.Path like r"%\\tttracer.exe"
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detect creation of dump files containing the memory space of lsass.exe, which contains sensitive credentials.
# Identifies usage of Sysinternals procdump.exe to export the memory space of lsass.exe which contains sensitive credentials.
# Author: E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community
RuleName = LSASS Memory Dumping
EventType = Process.Start
Tag = proc-start-lsass-memory-dumping
RiskScore = 75
Query = ((Process.CommandLine like r"%lsass%" and Process.CommandLine like r"%.dmp%") and not (Process.Path like r"%\\werfault.exe"))

[ActivityMonitoringRule]
# Detects process creation with a renamed BrowserCore.exe (used to extract Azure tokens)
# Author: Max Altgelt (Nextron Systems)
RuleName = Renamed BrowserCore.EXE Execution
EventType = Process.Start
Tag = proc-start-renamed-browsercore.exe-execution
RiskScore = 75
Query = (Process.Name == "BrowserCore.exe" and not ((Process.Path like r"%\\BrowserCore.exe")))

[ActivityMonitoringRule]
# Detects suspicious sub processes started by the Manage Engine ServiceDesk Plus Java web service process
# Author: Florian Roth (Nextron Systems)
RuleName = Manage Engine Java Suspicious Sub Process
EventType = Process.Start
Tag = proc-start-manage-engine-java-suspicious-sub-process
RiskScore = 75
Query = ((Parent.Path like r"%\\ManageEngine\\ServiceDesk\\%" and Parent.Path like r"%\\java.exe%" and (Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\sh.exe" or Process.Path like r"%\\bash.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\certutil.exe" or Process.Path like r"%\\whoami.exe" or Process.Path like r"%\\bitsadmin.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\scrcons.exe" or Process.Path like r"%\\wmic.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\forfiles.exe" or Process.Path like r"%\\mftrace.exe" or Process.Path like r"%\\AppVLP.exe" or Process.Path like r"%\\curl.exe" or Process.Path like r"%\\notepad.exe" or Process.Path like r"%\\systeminfo.exe" or Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe" or Process.Path like r"%\\reg.exe" or Process.Path like r"%\\query.exe")) and not (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") and Process.CommandLine like r"% stop%")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious launch of the PSEXESVC service on this system and a sub process run as LOCAL_SYSTEM (-s), which means that someone remotely started a command on this system running it with highest privileges and not only the privileges of the login user account (e.g. the administrator account)
# Author: Florian Roth (Nextron Systems)
RuleName = PsExec Service Child Process Execution as LOCAL SYSTEM
EventType = Process.Start
Tag = proc-start-psexec-service-child-process-execution-as-local-system
RiskScore = 75
Query = (Parent.Path like r"C:\\Windows\\PSEXESVC.exe" and (Process.User like r"%AUTHORI%" or Process.User like r"%AUTORI%"))
GenericProperty1 = Parent.Path
GenericProperty2 = Process.User

[ActivityMonitoringRule]
# Detects various execution patterns of the CrackMapExec pentesting framework
# Author: Thomas Patzke
RuleName = HackTool - CrackMapExec Execution Patterns
EventType = Process.Start
Tag = proc-start-hacktool-crackmapexec-execution-patterns
RiskScore = 75
Query = ((Process.CommandLine like r"%cmd.exe /Q /c % 1> \\%\\%\\% 2>&1" or Process.CommandLine like r"%cmd.exe /C % > \\%\\%\\% 2>&1" or Process.CommandLine like r"%cmd.exe /C % > %\\Temp\\% 2>&1") and (Process.CommandLine like r"%powershell.exe -exec bypass -noni -nop -w 1 -C \"%" or Process.CommandLine like r"%powershell.exe -noni -nop -w 1 -enc %"))

[ActivityMonitoringRule]
# Detects suspicious base64 encoded and obbfuscated LOAD string often used for reflection.assembly load
# Author: pH-T (Nextron Systems)
RuleName = Suspicious Encoded Obfuscated LOAD String
EventType = Process.Start
Tag = proc-start-suspicious-encoded-obfuscated-load-string
RiskScore = 75
Query = (Process.CommandLine like r"%OgA6ACgAIgBMACIAKwAiAG8AYQBkACIAKQ%" or Process.CommandLine like r"%oAOgAoACIATAAiACsAIgBvAGEAZAAiACkA%" or Process.CommandLine like r"%6ADoAKAAiAEwAIgArACIAbwBhAGQAIgApA%" or Process.CommandLine like r"%OgA6ACgAIgBMAG8AIgArACIAYQBkACIAKQ%" or Process.CommandLine like r"%oAOgAoACIATABvACIAKwAiAGEAZAAiACkA%" or Process.CommandLine like r"%6ADoAKAAiAEwAbwAiACsAIgBhAGQAIgApA%" or Process.CommandLine like r"%OgA6ACgAIgBMAG8AYQAiACsAIgBkACIAKQ%" or Process.CommandLine like r"%oAOgAoACIATABvAGEAIgArACIAZAAiACkA%" or Process.CommandLine like r"%6ADoAKAAiAEwAbwBhACIAKwAiAGQAIgApA%" or Process.CommandLine like r"%OgA6ACgAJwBMACcAKwAnAG8AYQBkACcAKQ%" or Process.CommandLine like r"%oAOgAoACcATAAnACsAJwBvAGEAZAAnACkA%" or Process.CommandLine like r"%6ADoAKAAnAEwAJwArACcAbwBhAGQAJwApA%" or Process.CommandLine like r"%OgA6ACgAJwBMAG8AJwArACcAYQBkACcAKQ%" or Process.CommandLine like r"%oAOgAoACcATABvACcAKwAnAGEAZAAnACkA%" or Process.CommandLine like r"%6ADoAKAAnAEwAbwAnACsAJwBhAGQAJwApA%" or Process.CommandLine like r"%OgA6ACgAJwBMAG8AYQAnACsAJwBkACcAKQ%" or Process.CommandLine like r"%oAOgAoACcATABvAGEAJwArACcAZAAnACkA%" or Process.CommandLine like r"%6ADoAKAAnAEwAbwBhACcAKwAnAGQAJwApA%")

[ActivityMonitoringRule]
# Detects javaw.exe in AppData folder as used by Adwind / JRAT
# Author: Florian Roth (Nextron Systems), Tom Ueltschi, Jonhnathan Ribeiro, oscd.community
RuleName = Adwind RAT / JRAT
EventType = Process.Start
Tag = proc-start-adwind-rat-/-jrat
RiskScore = 75
Query = ((Process.CommandLine like r"%\\AppData\\Roaming\\Oracle%" and Process.CommandLine like r"%\\java%" and Process.CommandLine like r"%.exe %") or (Process.CommandLine like r"%cscript.exe%" and Process.CommandLine like r"%Retrive%" and Process.CommandLine like r"%.vbs %"))

[ActivityMonitoringRule]
# Identifies use of Fodhelper.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes.
# Author: E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community
RuleName = Bypass UAC via Fodhelper.exe
EventType = Process.Start
Tag = proc-start-bypass-uac-via-fodhelper.exe
RiskScore = 75
Query = Parent.Path like r"%\\fodhelper.exe"
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects changes to the PowerShell execution policy registry key in order to bypass signing requirements for script execution from the CommandLine
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential PowerShell Execution Policy Tampering - ProcCreation
EventType = Process.Start
Tag = proc-start-potential-powershell-execution-policy-tampering-proccreation
RiskScore = 75
Query = ((Process.CommandLine like r"%\\ShellIds\\Microsoft.PowerShell\\ExecutionPolicy%" or Process.CommandLine like r"%\\Policies\\Microsoft\\Windows\\PowerShell\\ExecutionPolicy%") and (Process.CommandLine like r"%Bypass%" or Process.CommandLine like r"%RemoteSigned%" or Process.CommandLine like r"%Unrestricted%"))

[ActivityMonitoringRule]
# Detects the use of KrbRelay, a Kerberos relaying tool
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - KrbRelay Execution
EventType = Process.Start
Tag = proc-start-hacktool-krbrelay-execution
RiskScore = 75
Query = ((Process.Path like r"%\\KrbRelay.exe" or Process.Name == "KrbRelay.exe") or (Process.CommandLine like r"% -spn %" and Process.CommandLine like r"% -clsid %" and Process.CommandLine like r"% -rbcd %") or (Process.CommandLine like r"%shadowcred%" and Process.CommandLine like r"%clsid%" and Process.CommandLine like r"%spn%") or (Process.CommandLine like r"%spn %" and Process.CommandLine like r"%session %" and Process.CommandLine like r"%clsid %"))

[ActivityMonitoringRule]
# Files with well-known filenames (sensitive files with credential data) copying
# Author: Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community
RuleName = Copying Sensitive Files with Credential Data
EventType = Process.Start
Tag = proc-start-copying-sensitive-files-with-credential-data
RiskScore = 75
Query = (((Process.Path like r"%\\esentutl.exe" or Process.Name like r"\\esentutl.exe") and (Process.CommandLine like r"%vss%" or Process.CommandLine like r"% /m %" or Process.CommandLine like r"% /y %")) or (Process.CommandLine like r"%\\windows\\ntds\\ntds.dit%" or Process.CommandLine like r"%\\config\\sam%" or Process.CommandLine like r"%\\config\\security%" or Process.CommandLine like r"%\\config\\system %" or Process.CommandLine like r"%\\repair\\sam%" or Process.CommandLine like r"%\\repair\\system%" or Process.CommandLine like r"%\\repair\\security%" or Process.CommandLine like r"%\\config\\RegBack\\sam%" or Process.CommandLine like r"%\\config\\RegBack\\system%" or Process.CommandLine like r"%\\config\\RegBack\\security%"))

[ActivityMonitoringRule]
# Detects unknown program using commandline flags usually used by tools such as PsExec and PAExec to start programs with SYSTEM Privileges
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential Privilege Escalation To LOCAL SYSTEM
EventType = Process.Start
Tag = proc-start-potential-privilege-escalation-to-local-system
RiskScore = 75
Query = ((Process.CommandLine like r"% -s cmd%" or Process.CommandLine like r"% /s cmd%" or Process.CommandLine like r"% -s -i cmd%" or Process.CommandLine like r"% /s /i cmd%" or Process.CommandLine like r"% /s -i cmd%" or Process.CommandLine like r"% -s /i cmd%" or Process.CommandLine like r"% -i -s cmd%" or Process.CommandLine like r"% /i /s cmd%" or Process.CommandLine like r"% -i /s cmd%" or Process.CommandLine like r"% /i -s cmd%" or Process.CommandLine like r"% -s pwsh%" or Process.CommandLine like r"% /s pwsh%" or Process.CommandLine like r"% -s -i pwsh%" or Process.CommandLine like r"% /s /i pwsh%" or Process.CommandLine like r"% /s -i pwsh%" or Process.CommandLine like r"% -s /i pwsh%" or Process.CommandLine like r"% -i -s pwsh%" or Process.CommandLine like r"% /i /s pwsh%" or Process.CommandLine like r"% -i /s pwsh%" or Process.CommandLine like r"% /i -s pwsh%" or Process.CommandLine like r"% -s powershell%" or Process.CommandLine like r"% /s powershell%" or Process.CommandLine like r"% -s -i powershell%" or Process.CommandLine like r"% /s /i powershell%" or Process.CommandLine like r"% /s -i powershell%" or Process.CommandLine like r"% -s /i powershell%" or Process.CommandLine like r"% -i -s powershell%" or Process.CommandLine like r"% /i /s powershell%" or Process.CommandLine like r"% -i /s powershell%" or Process.CommandLine like r"% /i -s powershell%") and not ((Process.CommandLine like r"%paexec%" or Process.CommandLine like r"%PsExec%" or Process.CommandLine like r"%accepteula%")))

[ActivityMonitoringRule]
# Detects suspicious ways to download files or content and execute them using PowerShell Invoke-Expression
# Author: Florian Roth (Nextron Systems)
RuleName = PowerShell Web Download and Execution
EventType = Process.Start
Tag = proc-start-powershell-web-download-and-execution
RiskScore = 75
Query = ((Process.CommandLine like r"%.DownloadString(%" or Process.CommandLine like r"%.DownloadFile(%" or Process.CommandLine like r"%Invoke-WebRequest %" or Process.CommandLine like r"%iwr %") and (Process.CommandLine like r"%IEX(%" or Process.CommandLine like r"%IEX (%" or Process.CommandLine like r"%I`EX%" or Process.CommandLine like r"%IE`X%" or Process.CommandLine like r"%I`E`X%" or Process.CommandLine like r"%| IEX%" or Process.CommandLine like r"%|IEX %" or Process.CommandLine like r"%Invoke-Expression%" or Process.CommandLine like r"%;iex $%"))

[ActivityMonitoringRule]
# Detects the use of Ditsnap tool, an inspection tool for Active Directory database, ntds.dit.
# Author: Furkan Caliskan (@caliskanfurkan_)
RuleName = PUA - DIT Snapshot Viewer
EventType = Process.Start
Tag = proc-start-pua-dit-snapshot-viewer
RiskScore = 75
Query = (Process.Path like r"%\\ditsnap.exe" or Process.CommandLine like r"%ditsnap.exe%")

[ActivityMonitoringRule]
# Detects the execution of "reg.exe" for enabling/disabling the RDP service on the host by tampering with the 'CurrentControlSet\Control\Terminal Server' values
# Author: pH-T (Nextron Systems), @Kostastsale, @TheDFIRReport
RuleName = Potential Tampering With RDP Related Registry Keys Via Reg.EXE
EventType = Process.Start
Tag = proc-start-potential-tampering-with-rdp-related-registry-keys-via-reg.exe
RiskScore = 75
Query = (((Process.Path like r"%\\reg.exe" or Process.Name == "reg.exe") and (Process.CommandLine like r"% add %" and Process.CommandLine like r"%\\CurrentControlSet\\Control\\Terminal Server%" and Process.CommandLine like r"%REG\_DWORD%" and Process.CommandLine like r"% /f%")) and ((Process.CommandLine like r"%Licensing Core%" and Process.CommandLine like r"%EnableConcurrentSessions%") or (Process.CommandLine like r"%WinStations\\RDP-Tcp%" or Process.CommandLine like r"%MaxInstanceCount%" or Process.CommandLine like r"%fEnableWinStation%" or Process.CommandLine like r"%TSUserEnabled%" or Process.CommandLine like r"%TSEnabled%" or Process.CommandLine like r"%TSAppCompat%" or Process.CommandLine like r"%IdleWinStationPoolCount%" or Process.CommandLine like r"%TSAdvertise%" or Process.CommandLine like r"%AllowTSConnections%" or Process.CommandLine like r"%fSingleSessionPerUser%" or Process.CommandLine like r"%fDenyTSConnections%")))

[ActivityMonitoringRule]
# Detects a suspicious parent of csc.exe, which could by a sign of payload delivery
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Parent of Csc.exe
EventType = Process.Start
Tag = proc-start-suspicious-parent-of-csc.exe
RiskScore = 75
Query = (Process.Path like r"%\\csc.exe" and (Parent.Path like r"%\\wscript.exe" or Parent.Path like r"%\\cscript.exe" or Parent.Path like r"%\\mshta.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the use of CreateMiniDump hack tool used to dump the LSASS process memory for credential extraction on the attacker's machine
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - CreateMiniDump Execution
EventType = Process.Start
Tag = proc-start-hacktool-createminidump-execution
RiskScore = 75
Query = (Process.Path like r"%\\CreateMiniDump.exe" or Process.Hash.IMP == "4a07f944a83e8a7c2525efa35dd30e2f" or Process.Hashes like r"%IMPHASH=4a07f944a83e8a7c2525efa35dd30e2f%")
GenericProperty1 = Process.Hash.IMP
GenericProperty2 = Process.Hashes

[ActivityMonitoringRule]
# Detects the suspicious execution of a utility to convert Windows 3.x .grp files or for persistence purposes by malicious software or actors
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious GrpConv Execution
EventType = Process.Start
Tag = proc-start-suspicious-grpconv-execution
RiskScore = 75
Query = (Process.CommandLine like r"%grpconv.exe -o%" or Process.CommandLine like r"%grpconv -o%")

[ActivityMonitoringRule]
# Detects certain command line parameters often used during reconnaissance activity via web shells
# Author: Florian Roth (Nextron Systems), Jonhnathan Ribeiro, Anton Kutepov, oscd.community
RuleName = Webshell Detection With Command Line Keywords
EventType = Process.Start
Tag = proc-start-webshell-detection-with-command-line-keywords
RiskScore = 75
Query = (((Parent.Path like r"%\\w3wp.exe" or Parent.Path like r"%\\php-cgi.exe" or Parent.Path like r"%\\nginx.exe" or Parent.Path like r"%\\httpd.exe" or Parent.Path like r"%\\caddy.exe" or Parent.Path like r"%\\ws\_tomcatservice.exe") or ((Parent.Path like r"%\\java.exe" or Parent.Path like r"%\\javaw.exe") and (Parent.Path like r"%-tomcat-%" or Parent.Path like r"%\\tomcat%")) or ((Parent.Path like r"%\\java.exe" or Parent.Path like r"%\\javaw.exe") and (Process.CommandLine like r"%catalina.jar%" or Process.CommandLine like r"%CATALINA\_HOME%"))) and ((Process.Name in ["net.exe", "net1.exe"] and (Process.CommandLine like r"% user %" or Process.CommandLine like r"% use %" or Process.CommandLine like r"% group %")) or (Process.Name == "ping.exe" and Process.CommandLine like r"% -n %") or (Process.CommandLine like r"%&cd&echo%" or Process.CommandLine like r"%cd /d %") or (Process.Name == "wmic.exe" and Process.CommandLine like r"% /node:%") or ((Process.Path like r"%\\whoami.exe" or Process.Path like r"%\\systeminfo.exe" or Process.Path like r"%\\quser.exe" or Process.Path like r"%\\ipconfig.exe" or Process.Path like r"%\\pathping.exe" or Process.Path like r"%\\tracert.exe" or Process.Path like r"%\\netstat.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\vssadmin.exe" or Process.Path like r"%\\wevtutil.exe" or Process.Path like r"%\\tasklist.exe") or Process.Name in ["whoami.exe", "sysinfo.exe", "quser.exe", "ipconfig.exe", "pathping.exe", "tracert.exe", "netstat.exe", "schtasks.exe", "VSSADMIN.EXE", "wevtutil.exe", "tasklist.exe"]) or (Process.CommandLine like r"% Test-NetConnection %" or Process.CommandLine like r"%dir \\%")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects calls to base64 encoded WMI class such as "Win32_Shadowcopy", ""...etc.
# Author: Christian Burkard (Nextron Systems), Nasreddine Bencherchali
RuleName = PowerShell Base64 Encoded WMI Classes
EventType = Process.Start
Tag = proc-start-powershell-base64-encoded-wmi-classes
RiskScore = 75
Query = (((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") or Process.Name in ["PowerShell.EXE", "pwsh.dll"]) and ((Process.CommandLine like r"%VwBpAG4AMwAyAF8AUwBoAGEAZABvAHcAYwBvAHAAeQ%" or Process.CommandLine like r"%cAaQBuADMAMgBfAFMAaABhAGQAbwB3AGMAbwBwAHkA%" or Process.CommandLine like r"%XAGkAbgAzADIAXwBTAGgAYQBkAG8AdwBjAG8AcAB5A%" or Process.CommandLine like r"%V2luMzJfU2hhZG93Y29we%" or Process.CommandLine like r"%dpbjMyX1NoYWRvd2NvcH%" or Process.CommandLine like r"%XaW4zMl9TaGFkb3djb3B5%") or (Process.CommandLine like r"%VwBpAG4AMwAyAF8AUwBjAGgAZQBkAHUAbABlAGQASgBvAGIA%" or Process.CommandLine like r"%cAaQBuADMAMgBfAFMAYwBoAGUAZAB1AGwAZQBkAEoAbwBiA%" or Process.CommandLine like r"%XAGkAbgAzADIAXwBTAGMAaABlAGQAdQBsAGUAZABKAG8AYg%" or Process.CommandLine like r"%V2luMzJfU2NoZWR1bGVkSm9i%" or Process.CommandLine like r"%dpbjMyX1NjaGVkdWxlZEpvY%" or Process.CommandLine like r"%XaW4zMl9TY2hlZHVsZWRKb2%") or (Process.CommandLine like r"%VwBpAG4AMwAyAF8AUAByAG8AYwBlAHMAcw%" or Process.CommandLine like r"%cAaQBuADMAMgBfAFAAcgBvAGMAZQBzAHMA%" or Process.CommandLine like r"%XAGkAbgAzADIAXwBQAHIAbwBjAGUAcwBzA%" or Process.CommandLine like r"%V2luMzJfUHJvY2Vzc%" or Process.CommandLine like r"%dpbjMyX1Byb2Nlc3%" or Process.CommandLine like r"%XaW4zMl9Qcm9jZXNz%") or (Process.CommandLine like r"%VwBpAG4AMwAyAF8AVQBzAGUAcgBBAGMAYwBvAHUAbgB0A%" or Process.CommandLine like r"%cAaQBuADMAMgBfAFUAcwBlAHIAQQBjAGMAbwB1AG4AdA%" or Process.CommandLine like r"%XAGkAbgAzADIAXwBVAHMAZQByAEEAYwBjAG8AdQBuAHQA%" or Process.CommandLine like r"%V2luMzJfVXNlckFjY291bn%" or Process.CommandLine like r"%dpbjMyX1VzZXJBY2NvdW50%" or Process.CommandLine like r"%XaW4zMl9Vc2VyQWNjb3Vud%") or (Process.CommandLine like r"%VwBpAG4AMwAyAF8ATABvAGcAZwBlAGQATwBuAFUAcwBlAHIA%" or Process.CommandLine like r"%cAaQBuADMAMgBfAEwAbwBnAGcAZQBkAE8AbgBVAHMAZQByA%" or Process.CommandLine like r"%XAGkAbgAzADIAXwBMAG8AZwBnAGUAZABPAG4AVQBzAGUAcg%" or Process.CommandLine like r"%V2luMzJfTG9nZ2VkT25Vc2Vy%" or Process.CommandLine like r"%dpbjMyX0xvZ2dlZE9uVXNlc%" or Process.CommandLine like r"%XaW4zMl9Mb2dnZWRPblVzZX%")))

[ActivityMonitoringRule]
# Detects usage of "findstr" with the argument "385201". Which could indicate potential discovery of an installed Sysinternals Sysmon service using the default driver altitude (even if the name is changed).
# Author: frack113
RuleName = Sysmon Discovery Via Default Driver Altitude Using Findstr.EXE
EventType = Process.Start
Tag = proc-start-sysmon-discovery-via-default-driver-altitude-using-findstr.exe
RiskScore = 75
Query = ((Process.Path like r"%\\findstr.exe" or Process.Name == "FINDSTR.EXE") and Process.CommandLine like r"% 385201%")

[ActivityMonitoringRule]
# Detects nltest commands that can be used for information discovery
# Author: Craig Young, oscd.community, Georg Lauenstein
RuleName = Potential Recon Activity Via Nltest.EXE
EventType = Process.Start
Tag = proc-start-potential-recon-activity-via-nltest.exe
RiskScore = 75
Query = ((Process.Path like r"%\\nltest.exe" or Process.Name == "nltestrk.exe") and ((Process.CommandLine like r"%/server%" and Process.CommandLine like r"%/query%") or (Process.CommandLine like r"%/dclist:%" or Process.CommandLine like r"%/parentdomain%" or Process.CommandLine like r"%/domain\_trusts%" or Process.CommandLine like r"%/all\_trusts%" or Process.CommandLine like r"%/trusted\_domains%" or Process.CommandLine like r"%/user%")))

[ActivityMonitoringRule]
# Detection well-known mimikatz command line arguments
# Author: Teymur Kheirkhabarov, oscd.community, David ANDRE (additional keywords), Tim Shelton
RuleName = HackTool - Mimikatz Execution
EventType = Process.Start
Tag = proc-start-hacktool-mimikatz-execution
RiskScore = 75
Query = ((Process.CommandLine like r"%DumpCreds%" or Process.CommandLine like r"%mimikatz%") or (Process.CommandLine like r"%::aadcookie%" or Process.CommandLine like r"%::detours%" or Process.CommandLine like r"%::memssp%" or Process.CommandLine like r"%::mflt%" or Process.CommandLine like r"%::ncroutemon%" or Process.CommandLine like r"%::ngcsign%" or Process.CommandLine like r"%::printnightmare%" or Process.CommandLine like r"%::skeleton%" or Process.CommandLine like r"%::preshutdown%" or Process.CommandLine like r"%::mstsc%" or Process.CommandLine like r"%::multirdp%") or (Process.CommandLine like r"%rpc::%" or Process.CommandLine like r"%token::%" or Process.CommandLine like r"%crypto::%" or Process.CommandLine like r"%dpapi::%" or Process.CommandLine like r"%sekurlsa::%" or Process.CommandLine like r"%kerberos::%" or Process.CommandLine like r"%lsadump::%" or Process.CommandLine like r"%privilege::%" or Process.CommandLine like r"%process::%" or Process.CommandLine like r"%vault::%"))

[ActivityMonitoringRule]
# Detects the use of various CLI utilities exfiltrating data via web requests
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Potential Data Exfiltration Activity Via CommandLine Tools
EventType = Process.Start
Tag = proc-start-potential-data-exfiltration-activity-via-commandline-tools
RiskScore = 75
Query = ((((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\cmd.exe") and (Process.CommandLine like r"%Invoke-WebRequest%" or Process.CommandLine like r"%iwr %" or Process.CommandLine like r"%wget %" or Process.CommandLine like r"%curl %") and Process.CommandLine like r"% -ur%" and Process.CommandLine like r"% -me%" and Process.CommandLine like r"% -b%" and Process.CommandLine like r"% POST %") or (Process.Path like r"%\\curl.exe" and Process.CommandLine like r"%--ur%" and (Process.CommandLine like r"% -d %" or Process.CommandLine like r"% --data %"))) and ((Process.CommandLine like r"%ToBase64String%" or Process.CommandLine like r"%whoami%" or Process.CommandLine like r"%nltest%" or Process.CommandLine like r"%ifconfig%" or Process.CommandLine like r"%hostname%" or Process.CommandLine like r"%net view%" or Process.CommandLine like r"%qprocess%" or Process.CommandLine like r"%netstat%" or Process.CommandLine like r"%systeminfo%" or Process.CommandLine like r"%tasklist%" or Process.CommandLine like r"%sc query%") or (Process.CommandLine like r"%type %" and Process.CommandLine like r"% > %" and Process.CommandLine like r"% C:\\%")))

[ActivityMonitoringRule]
# Detects a certain command line flag combination used by mpiexec.exe LOLBIN from HPC pack that can be used to execute any other binary
# Author: Florian Roth (Nextron Systems)
RuleName = MpiExec Lolbin
EventType = Process.Start
Tag = proc-start-mpiexec-lolbin
RiskScore = 75
Query = ((Process.Path like r"%\\mpiexec.exe" or Process.Hash.IMP == "d8b52ef6aaa3a81501bdfff9dbb96217" or Process.Hashes like r"%IMPHASH=d8b52ef6aaa3a81501bdfff9dbb96217%") and (Process.CommandLine like r"% /n 1 %" or Process.CommandLine like r"% -n 1 %"))
GenericProperty1 = Process.Hash.IMP
GenericProperty2 = Process.Hashes

[ActivityMonitoringRule]
# The Devtoolslauncher.exe executes other binary
# Author: Beyu Denis, oscd.community (rule), @_felamos (idea)
RuleName = Devtoolslauncher.exe Executes Specified Binary
EventType = Process.Start
Tag = proc-start-devtoolslauncher.exe-executes-specified-binary
RiskScore = 75
Query = (Process.Path like r"%\\devtoolslauncher.exe" and Process.CommandLine like r"%LaunchForDeploy%")

[ActivityMonitoringRule]
# Detects usage of the "Set-Service" powershell cmdlet to configure a new SecurityDescriptor that allows a service to be hidden from other utilities such as "sc.exe", "Get-Service"...etc. (Works only in powershell 7)
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Abuse of Service Permissions to Hide Services Via Set-Service
EventType = Process.Start
Tag = proc-start-abuse-of-service-permissions-to-hide-services-via-set-service
RiskScore = 75
Query = ((Process.Path like r"%\\pwsh.exe" or Process.Name == "pwsh.dll") and (Process.CommandLine like r"%Set-Service %" and Process.CommandLine like r"%DCLCWPDTSD%") and (Process.CommandLine like r"%-SecurityDescriptorSddl %" or Process.CommandLine like r"%-sd %"))

[ActivityMonitoringRule]
# Detects the pattern of UAC Bypass using Event Viewer RecentViews
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = UAC Bypass Using Event Viewer RecentViews
EventType = Process.Start
Tag = proc-start-uac-bypass-using-event-viewer-recentviews
RiskScore = 75
Query = ((Process.CommandLine like r"%\\Event Viewer\\RecentViews%" or Process.CommandLine like r"%\\EventV~1\\RecentViews%") and Process.CommandLine like r"%>%")

[ActivityMonitoringRule]
# Detects a suspicious RDP session redirect using tscon.exe
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious RDP Redirect Using TSCON
EventType = Process.Start
Tag = proc-start-suspicious-rdp-redirect-using-tscon
RiskScore = 75
Query = Process.CommandLine like r"% /dest:rdp-tcp:%"

[ActivityMonitoringRule]
# Detects when an attacker tries to modify an already existing scheduled tasks to run from a suspicious location
# Attackers can create a simple looking task in order to avoid detection on creation as it's often the most focused on
# Instead they modify the task after creation to include their malicious payload
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Modification Of Scheduled Tasks
EventType = Process.Start
Tag = proc-start-suspicious-modification-of-scheduled-tasks
RiskScore = 75
Query = (Process.Path like r"%\\schtasks.exe" and Process.CommandLine like r"% /Change %" and Process.CommandLine like r"% /TN %" and (Process.CommandLine like r"%\\AppData\\Local\\Temp%" or Process.CommandLine like r"%\\AppData\\Roaming\\%" or Process.CommandLine like r"%\\Users\\Public\\%" or Process.CommandLine like r"%\\WINDOWS\\Temp\\%" or Process.CommandLine like r"%\\Desktop\\%" or Process.CommandLine like r"%\\Downloads\\%" or Process.CommandLine like r"%\\Temporary Internet%" or Process.CommandLine like r"%C:\\ProgramData\\%" or Process.CommandLine like r"%C:\\Perflogs\\%" or Process.CommandLine like r"%\%ProgramData\%%" or Process.CommandLine like r"%\%appdata\%%" or Process.CommandLine like r"%\%comspec\%%" or Process.CommandLine like r"%\%localappdata\%%") and (Process.CommandLine like r"%regsvr32%" or Process.CommandLine like r"%rundll32%" or Process.CommandLine like r"%cmd /c %" or Process.CommandLine like r"%cmd /k %" or Process.CommandLine like r"%cmd /r %" or Process.CommandLine like r"%cmd.exe /c %" or Process.CommandLine like r"%cmd.exe /k %" or Process.CommandLine like r"%cmd.exe /r %" or Process.CommandLine like r"%powershell%" or Process.CommandLine like r"%mshta%" or Process.CommandLine like r"%wscript%" or Process.CommandLine like r"%cscript%" or Process.CommandLine like r"%certutil%" or Process.CommandLine like r"%bitsadmin%" or Process.CommandLine like r"%bash.exe%" or Process.CommandLine like r"%bash %" or Process.CommandLine like r"%scrcons%" or Process.CommandLine like r"%wmic %" or Process.CommandLine like r"%wmic.exe%" or Process.CommandLine like r"%forfiles%" or Process.CommandLine like r"%scriptrunner%" or Process.CommandLine like r"%hh.exe%" or Process.CommandLine like r"%hh %"))

[ActivityMonitoringRule]
# Detects the use of stordiag.exe to execute schtasks.exe systeminfo.exe and fltmc.exe
# Author: Austin Songer (@austinsonger)
RuleName = Execution via stordiag.exe
EventType = Process.Start
Tag = proc-start-execution-via-stordiag.exe
RiskScore = 75
Query = ((Parent.Path like r"%\\stordiag.exe" and (Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\systeminfo.exe" or Process.Path like r"%\\fltmc.exe")) and not ((Parent.Path like r"c:\\windows\\system32\\%" or Parent.Path like r"c:\\windows\\syswow64\\%")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious command line patterns used when rundll32 is used to run JavaScript code
# Author: Florian Roth (Nextron Systems)
RuleName = Rundll32 JS RunHTMLApplication Pattern
EventType = Process.Start
Tag = proc-start-rundll32-js-runhtmlapplication-pattern
RiskScore = 75
Query = ((Process.CommandLine like r"%rundll32%" and Process.CommandLine like r"%javascript%" and Process.CommandLine like r"%..\\..\\mshtml,RunHTMLApplication%") or Process.CommandLine like r"%;document.write();GetObject(\"script%")

[ActivityMonitoringRule]
# Detects the execution of "whoami.exe" by privileged accounts that are often abused by threat actors
# Author: Florian Roth (Nextron Systems), Teymur Kheirkhabarov
RuleName = Suspicious Whoami.EXE Execution From Privileged Process
EventType = Process.Start
Tag = proc-start-suspicious-whoami.exe-execution-from-privileged-process
RiskScore = 75
Query = ((Process.Name == "whoami.exe" or Process.Path like r"%\\whoami.exe") and (Process.User like r"%AUTHORI%" or Process.User like r"%AUTORI%" or Process.User like r"%TrustedInstaller%"))
GenericProperty1 = Process.User

[ActivityMonitoringRule]
# Detects the execution of a renamed version of the "Mavinject" process. Which can be abused to perform process injection using the "/INJECTRUNNING" flag
# Author: frack113, Florian Roth
RuleName = Renamed Mavinject.EXE Execution
EventType = Process.Start
Tag = proc-start-renamed-mavinject.exe-execution
RiskScore = 75
Query = (Process.Name in ["mavinject32.exe", "mavinject64.exe"] and not ((Process.Path like r"%\\mavinject32.exe" or Process.Path like r"%\\mavinject64.exe")))

[ActivityMonitoringRule]
# Detects suspicious calls of DLLs in rundll32.dll exports by ordinal
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Call by Ordinal
EventType = Process.Start
Tag = proc-start-suspicious-call-by-ordinal
RiskScore = 75
Query = (((Process.Path like r"%\\rundll32.exe" or Process.Name == "RUNDLL32.EXE") and (Process.CommandLine like r"%,#%" or Process.CommandLine like r"%, #%" or Process.CommandLine like r"%.dll #%" or Process.CommandLine like r"%.ocx #%")) and not ((Process.CommandLine like r"%EDGEHTML.dll%" and Process.CommandLine like r"%#141%") or ((Parent.Path like r"%\\Msbuild\\Current\\Bin\\%" or Parent.Path like r"%\\VC\\Tools\\MSVC\\%" or Parent.Path like r"%\\Tracker.exe%") and (Process.CommandLine like r"%\\FileTracker32.dll,#1%" or Process.CommandLine like r"%\\FileTracker32.dll\",#1%" or Process.CommandLine like r"%\\FileTracker64.dll,#1%" or Process.CommandLine like r"%\\FileTracker64.dll\",#1%"))))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects a suspicious copy command to or from an Admin share or remote
# Author: Florian Roth (Nextron Systems), oscd.community, Teymur Kheirkhabarov @HeirhabarovT, Zach Stanford @svch0st, Nasreddine Bencherchali
RuleName = Copy from Admin Share
EventType = Process.Start
Tag = proc-start-copy-from-admin-share
RiskScore = 75
Query = (((Process.CommandLine like r"%\\\\\*" and Process.CommandLine like r"%$%") or Process.CommandLine like r"%\\Sysvol\\%") and ((((Process.Path like r"%\\robocopy.exe" or Process.Path like r"%\\xcopy.exe") or Process.Name in ["robocopy.exe", "XCOPY.EXE"]) or ((Process.Path like r"%\\cmd.exe" or Process.Name == "Cmd.Exe") and Process.CommandLine like r"%copy%")) or (((Process.Path like r"%\\powershell.exe%" or Process.Path like r"%\\pwsh.exe%") or Process.Name in ["PowerShell.EXE", "pwsh.dll"]) and (Process.CommandLine like r"%copy-item%" or Process.CommandLine like r"%copy %" or Process.CommandLine like r"%cpi %" or Process.CommandLine like r"% cp %" or Process.CommandLine like r"%move %" or Process.CommandLine like r"%move-item%" or Process.CommandLine like r"% mi %" or Process.CommandLine like r"% mv %"))))

[ActivityMonitoringRule]
# Detects suspicious encoded character syntax often used for defense evasion
# Author: Florian Roth (Nextron Systems)
RuleName = Potential PowerShell Obfuscation Via WCHAR
EventType = Process.Start
Tag = proc-start-potential-powershell-obfuscation-via-wchar
RiskScore = 75
Query = Process.CommandLine like r"%(WCHAR)0x%"

[ActivityMonitoringRule]
# Detects usage of bitsadmin downloading a file using an URL that contains an IP
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Download From Direct IP Via Bitsadmin
EventType = Process.Start
Tag = proc-start-suspicious-download-from-direct-ip-via-bitsadmin
RiskScore = 75
Query = (((Process.Path like r"%\\bitsadmin.exe" or Process.Name == "bitsadmin.exe") and (Process.CommandLine like r"% /transfer %" or Process.CommandLine like r"% /create %" or Process.CommandLine like r"% /addfile %") and (Process.CommandLine like r"%://1%" or Process.CommandLine like r"%://2%" or Process.CommandLine like r"%://3%" or Process.CommandLine like r"%://4%" or Process.CommandLine like r"%://5%" or Process.CommandLine like r"%://6%" or Process.CommandLine like r"%://7%" or Process.CommandLine like r"%://8%" or Process.CommandLine like r"%://9%")) and not ((Process.CommandLine like r"%://7-%")))

[ActivityMonitoringRule]
# Detect execution of suspicious double extension files in ParentCommandLine
# Author: frack113, Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Parent Double Extension File Execution
EventType = Process.Start
Tag = proc-start-suspicious-parent-double-extension-file-execution
RiskScore = 75
Query = ((Parent.Path like r"%.doc.lnk" or Parent.Path like r"%.docx.lnk" or Parent.Path like r"%.xls.lnk" or Parent.Path like r"%.xlsx.lnk" or Parent.Path like r"%.ppt.lnk" or Parent.Path like r"%.pptx.lnk" or Parent.Path like r"%.rtf.lnk" or Parent.Path like r"%.pdf.lnk" or Parent.Path like r"%.txt.lnk" or Parent.Path like r"%.doc.js" or Parent.Path like r"%.docx.js" or Parent.Path like r"%.xls.js" or Parent.Path like r"%.xlsx.js" or Parent.Path like r"%.ppt.js" or Parent.Path like r"%.pptx.js" or Parent.Path like r"%.rtf.js" or Parent.Path like r"%.pdf.js" or Parent.Path like r"%.txt.js") or (Parent.CommandLine like r"%.doc.lnk%" or Parent.CommandLine like r"%.docx.lnk%" or Parent.CommandLine like r"%.xls.lnk%" or Parent.CommandLine like r"%.xlsx.lnk%" or Parent.CommandLine like r"%.ppt.lnk%" or Parent.CommandLine like r"%.pptx.lnk%" or Parent.CommandLine like r"%.rtf.lnk%" or Parent.CommandLine like r"%.pdf.lnk%" or Parent.CommandLine like r"%.txt.lnk%" or Parent.CommandLine like r"%.doc.js%" or Parent.CommandLine like r"%.docx.js%" or Parent.CommandLine like r"%.xls.js%" or Parent.CommandLine like r"%.xlsx.js%" or Parent.CommandLine like r"%.ppt.js%" or Parent.CommandLine like r"%.pptx.js%" or Parent.CommandLine like r"%.rtf.js%" or Parent.CommandLine like r"%.pdf.js%" or Parent.CommandLine like r"%.txt.js%"))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects creation of a new service via "sc" command or the powershell "new-service" cmdlet with suspicious binary paths
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious New Service Creation
EventType = Process.Start
Tag = proc-start-suspicious-new-service-creation
RiskScore = 75
Query = (((Process.Path like r"%\\sc.exe" and Process.CommandLine like r"%create%" and Process.CommandLine like r"%binPath=%") or (Process.CommandLine like r"%New-Service%" and Process.CommandLine like r"%-BinaryPathName%")) and (Process.CommandLine like r"%powershell%" or Process.CommandLine like r"%mshta%" or Process.CommandLine like r"%wscript%" or Process.CommandLine like r"%cscript%" or Process.CommandLine like r"%svchost%" or Process.CommandLine like r"%dllhost%" or Process.CommandLine like r"%cmd %" or Process.CommandLine like r"%cmd.exe /c%" or Process.CommandLine like r"%cmd.exe /k%" or Process.CommandLine like r"%cmd.exe /r%" or Process.CommandLine like r"%rundll32%" or Process.CommandLine like r"%C:\\Users\\Public%" or Process.CommandLine like r"%\\Downloads\\%" or Process.CommandLine like r"%\\Desktop\\%" or Process.CommandLine like r"%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\%" or Process.CommandLine like r"%C:\\Windows\\TEMP\\%" or Process.CommandLine like r"%\\AppData\\Local\\Temp%"))

[ActivityMonitoringRule]
# Detects command line parameters used by ADCSPwn, a tool to escalate privileges in an active directory network by coercing authenticate from machine accounts and relaying to the certificate service
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - ADCSPwn Execution
EventType = Process.Start
Tag = proc-start-hacktool-adcspwn-execution
RiskScore = 75
Query = (Process.CommandLine like r"% --adcs %" and Process.CommandLine like r"% --port %")

[ActivityMonitoringRule]
# Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions.
# Author: @ROxPinTeddy
RuleName = Rar Usage with Password and Compression Level
EventType = Process.Start
Tag = proc-start-rar-usage-with-password-and-compression-level
RiskScore = 75
Query = (Process.CommandLine like r"% -hp%" and (Process.CommandLine like r"% -m%" or Process.CommandLine like r"% a %"))

[ActivityMonitoringRule]
# The CrachMapExec pentesting framework implements a PowerShell obfuscation with some static strings detected by this rule.
# Author: Thomas Patzke
RuleName = HackTool - CrackMapExec PowerShell Obfuscation
EventType = Process.Start
Tag = proc-start-hacktool-crackmapexec-powershell-obfuscation
RiskScore = 75
Query = (((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") or Process.Name in ["PowerShell.EXE", "pwsh.dll"]) and (Process.CommandLine like r"%join%split%" or Process.CommandLine like r"%( $ShellId[1]+$ShellId[13]+'x')%" or Process.CommandLine like r"%( $PSHome[%]+$PSHOME[%]+%" or Process.CommandLine like r"%( $env:Public[13]+$env:Public[5]+'x')%" or Process.CommandLine like r"%( $env:ComSpec[4,%,25]-Join'')%" or Process.CommandLine like r"%[1,3]+'x'-Join'')%"))

[ActivityMonitoringRule]
# Detects the use of Ngrok, a utility used for port forwarding and tunneling, often used by threat actors to make local protected services publicly available.
# Involved domains are bin.equinox.io for download and *.ngrok.io for connections.
# Author: Florian Roth (Nextron Systems)
RuleName = PUA - Ngrok Execution
EventType = Process.Start
Tag = proc-start-pua-ngrok-execution
RiskScore = 75
Query = ((Process.CommandLine like r"% tcp 139%" or Process.CommandLine like r"% tcp 445%" or Process.CommandLine like r"% tcp 3389%" or Process.CommandLine like r"% tcp 5985%" or Process.CommandLine like r"% tcp 5986%") or (Process.CommandLine like r"% start %" and Process.CommandLine like r"%--all%" and Process.CommandLine like r"%--config%" and Process.CommandLine like r"%.yml%") or (Process.Path like r"%ngrok.exe" and (Process.CommandLine like r"% tcp %" or Process.CommandLine like r"% http %" or Process.CommandLine like r"% authtoken %")) or (Process.CommandLine like r"%.exe authtoken %" or Process.CommandLine like r"%.exe start --all%"))

[ActivityMonitoringRule]
# Detects a suspicious execution from an uncommon folder
# Author: Florian Roth (Nextron Systems), Tim Shelton
RuleName = Execution from Suspicious Folder
EventType = Process.Start
Tag = proc-start-execution-from-suspicious-folder
RiskScore = 75
Query = (((Process.Path like r"%\\$Recycle.bin\\%" or Process.Path like r"%\\config\\systemprofile\\%" or Process.Path like r"%\\Intel\\Logs\\%" or Process.Path like r"%\\RSA\\MachineKeys\\%" or Process.Path like r"%\\Users\\All Users\\%" or Process.Path like r"%\\Users\\Default\\%" or Process.Path like r"%\\Users\\NetworkService\\%" or Process.Path like r"%\\Users\\Public\\%" or Process.Path like r"%\\Windows\\addins\\%" or Process.Path like r"%\\Windows\\debug\\%" or Process.Path like r"%\\Windows\\Fonts\\%" or Process.Path like r"%\\Windows\\Help\\%" or Process.Path like r"%\\Windows\\IME\\%" or Process.Path like r"%\\Windows\\Media\\%" or Process.Path like r"%\\Windows\\repair\\%" or Process.Path like r"%\\Windows\\security\\%" or Process.Path like r"%\\Windows\\System32\\Tasks\\%" or Process.Path like r"%\\Windows\\Tasks\\%") or Process.Path like r"C:\\Perflogs\\%") and not ((Process.Path like r"C:\\Users\\Public\\IBM\\ClientSolutions\\Start\_Programs\\%") or (Process.Path like r"C:\\Windows\\SysWOW64\\config\\systemprofile\\Citrix\\UpdaterBinaries\\%" and Process.Path like r"%\\CitrixReceiverUpdater.exe")))

[ActivityMonitoringRule]
# Detects a possible process memory dump that uses the white-listed Citrix TrolleyExpress.exe filename as a way to dump the lsass process memory
# Author: Florian Roth (Nextron Systems)
RuleName = Process Access via TrolleyExpress Exclusion
EventType = Process.Start
Tag = proc-start-process-access-via-trolleyexpress-exclusion
RiskScore = 75
Query = ((Process.CommandLine like r"%\\TrolleyExpress 7%" or Process.CommandLine like r"%\\TrolleyExpress 8%" or Process.CommandLine like r"%\\TrolleyExpress 9%" or Process.CommandLine like r"%\\TrolleyExpress.exe 7%" or Process.CommandLine like r"%\\TrolleyExpress.exe 8%" or Process.CommandLine like r"%\\TrolleyExpress.exe 9%" or Process.CommandLine like r"%\\TrolleyExpress.exe -ma %") or (Process.Path like r"%\\TrolleyExpress.exe" and not ((Process.Name like r"%CtxInstall%") or (Process.Name == ''))))

[ActivityMonitoringRule]
# Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code.
# Author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), Florian Roth (Nextron Systems), Sreeman, FPT.EagleEye Team
RuleName = Proxy Execution via Wuauclt
EventType = Process.Start
Tag = proc-start-proxy-execution-via-wuauclt
RiskScore = 75
Query = (((Process.Path like r"%\\wuauclt.exe" or Process.Name == "wuauclt.exe") and (Process.CommandLine like r"%UpdateDeploymentProvider%" and Process.CommandLine like r"%.dll%" and Process.CommandLine like r"%RunHandlerComServer%")) and not ((Process.CommandLine like r"% /UpdateDeploymentProvider UpdateDeploymentProvider.dll %" or Process.CommandLine like r"% wuaueng.dll %")))

[ActivityMonitoringRule]
# Detects the use of the RunXCmd tool to execute commands with System or TrustedInstaller accounts
# Author: Florian Roth (Nextron Systems)
RuleName = PUA - RunXCmd Execution
EventType = Process.Start
Tag = proc-start-pua-runxcmd-execution
RiskScore = 75
Query = ((Process.CommandLine like r"% /account=system %" or Process.CommandLine like r"% /account=ti %") and Process.CommandLine like r"%/exec=%")

[ActivityMonitoringRule]
# Detects Commandlet names from well-known PowerShell exploitation frameworks
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Malicious PowerShell Commandlets - ProcessCreation
EventType = Process.Start
Tag = proc-start-malicious-powershell-commandlets-processcreation
RiskScore = 75
Query = (Process.CommandLine like r"%Add-Exfiltration%" or Process.CommandLine like r"%Add-Persistence%" or Process.CommandLine like r"%Add-RegBackdoor%" or Process.CommandLine like r"%Add-RemoteRegBackdoor%" or Process.CommandLine like r"%Add-ScrnSaveBackdoor%" or Process.CommandLine like r"%Check-VM%" or Process.CommandLine like r"%ConvertTo-Rc4ByteStream%" or Process.CommandLine like r"%Decrypt-Hash%" or Process.CommandLine like r"%Do-Exfiltration%" or Process.CommandLine like r"%Enabled-DuplicateToken%" or Process.CommandLine like r"%Exploit-Jboss%" or Process.CommandLine like r"%Find-Fruit%" or Process.CommandLine like r"%Find-GPOLocation%" or Process.CommandLine like r"%Find-TrustedDocuments%" or Process.CommandLine like r"%Get-ApplicationHost%" or Process.CommandLine like r"%Get-ChromeDump%" or Process.CommandLine like r"%Get-ClipboardContents%" or Process.CommandLine like r"%Get-FoxDump%" or Process.CommandLine like r"%Get-GPPPassword%" or Process.CommandLine like r"%Get-IndexedItem%" or Process.CommandLine like r"%Get-Keystrokes%" or Process.CommandLine like r"%Get-LSASecret%" or Process.CommandLine like r"%Get-PassHashes%" or Process.CommandLine like r"%Get-RegAlwaysInstallElevated%" or Process.CommandLine like r"%Get-RegAutoLogon%" or Process.CommandLine like r"%Get-RemoteBootKey%" or Process.CommandLine like r"%Get-RemoteCachedCredential%" or Process.CommandLine like r"%Get-RemoteLocalAccountHash%" or Process.CommandLine like r"%Get-RemoteLSAKey%" or Process.CommandLine like r"%Get-RemoteMachineAccountHash%" or Process.CommandLine like r"%Get-RemoteNLKMKey%" or Process.CommandLine like r"%Get-RickAstley%" or Process.CommandLine like r"%Get-Screenshot%" or Process.CommandLine like r"%Get-SecurityPackages%" or Process.CommandLine like r"%Get-ServiceFilePermission%" or Process.CommandLine like r"%Get-ServicePermission%" or Process.CommandLine like r"%Get-ServiceUnquoted%" or Process.CommandLine like r"%Get-SiteListPassword%" or Process.CommandLine like r"%Get-System%" or Process.CommandLine like r"%Get-TimedScreenshot%" or Process.CommandLine like r"%Get-UnattendedInstallFile%" or Process.CommandLine like r"%Get-Unconstrained%" or Process.CommandLine like r"%Get-USBKeystrokes%" or Process.CommandLine like r"%Get-VaultCredential%" or Process.CommandLine like r"%Get-VulnAutoRun%" or Process.CommandLine like r"%Get-VulnSchTask%" or Process.CommandLine like r"%Gupt-Backdoor%" or Process.CommandLine like r"%HTTP-Login%" or Process.CommandLine like r"%Install-ServiceBinary%" or Process.CommandLine like r"%Install-SSP%" or Process.CommandLine like r"%Invoke-ACLScanner%" or Process.CommandLine like r"%Invoke-ADSBackdoor%" or Process.CommandLine like r"%Invoke-AllChecks%" or Process.CommandLine like r"%Invoke-ARPScan%" or Process.CommandLine like r"%Invoke-AzureHound%" or Process.CommandLine like r"%Invoke-BackdoorLNK%" or Process.CommandLine like r"%Invoke-BadPotato%" or Process.CommandLine like r"%Invoke-BetterSafetyKatz%" or Process.CommandLine like r"%Invoke-BypassUAC%" or Process.CommandLine like r"%Invoke-Carbuncle%" or Process.CommandLine like r"%Invoke-Certify%" or Process.CommandLine like r"%Invoke-ConPtyShell%" or Process.CommandLine like r"%Invoke-CredentialInjection%" or Process.CommandLine like r"%Invoke-DAFT%" or Process.CommandLine like r"%Invoke-DCSync%" or Process.CommandLine like r"%Invoke-DinvokeKatz%" or Process.CommandLine like r"%Invoke-DllInjection%" or Process.CommandLine like r"%Invoke-DomainPasswordSpray%" or Process.CommandLine like r"%Invoke-DowngradeAccount%" or Process.CommandLine like r"%Invoke-EgressCheck%" or Process.CommandLine like r"%Invoke-Eyewitness%" or Process.CommandLine like r"%Invoke-FakeLogonScreen%" or Process.CommandLine like r"%Invoke-Farmer%" or Process.CommandLine like r"%Invoke-Get-RBCD-Threaded%" or Process.CommandLine like r"%Invoke-Gopher%" or Process.CommandLine like r"%Invoke-Grouper%" or Process.CommandLine like r"%Invoke-HandleKatz%" or Process.CommandLine like r"%Invoke-ImpersonatedProcess%" or Process.CommandLine like r"%Invoke-ImpersonateSystem%" or Process.CommandLine like r"%Invoke-InteractiveSystemPowerShell%" or Process.CommandLine like r"%Invoke-Internalmonologue%" or Process.CommandLine like r"%Invoke-Inveigh%" or Process.CommandLine like r"%Invoke-InveighRelay%" or Process.CommandLine like r"%Invoke-KrbRelay%" or Process.CommandLine like r"%Invoke-LdapSignCheck%" or Process.CommandLine like r"%Invoke-Lockless%" or Process.CommandLine like r"%Invoke-MalSCCM%" or Process.CommandLine like r"%Invoke-Mimikatz%" or Process.CommandLine like r"%Invoke-Mimikittenz%" or Process.CommandLine like r"%Invoke-MITM6%" or Process.CommandLine like r"%Invoke-NanoDump%" or Process.CommandLine like r"%Invoke-NetRipper%" or Process.CommandLine like r"%Invoke-Nightmare%" or Process.CommandLine like r"%Invoke-NinjaCopy%" or Process.CommandLine like r"%Invoke-OfficeScrape%" or Process.CommandLine like r"%Invoke-OxidResolver%" or Process.CommandLine like r"%Invoke-P0wnedshell%" or Process.CommandLine like r"%Invoke-Paranoia%" or Process.CommandLine like r"%Invoke-PortScan%" or Process.CommandLine like r"%Invoke-PoshRatHttp%" or Process.CommandLine like r"%Invoke-PostExfil%" or Process.CommandLine like r"%Invoke-PowerDump%" or Process.CommandLine like r"%Invoke-PowerShellTCP%" or Process.CommandLine like r"%Invoke-PowerShellWMI%" or Process.CommandLine like r"%Invoke-PPLDump%" or Process.CommandLine like r"%Invoke-PsExec%" or Process.CommandLine like r"%Invoke-PSInject%" or Process.CommandLine like r"%Invoke-PsUaCme%" or Process.CommandLine like r"%Invoke-ReflectivePEInjection%" or Process.CommandLine like r"%Invoke-ReverseDNSLookup%" or Process.CommandLine like r"%Invoke-Rubeus%" or Process.CommandLine like r"%Invoke-RunAs%" or Process.CommandLine like r"%Invoke-SafetyKatz%" or Process.CommandLine like r"%Invoke-SauronEye%" or Process.CommandLine like r"%Invoke-SCShell%" or Process.CommandLine like r"%Invoke-Seatbelt%" or Process.CommandLine like r"%Invoke-ServiceAbuse%" or Process.CommandLine like r"%Invoke-ShadowSpray%" or Process.CommandLine like r"%Invoke-Sharp%" or Process.CommandLine like r"%Invoke-Shellcode%" or Process.CommandLine like r"%Invoke-SMBScanner%" or Process.CommandLine like r"%Invoke-Snaffler%" or Process.CommandLine like r"%Invoke-Spoolsample%" or Process.CommandLine like r"%Invoke-SpraySinglePassword%" or Process.CommandLine like r"%Invoke-SSHCommand%" or Process.CommandLine like r"%Invoke-StandIn%" or Process.CommandLine like r"%Invoke-StickyNotesExtract%" or Process.CommandLine like r"%Invoke-SystemCommand%" or Process.CommandLine like r"%Invoke-Tasksbackdoor%" or Process.CommandLine like r"%Invoke-Tater%" or Process.CommandLine like r"%Invoke-Thunderfox%" or Process.CommandLine like r"%Invoke-ThunderStruck%" or Process.CommandLine like r"%Invoke-TokenManipulation%" or Process.CommandLine like r"%Invoke-Tokenvator%" or Process.CommandLine like r"%Invoke-TotalExec%" or Process.CommandLine like r"%Invoke-UrbanBishop%" or Process.CommandLine like r"%Invoke-UserHunter%" or Process.CommandLine like r"%Invoke-VoiceTroll%" or Process.CommandLine like r"%Invoke-Whisker%" or Process.CommandLine like r"%Invoke-WinEnum%" or Process.CommandLine like r"%Invoke-winPEAS%" or Process.CommandLine like r"%Invoke-WireTap%" or Process.CommandLine like r"%Invoke-WmiCommand%" or Process.CommandLine like r"%Invoke-WMIExec%" or Process.CommandLine like r"%Invoke-WScriptBypassUAC%" or Process.CommandLine like r"%Invoke-Zerologon%" or Process.CommandLine like r"%MailRaider%" or Process.CommandLine like r"%New-HoneyHash%" or Process.CommandLine like r"%New-InMemoryModule%" or Process.CommandLine like r"%Out-Minidump%" or Process.CommandLine like r"%Port-Scan%" or Process.CommandLine like r"%PowerBreach%" or Process.CommandLine like r"%powercat %" or Process.CommandLine like r"%PowerUp%" or Process.CommandLine like r"%PowerView%" or Process.CommandLine like r"%Remove-Update%" or Process.CommandLine like r"%Set-MacAttribute%" or Process.CommandLine like r"%Set-Wallpaper%" or Process.CommandLine like r"%Show-TargetScreen%" or Process.CommandLine like r"%Start-CaptureServer%" or Process.CommandLine like r"%Start-WebcamRecorder%" or Process.CommandLine like r"%VolumeShadowCopyTools%")

[ActivityMonitoringRule]
# Detects suspicious process patterns used in NTDS.DIT exfiltration
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Process Patterns NTDS.DIT Exfil
EventType = Process.Start
Tag = proc-start-suspicious-process-patterns-ntds.dit-exfil
RiskScore = 75
Query = ((((Process.Path like r"%\\NTDSDump.exe" or Process.Path like r"%\\NTDSDumpEx.exe") or (Process.CommandLine like r"%ntds.dit%" and Process.CommandLine like r"%system.hiv%") or Process.CommandLine like r"%NTDSgrab.ps1%") or (Process.CommandLine like r"%ac i ntds%" and Process.CommandLine like r"%create full%") or (Process.CommandLine like r"%/c copy %" and Process.CommandLine like r"%\\windows\\ntds\\ntds.dit%") or (Process.CommandLine like r"%activate instance ntds%" and Process.CommandLine like r"%create full%") or (Process.CommandLine like r"%powershell%" and Process.CommandLine like r"%ntds.dit%")) or (Process.CommandLine like r"%ntds.dit%" and ((Parent.Path like r"%\\apache%" or Parent.Path like r"%\\tomcat%" or Parent.Path like r"%\\AppData\\%" or Parent.Path like r"%\\Temp\\%" or Parent.Path like r"%\\Public\\%" or Parent.Path like r"%\\PerfLogs\\%") or (Process.Path like r"%\\apache%" or Process.Path like r"%\\tomcat%" or Process.Path like r"%\\AppData\\%" or Process.Path like r"%\\Temp\\%" or Process.Path like r"%\\Public\\%" or Process.Path like r"%\\PerfLogs\\%"))))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects a suspicious reg.exe invocation that looks as if it would disable an important security service
# Author: Florian Roth (Nextron Systems), John Lambert (idea), elhoim
RuleName = Reg Disable Security Service
EventType = Process.Start
Tag = proc-start-reg-disable-security-service
RiskScore = 75
Query = ((Process.CommandLine like r"%reg%" and Process.CommandLine like r"%add%") and ((Process.CommandLine like r"% /d 4%" and Process.CommandLine like r"% /v Start%" and (Process.CommandLine like r"%\\Sense%" or Process.CommandLine like r"%\\WinDefend%" or Process.CommandLine like r"%\\MsMpSvc%" or Process.CommandLine like r"%\\NisSrv%" or Process.CommandLine like r"%\\WdBoot%" or Process.CommandLine like r"%\\WdNisDrv%" or Process.CommandLine like r"%\\WdNisSvc%" or Process.CommandLine like r"%\\wscsvc%" or Process.CommandLine like r"%\\SecurityHealthService%" or Process.CommandLine like r"%\\wuauserv%" or Process.CommandLine like r"%\\UsoSvc%" or Process.CommandLine like r"%\\WdFilter%" or Process.CommandLine like r"%\\AppIDSvc%")) or (Process.CommandLine like r"% /d 1%" and Process.CommandLine like r"%Windows Defender%" and (Process.CommandLine like r"%DisableIOAVProtection%" or Process.CommandLine like r"%DisableOnAccessProtection%" or Process.CommandLine like r"%DisableRoutinelyTakingAction%" or Process.CommandLine like r"%DisableScanOnRealtimeEnable%" or Process.CommandLine like r"%DisableBlockAtFirstSeen%" or Process.CommandLine like r"%DisableBehaviorMonitoring%" or Process.CommandLine like r"%DisableEnhancedNotifications%" or Process.CommandLine like r"%DisableAntiSpyware%" or Process.CommandLine like r"%DisableAntiSpywareRealtimeProtection%" or Process.CommandLine like r"%DisableConfig%" or Process.CommandLine like r"%DisablePrivacyMode%" or Process.CommandLine like r"%SignatureDisableUpdateOnStartupWithoutEngine%" or Process.CommandLine like r"%DisableArchiveScanning%" or Process.CommandLine like r"%DisableIntrusionPreventionSystem%" or Process.CommandLine like r"%DisableScriptScanning%"))))

[ActivityMonitoringRule]
# Detects Powershell as a child of the WmiPrvSE process. Which could be a signe of remote access via WMI
# Author: Markus Neis @Karneades
RuleName = WmiPrvSE Spawned PowerShell
EventType = Process.Start
Tag = proc-start-wmiprvse-spawned-powershell
RiskScore = 75
Query = ((Parent.Path like r"%\\wmiprvse.exe" and ((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") or Process.Name in ["PowerShell.EXE", "pwsh.dll"])) and not ((Process.CommandLine == "null") or (Process.CommandLine == '')))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious parent processes that should not have any children or should only have a single possible child program
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Process Parents
EventType = Process.Start
Tag = proc-start-suspicious-process-parents
RiskScore = 75
Query = ((Parent.Path like r"%\\minesweeper.exe" or Parent.Path like r"%\\winver.exe" or Parent.Path like r"%\\bitsadmin.exe") or ((Parent.Path like r"%\\csrss.exe" or Parent.Path like r"%\\certutil.exe" or Parent.Path like r"%\\eventvwr.exe" or Parent.Path like r"%\\calc.exe" or Parent.Path like r"%\\notepad.exe") and not (((Process.Path like r"%\\WerFault.exe" or Process.Path like r"%\\wermgr.exe" or Process.Path like r"%\\conhost.exe" or Process.Path like r"%\\mmc.exe" or Process.Path like r"%\\win32calc.exe" or Process.Path like r"%\\notepad.exe")) or (Process.Path == ''))))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# When configured with suitable command line arguments, w32tm can act as a delay mechanism
# Author: frack113
RuleName = Use of W32tm as Timer
EventType = Process.Start
Tag = proc-start-use-of-w32tm-as-timer
RiskScore = 75
Query = ((Process.Path like r"%\\w32tm.exe" or Process.Name == "w32time.dll") and (Process.CommandLine like r"%/stripchart%" and Process.CommandLine like r"%/computer:%" and Process.CommandLine like r"%/period:%" and Process.CommandLine like r"%/dataonly%" and Process.CommandLine like r"%/samples:%"))

[ActivityMonitoringRule]
# Detects attackers using tooling with bad opsec defaults.
# E.g. spawning a sacrificial process to inject a capability into the process without taking into account how the process is normally run.
# One trivial example of this is using rundll32.exe without arguments as a sacrificial process (default in CS, now highlighted by c2lint), running WerFault without arguments (Kraken - credit am0nsec), and other examples.
# Author: Oleg Kolesnikov @securonix invrep_de, oscd.community, Florian Roth (Nextron Systems), Christian Burkard (Nextron Systems)
RuleName = Bad Opsec Defaults Sacrificial Processes With Improper Arguments
EventType = Process.Start
Tag = proc-start-bad-opsec-defaults-sacrificial-processes-with-improper-arguments
RiskScore = 75
Query = (((Process.Path like r"%\\WerFault.exe" and Process.CommandLine like r"%WerFault.exe") or (Process.Path like r"%\\rundll32.exe" and Process.CommandLine like r"%rundll32.exe") or (Process.Path like r"%\\regsvcs.exe" and Process.CommandLine like r"%regsvcs.exe") or (Process.Path like r"%\\regasm.exe" and Process.CommandLine like r"%regasm.exe") or (Process.Path like r"%\\regsvr32.exe" and Process.CommandLine like r"%regsvr32.exe")) and not ((Parent.Path like r"C:\\Users\\%" and Parent.Path like r"%\\AppData\\Local\\Microsoft\\EdgeUpdate\\Install\\{%" and Parent.Path like r"%\\setup.exe" and Parent.CommandLine like r"%\\setup.exe\" --install-archive=\"C:\\Users\\%")))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects a Windows command line executable started from MMC
# Author: Karneades, Swisscom CSIRT
RuleName = MMC Spawning Windows Shell
EventType = Process.Start
Tag = proc-start-mmc-spawning-windows-shell
RiskScore = 75
Query = (Parent.Path like r"%\\mmc.exe" and ((Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\sh.exe" or Process.Path like r"%\\bash.exe" or Process.Path like r"%\\reg.exe" or Process.Path like r"%\\regsvr32.exe") or Process.Path like r"%\\BITSADMIN%"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious ways to use of a Visual Studio bundled tool named DumpMinitool.exe
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious DumpMinitool Usage
EventType = Process.Start
Tag = proc-start-suspicious-dumpminitool-usage
RiskScore = 75
Query = ((Process.Path like r"%\\DumpMinitool.exe" or Process.Name == "DumpMinitool.exe") and ((not ((Process.Path like r"%\\Microsoft Visual Studio\\%" or Process.Path like r"%\\Extensions\\%")) or Process.CommandLine like r"%.txt%") or (Process.CommandLine like r"% Full%" and not (Process.CommandLine like r"%--dumpType%"))))

[ActivityMonitoringRule]
# Detects a suspicious certreq execution taken from the LOLBAS examples, which can be abused to download (small) files
# Author: Christian Burkard (Nextron Systems)
RuleName = Suspicious Certreq Command to Download
EventType = Process.Start
Tag = proc-start-suspicious-certreq-command-to-download
RiskScore = 75
Query = ((Process.Path like r"%\\certreq.exe" or Process.Name == "CertReq.exe") and (Process.CommandLine like r"% -Post %" and Process.CommandLine like r"% -config %" and Process.CommandLine like r"% http%" and Process.CommandLine like r"% C:\\windows\\win.ini %"))

[ActivityMonitoringRule]
# Detects a privilege elevation attempt by coercing NTLM authentication on the Printer Spooler service
# Author: Elastic (idea), Tobias Michalski (Nextron Systems)
RuleName = Suspicious NTLM Authentication on the Printer Spooler Service
EventType = Process.Start
Tag = proc-start-suspicious-ntlm-authentication-on-the-printer-spooler-service
RiskScore = 75
Query = ((Process.Path like r"%\\rundll32.exe" or Process.Name == "RUNDLL32.EXE") and (Process.CommandLine like r"%C:\\windows\\system32\\davclnt.dll,DavSetCookie%" and Process.CommandLine like r"%http%" and (Process.CommandLine like r"%spoolss%" or Process.CommandLine like r"%srvsvc%" or Process.CommandLine like r"%/print/pipe/%")))

[ActivityMonitoringRule]
# Detects UTF-8 and UTF-16 Base64 encoded powershell 'Invoke-' calls
# Author: pH-T (Nextron Systems), Harjot Singh, '@cyb3rjy0t'
RuleName = PowerShell Base64 Encoded Invoke Keyword
EventType = Process.Start
Tag = proc-start-powershell-base64-encoded-invoke-keyword
RiskScore = 75
Query = (Process.CommandLine like r"%SQBuAHYAbwBrAGUALQ%" or Process.CommandLine like r"%kAbgB2AG8AawBlAC0A%" or Process.CommandLine like r"%JAG4AdgBvAGsAZQAtA%" or Process.CommandLine like r"%SW52b2tlL%" or Process.CommandLine like r"%ludm9rZS%" or Process.CommandLine like r"%JbnZva2Ut%")

[ActivityMonitoringRule]
# Detects execution of the AgentExecutor.exe binary. Which can be abused as a LOLBIN to execute powershell scripts with the ExecutionPolicy "Bypass" or any binary named "powershell.exe" located in the path provided by 6th positional argument
# Author: Nasreddine Bencherchali (Nextron Systems), memory-shards
RuleName = Suspicious AgentExecutor PowerShell Execution
EventType = Process.Start
Tag = proc-start-suspicious-agentexecutor-powershell-execution
RiskScore = 75
Query = (((Process.Path like r"%\\AgentExecutor.exe" or Process.Name == "AgentExecutor.exe") and (Process.CommandLine like r"% -powershell%" or Process.CommandLine like r"% -remediationScript%")) and not ((Process.CommandLine like r"%C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\%" or Process.CommandLine like r"%C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\%")))

[ActivityMonitoringRule]
# Detects a suspicious child process of Script Event Consumer (scrcons.exe).
# Author: Sittikorn S
RuleName = Script Event Consumer Spawning Process
EventType = Process.Start
Tag = proc-start-script-event-consumer-spawning-process
RiskScore = 75
Query = (Parent.Path like r"%\\scrcons.exe" and (Process.Path like r"%\\svchost.exe" or Process.Path like r"%\\dllhost.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\msiexec.exe" or Process.Path like r"%\\msbuild.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious child processes spawned by PowerShell
# Author: Florian Roth (Nextron Systems), Tim Shelton
RuleName = Suspicious PowerShell Child Processes
EventType = Process.Start
Tag = proc-start-suspicious-powershell-child-processes
RiskScore = 75
Query = (((Parent.Path like r"%\\powershell.exe" or Parent.Path like r"%\\pwsh.exe" or Parent.Path like r"%\\powershell\_ise.exe") and (Process.Path like r"%\\sh.exe" or Process.Path like r"%\\bash.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\certutil.exe" or Process.Path like r"%\\bitsadmin.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\scrcons.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\hh.exe" or Process.Path like r"%\\wmic.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\forfiles.exe" or Process.Path like r"%\\scriptrunner.exe")) and not ((Parent.CommandLine like r"%\\Program Files\\Amazon\\WorkspacesConfig\\Scripts\\%" and Process.CommandLine like r"%\\Program Files\\Amazon\\WorkspacesConfig\\Scripts\\%")))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects suspicious UTF16 and base64 encoded and often obfuscated PowerShell code often used in command lines
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Obfuscated PowerShell Code
EventType = Process.Start
Tag = proc-start-suspicious-obfuscated-powershell-code
RiskScore = 75
Query = (Process.CommandLine like r"%IAAtAGIAeABvAHIAIAAwAHgA%" or Process.CommandLine like r"%AALQBiAHgAbwByACAAMAB4A%" or Process.CommandLine like r"%gAC0AYgB4AG8AcgAgADAAeA%" or Process.CommandLine like r"%AC4ASQBuAHYAbwBrAGUAKAApACAAfAAg%" or Process.CommandLine like r"%AuAEkAbgB2AG8AawBlACgAKQAgAHwAI%" or Process.CommandLine like r"%ALgBJAG4AdgBvAGsAZQAoACkAIAB8AC%" or Process.CommandLine like r"%AHsAMQB9AHsAMAB9ACIAIAAtAGYAI%" or Process.CommandLine like r"%B7ADEAfQB7ADAAfQAiACAALQBmAC%" or Process.CommandLine like r"%AewAxAH0AewAwAH0AIgAgAC0AZgAg%" or Process.CommandLine like r"%AHsAMAB9AHsAMwB9ACIAIAAtAGYAI%" or Process.CommandLine like r"%B7ADAAfQB7ADMAfQAiACAALQBmAC%" or Process.CommandLine like r"%AewAwAH0AewAzAH0AIgAgAC0AZgAg%" or Process.CommandLine like r"%AHsAMgB9AHsAMAB9ACIAIAAtAGYAI%" or Process.CommandLine like r"%B7ADIAfQB7ADAAfQAiACAALQBmAC%" or Process.CommandLine like r"%AewAyAH0AewAwAH0AIgAgAC0AZgAg%" or Process.CommandLine like r"%AHsAMQB9AHsAMAB9ACcAIAAtAGYAI%" or Process.CommandLine like r"%B7ADEAfQB7ADAAfQAnACAALQBmAC%" or Process.CommandLine like r"%AewAxAH0AewAwAH0AJwAgAC0AZgAg%" or Process.CommandLine like r"%AHsAMAB9AHsAMwB9ACcAIAAtAGYAI%" or Process.CommandLine like r"%B7ADAAfQB7ADMAfQAnACAALQBmAC%" or Process.CommandLine like r"%AewAwAH0AewAzAH0AJwAgAC0AZgAg%" or Process.CommandLine like r"%AHsAMgB9AHsAMAB9ACcAIAAtAGYAI%" or Process.CommandLine like r"%B7ADIAfQB7ADAAfQAnACAALQBmAC%" or Process.CommandLine like r"%AewAyAH0AewAwAH0AJwAgAC0AZgAg%")

[ActivityMonitoringRule]
# Detects the malicious use of a control panel item
# Author: Kyaw Min Thein, Furkan Caliskan (@caliskanfurkan_)
RuleName = Control Panel Items
EventType = Process.Start
Tag = proc-start-control-panel-items
RiskScore = 75
Query = (((Process.Path like r"%\\reg.exe" or Process.Name == "reg.exe") and (Process.CommandLine like r"%add%" and Process.CommandLine like r"%CurrentVersion\\Control Panel\\CPLs%")) or (Process.CommandLine like r"%.cpl" and not (((Process.CommandLine like r"%\\System32\\%" or Process.CommandLine like r"%\%System\%%")) or (Process.CommandLine like r"%regsvr32 %" and Process.CommandLine like r"% /s %" and Process.CommandLine like r"%igfxCPL.cpl%"))))

[ActivityMonitoringRule]
# Detects Obfuscated use of Clip.exe to execute PowerShell
# Author: Jonathan Cheong, oscd.community
RuleName = Invoke-Obfuscation CLIP+ Launcher
EventType = Process.Start
Tag = proc-start-invoke-obfuscation-clip+-launcher
RiskScore = 75
Query = (Process.CommandLine like r"%cmd%" and Process.CommandLine like r"%&&%" and Process.CommandLine like r"%clipboard]::%" and Process.CommandLine like r"%-f%" and (Process.CommandLine like r"%/c%" or Process.CommandLine like r"%/r%"))

[ActivityMonitoringRule]
# Detects code execution via the Windows Update client (wuauclt)
# Author: FPT.EagleEye Team
RuleName = Windows Update Client LOLBIN
EventType = Process.Start
Tag = proc-start-windows-update-client-lolbin
RiskScore = 75
Query = (((Process.Path like r"%\\wuauclt.exe" or Process.Name == "wuauclt.exe") and (Process.CommandLine like r"%/UpdateDeploymentProvider%" and Process.CommandLine like r"%/RunHandlerComServer%" and Process.CommandLine like r"%.dll%")) and not ((Process.CommandLine like r"% /ClassId %" or Process.CommandLine like r"% wuaueng.dll %")))

[ActivityMonitoringRule]
# Detects Obfuscated Powershell via VAR++ LAUNCHER
# Author: Timur Zinniatullin, oscd.community
RuleName = Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION
EventType = Process.Start
Tag = proc-start-invoke-obfuscation-var++-launcher-obfuscation
RiskScore = 75
Query = (Process.CommandLine like r"%&&set%" and Process.CommandLine like r"%cmd%" and Process.CommandLine like r"%/c%" and Process.CommandLine like r"%-f%" and (Process.CommandLine like r"%{0}%" or Process.CommandLine like r"%{1}%" or Process.CommandLine like r"%{2}%" or Process.CommandLine like r"%{3}%" or Process.CommandLine like r"%{4}%" or Process.CommandLine like r"%{5}%"))

[ActivityMonitoringRule]
# Detects usage of namp/zenmap. Adversaries may attempt to get a listing of services running on remote hosts, including those that may be vulnerable to remote software exploitation
# Author: frack113
RuleName = PUA - Nmap/Zenmap Execution
EventType = Process.Start
Tag = proc-start-pua-nmap/zenmap-execution
RiskScore = 75
Query = ((Process.Path like r"%\\nmap.exe" or Process.Path like r"%\\zennmap.exe") or Process.Name in ["nmap.exe", "zennmap.exe"])

[ActivityMonitoringRule]
# Attempts to detect system changes made by Blue Mockingbird
# Author: Trent Liffick (@tliffick)
RuleName = Blue Mockingbird
EventType = Process.Start
Tag = proc-start-blue-mockingbird
RiskScore = 75
Query = ((Process.Path like r"%\\cmd.exe" and Process.CommandLine like r"%sc config%" and Process.CommandLine like r"%wercplsupporte.dll%") or (Process.Path like r"%\\wmic.exe" and Process.CommandLine like r"%COR\_PROFILER"))

[ActivityMonitoringRule]
# Detects suspicious powershell command line parameters used in Empire
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - Empire PowerShell Launch Parameters
EventType = Process.Start
Tag = proc-start-hacktool-empire-powershell-launch-parameters
RiskScore = 75
Query = (Process.CommandLine like r"% -NoP -sta -NonI -W Hidden -Enc %" or Process.CommandLine like r"% -noP -sta -w 1 -enc %" or Process.CommandLine like r"% -NoP -NonI -W Hidden -enc %" or Process.CommandLine like r"% -noP -sta -w 1 -enc%" or Process.CommandLine like r"% -enc  SQB%" or Process.CommandLine like r"% -nop -exec bypass -EncodedCommand %")

[ActivityMonitoringRule]
# Detects command line parameters used by Hydra password guessing hack tool
# Author: Vasiliy Burov
RuleName = HackTool - Hydra Password Bruteforce Execution
EventType = Process.Start
Tag = proc-start-hacktool-hydra-password-bruteforce-execution
RiskScore = 75
Query = (Process.CommandLine like r"%-u %" and Process.CommandLine like r"%-p %" and (Process.CommandLine like r"%^USER^%" or Process.CommandLine like r"%^PASS^%"))

[ActivityMonitoringRule]
# Detects suspicious ways to download files from Microsoft domains that are used to store attachments in Emails or OneNote documents
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Download from Office Domain
EventType = Process.Start
Tag = proc-start-suspicious-download-from-office-domain
RiskScore = 75
Query = (((Process.Path like r"%\\curl.exe" or Process.Path like r"%\\wget.exe") or (Process.CommandLine like r"%Invoke-WebRequest%" or Process.CommandLine like r"%iwr %" or Process.CommandLine like r"%curl %" or Process.CommandLine like r"%wget %" or Process.CommandLine like r"%Start-BitsTransfer%" or Process.CommandLine like r"%.DownloadFile(%" or Process.CommandLine like r"%.DownloadString(%")) and (Process.CommandLine like r"%https://attachment.outlook.live.net/owa/%" or Process.CommandLine like r"%https://onenoteonlinesync.onenote.com/onenoteonlinesync/%"))

[ActivityMonitoringRule]
# Detects suspicious start of rundll32.exe without any parameters as found in CobaltStrike beacon activity
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Rundll32 Without Any CommandLine Params
EventType = Process.Start
Tag = proc-start-suspicious-rundll32-without-any-commandline-params
RiskScore = 75
Query = (Process.CommandLine like r"%\\rundll32.exe" and not ((Parent.Path like r"%\\svchost.exe") or ((Parent.Path like r"%\\AppData\\Local\\%" or Parent.Path like r"%\\Microsoft\\Edge\\%"))))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects a suspicious IIS module registration as described in Microsoft threat report on IIS backdoors
# Author: Florian Roth (Nextron Systems), Microsoft (idea)
RuleName = Suspicious IIS Module Registration
EventType = Process.Start
Tag = proc-start-suspicious-iis-module-registration
RiskScore = 75
Query = (Parent.Path like r"%\\w3wp.exe" and (Process.CommandLine like r"%appcmd.exe add module%" or (Process.CommandLine like r"% system.enterpriseservices.internal.publish%" and Process.Path like r"%\\powershell.exe") or (Process.CommandLine like r"%gacutil%" and Process.CommandLine like r"% /I%")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious process patterns found in logs when CrackMapExec is used
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - CrackMapExec Process Patterns
EventType = Process.Start
Tag = proc-start-hacktool-crackmapexec-process-patterns
RiskScore = 75
Query = ((Process.CommandLine like r"%tasklist /fi %" and Process.CommandLine like r"%Imagename eq lsass.exe%" and (Process.CommandLine like r"%cmd.exe /c %" or Process.CommandLine like r"%cmd.exe /r %" or Process.CommandLine like r"%cmd.exe /k %" or Process.CommandLine like r"%cmd /c %" or Process.CommandLine like r"%cmd /r %" or Process.CommandLine like r"%cmd /k %") and (Process.User like r"%AUTHORI%" or Process.User like r"%AUTORI%")) or (Process.CommandLine like r"%do rundll32.exe C:\\windows\\System32\\comsvcs.dll, MiniDump%" and Process.CommandLine like r"%\\Windows\\Temp\\%" and Process.CommandLine like r"% full%" and Process.CommandLine like r"%\%\%B%") or (Process.CommandLine like r"%tasklist /v /fo csv%" and Process.CommandLine like r"%findstr /i \"lsass\"%"))
GenericProperty1 = Process.User

[ActivityMonitoringRule]
# Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious GUP Usage
EventType = Process.Start
Tag = proc-start-suspicious-gup-usage
RiskScore = 75
Query = (Process.Path like r"%\\GUP.exe" and not (((Process.Path like r"%\\Program Files\\Notepad++\\updater\\GUP.exe" or Process.Path like r"%\\Program Files (x86)\\Notepad++\\updater\\GUP.exe")) or (Process.Path like r"%\\Users\\%" and (Process.Path like r"%\\AppData\\Local\\Notepad++\\updater\\GUP.exe" or Process.Path like r"%\\AppData\\Roaming\\Notepad++\\updater\\GUP.exe"))))

[ActivityMonitoringRule]
# Shadow Copies storage symbolic link creation using operating systems utilities
# Author: Teymur Kheirkhabarov, oscd.community
RuleName = VolumeShadowCopy Symlink Creation Via Mklink
EventType = Process.Start
Tag = proc-start-volumeshadowcopy-symlink-creation-via-mklink
RiskScore = 75
Query = (Process.CommandLine like r"%mklink%" and Process.CommandLine like r"%HarddiskVolumeShadowCopy%")

[ActivityMonitoringRule]
# Detects KrbRelayUp used to perform a universal no-fix local privilege escalation in windows domain environments where LDAP signing is not enforced
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - KrbRelayUp Execution
EventType = Process.Start
Tag = proc-start-hacktool-krbrelayup-execution
RiskScore = 75
Query = ((Process.Path like r"%\\KrbRelayUp.exe" or Process.Name == "KrbRelayUp.exe") or (Process.CommandLine like r"% relay %" and Process.CommandLine like r"% -Domain %" and Process.CommandLine like r"% -ComputerName %") or (Process.CommandLine like r"% krbscm %" and Process.CommandLine like r"% -sc %") or (Process.CommandLine like r"% spawn %" and Process.CommandLine like r"% -d %" and Process.CommandLine like r"% -cn %" and Process.CommandLine like r"% -cp %"))

[ActivityMonitoringRule]
# Detects potential reconnaissance activity used by Trickbot malware. Trickbot enumerates domain/network topology and executes certain commands automatically every few minutes.
# Author: David Burkett, Florian Roth
RuleName = Trickbot Malware Reconnaissance Activity
EventType = Process.Start
Tag = proc-start-trickbot-malware-reconnaissance-activity
RiskScore = 75
Query = (Parent.Path like r"%\\cmd.exe" and Process.Path like r"%\\nltest.exe" and Process.CommandLine like r"%/domain\_trusts /all\_trusts%")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious LOLBIN AccCheckConsole execution with parameters as used to load an arbitrary DLL
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious LOLBIN AccCheckConsole
EventType = Process.Start
Tag = proc-start-suspicious-lolbin-acccheckconsole
RiskScore = 75
Query = ((Process.Path like r"%\\AccCheckConsole.exe" or Process.Name == "AccCheckConsole.exe") and (Process.CommandLine like r"% -window %" and Process.CommandLine like r"%.dll%"))

[ActivityMonitoringRule]
# Detects the execution of PowerShell with a specific flag sequence that is used by the Wmiexec script
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = HackTool - Wmiexec Default Powershell Command
EventType = Process.Start
Tag = proc-start-hacktool-wmiexec-default-powershell-command
RiskScore = 75
Query = Process.CommandLine like r"%-NoP -NoL -sta -NonI -W Hidden -Exec Bypass -Enc%"

[ActivityMonitoringRule]
# Detects commands that temporarily turn off Volume Snapshots
# Author: Florian Roth (Nextron Systems)
RuleName = Disabled Volume Snapshots
EventType = Process.Start
Tag = proc-start-disabled-volume-snapshots
RiskScore = 75
Query = (Process.CommandLine like r"%reg%" and Process.CommandLine like r"% add %" and Process.CommandLine like r"%\\Services\\VSS\\Diag%" and Process.CommandLine like r"%/d Disabled%")

[ActivityMonitoringRule]
# Detects suspicious manipulations of default accounts such as 'administrator' and 'guest'. For example 'enable' or 'disable' accounts or change the password...etc
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Manipulation Of Default Accounts Via Net.EXE
EventType = Process.Start
Tag = proc-start-suspicious-manipulation-of-default-accounts-via-net.exe
RiskScore = 75
Query = ((((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") or Process.Name in ["net.exe", "net1.exe"]) and Process.CommandLine like r"% user %" and (Process.CommandLine like r"% JÃ¤rjestelmÃ¤nvalvoja %" or Process.CommandLine like r"% Rendszergazda %" or Process.CommandLine like r"% ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€ %" or Process.CommandLine like r"% Administrateur %" or Process.CommandLine like r"% Administrador %" or Process.CommandLine like r"% AdministratÃ¶r %" or Process.CommandLine like r"% Administrator %" or Process.CommandLine like r"% guest %" or Process.CommandLine like r"% DefaultAccount %" or Process.CommandLine like r"% \"JÃ¤rjestelmÃ¤nvalvoja\" %" or Process.CommandLine like r"% \"Rendszergazda\" %" or Process.CommandLine like r"% \"ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€\" %" or Process.CommandLine like r"% \"Administrateur\" %" or Process.CommandLine like r"% \"Administrador\" %" or Process.CommandLine like r"% \"AdministratÃ¶r\" %" or Process.CommandLine like r"% \"Administrator\" %" or Process.CommandLine like r"% \"guest\" %" or Process.CommandLine like r"% \"DefaultAccount\" %" or Process.CommandLine like r"% 'JÃ¤rjestelmÃ¤nvalvoja' %" or Process.CommandLine like r"% 'Rendszergazda' %" or Process.CommandLine like r"% 'ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€' %" or Process.CommandLine like r"% 'Administrateur' %" or Process.CommandLine like r"% 'Administrador' %" or Process.CommandLine like r"% 'AdministratÃ¶r' %" or Process.CommandLine like r"% 'Administrator' %" or Process.CommandLine like r"% 'guest' %" or Process.CommandLine like r"% 'DefaultAccount' %")) and not (Process.CommandLine like r"%guest%" and Process.CommandLine like r"%/active no%"))

[ActivityMonitoringRule]
# Detects encoded base64 MZ header in the commandline
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Base64 MZ Header In CommandLine
EventType = Process.Start
Tag = proc-start-base64-mz-header-in-commandline
RiskScore = 75
Query = (Process.CommandLine like r"%TVqQAAMAAAAEAAAA%" or Process.CommandLine like r"%TVpQAAIAAAAEAA8A%" or Process.CommandLine like r"%TVqAAAEAAAAEABAA%" or Process.CommandLine like r"%TVoAAAAAAAAAAAAA%" or Process.CommandLine like r"%TVpTAQEAAAAEAAAA%")

[ActivityMonitoringRule]
# Detects use of chcp to look up the system locale value as part of host discovery
# Author: _pete_0, TheDFIRReport
RuleName = Console CodePage Lookup Via CHCP
EventType = Process.Start
Tag = proc-start-console-codepage-lookup-via-chcp
RiskScore = 75
Query = (Parent.Path like r"%\\cmd.exe" and (Parent.CommandLine like r"% /c %" or Parent.CommandLine like r"% /r %" or Parent.CommandLine like r"% /k %") and Process.Path like r"%\\chcp.com" and (Process.CommandLine like r"%chcp" or Process.CommandLine like r"%chcp " or Process.CommandLine like r"%chcp  "))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects execution of the SharpImpersonation tool. Which can be used to manipulate tokens on a Windows computers remotely (PsExec/WmiExec) or interactively
# Author: Sai Prashanth Pulisetti @pulisettis, Nasreddine Bencherchali (Nextron Systems)
RuleName = HackTool - SharpImpersonation Execution
EventType = Process.Start
Tag = proc-start-hacktool-sharpimpersonation-execution
RiskScore = 75
Query = (Process.Path like r"%\\SharpImpersonation.exe" or Process.Name == "SharpImpersonation.exe" or (Process.CommandLine like r"% user:%" and Process.CommandLine like r"% binary:%") or (Process.CommandLine like r"% user:%" and Process.CommandLine like r"% shellcode:%") or (Process.CommandLine like r"% technique:CreateProcessAsUserW%" or Process.CommandLine like r"% technique:ImpersonateLoggedOnuser%"))

[ActivityMonitoringRule]
# Detects suspicious process related to rundll32 based on command line that includes a *.sys file as seen being used by UNC2452
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Rundll32 Activity Invoking Sys File
EventType = Process.Start
Tag = proc-start-suspicious-rundll32-activity-invoking-sys-file
RiskScore = 75
Query = (Process.CommandLine like r"%rundll32.exe%" and (Process.CommandLine like r"%.sys,%" or Process.CommandLine like r"%.sys %"))

[ActivityMonitoringRule]
# Detects the pattern of UAC Bypass using ICMLuaUtil Elevated COM interface
# Author: Florian Roth (Nextron Systems)
RuleName = UAC Bypass via ICMLuaUtil
EventType = Process.Start
Tag = proc-start-uac-bypass-via-icmluautil
RiskScore = 75
Query = ((Parent.Path like r"%\\dllhost.exe" and (Parent.CommandLine like r"%/Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}%" or Parent.CommandLine like r"%/Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}%")) and not (Process.Path like r"%\\WerFault.exe" or Process.Name == "WerFault.exe"))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects service path modification via the "sc" binary to a suspicious command or path
# Author: Victor Sergeev, oscd.community, Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Service Path Modification
EventType = Process.Start
Tag = proc-start-suspicious-service-path-modification
RiskScore = 75
Query = (Process.Path like r"%\\sc.exe" and Process.CommandLine like r"%config%" and Process.CommandLine like r"%binPath%" and (Process.CommandLine like r"%powershell%" or Process.CommandLine like r"%cmd %" or Process.CommandLine like r"%mshta%" or Process.CommandLine like r"%wscript%" or Process.CommandLine like r"%cscript%" or Process.CommandLine like r"%rundll32%" or Process.CommandLine like r"%svchost%" or Process.CommandLine like r"%dllhost%" or Process.CommandLine like r"%cmd.exe /c%" or Process.CommandLine like r"%cmd.exe /k%" or Process.CommandLine like r"%cmd.exe /r%" or Process.CommandLine like r"%cmd /c%" or Process.CommandLine like r"%cmd /k%" or Process.CommandLine like r"%cmd /r%" or Process.CommandLine like r"%C:\\Users\\Public%" or Process.CommandLine like r"%\\Downloads\\%" or Process.CommandLine like r"%\\Desktop\\%" or Process.CommandLine like r"%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\%" or Process.CommandLine like r"%C:\\Windows\\TEMP\\%" or Process.CommandLine like r"%\\AppData\\Local\\Temp%"))

[ActivityMonitoringRule]
# Detects suspicious Splwow64.exe process without any command line parameters
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Splwow64 Without Params
EventType = Process.Start
Tag = proc-start-suspicious-splwow64-without-params
RiskScore = 75
Query = (Process.Path like r"%\\splwow64.exe" and Process.CommandLine like r"%splwow64.exe")

[ActivityMonitoringRule]
# Suspicious behaviours related to an actor tracked by Microsoft as SOURGUM
# Author: MSTIC, FPT.EagleEye
RuleName = SOURGUM Actor Behaviours
EventType = Process.Start
Tag = proc-start-sourgum-actor-behaviours
RiskScore = 75
Query = ((Process.Path like r"%windows\\system32\\Physmem.sys%" or Process.Path like r"%Windows\\system32\\ime\\SHARED\\WimBootConfigurations.ini%" or Process.Path like r"%Windows\\system32\\ime\\IMEJP\\WimBootConfigurations.ini%" or Process.Path like r"%Windows\\system32\\ime\\IMETC\\WimBootConfigurations.ini%") or ((Process.Path like r"%windows\\system32\\filepath2%" or Process.Path like r"%windows\\system32\\ime%") and Process.CommandLine like r"%reg add%" and (Process.CommandLine like r"%HKEY\_LOCAL\_MACHINE\\software\\classes\\clsid\\{7c857801-7381-11cf-884d-00aa004b2e24}\\inprocserver32%" or Process.CommandLine like r"%HKEY\_LOCAL\_MACHINE\\software\\classes\\clsid\\{cf4cc405-e2c5-4ddd-b3ce-5e7582d8c9fa}\\inprocserver32%")))

[ActivityMonitoringRule]
# Detects exploitation attempt of privilege escalation vulnerability via SetupComplete.cmd and PartnerSetupComplete.cmd described in CVE-2019-1378
# Author: Florian Roth (Nextron Systems), oscd.community, Jonhnathan Ribeiro
RuleName = Exploiting SetupComplete.cmd CVE-2019-1378
EventType = Process.Start
Tag = proc-start-exploiting-setupcomplete.cmd-cve-2019-1378
RiskScore = 75
Query = ((Parent.CommandLine like r"%\\cmd.exe%" and Parent.CommandLine like r"%/c%" and Parent.CommandLine like r"%C:\\Windows\\Setup\\Scripts\\%" and (Parent.CommandLine like r"%SetupComplete.cmd" or Parent.CommandLine like r"%PartnerSetupComplete.cmd")) and not ((Process.Path like r"C:\\Windows\\System32\\%" or Process.Path like r"C:\\Windows\\SysWOW64\\%" or Process.Path like r"C:\\Windows\\WinSxS\\%" or Process.Path like r"C:\\Windows\\Setup\\%")))
GenericProperty1 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects suspicious execution of Regasm/Regsvcs utilities
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Regasm/Regsvcs Suspicious Execution
EventType = Process.Start
Tag = proc-start-regasm/regsvcs-suspicious-execution
RiskScore = 75
Query = ((((Process.Path like r"%\\Regsvcs.exe" or Process.Path like r"%\\Regasm.exe") or Process.Name in ["RegSvcs.exe", "RegAsm.exe"]) and (Process.CommandLine like r"%\\Users\\Public\\%" or Process.CommandLine like r"%\\AppData\\Local\\Temp\\%" or Process.CommandLine like r"%\\Desktop\\%" or Process.CommandLine like r"%\\Downloads\\%" or Process.CommandLine like r"%\\PerfLogs\\%" or Process.CommandLine like r"%\\Windows\\Temp\\%" or Process.CommandLine like r"%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\%")) or (((Process.Path like r"%\\Regsvcs.exe" or Process.Path like r"%\\Regasm.exe") or Process.Name in ["RegSvcs.exe", "RegAsm.exe"]) and not ((Process.CommandLine like r"%.dll%") or ((Process.CommandLine like r"%\\Regasm.exe\"" or Process.CommandLine like r"%\\Regasm.exe" or Process.CommandLine like r"%\\Regsvcs.exe\"" or Process.CommandLine like r"%\\Regsvcs.exe")))))

[ActivityMonitoringRule]
# It is extremely abnormal for svchost.exe to spawn without any CLI arguments and is normally observed when a malicious process spawns the process and injects code into the process memory space.
# Author: David Burkett, @signalblur
RuleName = Suspect Svchost Activity
EventType = Process.Start
Tag = proc-start-suspect-svchost-activity
RiskScore = 75
Query = ((Process.CommandLine like r"%svchost.exe" and Process.Path like r"%\\svchost.exe") and not ((Parent.Path like r"%\\rpcnet.exe" or Parent.Path like r"%\\rpcnetp.exe") or Process.CommandLine == ''))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects the execution of a renamed MegaSync.exe as seen used by ransomware families like Nefilim, Sodinokibi, Pysa, and Conti.
# Author: Sittikorn S
RuleName = Renamed MegaSync Execution
EventType = Process.Start
Tag = proc-start-renamed-megasync-execution
RiskScore = 75
Query = (Process.Name == "megasync.exe" and not (Process.Path like r"%\\megasync.exe"))

[ActivityMonitoringRule]
# Detects suspicious DACL modifications to allow access to a service from a suspicious trustee. This can be used to override access restrictions set by previous ACLs.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Allow Service Access Using Security Descriptor Tampering Via Sc.EXE
EventType = Process.Start
Tag = proc-start-allow-service-access-using-security-descriptor-tampering-via-sc.exe
RiskScore = 75
Query = ((Process.Path like r"%\\sc.exe" or Process.Name == "sc.exe") and (Process.CommandLine like r"%sdset%" and Process.CommandLine like r"%A;%") and (Process.CommandLine like r"%;IU%" or Process.CommandLine like r"%;SU%" or Process.CommandLine like r"%;BA%" or Process.CommandLine like r"%;SY%" or Process.CommandLine like r"%;WD%"))

[ActivityMonitoringRule]
# Detects a suspicious child process spawning from Outlook where the image is located in a remote location (SMB/WebDav shares).
# Author: Markus Neis, Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Remote Child Process From Outlook
EventType = Process.Start
Tag = proc-start-suspicious-remote-child-process-from-outlook
RiskScore = 75
Query = (Parent.Path like r"%\\outlook.exe" and Process.Path like r"\\\\\*")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects Obfuscated Powershell via Stdin in Scripts
# Author: Nikita Nazarov, oscd.community
RuleName = Invoke-Obfuscation Via Stdin
EventType = Process.Start
Tag = proc-start-invoke-obfuscation-via-stdin
RiskScore = 75
Query = (Process.CommandLine like r"%set%" and Process.CommandLine like r"%&&%" and (Process.CommandLine like r"%environment%" or Process.CommandLine like r"%invoke%" or Process.CommandLine like r"%input%"))

[ActivityMonitoringRule]
# Detects a whoami.exe executed with the /priv command line flag instructing the tool to show all current user privileges. This is often used after a privilege escalation attempt.
# Author: Florian Roth (Nextron Systems)
RuleName = Security Privileges Enumeration Via Whoami.EXE
EventType = Process.Start
Tag = proc-start-security-privileges-enumeration-via-whoami.exe
RiskScore = 75
Query = ((Process.Path like r"%\\whoami.exe" or Process.Name == "whoami.exe") and (Process.CommandLine like r"% /priv%" or Process.CommandLine like r"% -priv%"))

[ActivityMonitoringRule]
# Detects WMIC executing "process call create" with suspicious calls to processes such as "rundll32", "regsrv32", etc.
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Process Created Via Wmic.EXE
EventType = Process.Start
Tag = proc-start-suspicious-process-created-via-wmic.exe
RiskScore = 75
Query = (Process.CommandLine like r"%process %" and Process.CommandLine like r"%call %" and Process.CommandLine like r"%create %" and (Process.CommandLine like r"%rundll32%" or Process.CommandLine like r"%bitsadmin%" or Process.CommandLine like r"%regsvr32%" or Process.CommandLine like r"%cmd.exe /c %" or Process.CommandLine like r"%cmd.exe /k %" or Process.CommandLine like r"%cmd.exe /r %" or Process.CommandLine like r"%cmd /c %" or Process.CommandLine like r"%cmd /k %" or Process.CommandLine like r"%cmd /r %" or Process.CommandLine like r"%powershell%" or Process.CommandLine like r"%pwsh%" or Process.CommandLine like r"%certutil%" or Process.CommandLine like r"%cscript%" or Process.CommandLine like r"%wscript%" or Process.CommandLine like r"%mshta%" or Process.CommandLine like r"%\\Users\\Public\\%" or Process.CommandLine like r"%\\Windows\\Temp\\%" or Process.CommandLine like r"%\\AppData\\Local\\%" or Process.CommandLine like r"%\%temp\%%" or Process.CommandLine like r"%\%tmp\%%" or Process.CommandLine like r"%\%ProgramData\%%" or Process.CommandLine like r"%\%appdata\%%" or Process.CommandLine like r"%\%comspec\%%" or Process.CommandLine like r"%\%localappdata\%%"))

[ActivityMonitoringRule]
# Detects a tscon.exe start as LOCAL SYSTEM
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious TSCON Start as SYSTEM
EventType = Process.Start
Tag = proc-start-suspicious-tscon-start-as-system
RiskScore = 75
Query = ((Process.User like r"%AUTHORI%" or Process.User like r"%AUTORI%") and Process.Path like r"%\\tscon.exe")
GenericProperty1 = Process.User

[ActivityMonitoringRule]
# Detects Cobalt Strike module/commands accidentally entered in CMD shell
# Author: _pete_0, TheDFIRReport
RuleName = Operator Bloopers Cobalt Strike Modules
EventType = Process.Start
Tag = proc-start-operator-bloopers-cobalt-strike-modules
RiskScore = 75
Query = ((Process.Name == "Cmd.Exe" or Process.Path like r"%\\cmd.exe") and (Process.CommandLine like r"%Invoke-UserHunter%" or Process.CommandLine like r"%Invoke-ShareFinder%" or Process.CommandLine like r"%Invoke-Kerberoast%" or Process.CommandLine like r"%Invoke-SMBAutoBrute%" or Process.CommandLine like r"%Invoke-Nightmare%" or Process.CommandLine like r"%zerologon%" or Process.CommandLine like r"%av\_query%"))

[ActivityMonitoringRule]
# Detects the execution of a renamed version of the Plink binary
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Renamed Plink Execution
EventType = Process.Start
Tag = proc-start-renamed-plink-execution
RiskScore = 75
Query = ((Process.Name == "Plink" or (Process.CommandLine like r"% -l forward%" and Process.CommandLine like r"% -P %" and Process.CommandLine like r"% -R %")) and not (Process.Path like r"%\\plink.exe"))

[ActivityMonitoringRule]
# Detects suspicious PowerShell download patterns that are often used in malicious scripts, stagers or downloaders (make sure that your backend applies the strings case-insensitive)
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious PowerShell Download and Execute Pattern
EventType = Process.Start
Tag = proc-start-suspicious-powershell-download-and-execute-pattern
RiskScore = 75
Query = (Process.CommandLine like r"%IEX ((New-Object Net.WebClient).DownloadString%" or Process.CommandLine like r"%IEX (New-Object Net.WebClient).DownloadString%" or Process.CommandLine like r"%IEX((New-Object Net.WebClient).DownloadString%" or Process.CommandLine like r"%IEX(New-Object Net.WebClient).DownloadString%" or Process.CommandLine like r"% -command (New-Object System.Net.WebClient).DownloadFile(%" or Process.CommandLine like r"% -c (New-Object System.Net.WebClient).DownloadFile(%")

[ActivityMonitoringRule]
# Detects the presence of the keywords "Wscript", "Shell" and "Run" in the command, which could indicate a suspicious activity
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Wscript Shell Run In CommandLine
EventType = Process.Start
Tag = proc-start-wscript-shell-run-in-commandline
RiskScore = 75
Query = (Process.CommandLine like r"%Wscript.%" and Process.CommandLine like r"%.Shell%" and Process.CommandLine like r"%.Run%")

[ActivityMonitoringRule]
# Detects the execution of the LOLBIN PrintBrm.exe, which can be used to create or extract ZIP files. PrintBrm.exe should not be run on a normal workstation.
# Author: frack113
RuleName = PrintBrm ZIP Creation of Extraction
EventType = Process.Start
Tag = proc-start-printbrm-zip-creation-of-extraction
RiskScore = 75
Query = (Process.Path like r"%\\PrintBrm.exe" and Process.CommandLine like r"% -f%" and Process.CommandLine like r"%.zip%")

[ActivityMonitoringRule]
# Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework
# Author: Ecco, oscd.community, Jonhnathan Ribeiro, Tim Rauch
RuleName = HackTool - Potential Impacket Lateral Movement Activity
EventType = Process.Start
Tag = proc-start-hacktool-potential-impacket-lateral-movement-activity
RiskScore = 75
Query = (((Parent.Path like r"%\\wmiprvse.exe" or Parent.Path like r"%\\mmc.exe" or Parent.Path like r"%\\explorer.exe" or Parent.Path like r"%\\services.exe") and Process.CommandLine like r"%cmd.exe%" and Process.CommandLine like r"%/Q%" and Process.CommandLine like r"%/c%" and Process.CommandLine like r"%\\\\127.0.0.1\\\*" and Process.CommandLine like r"%&1%") or ((Parent.CommandLine like r"%svchost.exe -k netsvcs%" or Parent.CommandLine like r"%taskeng.exe%") and Process.CommandLine like r"%cmd.exe%" and Process.CommandLine like r"%/C%" and Process.CommandLine like r"%Windows\\Temp\\%" and Process.CommandLine like r"%&1%"))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Office application called wmic to proxye execution through a LOLBIN process. This is often used to break suspicious parent-child chain (Office app spawns LOLBin).
# Author: Vadim Khrykov, Cyb3rEng
RuleName = Suspicious WMIC Execution Via Office Process
EventType = Process.Start
Tag = proc-start-suspicious-wmic-execution-via-office-process
RiskScore = 75
Query = ((Parent.Path like r"%\\WINWORD.EXE" or Parent.Path like r"%\\EXCEL.EXE" or Parent.Path like r"%\\POWERPNT.exe" or Parent.Path like r"%\\MSPUB.exe" or Parent.Path like r"%\\VISIO.exe" or Parent.Path like r"%\\MSACCESS.EXE" or Parent.Path like r"%\\EQNEDT32.EXE" or Parent.Path like r"%\\ONENOTE.EXE" or Parent.Path like r"%\\wordpad.exe" or Parent.Path like r"%\\wordview.exe") and (Process.Path like r"%\\wbem\\WMIC.exe" or Process.Name == "wmic.exe") and (Process.CommandLine like r"%process%" and Process.CommandLine like r"%create%" and Process.CommandLine like r"%call%" and (Process.CommandLine like r"%regsvr32%" or Process.CommandLine like r"%rundll32%" or Process.CommandLine like r"%msiexec%" or Process.CommandLine like r"%mshta%" or Process.CommandLine like r"%verclsid%" or Process.CommandLine like r"%wscript%" or Process.CommandLine like r"%cscript%")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects execution of the Notepad++ updater (gup) from a process other than Notepad++ to download files.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = File Download Using Notepad++ GUP Utility
EventType = Process.Start
Tag = proc-start-file-download-using-notepad++-gup-utility
RiskScore = 75
Query = (((Process.Path like r"%\\GUP.exe" or Process.Name == "gup.exe") and (Process.CommandLine like r"% -unzipTo %" and Process.CommandLine like r"%http%")) and not (Parent.Path like r"%\\notepad++.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects execution of wab.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) from non default locations as seen with bumblebee activity
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Wab Execution From Non Default Location
EventType = Process.Start
Tag = proc-start-wab-execution-from-non-default-location
RiskScore = 75
Query = ((Process.Path like r"%\\wab.exe" or Process.Path like r"%\\wabmig.exe") and not ((Process.Path like r"C:\\Windows\\WinSxS\\%" or Process.Path like r"C:\\Program Files\\Windows Mail\\%" or Process.Path like r"C:\\Program Files (x86)\\Windows Mail\\%")))

[ActivityMonitoringRule]
# Detects process injection using the signed Windows tool "Mavinject" via the "INJECTRUNNING" flag
# Author: frack113, Florian Roth
RuleName = Mavinject Inject DLL Into Running Process
EventType = Process.Start
Tag = proc-start-mavinject-inject-dll-into-running-process
RiskScore = 75
Query = (Process.CommandLine like r"% /INJECTRUNNING %" and not (Parent.Path like r"C:\\Windows\\System32\\AppVClient.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious child processes of the Microsoft OneNote application. This may indicate an attempt to execute malicious embedded objects from a .one file.
# Author: Tim Rauch (Nextron Systems), Nasreddine Bencherchali (Nextron Systems), Elastic (idea)
RuleName = Suspicious Microsoft OneNote Child Process
EventType = Process.Start
Tag = proc-start-suspicious-microsoft-onenote-child-process
RiskScore = 75
Query = ((Parent.Path like r"%\\onenote.exe" and ((Process.Name in ["bitsadmin.exe", "CertOC.exe", "CertUtil.exe", "Cmd.Exe", "CMSTP.EXE", "cscript.exe", "curl.exe", "HH.exe", "IEExec.exe", "InstallUtil.exe", "javaw.exe", "Microsoft.Workflow.Compiler.exe", "msdt.exe", "MSHTA.EXE", "msiexec.exe", "Msxsl.exe", "odbcconf.exe", "pcalua.exe", "PowerShell.EXE", "RegAsm.exe", "RegSvcs.exe", "REGSVR32.exe", "RUNDLL32.exe", "schtasks.exe", "ScriptRunner.exe", "wmic.exe", "WorkFolders.exe", "wscript.exe"] or (Process.Path like r"%\\AppVLP.exe" or Process.Path like r"%\\bash.exe" or Process.Path like r"%\\bitsadmin.exe" or Process.Path like r"%\\certoc.exe" or Process.Path like r"%\\certutil.exe" or Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\cmstp.exe" or Process.Path like r"%\\control.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\curl.exe" or Process.Path like r"%\\forfiles.exe" or Process.Path like r"%\\hh.exe" or Process.Path like r"%\\ieexec.exe" or Process.Path like r"%\\installutil.exe" or Process.Path like r"%\\javaw.exe" or Process.Path like r"%\\mftrace.exe" or Process.Path like r"%\\Microsoft.Workflow.Compiler.exe" or Process.Path like r"%\\msbuild.exe" or Process.Path like r"%\\msdt.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\msidb.exe" or Process.Path like r"%\\msiexec.exe" or Process.Path like r"%\\msxsl.exe" or Process.Path like r"%\\odbcconf.exe" or Process.Path like r"%\\pcalua.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\regasm.exe" or Process.Path like r"%\\regsvcs.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\schtasks.exe" or Process.Path like r"%\\scrcons.exe" or Process.Path like r"%\\scriptrunner.exe" or Process.Path like r"%\\sh.exe" or Process.Path like r"%\\svchost.exe" or Process.Path like r"%\\verclsid.exe" or Process.Path like r"%\\wmic.exe" or Process.Path like r"%\\workfolders.exe" or Process.Path like r"%\\wscript.exe")) or (Process.Path like r"%\\explorer.exe" and (Process.CommandLine like r"%.hta%" or Process.CommandLine like r"%.vb%" or Process.CommandLine like r"%.wsh%" or Process.CommandLine like r"%.js%" or Process.CommandLine like r"%.ps%" or Process.CommandLine like r"%.scr%" or Process.CommandLine like r"%.pif%" or Process.CommandLine like r"%.bat%" or Process.CommandLine like r"%.cmd%")) or (Process.Path like r"%\\AppData\\%" or Process.Path like r"%\\Users\\Public\\%" or Process.Path like r"%\\ProgramData\\%" or Process.Path like r"%\\Windows\\Tasks\\%" or Process.Path like r"%\\Windows\\Temp\\%" or Process.Path like r"%\\Windows\\System32\\Tasks\\%"))) and not ((Process.Path like r"%\\AppData\\Local\\Microsoft\\Teams\\current\\Teams.exe" and Process.CommandLine like r"%-Embedding") or (Process.Path like r"%\\AppData\\Local\\Microsoft\\OneDrive\\%" and Process.Path like r"%\\FileCoAuth.exe" and Process.CommandLine like r"%-Embedding")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects PowerShell command line contents that include a suspicious abnormal casing in the Net.Webclient (e.g. nEt.WEbCliEnT) string as used in obfuscation techniques
# Author: Florian Roth (Nextron Systems)
RuleName = Net WebClient Casing Anomalies
EventType = Process.Start
Tag = proc-start-net-webclient-casing-anomalies
RiskScore = 75
Query = (((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") or Process.Name in ["PowerShell.EXE", "pwsh.dll"]) and (Process.CommandLine like r"%TgBlAFQALgB3AEUAQg%" or Process.CommandLine like r"%4AZQBUAC4AdwBFAEIA%" or Process.CommandLine like r"%OAGUAVAAuAHcARQBCA%" or Process.CommandLine like r"%bgBFAHQALgB3AGUAYg%" or Process.CommandLine like r"%4ARQB0AC4AdwBlAGIA%" or Process.CommandLine like r"%uAEUAdAAuAHcAZQBiA%" or Process.CommandLine like r"%TgBFAHQALgB3AGUAYg%" or Process.CommandLine like r"%OAEUAdAAuAHcAZQBiA%" or Process.CommandLine like r"%bgBlAFQALgB3AGUAYg%" or Process.CommandLine like r"%4AZQBUAC4AdwBlAGIA%" or Process.CommandLine like r"%uAGUAVAAuAHcAZQBiA%" or Process.CommandLine like r"%TgBlAFQALgB3AGUAYg%" or Process.CommandLine like r"%OAGUAVAAuAHcAZQBiA%" or Process.CommandLine like r"%bgBFAFQALgB3AGUAYg%" or Process.CommandLine like r"%4ARQBUAC4AdwBlAGIA%" or Process.CommandLine like r"%uAEUAVAAuAHcAZQBiA%" or Process.CommandLine like r"%bgBlAHQALgBXAGUAYg%" or Process.CommandLine like r"%4AZQB0AC4AVwBlAGIA%" or Process.CommandLine like r"%uAGUAdAAuAFcAZQBiA%" or Process.CommandLine like r"%bgBFAHQALgBXAGUAYg%" or Process.CommandLine like r"%4ARQB0AC4AVwBlAGIA%" or Process.CommandLine like r"%uAEUAdAAuAFcAZQBiA%" or Process.CommandLine like r"%TgBFAHQALgBXAGUAYg%" or Process.CommandLine like r"%OAEUAdAAuAFcAZQBiA%" or Process.CommandLine like r"%bgBlAFQALgBXAGUAYg%" or Process.CommandLine like r"%4AZQBUAC4AVwBlAGIA%" or Process.CommandLine like r"%uAGUAVAAuAFcAZQBiA%" or Process.CommandLine like r"%TgBlAFQALgBXAGUAYg%" or Process.CommandLine like r"%OAGUAVAAuAFcAZQBiA%" or Process.CommandLine like r"%bgBFAFQALgBXAGUAYg%" or Process.CommandLine like r"%4ARQBUAC4AVwBlAGIA%" or Process.CommandLine like r"%uAEUAVAAuAFcAZQBiA%" or Process.CommandLine like r"%bgBlAHQALgB3AEUAYg%" or Process.CommandLine like r"%4AZQB0AC4AdwBFAGIA%" or Process.CommandLine like r"%uAGUAdAAuAHcARQBiA%" or Process.CommandLine like r"%TgBlAHQALgB3AEUAYg%" or Process.CommandLine like r"%OAGUAdAAuAHcARQBiA%" or Process.CommandLine like r"%bgBFAHQALgB3AEUAYg%" or Process.CommandLine like r"%4ARQB0AC4AdwBFAGIA%" or Process.CommandLine like r"%uAEUAdAAuAHcARQBiA%" or Process.CommandLine like r"%TgBFAHQALgB3AEUAYg%" or Process.CommandLine like r"%OAEUAdAAuAHcARQBiA%" or Process.CommandLine like r"%bgBlAFQALgB3AEUAYg%" or Process.CommandLine like r"%4AZQBUAC4AdwBFAGIA%" or Process.CommandLine like r"%uAGUAVAAuAHcARQBiA%" or Process.CommandLine like r"%TgBlAFQALgB3AEUAYg%" or Process.CommandLine like r"%OAGUAVAAuAHcARQBiA%" or Process.CommandLine like r"%bgBFAFQALgB3AEUAYg%" or Process.CommandLine like r"%4ARQBUAC4AdwBFAGIA%" or Process.CommandLine like r"%uAEUAVAAuAHcARQBiA%" or Process.CommandLine like r"%TgBFAFQALgB3AEUAYg%" or Process.CommandLine like r"%OAEUAVAAuAHcARQBiA%" or Process.CommandLine like r"%bgBlAHQALgBXAEUAYg%" or Process.CommandLine like r"%4AZQB0AC4AVwBFAGIA%" or Process.CommandLine like r"%uAGUAdAAuAFcARQBiA%" or Process.CommandLine like r"%TgBlAHQALgBXAEUAYg%" or Process.CommandLine like r"%OAGUAdAAuAFcARQBiA%" or Process.CommandLine like r"%bgBFAHQALgBXAEUAYg%" or Process.CommandLine like r"%4ARQB0AC4AVwBFAGIA%" or Process.CommandLine like r"%uAEUAdAAuAFcARQBiA%" or Process.CommandLine like r"%TgBFAHQALgBXAEUAYg%" or Process.CommandLine like r"%OAEUAdAAuAFcARQBiA%" or Process.CommandLine like r"%bgBlAFQALgBXAEUAYg%" or Process.CommandLine like r"%4AZQBUAC4AVwBFAGIA%" or Process.CommandLine like r"%uAGUAVAAuAFcARQBiA%" or Process.CommandLine like r"%TgBlAFQALgBXAEUAYg%" or Process.CommandLine like r"%OAGUAVAAuAFcARQBiA%" or Process.CommandLine like r"%bgBFAFQALgBXAEUAYg%" or Process.CommandLine like r"%4ARQBUAC4AVwBFAGIA%" or Process.CommandLine like r"%uAEUAVAAuAFcARQBiA%" or Process.CommandLine like r"%TgBFAFQALgBXAEUAYg%" or Process.CommandLine like r"%OAEUAVAAuAFcARQBiA%" or Process.CommandLine like r"%bgBlAHQALgB3AGUAQg%" or Process.CommandLine like r"%4AZQB0AC4AdwBlAEIA%" or Process.CommandLine like r"%uAGUAdAAuAHcAZQBCA%" or Process.CommandLine like r"%TgBlAHQALgB3AGUAQg%" or Process.CommandLine like r"%OAGUAdAAuAHcAZQBCA%" or Process.CommandLine like r"%bgBFAHQALgB3AGUAQg%" or Process.CommandLine like r"%4ARQB0AC4AdwBlAEIA%" or Process.CommandLine like r"%uAEUAdAAuAHcAZQBCA%" or Process.CommandLine like r"%TgBFAHQALgB3AGUAQg%" or Process.CommandLine like r"%OAEUAdAAuAHcAZQBCA%" or Process.CommandLine like r"%bgBlAFQALgB3AGUAQg%" or Process.CommandLine like r"%4AZQBUAC4AdwBlAEIA%" or Process.CommandLine like r"%uAGUAVAAuAHcAZQBCA%" or Process.CommandLine like r"%TgBlAFQALgB3AGUAQg%" or Process.CommandLine like r"%OAGUAVAAuAHcAZQBCA%" or Process.CommandLine like r"%bgBFAFQALgB3AGUAQg%" or Process.CommandLine like r"%4ARQBUAC4AdwBlAEIA%" or Process.CommandLine like r"%uAEUAVAAuAHcAZQBCA%" or Process.CommandLine like r"%TgBFAFQALgB3AGUAQg%" or Process.CommandLine like r"%OAEUAVAAuAHcAZQBCA%" or Process.CommandLine like r"%bgBlAHQALgBXAGUAQg%" or Process.CommandLine like r"%4AZQB0AC4AVwBlAEIA%" or Process.CommandLine like r"%uAGUAdAAuAFcAZQBCA%" or Process.CommandLine like r"%TgBlAHQALgBXAGUAQg%" or Process.CommandLine like r"%OAGUAdAAuAFcAZQBCA%" or Process.CommandLine like r"%bgBFAHQALgBXAGUAQg%" or Process.CommandLine like r"%4ARQB0AC4AVwBlAEIA%" or Process.CommandLine like r"%uAEUAdAAuAFcAZQBCA%" or Process.CommandLine like r"%TgBFAHQALgBXAGUAQg%" or Process.CommandLine like r"%OAEUAdAAuAFcAZQBCA%" or Process.CommandLine like r"%bgBlAFQALgBXAGUAQg%" or Process.CommandLine like r"%4AZQBUAC4AVwBlAEIA%" or Process.CommandLine like r"%uAGUAVAAuAFcAZQBCA%" or Process.CommandLine like r"%TgBlAFQALgBXAGUAQg%" or Process.CommandLine like r"%OAGUAVAAuAFcAZQBCA%" or Process.CommandLine like r"%bgBFAFQALgBXAGUAQg%" or Process.CommandLine like r"%4ARQBUAC4AVwBlAEIA%" or Process.CommandLine like r"%uAEUAVAAuAFcAZQBCA%" or Process.CommandLine like r"%TgBFAFQALgBXAGUAQg%" or Process.CommandLine like r"%OAEUAVAAuAFcAZQBCA%" or Process.CommandLine like r"%bgBlAHQALgB3AEUAQg%" or Process.CommandLine like r"%4AZQB0AC4AdwBFAEIA%" or Process.CommandLine like r"%uAGUAdAAuAHcARQBCA%" or Process.CommandLine like r"%TgBlAHQALgB3AEUAQg%" or Process.CommandLine like r"%OAGUAdAAuAHcARQBCA%" or Process.CommandLine like r"%bgBFAHQALgB3AEUAQg%" or Process.CommandLine like r"%4ARQB0AC4AdwBFAEIA%" or Process.CommandLine like r"%uAEUAdAAuAHcARQBCA%" or Process.CommandLine like r"%TgBFAHQALgB3AEUAQg%" or Process.CommandLine like r"%OAEUAdAAuAHcARQBCA%" or Process.CommandLine like r"%bgBlAFQALgB3AEUAQg%" or Process.CommandLine like r"%uAGUAVAAuAHcARQBCA%" or Process.CommandLine like r"%bgBFAFQALgB3AEUAQg%" or Process.CommandLine like r"%4ARQBUAC4AdwBFAEIA%" or Process.CommandLine like r"%uAEUAVAAuAHcARQBCA%" or Process.CommandLine like r"%TgBFAFQALgB3AEUAQg%" or Process.CommandLine like r"%OAEUAVAAuAHcARQBCA%" or Process.CommandLine like r"%TgBlAHQALgBXAEUAQg%" or Process.CommandLine like r"%4AZQB0AC4AVwBFAEIA%" or Process.CommandLine like r"%OAGUAdAAuAFcARQBCA%" or Process.CommandLine like r"%bgBFAHQALgBXAEUAQg%" or Process.CommandLine like r"%4ARQB0AC4AVwBFAEIA%" or Process.CommandLine like r"%uAEUAdAAuAFcARQBCA%" or Process.CommandLine like r"%TgBFAHQALgBXAEUAQg%" or Process.CommandLine like r"%OAEUAdAAuAFcARQBCA%" or Process.CommandLine like r"%bgBlAFQALgBXAEUAQg%" or Process.CommandLine like r"%4AZQBUAC4AVwBFAEIA%" or Process.CommandLine like r"%uAGUAVAAuAFcARQBCA%" or Process.CommandLine like r"%TgBlAFQALgBXAEUAQg%" or Process.CommandLine like r"%OAGUAVAAuAFcARQBCA%" or Process.CommandLine like r"%bgBFAFQALgBXAEUAQg%" or Process.CommandLine like r"%4ARQBUAC4AVwBFAEIA%" or Process.CommandLine like r"%uAEUAVAAuAFcARQBCA%"))

[ActivityMonitoringRule]
# Detects the execution of Xwizard tool from the non-default directory which can be used to sideload a custom xwizards.dll
# Author: Christian Burkard (Nextron Systems)
RuleName = Xwizard DLL Sideloading
EventType = Process.Start
Tag = proc-start-xwizard-dll-sideloading
RiskScore = 75
Query = (Process.Path like r"%\\xwizard.exe" and not (Process.Path like r"C:\\Windows\\System32\\%"))

[ActivityMonitoringRule]
# Detects the creation of a symbolic link between "cmd.exe" and the accessibility on-screen keyboard binary (osk.exe) using "mklink". This technique provides an elevated command prompt to the user from the login screen without the need to log in.
# Author: frack113
RuleName = Potential Privilege Escalation Using Symlink Between Osk and Cmd
EventType = Process.Start
Tag = proc-start-potential-privilege-escalation-using-symlink-between-osk-and-cmd
RiskScore = 75
Query = ((Process.Path like r"%\\cmd.exe" or Process.Name == "Cmd.Exe") and (Process.CommandLine like r"%mklink%" and Process.CommandLine like r"%\\osk.exe%" and Process.CommandLine like r"%\\cmd.exe%"))

[ActivityMonitoringRule]
# Detects uses of the createdump.exe LOLOBIN utility to dump process memory
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleName = CreateDump Process Dump
EventType = Process.Start
Tag = proc-start-createdump-process-dump
RiskScore = 75
Query = ((Process.Path like r"%\\createdump.exe" or Process.Name like r"FX\_VER\_INTERNALNAME\_STR") and (Process.CommandLine like r"% -u %" or Process.CommandLine like r"% --full %" or Process.CommandLine like r"% -f %" or Process.CommandLine like r"% --name %" or Process.CommandLine like r"%.dmp %"))

[ActivityMonitoringRule]
# Detects the execution of a signed binary dropped by Kaspersky Lab Products Remover (kavremover) which can be abused as a LOLBIN to execute arbitrary commands and binaries.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Kavremover Dropped Binary LOLBIN Usage
EventType = Process.Start
Tag = proc-start-kavremover-dropped-binary-lolbin-usage
RiskScore = 75
Query = (Process.CommandLine like r"% run run-cmd %" and not ((Parent.Path like r"%\\kavremover.exe" or Parent.Path like r"%\\cleanapi.exe")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems
# Author: frack113
RuleName = HackTool - SharpView Execution
EventType = Process.Start
Tag = proc-start-hacktool-sharpview-execution
RiskScore = 75
Query = (Process.Name == "SharpView.exe" or Process.Path like r"%\\SharpView.exe" or (Process.CommandLine like r"%Add-RemoteConnection%" or Process.CommandLine like r"%Convert-ADName%" or Process.CommandLine like r"%ConvertFrom-SID%" or Process.CommandLine like r"%ConvertFrom-UACValue%" or Process.CommandLine like r"%Convert-SidToName%" or Process.CommandLine like r"%Export-PowerViewCSV%" or Process.CommandLine like r"%Find-DomainObjectPropertyOutlier%" or Process.CommandLine like r"%Find-DomainProcess%" or Process.CommandLine like r"%Find-DomainShare%" or Process.CommandLine like r"%Find-DomainUserEvent%" or Process.CommandLine like r"%Find-DomainUserLocation%" or Process.CommandLine like r"%Find-ForeignGroup%" or Process.CommandLine like r"%Find-ForeignUser%" or Process.CommandLine like r"%Find-GPOComputerAdmin%" or Process.CommandLine like r"%Find-GPOLocation%" or Process.CommandLine like r"%Find-Interesting%" or Process.CommandLine like r"%Find-LocalAdminAccess%" or Process.CommandLine like r"%Find-ManagedSecurityGroups%" or Process.CommandLine like r"%Get-CachedRDPConnection%" or Process.CommandLine like r"%Get-DFSshare%" or Process.CommandLine like r"%Get-DomainComputer%" or Process.CommandLine like r"%Get-DomainController%" or Process.CommandLine like r"%Get-DomainDFSShare%" or Process.CommandLine like r"%Get-DomainDNSRecord%" or Process.CommandLine like r"%Get-DomainFileServer%" or Process.CommandLine like r"%Get-DomainForeign%" or Process.CommandLine like r"%Get-DomainGPO%" or Process.CommandLine like r"%Get-DomainGroup%" or Process.CommandLine like r"%Get-DomainGUIDMap%" or Process.CommandLine like r"%Get-DomainManagedSecurityGroup%" or Process.CommandLine like r"%Get-DomainObject%" or Process.CommandLine like r"%Get-DomainOU%" or Process.CommandLine like r"%Get-DomainPolicy%" or Process.CommandLine like r"%Get-DomainSID%" or Process.CommandLine like r"%Get-DomainSite%" or Process.CommandLine like r"%Get-DomainSPNTicket%" or Process.CommandLine like r"%Get-DomainSubnet%" or Process.CommandLine like r"%Get-DomainTrust%" or Process.CommandLine like r"%Get-DomainUserEvent%" or Process.CommandLine like r"%Get-ForestDomain%" or Process.CommandLine like r"%Get-ForestGlobalCatalog%" or Process.CommandLine like r"%Get-ForestTrust%" or Process.CommandLine like r"%Get-GptTmpl%" or Process.CommandLine like r"%Get-GroupsXML%" or Process.CommandLine like r"%Get-LastLoggedOn%" or Process.CommandLine like r"%Get-LoggedOnLocal%" or Process.CommandLine like r"%Get-NetComputer%" or Process.CommandLine like r"%Get-NetDomain%" or Process.CommandLine like r"%Get-NetFileServer%" or Process.CommandLine like r"%Get-NetForest%" or Process.CommandLine like r"%Get-NetGPO%" or Process.CommandLine like r"%Get-NetGroupMember%" or Process.CommandLine like r"%Get-NetLocalGroup%" or Process.CommandLine like r"%Get-NetLoggedon%" or Process.CommandLine like r"%Get-NetOU%" or Process.CommandLine like r"%Get-NetProcess%" or Process.CommandLine like r"%Get-NetRDPSession%" or Process.CommandLine like r"%Get-NetSession%" or Process.CommandLine like r"%Get-NetShare%" or Process.CommandLine like r"%Get-NetSite%" or Process.CommandLine like r"%Get-NetSubnet%" or Process.CommandLine like r"%Get-NetUser%" or Process.CommandLine like r"%Get-PathAcl%" or Process.CommandLine like r"%Get-PrincipalContext%" or Process.CommandLine like r"%Get-RegistryMountedDrive%" or Process.CommandLine like r"%Get-RegLoggedOn%" or Process.CommandLine like r"%Get-WMIRegCachedRDPConnection%" or Process.CommandLine like r"%Get-WMIRegLastLoggedOn%" or Process.CommandLine like r"%Get-WMIRegMountedDrive%" or Process.CommandLine like r"%Get-WMIRegProxy%" or Process.CommandLine like r"%Invoke-ACLScanner%" or Process.CommandLine like r"%Invoke-CheckLocalAdminAccess%" or Process.CommandLine like r"%Invoke-Kerberoast%" or Process.CommandLine like r"%Invoke-MapDomainTrust%" or Process.CommandLine like r"%Invoke-RevertToSelf%" or Process.CommandLine like r"%Invoke-Sharefinder%" or Process.CommandLine like r"%Invoke-UserImpersonation%" or Process.CommandLine like r"%Remove-DomainObjectAcl%" or Process.CommandLine like r"%Remove-RemoteConnection%" or Process.CommandLine like r"%Request-SPNTicket%" or Process.CommandLine like r"%Set-DomainObject%" or Process.CommandLine like r"%Test-AdminAccess%"))

[ActivityMonitoringRule]
# Detects execution of the binary "wpbbin" which is used as part of the UEFI based persistence method described in the reference section
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = UEFI Persistence Via Wpbbin - ProcessCreation
EventType = Process.Start
Tag = proc-start-uefi-persistence-via-wpbbin-processcreation
RiskScore = 75
Query = Process.Path like r"C:\\Windows\\System32\\wpbbin.exe"

[ActivityMonitoringRule]
# Detects suspicious powershell execution via a schedule task where the command ends with an suspicious flags to hide the powershell instance instead of executeing scripts or commands. This could be a sign of persistence via PowerShell "Get-Variable" technique as seen being used in Colibri Loader
# Author: pH-T (Nextron Systems), Florian Roth (Nextron Systems)
RuleName = Potential Persistence Via Powershell Search Order Hijacking - Task
EventType = Process.Start
Tag = proc-start-potential-persistence-via-powershell-search-order-hijacking-task
RiskScore = 75
Query = (Parent.Path like r"C:\\WINDOWS\\System32\\svchost.exe" and Parent.CommandLine like r"%-k netsvcs%" and Parent.CommandLine like r"%-s Schedule%" and (Process.CommandLine like r"% -windowstyle hidden" or Process.CommandLine like r"% -w hidden" or Process.CommandLine like r"% -ep bypass" or Process.CommandLine like r"% -noni"))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects suspicious way to dump the kernel on Windows systems using dtrace.exe, which is available on Windows systems since Windows 10 19H1
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Kernel Dump Using Dtrace
EventType = Process.Start
Tag = proc-start-suspicious-kernel-dump-using-dtrace
RiskScore = 75
Query = ((Process.Path like r"%\\dtrace.exe" and Process.CommandLine like r"%lkd(0)%") or (Process.CommandLine like r"%syscall:::return%" and Process.CommandLine like r"%lkd(%"))

[ActivityMonitoringRule]
# Detects process patterns found in Cobalt Strike beacon activity (see reference for more details) and also cases in which a China Chopper like webshell is used to run whoami
# Author: Florian Roth (Nextron Systems)
RuleName = CobaltStrike Process Patterns
EventType = Process.Start
Tag = proc-start-cobaltstrike-process-patterns
RiskScore = 75
Query = (((Process.CommandLine like r"%\\cmd.exe /C whoami%" and Parent.Path like r"C:\\Temp%") or ((Process.CommandLine like r"%cmd.exe /c echo%" or Process.CommandLine like r"%> \\\\.\\pipe%" or Process.CommandLine like r"%\\whoami.exe%") and Parent.Path like r"%\\dllhost.exe") or (Process.Path like r"%\\cmd.exe" and Parent.Path like r"%\\runonce.exe" and Parent.CommandLine like r"%\\runonce.exe")) or ((Process.CommandLine like r"%conhost.exe 0xffffffff -ForceV1%" and (Parent.CommandLine like r"%/C whoami%" or Parent.CommandLine like r"%cmd.exe /C echo%" or Parent.CommandLine like r"% > \\\\.\\pipe%")) and not ((Parent.CommandLine like r"%C:\\Program Files (x86)\\Internet Download Manager\\IDMMsgHost.exe%" or Parent.CommandLine like r"%chrome-extension://%"))))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report
# Author: Bhabesh Raj
RuleName = Pingback Backdoor Activity
EventType = Process.Start
Tag = proc-start-pingback-backdoor-activity
RiskScore = 75
Query = (Parent.Path like r"%\\updata.exe" and Process.CommandLine like r"%config%" and Process.CommandLine like r"%msdtc%" and Process.CommandLine like r"%start%" and Process.CommandLine like r"%auto%")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects suspicious command line using the "mshtml.dll" RunHTMLApplication export to run arbitrary code via different protocol handlers (vbscript, javascript, file, htpp...)
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Mshtml DLL RunHTMLApplication Abuse
EventType = Process.Start
Tag = proc-start-mshtml-dll-runhtmlapplication-abuse
RiskScore = 75
Query = (Process.CommandLine like r"%\\..\\%" and Process.CommandLine like r"%mshtml%" and Process.CommandLine like r"%RunHTMLApplication%")

[ActivityMonitoringRule]
# Detects a suspicious script executions from temporary folder
# Author: Florian Roth (Nextron Systems), Max Altgelt (Nextron Systems), Tim Shelton
RuleName = Suspicious Script Execution From Temp Folder
EventType = Process.Start
Tag = proc-start-suspicious-script-execution-from-temp-folder
RiskScore = 75
Query = (((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\cscript.exe") and (Process.CommandLine like r"%\\Windows\\Temp%" or Process.CommandLine like r"%\\Temporary Internet%" or Process.CommandLine like r"%\\AppData\\Local\\Temp%" or Process.CommandLine like r"%\\AppData\\Roaming\\Temp%" or Process.CommandLine like r"%\%TEMP\%%" or Process.CommandLine like r"%\%TMP\%%" or Process.CommandLine like r"%\%LocalAppData\%\\Temp%")) and not ((Process.CommandLine like r"% >%" or Process.CommandLine like r"%Out-File%" or Process.CommandLine like r"%ConvertTo-Json%" or Process.CommandLine like r"%-WindowStyle hidden -Verb runAs%" or Process.CommandLine like r"%\\Windows\\system32\\config\\systemprofile\\AppData\\Local\\Temp\\Amazon\\EC2-Windows\\%")))

[ActivityMonitoringRule]
# Detects base64 encoded .NET reflective loading of Assembly
# Author: Christian Burkard (Nextron Systems), pH-T (Nextron Systems)
RuleName = PowerShell Base64 Encoded Reflective Assembly Load
EventType = Process.Start
Tag = proc-start-powershell-base64-encoded-reflective-assembly-load
RiskScore = 75
Query = (Process.CommandLine like r"%WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA%" or Process.CommandLine like r"%sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA%" or Process.CommandLine like r"%bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA%" or Process.CommandLine like r"%AFsAcgBlAGYAbABlAGMAdABpAG8AbgAuAGEAcwBzAGUAbQBiAGwAeQBdADoAOgAoACIATABvAGEAZAAiAC%" or Process.CommandLine like r"%BbAHIAZQBmAGwAZQBjAHQAaQBvAG4ALgBhAHMAcwBlAG0AYgBsAHkAXQA6ADoAKAAiAEwAbwBhAGQAIgAp%" or Process.CommandLine like r"%AWwByAGUAZgBsAGUAYwB0AGkAbwBuAC4AYQBzAHMAZQBtAGIAbAB5AF0AOgA6ACgAIgBMAG8AYQBkACIAK%" or Process.CommandLine like r"%WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6ACgAIgBMAG8AYQBkACIAKQ%" or Process.CommandLine like r"%sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgAoACIATABvAGEAZAAiACkA%" or Process.CommandLine like r"%bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoAKAAiAEwAbwBhAGQAIgApA%" or Process.CommandLine like r"%WwByAGUAZgBsAGUAYwB0AGkAbwBuAC4AYQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA%" or Process.CommandLine like r"%sAcgBlAGYAbABlAGMAdABpAG8AbgAuAGEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA%" or Process.CommandLine like r"%bAHIAZQBmAGwAZQBjAHQAaQBvAG4ALgBhAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA%")

[ActivityMonitoringRule]
# Detects indirect command execution via Program Compatibility Assistant "pcwrun.exe" leveraging the follina (CVE-2022-30190) vulnerability
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Execute Pcwrun.EXE To Leverage Follina
EventType = Process.Start
Tag = proc-start-execute-pcwrun.exe-to-leverage-follina
RiskScore = 75
Query = (Process.Path like r"%\\pcwrun.exe" and Process.CommandLine like r"%../%")

[ActivityMonitoringRule]
# This rule detect common flag combinations used by CrackMapExec in order to detect its use even if the binary has been replaced.
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - CrackMapExec Execution
EventType = Process.Start
Tag = proc-start-hacktool-crackmapexec-execution
RiskScore = 75
Query = ((Process.Path like r"%\\crackmapexec.exe" or Process.CommandLine like r"% -M pe\_inject %" or (Process.CommandLine like r"% --local-auth%" and Process.CommandLine like r"% -u %" and Process.CommandLine like r"% -x %") or (Process.CommandLine like r"% --local-auth%" and Process.CommandLine like r"% -u %" and Process.CommandLine like r"% -p %" and Process.CommandLine like r"% -H 'NTHASH'%") or (Process.CommandLine like r"% mssql %" and Process.CommandLine like r"% -u %" and Process.CommandLine like r"% -p %" and Process.CommandLine like r"% -M %" and Process.CommandLine like r"% -d %") or (Process.CommandLine like r"% smb %" and Process.CommandLine like r"% -u %" and Process.CommandLine like r"% -H %" and Process.CommandLine like r"% -M %" and Process.CommandLine like r"% -o %") or (Process.CommandLine like r"% smb %" and Process.CommandLine like r"% -u %" and Process.CommandLine like r"% -p %" and Process.CommandLine like r"% --local-auth%")) or (Process.CommandLine like r"% --local-auth%" and Process.CommandLine like r"% -u %" and Process.CommandLine like r"% -p %" and Process.CommandLine like r"% 10.%" and Process.CommandLine like r"% 192.168.%" and Process.CommandLine like r"%/24 %"))

[ActivityMonitoringRule]
# Detects uses of the rdrleakdiag.exe LOLOBIN utility to dump process memory
# Author: Florian Roth (Nextron Systems)
RuleName = Process Memory Dumped Via RdrLeakDiag.EXE
EventType = Process.Start
Tag = proc-start-process-memory-dumped-via-rdrleakdiag.exe
RiskScore = 75
Query = ((Process.Path like r"%\\rdrleakdiag.exe" and Process.CommandLine like r"%/fullmemdmp%") or (Process.CommandLine like r"%/fullmemdmp%" and Process.CommandLine like r"% /o %" and Process.CommandLine like r"% /p %"))

[ActivityMonitoringRule]
# Detects REGSVR32.exe to execute DLL hosted on remote shares
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Regsvr32 Execution From Remote Share
EventType = Process.Start
Tag = proc-start-suspicious-regsvr32-execution-from-remote-share
RiskScore = 75
Query = ((Process.Path like r"%\\regsvr32.exe" or Process.Name like r"\\REGSVR32.EXE") and Process.CommandLine like r"% \\\\\*")

[ActivityMonitoringRule]
# Detects the execution of the builtin "copy" command that targets a shadow copy (sometimes used to copy registry hives that are in use)
# Author: Max Altgelt (Nextron Systems), Tobias Michalski (Nextron Systems)
RuleName = Copy From VolumeShadowCopy Via Cmd.EXE
EventType = Process.Start
Tag = proc-start-copy-from-volumeshadowcopy-via-cmd.exe
RiskScore = 75
Query = (Process.CommandLine like r"%copy %" and Process.CommandLine like r"%\\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy%")

[ActivityMonitoringRule]
# Detects suspicious parameters of fsutil (deleting USN journal, configuring it with small size, etc).
# Might be used by ransomwares during the attack (seen by NotPetya and others).
# Author: Ecco, E.M. Anhaus, oscd.community
RuleName = Fsutil Suspicious Invocation
EventType = Process.Start
Tag = proc-start-fsutil-suspicious-invocation
RiskScore = 75
Query = ((Process.Path like r"%\\fsutil.exe" or Process.Name == "fsutil.exe") and (Process.CommandLine like r"%deletejournal%" or Process.CommandLine like r"%createjournal%"))

[ActivityMonitoringRule]
# Detects specific process parameters as used by Mustang Panda droppers
# Author: Florian Roth (Nextron Systems), oscd.community
RuleName = Mustang Panda Dropper
EventType = Process.Start
Tag = proc-start-mustang-panda-dropper
RiskScore = 75
Query = ((Process.CommandLine like r"%Temp\\wtask.exe /create%" or Process.CommandLine like r"%\%windir:~-3,1\%\%PUBLIC:~-9,1\%%" or Process.CommandLine like r"%/tn \"Security Script %" or Process.CommandLine like r"%\%windir:~-1,1\%%") or (Process.CommandLine like r"%/E:vbscript%" and Process.CommandLine like r"%C:\\Users\\%" and Process.CommandLine like r"%.txt%" and Process.CommandLine like r"%/F%") or Process.Path like r"%Temp\\winwsh.exe")

[ActivityMonitoringRule]
# Detects using WorkFolders.exe to execute an arbitrary control.exe
# Author: Maxime Thiebaut (@0xThiebaut)
RuleName = Execution via WorkFolders.exe
EventType = Process.Start
Tag = proc-start-execution-via-workfolders.exe
RiskScore = 75
Query = ((Process.Path like r"%\\control.exe" and Parent.Path like r"%\\WorkFolders.exe") and not (Process.Path like r"C:\\Windows\\System32\\control.exe"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects usage of the copy builtin cmd command to copy files with the ".dmp"/".dump" extension from a remote share
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Copy .DMP/.DUMP Files From Remote Share Via Cmd.EXE
EventType = Process.Start
Tag = proc-start-copy-.dmp/.dump-files-from-remote-share-via-cmd.exe
RiskScore = 75
Query = ((Process.Path like r"%\\cmd.exe" or Process.Name == "Cmd.Exe") and (Process.CommandLine like r"%copy %" and Process.CommandLine like r"% \\\\\*" and (Process.CommandLine like r"%.dmp%" or Process.CommandLine like r"%.dump%")))

[ActivityMonitoringRule]
# Detects the execution of the tool PowerTool which has the ability to kill a process, delete its process file, unload drivers, and delete the driver files
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = HackTool - PowerTool Execution
EventType = Process.Start
Tag = proc-start-hacktool-powertool-execution
RiskScore = 75
Query = ((Process.Path like r"%\\PowerTool.exe" or Process.Path like r"%\\PowerTool64.exe") or Process.Name == "PowerTool.exe")

[ActivityMonitoringRule]
# Detects the creation of a schtask via PowerSploit or Empire Default Configuration.
# Author: Markus Neis, @Karneades
RuleName = HackTool - Default PowerSploit/Empire Scheduled Task Creation
EventType = Process.Start
Tag = proc-start-hacktool-default-powersploit/empire-scheduled-task-creation
RiskScore = 75
Query = ((Parent.Path like r"%\\powershell.exe" or Parent.Path like r"%\\pwsh.exe") and Process.Path like r"%\\schtasks.exe" and Process.CommandLine like r"%/Create%" and Process.CommandLine like r"%powershell.exe -NonI%" and Process.CommandLine like r"%/TN Updater /TR%" and (Process.CommandLine like r"%/SC ONLOGON%" or Process.CommandLine like r"%/SC DAILY /ST%" or Process.CommandLine like r"%/SC ONIDLE%" or Process.CommandLine like r"%/SC HOURLY%"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects wscript/cscript executions of scripts located in user directories
# Author: Margaritis Dimitrios (idea), Florian Roth (Nextron Systems), oscd.community
RuleName = WScript or CScript Dropper
EventType = Process.Start
Tag = proc-start-wscript-or-cscript-dropper
RiskScore = 75
Query = (((Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\cscript.exe") and (Process.CommandLine like r"%C:\\Users\\%" or Process.CommandLine like r"%C:\\ProgramData\\%") and (Process.CommandLine like r"%.jse%" or Process.CommandLine like r"%.vbe%" or Process.CommandLine like r"%.js%" or Process.CommandLine like r"%.vba%" or Process.CommandLine like r"%.vbs%")) and not (Parent.Path like r"%\\winzip%"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# This rule detects execution of PowerShell scripts located in the "C:\Users\Public" folder
# Author: Max Altgelt (Nextron Systems)
RuleName = Execution of Powershell Script in Public Folder
EventType = Process.Start
Tag = proc-start-execution-of-powershell-script-in-public-folder
RiskScore = 75
Query = ((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") and (Process.CommandLine like r"%-f C:\\Users\\Public%" or Process.CommandLine like r"%-f \"C:\\Users\\Public%" or Process.CommandLine like r"%-f \%Public\%%" or Process.CommandLine like r"%-fi C:\\Users\\Public%" or Process.CommandLine like r"%-fi \"C:\\Users\\Public%" or Process.CommandLine like r"%-fi \%Public\%%" or Process.CommandLine like r"%-fil C:\\Users\\Public%" or Process.CommandLine like r"%-fil \"C:\\Users\\Public%" or Process.CommandLine like r"%-fil \%Public\%%" or Process.CommandLine like r"%-file C:\\Users\\Public%" or Process.CommandLine like r"%-file \"C:\\Users\\Public%" or Process.CommandLine like r"%-file \%Public\%%"))

[ActivityMonitoringRule]
# Detects Obfuscated use of stdin to execute PowerShell
# Author: Jonathan Cheong, oscd.community
RuleName = Invoke-Obfuscation STDIN+ Launcher
EventType = Process.Start
Tag = proc-start-invoke-obfuscation-stdin+-launcher
RiskScore = 75
Query = ((Process.CommandLine like r"%cmd%" and Process.CommandLine like r"%powershell%" and (Process.CommandLine like r"%/c%" or Process.CommandLine like r"%/r%")) and (Process.CommandLine like r"%noexit%" or (Process.CommandLine like r"%input%" and Process.CommandLine like r"%$%")))

[ActivityMonitoringRule]
# Detects scheduled task creation events that include suspicious actions, and is run once at 00:00
# Author: pH-T (Nextron Systems)
RuleName = Uncommon One Time Only Scheduled Task At 00:00
EventType = Process.Start
Tag = proc-start-uncommon-one-time-only-scheduled-task-at-00:00
RiskScore = 75
Query = ((Process.Path like r"%\\schtasks.exe%" or Process.Name == "schtasks.exe") and (Process.CommandLine like r"%wscript%" or Process.CommandLine like r"%vbscript%" or Process.CommandLine like r"%cscript%" or Process.CommandLine like r"%wmic %" or Process.CommandLine like r"%wmic.exe%" or Process.CommandLine like r"%regsvr32.exe%" or Process.CommandLine like r"%powershell%" or Process.CommandLine like r"%\\AppData\\%") and (Process.CommandLine like r"%once%" and Process.CommandLine like r"%00:00%"))

[ActivityMonitoringRule]
# Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of "-Embedding" as a child of svchost.exe
# Author: @2xxeformyshirt (Security Risk Advisors) - rule; Teymur Kheirkhabarov (idea)
RuleName = MMC20 Lateral Movement
EventType = Process.Start
Tag = proc-start-mmc20-lateral-movement
RiskScore = 75
Query = (Parent.Path like r"%\\svchost.exe" and Process.Path like r"%\\mmc.exe" and Process.CommandLine like r"%-Embedding%")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects a suspicious svchost process start
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Svchost Process
EventType = Process.Start
Tag = proc-start-suspicious-svchost-process
RiskScore = 75
Query = (Process.Path like r"%\\svchost.exe" and not (((Parent.Path like r"%\\services.exe" or Parent.Path like r"%\\MsMpEng.exe" or Parent.Path like r"%\\Mrt.exe" or Parent.Path like r"%\\rpcnet.exe" or Parent.Path like r"%\\ngen.exe" or Parent.Path like r"%\\TiWorker.exe")) or (Parent.Path == '') or (Parent.Path == "") or (Parent.Path == "-")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects a renamed dctask64.exe used for process injection, command execution, process creation with a signed binary by ZOHO Corporation
# Author: Florian Roth (Nextron Systems)
RuleName = Renamed ZOHO Dctask64 Execution
EventType = Process.Start
Tag = proc-start-renamed-zoho-dctask64-execution
RiskScore = 75
Query = (Process.Hashes like r"%6834B1B94E49701D77CCB3C0895E1AFD%" and not (Process.Path like r"%\\dctask64.exe"))
GenericProperty1 = Process.Hashes

[ActivityMonitoringRule]
# Detects execution of javascript code using "mshta.exe".
# Author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community
RuleName = Suspicious JavaScript Execution Via Mshta.EXE
EventType = Process.Start
Tag = proc-start-suspicious-javascript-execution-via-mshta.exe
RiskScore = 75
Query = ((Process.Path like r"%\\mshta.exe" or Process.Name == "MSHTA.EXE") and Process.CommandLine like r"%javascript%")

[ActivityMonitoringRule]
# Detects process connections to a Monero crypto mining pool
# Author: Florian Roth (Nextron Systems)
RuleName = Windows Crypto Mining Pool Connections
EventType = Net.Any
Tag = windows-crypto-mining-pool-connections
RiskScore = 75
Query = Net.Target.Name in ["pool.minexmr.com", "fr.minexmr.com", "de.minexmr.com", "sg.minexmr.com", "ca.minexmr.com", "us-west.minexmr.com", "pool.supportxmr.com", "mine.c3pool.com", "xmr-eu1.nanopool.org", "xmr-eu2.nanopool.org", "xmr-us-east1.nanopool.org", "xmr-us-west1.nanopool.org", "xmr-asia1.nanopool.org", "xmr-jp1.nanopool.org", "xmr-au1.nanopool.org", "xmr.2miners.com", "xmr.hashcity.org", "xmr.f2pool.com", "xmrpool.eu", "pool.hashvault.pro", "moneroocean.stream", "monerocean.stream"]
GenericProperty1 = Net.Target.Name

[ActivityMonitoringRule]
# Detects network connections from Equation Editor
# Author: Max Altgelt (Nextron Systems)
RuleName = Equation Editor Network Connection
EventType = Net.Any
Tag = equation-editor-network-connection
RiskScore = 75
Query = Process.Path like r"%\\eqnedt32.exe"

[ActivityMonitoringRule]
# Detects network connections and DNS queries initiated by Regsvr32.exe
# Author: Dmitriy Lifanov, oscd.community
RuleName = Regsvr32 Network Activity
EventType = Net.Any
Tag = regsvr32-network-activity
RiskScore = 75
Query = Process.Path like r"%\\regsvr32.exe"

[ActivityMonitoringRule]
# Detects an executable accessing an ngrok tunneling endpoint, which could be a sign of forbidden exfiltration of data exfiltration by malicious actors
# Author: Florian Roth (Nextron Systems)
RuleName = Communication To Ngrok Tunneling Service
EventType = Net.Any
Tag = communication-to-ngrok-tunneling-service
RiskScore = 75
Query = (Net.Target.Name like r"%tunnel.us.ngrok.com%" or Net.Target.Name like r"%tunnel.eu.ngrok.com%" or Net.Target.Name like r"%tunnel.ap.ngrok.com%" or Net.Target.Name like r"%tunnel.au.ngrok.com%" or Net.Target.Name like r"%tunnel.sa.ngrok.com%" or Net.Target.Name like r"%tunnel.jp.ngrok.com%" or Net.Target.Name like r"%tunnel.in.ngrok.com%")
GenericProperty1 = Net.Target.Name

[ActivityMonitoringRule]
# Detects programs with network connections running in suspicious files system locations
# Author: Florian Roth (Nextron Systems), Tim Shelton
RuleName = Suspicious Program Location with Network Connections
EventType = Net.Any
Tag = suspicious-program-location-with-network-connections
RiskScore = 75
Query = (((Process.Path like r"%\\Users\\All Users\\%" or Process.Path like r"%\\Users\\Default\\%" or Process.Path like r"%\\Users\\Public\\%" or Process.Path like r"%\\Users\\Contacts\\%" or Process.Path like r"%\\Users\\Searches\\%" or Process.Path like r"%\\config\\systemprofile\\%" or Process.Path like r"%\\Windows\\Fonts\\%" or Process.Path like r"%\\Windows\\IME\\%" or Process.Path like r"%\\Windows\\addins\\%") or Process.Path like r"%\\$Recycle.bin" or Process.Path like r"C:\\Perflogs\\%") and not ((Process.Path like r"C:\\Users\\Public\\IBM\\ClientSolutions\\Start\_Programs\\%")))

[ActivityMonitoringRule]
# Detects suspicious network connection by Notepad
# Author: EagleEye Team
RuleName = Notepad Making Network Connection
EventType = Net.Any
Tag = notepad-making-network-connection
RiskScore = 75
Query = (Process.Path like r"%\\notepad.exe" and not (Net.Target.Port == "9100"))
GenericProperty1 = Net.Target.Port

[ActivityMonitoringRule]
# Detects UAC bypass method using Windows event viewer
# Author: Florian Roth (Nextron Systems)
RuleName = UAC Bypass via Event Viewer - Registry Set
EventType = Reg.Any
Tag = uac-bypass-via-event-viewer-registry-set
RiskScore = 75
Query = (Reg.Key.Target like r"HKCU\\%" and Reg.Key.Target like r"%\\mscfile\\shell\\open\\command")
Hive = HKLM,HKU
GenericProperty1 = Reg.Key.Target

[ActivityMonitoringRule]
# Detects registry persistence technique using the GlobalFlags and SilentProcessExit keys
# Author: Karneades, Jonhnathan Ribeiro, Florian Roth
RuleName = Potential Persistence Via GlobalFlags
EventType = Reg.Any
Tag = potential-persistence-via-globalflags
RiskScore = 75
Query = (Reg.Key.Target like r"%\\Microsoft\\Windows NT\\CurrentVersion\\%" and Reg.Key.Target like r"%\\Image File Execution Options\\%" and Reg.Key.Target like r"%\\GlobalFlag%" and Reg.Key.Target like r"%\\SilentProcessExit\\%" and (Reg.Key.Target like r"%\\ReportingMode%" or Reg.Key.Target like r"%\\MonitorProcess%"))
Hive = HKLM,HKU
GenericProperty1 = Reg.Key.Target

[ActivityMonitoringRule]
# Sysmon registry detection of a local hidden user account.
# Author: Christian Burkard (Nextron Systems)
RuleName = Creation of a Local Hidden User Account by Registry
EventType = Reg.Any
Tag = creation-of-a-local-hidden-user-account-by-registry
RiskScore = 75
Query = (Reg.Key.Target like r"%\\SAM\\SAM\\Domains\\Account\\Users\\Names\\%" and Reg.Key.Target like r"%$" and Process.Path like r"%\\lsass.exe")
Hive = HKLM,HKU
GenericProperty1 = Reg.Key.Target

[ActivityMonitoringRule]
# Detects Processes accessing the camera and microphone from suspicious folder
# Author: Den Iuzvyk
RuleName = Suspicious Camera and Microphone Access
EventType = Reg.Any
Tag = suspicious-camera-and-microphone-access
RiskScore = 75
Query = (Reg.Key.Target like r"%\\Software\\Microsoft\\Windows\\CurrentVersion\\CapabilityAccessManager\\ConsentStore\\%" and Reg.Key.Target like r"%\\NonPackaged%" and (Reg.Key.Target like r"%microphone%" or Reg.Key.Target like r"%webcam%") and (Reg.Key.Target like r"%:#Windows#Temp#%" or Reg.Key.Target like r"%:#$Recycle.bin#%" or Reg.Key.Target like r"%:#Temp#%" or Reg.Key.Target like r"%:#Users#Public#%" or Reg.Key.Target like r"%:#Users#Default#%" or Reg.Key.Target like r"%:#Users#Desktop#%"))
Hive = HKLM,HKU
GenericProperty1 = Reg.Key.Target

[ActivityMonitoringRule]
# Detects NetNTLM downgrade attack
# Author: Florian Roth (Nextron Systems), wagga
RuleName = NetNTLM Downgrade Attack - Registry
EventType = Reg.Any
Tag = netntlm-downgrade-attack-registry
RiskScore = 75
Query = (Reg.Key.Target like r"%SYSTEM\\%" and Reg.Key.Target like r"%ControlSet%" and Reg.Key.Target like r"%\\Control\\Lsa%" and (Reg.Key.Target like r"%\\lmcompatibilitylevel" or Reg.Key.Target like r"%\\NtlmMinClientSec" or Reg.Key.Target like r"%\\RestrictSendingNTLMTraffic"))
Hive = HKLM,HKU
GenericProperty1 = Reg.Key.Target

[ActivityMonitoringRule]
# Detects the volume shadow copy service initialization and processing via esentutl. Registry keys such as HKLM\\System\\CurrentControlSet\\Services\\VSS\\Diag\\VolSnap\\Volume are captured.
# Author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)
RuleName = Esentutl Volume Shadow Copy Service Keys
EventType = Reg.Any
Tag = esentutl-volume-shadow-copy-service-keys
RiskScore = 75
Query = ((Reg.Key.Target like r"%System\\CurrentControlSet\\Services\\VSS%" and Process.Path like r"%esentutl.exe") and not (Reg.Key.Target like r"%System\\CurrentControlSet\\Services\\VSS\\Start%"))
Hive = HKLM,HKU
GenericProperty1 = Reg.Key.Target

[ActivityMonitoringRule]
# Detects the suspicious RUN keys created by software located in Download or temporary Outlook/Internet Explorer directories
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Run Key from Download
EventType = Reg.Any
Tag = suspicious-run-key-from-download
RiskScore = 75
Query = ((Process.Path like r"%\\Downloads\\%" or Process.Path like r"%\\Temporary Internet Files\\Content.Outlook\\%" or Process.Path like r"%\\Local Settings\\Temporary Internet Files\\%") and Reg.Key.Target like r"%\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\%")
Hive = HKLM,HKU
GenericProperty1 = Reg.Key.Target

[ActivityMonitoringRule]
# Detects potential malicious modification of the property value of IsCredGuardEnabled from
# HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest to disable Cred Guard on a system.
# This is usually used with UseLogonCredential to manipulate the caching credentials.
# Author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)
RuleName = Wdigest CredGuard Registry Modification
EventType = Reg.Any
Tag = wdigest-credguard-registry-modification
RiskScore = 75
Query = Reg.Key.Target like r"%\\IsCredGuardEnabled"
Hive = HKLM,HKU
GenericProperty1 = Reg.Key.Target

[ActivityMonitoringRule]
# Detects potential malicious modification of run keys by winekey or team9 backdoor
# Author: omkar72
RuleName = WINEKEY Registry Modification
EventType = Reg.Any
Tag = winekey-registry-modification
RiskScore = 75
Query = Reg.Key.Target like r"%Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Backup Mgr"
Hive = HKLM,HKU
GenericProperty1 = Reg.Key.Target

[ActivityMonitoringRule]
# Detects actions caused by the RedMimicry Winnti playbook
# Author: Alexander Rausch
RuleName = RedMimicry Winnti Playbook Registry Manipulation
EventType = Reg.Any
Tag = redmimicry-winnti-playbook-registry-manipulation
RiskScore = 75
Query = Reg.Key.Target like r"%HKLM\\SOFTWARE\\Microsoft\\HTMLHelp\\data%"
Hive = HKLM,HKU
GenericProperty1 = Reg.Key.Target

[ActivityMonitoringRule]
# Unfixed method for UAC bypass from windows 10. WSReset.exe file associated with the Windows Store. It will run a binary file contained in a low-privilege registry.
# Author: oscd.community, Dmitry Uchakin
RuleName = UAC Bypass Via Wsreset
EventType = Reg.Any
Tag = uac-bypass-via-wsreset
RiskScore = 75
Query = Reg.Key.Target like r"%\\AppX82a6gwre4fdg3bt635tn5ctqjf8msdd2\\Shell\\open\\command"
Hive = HKLM,HKU
GenericProperty1 = Reg.Key.Target

[ActivityMonitoringRule]
# Detects various indicators of Microsoft Connection Manager Profile Installer execution
# Author: Nik Seetharaman
RuleName = CMSTP Execution Registry Event
EventType = Reg.Any
Tag = cmstp-execution-registry-event
RiskScore = 75
Query = Reg.Key.Target like r"%\\cmmgr32.exe%"
Hive = HKLM,HKU
GenericProperty1 = Reg.Key.Target

[ActivityMonitoringRule]
# Detects potential use of CreateRemoteThread api and LoadLibrary function to inject DLL into a process
# Author: Roberto Rodriguez @Cyb3rWard0g
RuleName = CreateRemoteThread API and LoadLibrary
EventType = Process.CreateRemoteThread
Tag = createremotethread-api-and-loadlibrary
RiskScore = 75
Query = (Thread.StartModule like r"%\\kernel32.dll" and Thread.StartFunctionName == "LoadLibraryA")
GenericProperty1 = Thread.StartModule
GenericProperty2 = Thread.StartFunctionName

[ActivityMonitoringRule]
# Detects remote thread creation in KeePass.exe indicating password dumping activity
# Author: Timon Hackenjos
RuleName = KeePass Password Dumping
EventType = Process.CreateRemoteThread
Tag = keepass-password-dumping
RiskScore = 75
Query = Process.Path like r"%\\KeePass.exe"

[ActivityMonitoringRule]
# Detects password dumper activity by monitoring remote thread creation EventID 8 in combination with the lsass.exe process as TargetImage.
# The process in field Process is the malicious program. A single execution can lead to hundreds of events.
# Author: Thomas Patzke
RuleName = Password Dumper Remote Thread in LSASS
EventType = Process.CreateRemoteThread
Tag = password-dumper-remote-thread-in-lsass
RiskScore = 75
Query = (Process.Path like r"%\\lsass.exe" and Thread.StartModule == "")
GenericProperty1 = Thread.StartModule

[ActivityMonitoringRule]
# Detects communication to C2 servers mentioned in the operational notes of the ShadowBroker leak of EquationGroup C2 tools
# Author: Florian Roth (Nextron Systems)
RuleName = Equation Group C2 Communication
EventType = Net.Any
Tag = equation-group-c2-communication
RiskScore = 75
Query = (Net.Target.Ip in ["69.42.98.86", "89.185.234.145"] or Net.Source.Ip in ["69.42.98.86", "89.185.234.145"])
GenericProperty1 = Net.Target.Ip
GenericProperty2 = Net.Source.Ip

[ActivityMonitoringRule]
# Detects the execution traces of the WizardUpdate malware. WizardUpdate is a macOS trojan that attempts to infiltrate macOS machines to steal data and it is associated with other types of malicious payloads, increasing the chances of multiple infections on a device.
# Author: Tim Rauch (rule), Elastic (idea)
RuleName = Potential WizardUpdate Malware Infection
EventType = Process.Start
Tag = proc-start-potential-wizardupdate-malware-infection
RiskScore = 75
Query = ((Process.Path like r"%/sh" and Process.CommandLine like r"%=$(curl %" and Process.CommandLine like r"%eval%") or (Process.Path like r"%/curl" and Process.CommandLine like r"%\_intermediate\_agent\_%"))

[ActivityMonitoringRule]
# Detects suspicious child processes spawning from microsoft office suite applications such as word or excel. This could indicates malicious macro execution
# Author: Sohan G (D4rkCiph3r)
RuleName = Suspicious Microsoft Office Child Process - MacOS
EventType = Process.Start
Tag = proc-start-suspicious-microsoft-office-child-process-macos
RiskScore = 75
Query = ((Parent.Path like r"%Microsoft Word%" or Parent.Path like r"%Microsoft Excel%" or Parent.Path like r"%Microsoft PowerPoint%" or Parent.Path like r"%Microsoft OneNote%") and (Process.Path like r"%/bash" or Process.Path like r"%/curl" or Process.Path like r"%/dash" or Process.Path like r"%/fish" or Process.Path like r"%/osacompile" or Process.Path like r"%/osascript" or Process.Path like r"%/sh" or Process.Path like r"%/zsh" or Process.Path like r"%/python" or Process.Path like r"%/python3" or Process.Path like r"%/wget"))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects possible malicious execution of JXA in-memory via OSAScript
# Author: Sohan G (D4rkCiph3r)
RuleName = JXA In-memory Execution Via OSAScript
EventType = Process.Start
Tag = proc-start-jxa-in-memory-execution-via-osascript
RiskScore = 75
Query = ((Process.CommandLine like r"%osascript%" and Process.CommandLine like r"% -e %" and Process.CommandLine like r"%eval%" and Process.CommandLine like r"%NSData.dataWithContentsOfURL%") and ((Process.CommandLine like r"% -l %" and Process.CommandLine like r"%JavaScript%") or Process.CommandLine like r"%.js%"))

[ActivityMonitoringRule]
# Detects potential persistence activity using LaunchAgents or LaunchDaemons via the PlistBuddy utility
# Author: Sohan G (D4rkCiph3r)
RuleName = Potential Persistence Via PlistBuddy
EventType = Process.Start
Tag = proc-start-potential-persistence-via-plistbuddy
RiskScore = 75
Query = (Process.Path like r"%/PlistBuddy" and Process.CommandLine like r"%RunAtLoad%" and Process.CommandLine like r"%true%" and (Process.CommandLine like r"%LaunchAgents%" or Process.CommandLine like r"%LaunchDaemons%"))

[ActivityMonitoringRule]
# Detecting attempts to extract passwords with grep and laZagne
# Author: Igor Fits, Mikhail Larin, oscd.community
RuleName = Credentials In Files
EventType = Process.Start
Tag = proc-start-credentials-in-files
RiskScore = 75
Query = ((Process.Path like r"%/grep" and Process.CommandLine like r"%password%") or Process.CommandLine like r"%laZagne%")

[ActivityMonitoringRule]
# Detects potential suspicious run-only executions compiled using OSACompile
# Author: Sohan G (D4rkCiph3r)
RuleName = OSACompile Run-Only Execution
EventType = Process.Start
Tag = proc-start-osacompile-run-only-execution
RiskScore = 75
Query = (Process.CommandLine like r"%osacompile%" and Process.CommandLine like r"% -x %" and Process.CommandLine like r"% -e %")

[ActivityMonitoringRule]
# Detects possible collection of data from the clipboard via execution of the osascript binary
# Author: Sohan G (D4rkCiph3r)
RuleName = Clipboard Data Collection Via OSAScript
EventType = Process.Start
Tag = proc-start-clipboard-data-collection-via-osascript
RiskScore = 75
Query = (Process.CommandLine like r"%osascript%" and Process.CommandLine like r"% -e %" and Process.CommandLine like r"%clipboard%")

[ActivityMonitoringRule]
# Adversaries may use binary padding to add junk data and change the on-disk representation of malware. This rule detect using dd and truncate to add a junk data to file.
# Author: Igor Fits, Mikhail Larin, oscd.community
RuleName = Binary Padding - MacOS
EventType = Process.Start
Tag = proc-start-binary-padding-macos
RiskScore = 75
Query = ((Process.Path like r"%/truncate" and Process.CommandLine like r"%-s +%") or (Process.Path like r"%/dd" and (Process.CommandLine like r"%if=/dev/zero%" or Process.CommandLine like r"%if=/dev/random%" or Process.CommandLine like r"%if=/dev/urandom%")))

