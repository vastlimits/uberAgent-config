
#
# The rules are generated from the Sigma GitHub repository at https://github.com/SigmaHQ/sigma
# To generate the ruleset, please follow the instructions provided in the repository: https://github.com/vastlimits/pySigma-backend-uberAgent/
#
# The command used to generate the ruleset is:
#    sigma convert -s -f conf -p uberagent-7.1.0 -t uberagent /home/runner/work/uberAgent-config/uberAgent-config/build/sigma-low-windows >> uberAgent-ESA-am-sigma-low-windows.conf
#

[ActivityMonitoringRule platform=Windows]
# Detects usage of the "dir" command that is part of Windows batch/cmd to collect information about directories
# Author: frack113
RuleId = 7c9340a9-e2ee-4e43-94c5-c54ebbea1006
RuleName = Files And Subdirectories Listing Using Dir
EventType = Process.Start
Tag = proc-start-files-and-subdirectories-listing-using-dir
RiskScore = 25
Annotation = {"mitre_attack": ["T1217"]}
Query = Process.CommandLine like "%dir %" and Process.CommandLine like "% /s%" and Process.CommandLine like "% /b%"


[ActivityMonitoringRule platform=Windows]
# Detects loading of Amsi.dll by uncommon processes
# Author: frack113
RuleId = facd1549-e416-48e0-b8c4-41d7215eedc8
RuleName = Amsi.DLL Load By Uncommon Process
EventType = Image.Load
Tag = amsi.dll-load-by-uncommon-process
RiskScore = 25
Annotation = {"mitre_attack": ["T1490"]}
Query = Image.Path like "%\\amsi.dll" and not (Process.Path in ["C:\\Windows\\explorer.exe", "C:\\Windows\\Sysmon64.exe"] or Process.Path like "C:\\Program Files (x86)\\%" or Process.Path like "C:\\Program Files\\%" or Process.Path like "C:\\Windows\\System32\\%" or Process.Path like "C:\\Windows\\SysWOW64\\%" or Process.Path like "C:\\Windows\\WinSxS\\%" or Process.Path like "C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\%" and Process.Path like "%\\MsMpEng.exe" or (Process.Path like "C:\\Windows\\Microsoft.NET\\Framework\\%" or Process.Path like "C:\\Windows\\Microsoft.NET\\Framework64\\%") and Process.Path like "%\\ngentask.exe" or isnull(Process.Path) or Process.Path == "")
GenericProperty1 = Image.Path


[ActivityMonitoringRule platform=Windows]
# Detect the usage of "DirLister.exe" a utility for quickly listing folder or drive contents. It was seen used by BlackCat ransomware to create a list of accessible directories and files.
# Author: frack113
RuleId = b4dc61f5-6cce-468e-a608-b48b469feaa2
RuleName = DirLister Execution
EventType = Process.Start
Tag = proc-start-dirlister-execution
RiskScore = 25
Annotation = {"mitre_attack": ["T1083"]}
Query = Process.Name == "DirLister.exe" or Process.Path like "%\\dirlister.exe"


[ActivityMonitoringRule platform=Windows]
# Detects execution of Net.exe, whether suspicious or benign.
# Author: Michael Haag, Mark Woan (improvements), James Pemberton / @4A616D6573 / oscd.community (improvements)
RuleId = 183e7ea8-ac4b-4c23-9aec-b3dac4e401ac
RuleName = Net.exe Execution
EventType = Process.Start
Tag = proc-start-net.exe-execution
RiskScore = 25
Annotation = {"mitre_attack": ["T1007", "T1049", "T1018", "T1135", "T1201", "T1069.001", "T1069.002", "T1087.001", "T1087.002", "T1021.002"]}
Query = (Process.Path like "%\\net.exe" or Process.Path like "%\\net1.exe" or Process.Name in ["net.exe", "net1.exe"]) and (Process.CommandLine like "% group%" or Process.CommandLine like "% localgroup%" or Process.CommandLine like "% user%" or Process.CommandLine like "% view%" or Process.CommandLine like "% share%" or Process.CommandLine like "% accounts%" or Process.CommandLine like "% stop %" or Process.CommandLine like "% start%")


[ActivityMonitoringRule platform=Windows]
# Detects execution of findstr with the "s" and "i" flags for a "subfolder" and "insensitive" search respectively. Attackers sometimes leverage this built-in utility to search the system for interesting files or filter through results of commands.
# Author: Furkan CALISKAN, @caliskanfurkan_, @oscd_initiative, Nasreddine Bencherchali (Nextron Systems)
RuleId = 04936b66-3915-43ad-a8e5-809eadfd1141
RuleName = Insensitive Subfolder Search Via Findstr.EXE
EventType = Process.Start
Tag = proc-start-insensitive-subfolder-search-via-findstr.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1218", "T1564.004", "T1552.001", "T1105"]}
Query = (Process.CommandLine like "%findstr%" or Process.Path like "%findstr.exe" or Process.Name == "FINDSTR.EXE") and (Process.CommandLine like "% /s %" or Process.CommandLine like "% -s %") and (Process.CommandLine like "% /i %" or Process.CommandLine like "% -i %")


[ActivityMonitoringRule platform=Windows]
# Detects the execution of "attrib" with the "+s" flag to mark files as system files
# Author: frack113
RuleId = bb19e94c-59ae-4c15-8c12-c563d23fe52b
RuleName = Set Files as System Files Using Attrib.EXE
EventType = Process.Start
Tag = proc-start-set-files-as-system-files-using-attrib.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1564.001"]}
Query = (Process.Path like "%\\attrib.exe" or Process.Name == "ATTRIB.EXE") and Process.CommandLine like "% +s %"


[ActivityMonitoringRule platform=Windows]
# Detects specific combinations of encoding methods in PowerShell via the commandline
# Author: Teymur Kheirkhabarov (idea), Vasiliy Burov (rule), oscd.community, Tim Shelton
RuleId = cdf05894-89e7-4ead-b2b0-0a5f97a90f2f
RuleName = Potential Encoded PowerShell Patterns In CommandLine
EventType = Process.Start
Tag = proc-start-potential-encoded-powershell-patterns-in-commandline
RiskScore = 25
Annotation = {"mitre_attack": ["T1027", "T1059.001"]}
Query = (Process.Path like "%\\powershell.exe" or Process.Path like "%\\pwsh.exe" or Process.Name in ["PowerShell.EXE", "pwsh.dll"]) and ((Process.CommandLine like "%ToInt%" or Process.CommandLine like "%ToDecimal%" or Process.CommandLine like "%ToByte%" or Process.CommandLine like "%ToUint%" or Process.CommandLine like "%ToSingle%" or Process.CommandLine like "%ToSByte%") and (Process.CommandLine like "%ToChar%" or Process.CommandLine like "%ToString%" or Process.CommandLine like "%String%") or Process.CommandLine like "%char%" and Process.CommandLine like "%join%" or Process.CommandLine like "%split%" and Process.CommandLine like "%join%")


[ActivityMonitoringRule platform=Windows]
# Detects the stopping of a Windows service
# Author: Jakob Weinzettl, oscd.community, Nasreddine Bencherchali (Nextron Systems)
RuleId = 81bcb81b-5b1f-474b-b373-52c871aaa7b1
RuleName = Stop Windows Service Via Sc.EXE
EventType = Process.Start
Tag = proc-start-stop-windows-service-via-sc.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1489"]}
Query = (Process.Name == "sc.exe" or Process.Path like "%\\sc.exe") and Process.CommandLine like "% stop %" and not ((Process.CommandLine in ["sc  stop KSCWebConsoleMessageQueue", "sc  stop LGHUBUpdaterService"]) and (Process.User like "%AUTHORI%" or Process.User like "%AUTORI%"))
GenericProperty1 = Process.User


[ActivityMonitoringRule platform=Windows]
# Detects the creation of a process from Windows task manager
# Author: Florian Roth (Nextron Systems)
RuleId = 3d7679bd-0c00-440c-97b0-3f204273e6c7
RuleName = Taskmgr as Parent
EventType = Process.Start
Tag = proc-start-taskmgr-as-parent
RiskScore = 25
Annotation = {"mitre_attack": ["T1036"]}
Query = Parent.Path like "%\\taskmgr.exe" and not (Process.Path like "%\\resmon.exe" or Process.Path like "%\\mmc.exe" or Process.Path like "%\\taskmgr.exe")
GenericProperty1 = Parent.Path


[ActivityMonitoringRule platform=Windows]
# Detects nltest commands that can be used for information discovery
# Author: Arun Chauhan
RuleId = 903076ff-f442-475a-b667-4f246bcc203b
RuleName = Nltest.EXE Execution
EventType = Process.Start
Tag = proc-start-nltest.exe-execution
RiskScore = 25
Annotation = {"mitre_attack": ["T1016", "T1018", "T1482"]}
Query = Process.Path like "%\\nltest.exe" or Process.Name == "nltestrk.exe"


[ActivityMonitoringRule platform=Windows]
# Detect indirect command execution via Program Compatibility Assistant pcwrun.exe
# Author: A. Sungurov , oscd.community
RuleId = b97cd4b1-30b8-4a9d-bd72-6293928d52bc
RuleName = Indirect Command Execution By Program Compatibility Wizard
EventType = Process.Start
Tag = proc-start-indirect-command-execution-by-program-compatibility-wizard
RiskScore = 25
Annotation = {"mitre_attack": ["T1218"]}
Query = Parent.Path like "%\\pcwrun.exe"
GenericProperty1 = Parent.Path


[ActivityMonitoringRule platform=Windows]
# Detects the deletion of the TeamViewer log files which may indicate an attempt to destroy forensic evidence
# Author: frack113
RuleId = b1decb61-ed83-4339-8e95-53ea51901720
RuleName = TeamViewer Log File Deleted
EventType = File.Delete
Tag = teamviewer-log-file-deleted
RiskScore = 25
Annotation = {"mitre_attack": ["T1070.004"]}
Query = File.Path like "%\\TeamViewer\_%" and File.Path like "%.log" and not Process.Path == "C:\\Windows\\system32\\svchost.exe"
GenericProperty1 = File.Path


[ActivityMonitoringRule platform=Windows]
# Detects the use of the redirection character ">" to redicrect information in commandline
# Author: frack113
RuleId = 4f4eaa9f-5ad4-410c-a4be-bc6132b0175a
RuleName = CMD Shell Output Redirect
EventType = Process.Start
Tag = proc-start-cmd-shell-output-redirect
RiskScore = 25
Annotation = {"mitre_attack": ["T1082"]}
Query = (Process.Name == "Cmd.Exe" or Process.Path like "%\\cmd.exe") and Process.CommandLine like "%>%" and not (Process.CommandLine like "%C:\\Program Files (x86)\\Internet Download Manager\\IDMMsgHost.exe%" or Process.CommandLine like "%chrome-extension://%" or Process.CommandLine like "%\\.\\pipe\\chrome.nativeMessaging%")


[ActivityMonitoringRule platform=Windows]
# Attackers can use explorer.exe for evading defense mechanisms
# Author: Furkan CALISKAN, @caliskanfurkan_, @oscd_initiative
RuleId = 9eb271b9-24ae-4cd4-9465-19cfc1047f3e
RuleName = Proxy Execution Via Explorer.exe
EventType = Process.Start
Tag = proc-start-proxy-execution-via-explorer.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1218"]}
Query = Process.Path like "%\\explorer.exe" and Parent.Path like "%\\cmd.exe" and Process.CommandLine like "%explorer.exe%"
GenericProperty1 = Parent.Path


[ActivityMonitoringRule platform=Windows]
# Detects DNS server discovery via LDAP query requests from uncommon applications
# Author: frack113
RuleId = a21bcd7e-38ec-49ad-b69a-9ea17e69509e
RuleName = DNS Server Discovery Via LDAP Query
EventType = Dns.Query
Tag = dns-server-discovery-via-ldap-query
RiskScore = 25
Annotation = {"mitre_attack": ["T1482"]}
Query = Dns.QueryRequest like "\_ldap.%" and not (Process.Path like "%:\\Program Files\\%" or Process.Path like "%:\\Program Files (x86)\\%" or Process.Path like "%:\\Windows\\%" or Process.Path like "%:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\%" and Process.Path like "%\\MsMpEng.exe" or Process.Path == "<unknown process>" or isnull(Process.Path)) and not (Process.Path like "C:\\WindowsAzure\\GuestAgent%" or Process.Path like "%\\chrome.exe" or Process.Path like "%\\firefox.exe" or Process.Path like "%\\opera.exe")
GenericProperty1 = Dns.QueryRequest


[ActivityMonitoringRule platform=Windows]
# Detects the creation of a new service using powershell.
# Author: Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community
RuleId = c02e96b7-c63a-4c47-bd83-4a9f74afcfb2
RuleName = New Service Creation Using PowerShell
EventType = Process.Start
Tag = proc-start-new-service-creation-using-powershell
RiskScore = 25
Annotation = {"mitre_attack": ["T1543.003"]}
Query = Process.CommandLine like "%New-Service%" and Process.CommandLine like "%-BinaryPathName%"


[ActivityMonitoringRule platform=Windows]
# Detects default PsExec service filename which indicates PsExec service installation and execution
# Author: Thomas Patzke
RuleId = 259e5a6a-b8d2-4c38-86e2-26c5e651361d
RuleName = PsExec Service File Creation
EventType = File.Create
Tag = psexec-service-file-creation
RiskScore = 25
Annotation = {"mitre_attack": ["T1569.002"]}
Query = File.Path like "%\\PSEXESVC.exe"
GenericProperty1 = File.Path


[ActivityMonitoringRule platform=Windows]
# Detects the execution of "wmic" with the "group" flag.
# Adversaries may attempt to find local system groups and permission settings.
# The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.
# Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.
# Author: frack113
RuleId = 164eda96-11b2-430b-85ff-6a265c15bf32
RuleName = Local Groups Reconnaissance Via Wmic.EXE
EventType = Process.Start
Tag = proc-start-local-groups-reconnaissance-via-wmic.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1069.001"]}
Query = (Process.Path like "%\\wmic.exe" or Process.Name == "wmic.exe") and Process.CommandLine like "% group%"


[ActivityMonitoringRule platform=Windows]
# Detects potential RDP connection via Mstsc using a local ".rdp" file
# Author: Nasreddine Bencherchali (Nextron Systems), Christopher Peacock @securepeacock
RuleId = 5fdce3ac-e7f9-4ecd-a3aa-a4d78ebbf0af
RuleName = Mstsc.EXE Execution With Local RDP File
EventType = Process.Start
Tag = proc-start-mstsc.exe-execution-with-local-rdp-file
RiskScore = 25
Annotation = {"mitre_attack": ["T1219"]}
Query = (Process.Path like "%\\mstsc.exe" or Process.Name == "mstsc.exe") and (Process.CommandLine like "%.rdp" or Process.CommandLine like "%.rdp\"") and not (Parent.Path == "C:\\Windows\\System32\\lxss\\wslhost.exe" and Process.CommandLine like "%C:\\ProgramData\\Microsoft\\WSL\\wslg.rdp%")
GenericProperty1 = Parent.Path


[ActivityMonitoringRule platform=Windows]
# Detects PowerShell creating a PowerShell file (.ps1). While often times this behavior is benign, sometimes it can be a sign of a dropper script trying to achieve persistence.
# Author: frack113
RuleId = 576426ad-0131-4001-ae01-be175da0c108
RuleName = PowerShell Script Dropped Via PowerShell.EXE
EventType = File.Create
Tag = powershell-script-dropped-via-powershell.exe
RiskScore = 25
Query = (Process.Path like "%\\powershell.exe" or Process.Path like "%\\pwsh.exe") and File.Path like "%.ps1" and not (File.Path like "%\_\_PSScriptPolicyTest\_%" or File.Path like "C:\\Users\\%" and File.Path like "%\\AppData\\Local\\Temp\\%" or File.Path like "C:\\Windows\\Temp\\%")
GenericProperty1 = File.Path


[ActivityMonitoringRule platform=Windows]
# Detects the creation of files in a specific location by ScreenConnect RMM.
# ScreenConnect has feature to remotely execute binaries on a target machine. These binaries will be dropped to ":\Users\<username>\Documents\ConnectWiseControl\Temp\" before execution.
# Author: Ali Alwashali
RuleId = 0afecb6e-6223-4a82-99fb-bf5b981e92a5
RuleName = Remote Access Tool - ScreenConnect Temporary File
EventType = File.Create
Tag = remote-access-tool-screenconnect-temporary-file
RiskScore = 25
Annotation = {"mitre_attack": ["T1059.003"]}
Query = Process.Path like "%\\ScreenConnect.WindowsClient.exe" and File.Path like "%\\Documents\\ConnectWiseControl\\Temp\\%"
GenericProperty1 = File.Path


[ActivityMonitoringRule platform=Windows]
# Local accounts, System Owner/User discovery using operating systems utilities
# Author: Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community
RuleId = 502b42de-4306-40b4-9596-6f590c81f073
RuleName = Local Accounts Discovery
EventType = Process.Start
Tag = proc-start-local-accounts-discovery
RiskScore = 25
Annotation = {"mitre_attack": ["T1033", "T1087.001"]}
Query = Process.Path like "%\\cmd.exe" and Process.CommandLine like "% /c%" and Process.CommandLine like "%dir %" and Process.CommandLine like "%\\Users\\%" and not Process.CommandLine like "% rmdir %" or (Process.Path like "%\\net.exe" or Process.Path like "%\\net1.exe") and Process.CommandLine like "%user%" and not (Process.CommandLine like "%/domain%" or Process.CommandLine like "%/add%" or Process.CommandLine like "%/delete%" or Process.CommandLine like "%/active%" or Process.CommandLine like "%/expires%" or Process.CommandLine like "%/passwordreq%" or Process.CommandLine like "%/scriptpath%" or Process.CommandLine like "%/times%" or Process.CommandLine like "%/workstations%") or Process.Path like "%\\whoami.exe" or Process.Path like "%\\quser.exe" or Process.Path like "%\\qwinsta.exe" or Process.Path like "%\\wmic.exe" and Process.CommandLine like "%useraccount%" and Process.CommandLine like "%get%" or Process.Path like "%\\cmdkey.exe" and Process.CommandLine like "% /l%"


[ActivityMonitoringRule platform=Windows]
# Adversaries may enumerate browser bookmarks to learn more about compromised hosts.
# Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about
# internal network resources such as servers, tools/dashboards, or other related infrastructure.
# Author: frack113, Nasreddine Bencherchali (Nextron Systems)
RuleId = 725a9768-0f5e-4cb3-aec2-bc5719c6831a
RuleName = Suspicious Where Execution
EventType = Process.Start
Tag = proc-start-suspicious-where-execution
RiskScore = 25
Annotation = {"mitre_attack": ["T1217"]}
Query = (Process.Path like "%\\where.exe" or Process.Name == "where.exe") and (Process.CommandLine like "%places.sqlite%" or Process.CommandLine like "%cookies.sqlite%" or Process.CommandLine like "%formhistory.sqlite%" or Process.CommandLine like "%logins.json%" or Process.CommandLine like "%key4.db%" or Process.CommandLine like "%key3.db%" or Process.CommandLine like "%sessionstore.jsonlz4%" or Process.CommandLine like "%History%" or Process.CommandLine like "%Bookmarks%" or Process.CommandLine like "%Cookies%" or Process.CommandLine like "%Login Data%")


[ActivityMonitoringRule platform=Windows]
# Detects execution of the builtin "rmdir" command in order to delete directories.
# Adversaries may delete files left behind by the actions of their intrusion activity.
# Malware, tools, or other non-native files dropped or created on a system by an adversary may leave traces to indicate to what was done within a network and how.
# Removal of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversary's footprint.
# Author: frack113
RuleId = 41ca393d-538c-408a-ac27-cf1e038be80c
RuleName = Directory Removal Via Rmdir
EventType = Process.Start
Tag = proc-start-directory-removal-via-rmdir
RiskScore = 25
Annotation = {"mitre_attack": ["T1070.004"]}
Query = (Process.Path like "%\\cmd.exe" or Process.Name == "Cmd.Exe") and Process.CommandLine like "%rmdir%" and (Process.CommandLine like "%/s%" or Process.CommandLine like "%/q%")


[ActivityMonitoringRule platform=Windows]
# Detects command lines that contain the 'accepteula' flag which could be a sign of execution of one of the Sysinternals tools
# Author: Markus Neis
RuleId = 7cccd811-7ae9-4ebe-9afd-cb5c406b824b
RuleName = Potential Execution of Sysinternals Tools
EventType = Process.Start
Tag = proc-start-potential-execution-of-sysinternals-tools
RiskScore = 25
Annotation = {"mitre_attack": ["T1588.002"]}
Query = Process.CommandLine like "% -accepteula%" or Process.CommandLine like "% /accepteula%"


[ActivityMonitoringRule platform=Windows]
# When C# is compiled dynamically, a .cmdline file will be created as a part of the process.
# Certain processes are not typically observed compiling C# code, but can do so without touching disk.
# This can be used to unpack a payload for execution
# Author: frack113
RuleId = e4a74e34-ecde-4aab-b2fb-9112dd01aed0
RuleName = Dynamic CSharp Compile Artefact
EventType = File.Create
Tag = dynamic-csharp-compile-artefact
RiskScore = 25
Annotation = {"mitre_attack": ["T1027.004"]}
Query = File.Path like "%.cmdline"
GenericProperty1 = File.Path


[ActivityMonitoringRule platform=Windows]
# Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network.
# Author: frack113
RuleId = 1c67a717-32ba-409b-a45d-0fb704a73a81
RuleName = System Network Connections Discovery Via Net.EXE
EventType = Process.Start
Tag = proc-start-system-network-connections-discovery-via-net.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1049"]}
Query = (Process.Path like "%\\net.exe" or Process.Path like "%\\net1.exe" or Process.Name in ["net.exe", "net1.exe"]) and (Process.CommandLine like "% use" or Process.CommandLine like "% sessions" or Process.CommandLine like "% use %" or Process.CommandLine like "% sessions %")


[ActivityMonitoringRule platform=Windows]
# Identifies use of various commands to query a systems time. This technique may be used before executing a scheduled task or to discover the time zone of a target system.
# Author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community
RuleId = b243b280-65fe-48df-ba07-6ddea7646427
RuleName = Discovery of a System Time
EventType = Process.Start
Tag = proc-start-discovery-of-a-system-time
RiskScore = 25
Annotation = {"mitre_attack": ["T1124"]}
Query = (Process.Path like "%\\net.exe" or Process.Path like "%\\net1.exe") and Process.CommandLine like "%time%" or Process.Path like "%\\w32tm.exe" and Process.CommandLine like "%tz%"


[ActivityMonitoringRule platform=Windows]
# Detects the creation of a new service using the "sc.exe" utility.
# Author: Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community
RuleId = 85ff530b-261d-48c6-a441-facaa2e81e48
RuleName = New Service Creation Using Sc.EXE
EventType = Process.Start
Tag = proc-start-new-service-creation-using-sc.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1543.003"]}
Query = Process.Path like "%\\sc.exe" and Process.CommandLine like "%create%" and Process.CommandLine like "%binPath%"


[ActivityMonitoringRule platform=Windows]
# Detects execution of "sc.exe" to query information about registered services on the system
# Author: frack113
RuleId = 57712d7a-679c-4a41-a913-87e7175ae429
RuleName = SC.EXE Query Execution
EventType = Process.Start
Tag = proc-start-sc.exe-query-execution
RiskScore = 25
Annotation = {"mitre_attack": ["T1007"]}
Query = Process.Path like "%\\sc.exe" and Process.Name like "%sc.exe" and Process.CommandLine like "% query%"


[ActivityMonitoringRule platform=Windows]
# Use of hostname to get information
# Author: frack113
RuleId = 7be5fb68-f9ef-476d-8b51-0256ebece19e
RuleName = Suspicious Execution of Hostname
EventType = Process.Start
Tag = proc-start-suspicious-execution-of-hostname
RiskScore = 25
Annotation = {"mitre_attack": ["T1082"]}
Query = Process.Path like "%\\HOSTNAME.EXE"


[ActivityMonitoringRule platform=Windows]
# Detects the export of the target Registry key to a file.
# Author: Oddvar Moe, Sander Wiebing, oscd.community
RuleId = f0e53e89-8d22-46ea-9db5-9d4796ee2f8a
RuleName = Exports Registry Key To a File
EventType = Process.Start
Tag = proc-start-exports-registry-key-to-a-file
RiskScore = 25
Annotation = {"mitre_attack": ["T1012"]}
Query = (Process.Path like "%\\regedit.exe" or Process.Name == "REGEDIT.EXE") and (Process.CommandLine like "% /E %" or Process.CommandLine like "% -E %") and not ((Process.CommandLine like "%hklm%" or Process.CommandLine like "%hkey\_local\_machine%") and (Process.CommandLine like "%\\system" or Process.CommandLine like "%\\sam" or Process.CommandLine like "%\\security"))


[ActivityMonitoringRule platform=Windows]
# Detects a non-browser process communicating with the Notion API. This could indicate potential use of a covert C2 channel such as "OffensiveNotion C2"
# Author: Gavin Knapp
RuleId = 7e9cf7b6-e827-11ed-a05b-15959c120003
RuleName = Potentially Suspicious Network Connection To Notion API
EventType = Net.Any
Tag = potentially-suspicious-network-connection-to-notion-api
RiskScore = 25
Annotation = {"mitre_attack": ["T1102"]}
Query = Net.Target.Name like "%api.notion.com%" and not (Process.Path like "%\\AppData\\Local\\Programs\\Notion\\Notion.exe" or Process.Path like "%\\brave.exe" or Process.Path in ["C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe", "C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe"] or Process.Path in ["C:\\Program Files\\Mozilla Firefox\\firefox.exe", "C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe"] or Process.Path in ["C:\\Program Files (x86)\\Internet Explorer\\iexplore.exe", "C:\\Program Files\\Internet Explorer\\iexplore.exe"] or Process.Path like "%\\maxthon.exe" or Process.Path like "C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\%" or Process.Path like "%\\WindowsApps\\MicrosoftEdge.exe" or Process.Path in ["C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe", "C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe"] or (Process.Path like "C:\\Program Files (x86)\\Microsoft\\EdgeCore\\%" or Process.Path like "C:\\Program Files\\Microsoft\\EdgeCore\\%") and (Process.Path like "%\\msedge.exe" or Process.Path like "%\\msedgewebview2.exe") or Process.Path like "%\\opera.exe" or Process.Path like "%\\safari.exe" or Process.Path like "%\\seamonkey.exe" or Process.Path like "%\\vivaldi.exe" or Process.Path like "%\\whale.exe")
GenericProperty1 = Net.Target.Name


[ActivityMonitoringRule platform=Windows]
# Detects the creation of a new office macro files on the systems
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = 91174a41-dc8f-401b-be89-7bfc140612a0
RuleName = Office Macro File Creation
EventType = File.Create
Tag = office-macro-file-creation
RiskScore = 25
Annotation = {"mitre_attack": ["T1566.001"]}
Query = File.Path like "%.docm" or File.Path like "%.dotm" or File.Path like "%.xlsm" or File.Path like "%.xltm" or File.Path like "%.potm" or File.Path like "%.pptm"
GenericProperty1 = File.Path


[ActivityMonitoringRule platform=Windows]
# This tool enables enumeration and exporting of all DNS records in the zone for recon purposes of internal networks Python 3 and python.exe must be installed,
# Usee to Query/modify DNS records for Active Directory integrated DNS via LDAP
# Author: frack113
RuleId = 26d3f0a2-f514-4a3f-a8a7-e7e48a8d9160
RuleName = PUA - Adidnsdump Execution
EventType = Process.Start
Tag = proc-start-pua-adidnsdump-execution
RiskScore = 25
Annotation = {"mitre_attack": ["T1018"]}
Query = Process.Path like "%\\python.exe" and Process.CommandLine like "%adidnsdump%"


[ActivityMonitoringRule platform=Windows]
# Detects the usage of the "net.exe" command to start a service using the "start" flag
# Author: Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community
RuleId = 2a072a96-a086-49fa-bcb5-15cc5a619093
RuleName = Start Windows Service Via Net.EXE
EventType = Process.Start
Tag = proc-start-start-windows-service-via-net.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1569.002"]}
Query = (Process.Path like "%\\net.exe" or Process.Path like "%\\net1.exe" or Process.Name in ["net.exe", "net1.exe"]) and Process.CommandLine like "% start %"


[ActivityMonitoringRule platform=Windows]
# Detects a WMI modules being loaded by an uncommon process
# Author: Roberto Rodriguez @Cyb3rWard0g
RuleId = 671bb7e3-a020-4824-a00e-2ee5b55f385e
RuleName = WMI Module Loaded By Non Uncommon Process
EventType = Image.Load
Tag = wmi-module-loaded-by-non-uncommon-process
RiskScore = 25
Annotation = {"mitre_attack": ["T1047"]}
Query = (Image.Path like "%\\fastprox.dll" or Image.Path like "%\\wbemcomn.dll" or Image.Path like "%\\wbemprox.dll" or Image.Path like "%\\wbemsvc.dll" or Image.Path like "%\\WmiApRpl.dll" or Image.Path like "%\\wmiclnt.dll" or Image.Path like "%\\WMINet\_Utils.dll" or Image.Path like "%\\wmiprov.dll" or Image.Path like "%\\wmiutils.dll") and not (Process.Path like "%:\\Microsoft\\Teams\\current\\Teams.exe%" or Process.Path like "%:\\Microsoft\\Teams\\Update.exe%" or Process.Path like "%:\\Windows\\explorer.exe%" or Process.Path like "%:\\Windows\\Sysmon.exe%" or Process.Path like "%:\\Windows\\Sysmon64.exe%" or Process.Path like "%:\\Windows\\System32\\%" or Process.Path like "%:\\Windows\\SysWOW64\\%") and not (Process.Path like "%\\WindowsAzureGuestAgent.exe" or Process.Path like "%\\WaAppAgent.exe" or Process.Path like "%\\thor.exe" or Process.Path like "%\\thor64.exe" or Process.Path like "%\\MsMpEng.exe" or (Process.Path like "%:\\Windows\\Microsoft.NET\\Framework\\%" or Process.Path like "%:\\Windows\\Microsoft.NET\\Framework64\\%") and Process.Path like "%\\ngentask.exe" or Process.Path like "%:\\Program Files\\%" or Process.Path like "%:\\Program Files (x86)\\%")
GenericProperty1 = Image.Path


[ActivityMonitoringRule platform=Windows]
# Detects DNS queries to "ufile.io", which was seen abused by malware and threat actors as a method for data exfiltration
# Author: yatinwad, TheDFIRReport
RuleId = 1cbbeaaf-3c8c-4e4c-9d72-49485b6a176b
RuleName = DNS Query To Ufile.io
EventType = Dns.Query
Tag = dns-query-to-ufile.io
RiskScore = 25
Annotation = {"mitre_attack": ["T1567.002"]}
Query = Dns.QueryRequest like "%ufile.io%"
GenericProperty1 = Dns.QueryRequest


[ActivityMonitoringRule platform=Windows]
# Detects abusing Azure Browser SSO by requesting OAuth 2.0 refresh tokens for an Azure-AD-authenticated Windows user (i.e. the machine is joined to Azure AD and a user logs in with their Azure AD account) wanting to perform SSO authentication in the browser.
# An attacker can use this to authenticate to Azure AD in a browser as that user.
# Author: Den Iuzvyk
RuleId = 50f852e6-af22-4c78-9ede-42ef36aa3453
RuleName = Potential Azure Browser SSO Abuse
EventType = Image.Load
Tag = potential-azure-browser-sso-abuse
RiskScore = 25
Annotation = {"mitre_attack": ["T1574.002"]}
Query = Image.Path == "C:\\Windows\\System32\\MicrosoftAccountTokenProvider.dll" and not ((Process.Path like "C:\\Windows\\System32\\%" or Process.Path like "C:\\Windows\\SysWOW64\\%") and Process.Path like "%\\BackgroundTaskHost.exe") and not ((Process.Path like "C:\\Program Files\\Microsoft Visual Studio\\%" or Process.Path like "C:\\Program Files (x86)\\Microsoft Visual Studio\\%") and Process.Path like "%\\IDE\\devenv.exe" or Process.Path in ["C:\\Program Files (x86)\\Internet Explorer\\iexplore.exe", "C:\\Program Files\\Internet Explorer\\iexplore.exe"] or Process.Path like "C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\%" or Process.Path like "%\\WindowsApps\\MicrosoftEdge.exe" or Process.Path in ["C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe", "C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe"] or (Process.Path like "C:\\Program Files (x86)\\Microsoft\\EdgeCore\\%" or Process.Path like "C:\\Program Files\\Microsoft\\EdgeCore\\%") and (Process.Path like "%\\msedge.exe" or Process.Path like "%\\msedgewebview2.exe") or Process.Path like "%\\AppData\\Local\\Microsoft\\OneDrive\\OneDrive.exe" or isnull(Process.Path))
GenericProperty1 = Image.Path


[ActivityMonitoringRule platform=Windows]
# Detects the load of known vulnerable drivers via their names only.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = 72cd00d6-490c-4650-86ff-1d11f491daa1
RuleName = Vulnerable Driver Load By Name
EventType = Driver.Load
Tag = vulnerable-driver-load-by-name
RiskScore = 25
Annotation = {"mitre_attack": ["T1543.003", "T1068"]}
Query = Image.Path like "%\\lv561av.sys" or Image.Path like "%\\hpportiox64.sys" or Image.Path like "%\\d2.sys" or Image.Path like "%\\rtcore64.sys" or Image.Path like "%\\gdrv.sys" or Image.Path like "%\\fiddrv.sys" or Image.Path like "%\\fiddrv64.sys" or Image.Path like "%\\asio32.sys" or Image.Path like "%\\cpupress.sys" or Image.Path like "%\\chaos-rootkit.sys" or Image.Path like "%\\eio.sys" or Image.Path like "%\\kfeco11x64.sys" or Image.Path like "%\\atillk64.sys" or Image.Path like "%\\gvcidrv64.sys" or Image.Path like "%\\eneio64.sys" or Image.Path like "%\\lgdcatcher.sys" or Image.Path like "%\\ene.sys" or Image.Path like "%\\t7.sys" or Image.Path like "%\\hwrwdrv.sys" or Image.Path like "%\\bs\_rciow1064.sys" or Image.Path like "%\\amp.sys" or Image.Path like "%\\mhyprot2.sys" or Image.Path like "%\\agent64.sys" or Image.Path like "%\\asupio.sys" or Image.Path like "%\\d4.sys" or Image.Path like "%\\wiseunlo.sys" or Image.Path like "%\\msrhook.sys" or Image.Path like "%\\winiodrv.sys" or Image.Path like "%\\driver7-x64.sys" or Image.Path like "%\\proxy32.sys" or Image.Path like "%\\bsmemx64.sys" or Image.Path like "%\\msio64.sys" or Image.Path like "%\\amigendrv64.sys" or Image.Path like "%\\ni.sys" or Image.Path like "%\\smep\_namco.sys" or Image.Path like "%\\bs\_rcio64.sys" or Image.Path like "%\\black.sys" or Image.Path like "%\\testbone.sys" or Image.Path like "%\\blackbonedrv10.sys" or Image.Path like "%\\nchgbios2x64.sys" or Image.Path like "%\\lgcoretemp.sys" or Image.Path like "%\\hostnt.sys" or Image.Path like "%\\viraglt64.sys" or Image.Path like "%\\t.sys" or Image.Path like "%\\kbdcap64.sys" or Image.Path like "%\\winflash64.sys" or Image.Path like "%\\windows-xp-64.sys" or Image.Path like "%\\asribdrv.sys" or Image.Path like "%\\citmdrv\_amd64.sys" or Image.Path like "%\\enetechio64.sys" or Image.Path like "%\\vproeventmonitor.sys" or Image.Path like "%\\amifldrv64.sys" or Image.Path like "%\\my.sys" or Image.Path like "%\\amdpowerprofiler.sys" or Image.Path like "%\\80.sys" or Image.Path like "%\\dbutil\_2\_3.sys" or Image.Path like "%\\asrrapidstartdrv.sys" or Image.Path like "%\\b3.sys" or Image.Path like "%\\nbiolib\_x64.sys" or Image.Path like "%\\nicm.sys" or Image.Path like "%\\bs\_flash64.sys" or Image.Path like "%\\kevp64.sys" or Image.Path like "%\\hw.sys" or Image.Path like "%\\bwrs.sys" or Image.Path like "%\\wcpu.sys" or Image.Path like "%\\nt6.sys" or Image.Path like "%\\asrsmartconnectdrv.sys" or Image.Path like "%\\phymem64.sys" or Image.Path like "%\\winio32.sys" or Image.Path like "%\\dbutildrv2.sys" or Image.Path like "%\\segwindrvx64.sys" or Image.Path like "%\\netproxydriver.sys" or Image.Path like "%\\ctiio64.sys" or Image.Path like "%\\inpoutx64.sys" or Image.Path like "%\\nscm.sys" or Image.Path like "%\\procexp.sys" or Image.Path like "%\\nstrwsk.sys" or Image.Path like "%\\tmcomm.sys" or Image.Path like "%\\asrdrv103.sys" or Image.Path like "%\\smep\_capcom.sys" or Image.Path like "%\\gametersafe.sys" or Image.Path like "%\\piddrv.sys" or Image.Path like "%\\fairplaykd.sys" or Image.Path like "%\\sfdrvx32.sys" or Image.Path like "%\\kfeco10x64.sys" or Image.Path like "%\\phymemx64.sys" or Image.Path like "%\\bs\_hwmio64.sys" or Image.Path like "%\\asrdrv101.sys" or Image.Path like "%\\hwos2ec10x64.sys" or Image.Path like "%\\rzpnk.sys" or Image.Path like "%\\asrsetupdrv103.sys" or Image.Path like "%\\winio32b.sys" or Image.Path like "%\\phlashnt.sys" or Image.Path like "%\\bs\_def.sys" or Image.Path like "%\\d.sys" or Image.Path like "%\\dcr.sys" or Image.Path like "%\\nt5.sys" or Image.Path like "%\\citmdrv\_ia64.sys" or Image.Path like "%\\driver7-x86.sys" or Image.Path like "%\\asrdrv104.sys" or Image.Path like "%\\bwrsh.sys" or Image.Path like "%\\asrdrv106.sys" or Image.Path like "%\\atszio64.sys" or Image.Path like "%\\directio64.sys" or Image.Path like "%\\elrawdsk.sys" or Image.Path like "%\\ucorew64.sys" or Image.Path like "%\\fidpcidrv64.sys" or Image.Path like "%\\bsmi.sys" or Image.Path like "%\\b1.sys" or Image.Path like "%\\magdrvamd64.sys" or Image.Path like "%\\elbycdio.sys" or Image.Path like "%\\winio64.sys" or Image.Path like "%\\winio64a.sys" or Image.Path like "%\\physmem.sys" or Image.Path like "%\\monitor\_win10\_x64.sys" or Image.Path like "%\\panio.sys" or Image.Path like "%\\asio64.sys" or Image.Path like "%\\fidpcidrv.sys" or Image.Path like "%\\aswvmm.sys" or Image.Path like "%\\atszio.sys" or Image.Path like "%\\mhyprot3.sys" or Image.Path like "%\\gameink.sys" or Image.Path like "%\\alsysio64.sys" or Image.Path like "%\\kprocesshacker.sys" or Image.Path like "%\\d3.sys" or Image.Path like "%\\ncpl.sys" or Image.Path like "%\\asupio64.sys" or Image.Path like "%\\bw.sys" or Image.Path like "%\\iobitunlocker.sys" or Image.Path like "%\\rtkio.sys" or Image.Path like "%\\bs\_i2cio.sys" or Image.Path like "%\\amdryzenmasterdriver.sys" or Image.Path like "%\\81.sys" or Image.Path like "%\\b.sys" or Image.Path like "%\\asio.sys" or Image.Path like "%\\otipcibus.sys" or Image.Path like "%\\winio64b.sys" or Image.Path like "%\\directio32.sys" or Image.Path like "%\\panmonfltx64.sys" or Image.Path like "%\\vboxusb.sys" or Image.Path like "%\\t3.sys" or Image.Path like "%\\semav6msr.sys" or Image.Path like "%\\etdsupp.sys" or Image.Path like "%\\vboxdrv.sys" or Image.Path like "%\\proxy64.sys" or Image.Path like "%\\lurker.sys" or Image.Path like "%\\winio32a.sys" or Image.Path like "%\\nt3.sys" or Image.Path like "%\\glckio2.sys" or Image.Path like "%\\sandra.sys" or Image.Path like "%\\asmmap64.sys" or Image.Path like "%\\mhyprot.sys" or Image.Path like "%\\driver7-x86-withoutdbg.sys" or Image.Path like "%\\nt2.sys" or Image.Path like "%\\iqvw64.sys" or Image.Path like "%\\lmiinfo.sys" or Image.Path like "%\\dh\_kernel\_10.sys" or Image.Path like "%\\naldrv.sys" or Image.Path like "%\\c.sys" or Image.Path like "%\\bs\_hwmio64\_w10.sys" or Image.Path like "%\\bsmixp64.sys" or Image.Path like "%\\t8.sys" or Image.Path like "%\\dbk64.sys" or Image.Path like "%\\asrdrv102.sys" or Image.Path like "%\\windows7-32.sys" or Image.Path like "%\\1.sys" or Image.Path like "%\\dh\_kernel.sys" or Image.Path like "%\\ntiolib.sys" or Image.Path like "%\\viragt64.sys" or Image.Path like "%\\lenovodiagnosticsdriver.sys" or Image.Path like "%\\cpuz.sys" or Image.Path like "%\\cpuz141.sys" or Image.Path like "%\\speedfan.sys" or Image.Path like "%\\se64a.sys" or Image.Path like "%\\mtcbsv64.sys" or Image.Path like "%\\tgsafe.sys" or Image.Path like "%\\nvflash.sys" or Image.Path like "%\\nt4.sys" or Image.Path like "%\\irec.sys" or Image.Path like "%\\lha.sys" or Image.Path like "%\\echo\_driver.sys" or Image.Path like "%\\cupfixerx64.sys" or Image.Path like "%\\winio64c.sys" or Image.Path like "%\\dbutil.sys" or Image.Path like "%\\viragt.sys" or Image.Path like "%\\msio32.sys" or Image.Path like "%\\vmdrv.sys" or Image.Path like "%\\pchunter.sys" or Image.Path like "%\\ssport.sys" or Image.Path like "%\\asromgdrv.sys" or Image.Path like "%\\adv64drv.sys" or Image.Path like "%\\superbmc.sys" or Image.Path like "%\\asrdrv10.sys" or Image.Path like "%\\paniox64.sys" or Image.Path like "%\\mydrivers.sys" or Image.Path like "%\\bedaisy.sys" or Image.Path like "%\\aswarpot.sys" or Image.Path like "%\\rwdrv.sys" or Image.Path like "%\\amsdk.sys" or Image.Path like "%\\bs\_def64.sys" or Image.Path like "%\\sysdrv3s.sys" or Image.Path like "%\\openlibsys.sys" or Image.Path like "%\\netflt.sys" or Image.Path like "%\\protects.sys" or Image.Path like "%\\cpuz\_x64.sys" or Image.Path like "%\\bs\_i2c64.sys" or Image.Path like "%\\nvflsh64.sys" or Image.Path like "%\\bsmix64.sys" or Image.Path like "%\\b4.sys" or Image.Path like "%\\bandai.sys" or Image.Path like "%\\bs\_rcio.sys" or Image.Path like "%\\libnicm.sys" or Image.Path like "%\\corsairllaccess64.sys" or Image.Path like "%\\iomap64.sys" or Image.Path like "%\\iomem64.sys" or Image.Path like "%\\wyproxy64.sys" or Image.Path like "%\\full.sys" or Image.Path like "%\\winring0.sys" or Image.Path like "%\\nstr.sys" or Image.Path like "%\\fd3b7234419fafc9bdd533f48896ed73\_b816c5cd.sys" or Image.Path like "%\\iqvw64e.sys" or Image.Path like "%\\netfilterdrv.sys" or Image.Path like "%\\zam64.sys" or Image.Path like "%\\hwos2ec7x64.sys" or Image.Path like "%\\ntiolib\_x64.sys" or Image.Path like "%\\capcom.sys" or Image.Path like "%\\asrautochkupddrv.sys" or Image.Path like "%\\directio.sys" or Image.Path like "%\\windows8-10-32.sys" or Image.Path like "%\\sysinfo.sys" or Image.Path like "%\\panmonflt.sys" or Image.Path like "%\\piddrv64.sys" or Image.Path like "%\\goad.sys"
GenericProperty1 = Image.Path


[ActivityMonitoringRule platform=Windows]
# Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems
# Author: frack113, Christopher Peacock '@securepeacock', SCYTHE '@scythe_io'
RuleId = a29c1813-ab1f-4dde-b489-330b952e91ae
RuleName = Suspicious Network Command
EventType = Process.Start
Tag = proc-start-suspicious-network-command
RiskScore = 25
Annotation = {"mitre_attack": ["T1016"]}
Query = Process.CommandLine like "%ipconfig /all%" or Process.CommandLine like "%netsh interface show interface%" or Process.CommandLine like "%arp -a%" or Process.CommandLine like "%nbtstat -n%" or Process.CommandLine like "%net config%" or Process.CommandLine like "%route print%"


[ActivityMonitoringRule platform=Windows]
# Detects usage of "rar" to add files to an archive for potential compression. An adversary may compress data (e.g. sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.
# Author: Timur Zinniatullin, E.M. Anhaus, oscd.community
RuleId = 6f3e2987-db24-4c78-a860-b4f4095a7095
RuleName = Files Added To An Archive Using Rar.EXE
EventType = Process.Start
Tag = proc-start-files-added-to-an-archive-using-rar.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1560.001"]}
Query = Process.Path like "%\\rar.exe" and Process.CommandLine like "% a %"


[ActivityMonitoringRule platform=Windows]
# Adversaries can carry out malicious operations using a virtual instance to avoid detection. This rule is built to detect the registration of the Virtualbox driver or start of a Virtualbox VM.
# Author: Janantha Marasinghe
RuleId = bab049ca-7471-4828-9024-38279a4c04da
RuleName = Detect Virtualbox Driver Installation OR Starting Of VMs
EventType = Process.Start
Tag = proc-start-detect-virtualbox-driver-installation-or-starting-of-vms
RiskScore = 25
Annotation = {"mitre_attack": ["T1564.006", "T1564"]}
Query = Process.CommandLine like "%VBoxRT.dll,RTR3Init%" or Process.CommandLine like "%VBoxC.dll%" or Process.CommandLine like "%VBoxDrv.sys%" or Process.CommandLine like "%startvm%" or Process.CommandLine like "%controlvm%"


[ActivityMonitoringRule platform=Windows]
# Windows Test Authoring and Execution Framework (TAEF) framework allows you to run automation by executing tests files written on different languages (C, C#, Microsoft COM Scripting interfaces
# Adversaries may execute malicious code (such as WSC file with VBScript, dll and so on) directly by running te.exe
# Author: Agro (@agro_sev) oscd.community
RuleId = 634b00d5-ccc3-4a06-ae3b-0ec8444dd51b
RuleName = Malicious Windows Script Components File Execution by TAEF Detection
EventType = Process.Start
Tag = proc-start-malicious-windows-script-components-file-execution-by-taef-detection
RiskScore = 25
Annotation = {"mitre_attack": ["T1218"]}
Query = Process.Path like "%\\te.exe" or Parent.Path like "%\\te.exe" or Process.Name == "\\te.exe"
GenericProperty1 = Parent.Path


[ActivityMonitoringRule platform=Windows]
# Detects the creation of a file with the ".dmp"/".hdmp" extension. Often created by software during a crash. Memory dumps can sometimes contain sensitive information such as credentials. It's best to determine the source of the crash.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = 3a525307-d100-48ae-b3b9-0964699d7f97
RuleName = DMP/HDMP File Creation
EventType = File.Create
Tag = dmp/hdmp-file-creation
RiskScore = 25
Query = File.Path like "%.dmp" or File.Path like "%.dump" or File.Path like "%.hdmp"
GenericProperty1 = File.Path


[ActivityMonitoringRule platform=Windows]
# Detects changes to the AppInstaller (winget) admin settings. Such as enabling local manifest installations or disabling installer hash checks
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = 6db5eaf9-88f7-4ed9-af7d-9ef2ad12f236
RuleName = Winget Admin Settings Modification
EventType = Reg.Any
Tag = winget-admin-settings-modification
RiskScore = 25
Query = Process.Path like "%\\winget.exe" and Reg.Key.Target like "\\REGISTRY\\A\\%" and Reg.Key.Target like "%\\LocalState\\admin\_settings"
Hive = HKLM,HKU
GenericProperty1 = Reg.Key.Target


[ActivityMonitoringRule platform=Windows]
# Detects file access requests to browser credential stores by uncommon processes.
# Could indicate potential attempt of credential stealing.
# Requires heavy baselining before usage
# Author: frack113
RuleId = 91cb43db-302a-47e3-b3c8-7ede481e27bf
RuleName = Access To Browser Credential Files By Uncommon Application
EventType = File.Read
Tag = access-to-browser-credential-files-by-uncommon-application
RiskScore = 25
Annotation = {"mitre_attack": ["T1003"]}
Query = (File.Path like "%\\Appdata\\Local\\Microsoft\\Windows\\WebCache\\WebCacheV01.dat" or File.Path like "%\\cookies.sqlite" or File.Path like "%release\\key3.db" or File.Path like "%release\\key4.db" or File.Path like "%release\\logins.json" or File.Path like "%\\Appdata\\Local\\Chrome\\User Data\\Default\\Login Data%" or File.Path like "%\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Network\\Cookies%" or File.Path like "%\\AppData\\Local\\Google\\Chrome\\User Data\\Local State%") and not (Process.Path == "System" and Parent.Path == "Idle" or Process.Path like "C:\\Program Files\\%" or Process.Path like "C:\\Program Files (x86)\\%" or Process.Path like "C:\\WINDOWS\\system32\\%" or Process.Path like "C:\\WINDOWS\\SysWOW64\\%") and not (Process.Path like "C:\\ProgramData\\Microsoft\\Windows Defender\\%" and (Process.Path like "%\\MpCopyAccelerator.exe" or Process.Path like "%\\MsMpEng.exe") or Process.Path like "%\\thor64.exe" or Process.Path like "%\\thor.exe" or Parent.Path == "C:\\Windows\\System32\\msiexec.exe")
GenericProperty1 = Parent.Path
GenericProperty2 = File.Path


[ActivityMonitoringRule platform=Windows]
# Detects when a share is mounted using the "net.exe" utility
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = f117933c-980c-4f78-b384-e3d838111165
RuleName = Windows Share Mount Via Net.EXE
EventType = Process.Start
Tag = proc-start-windows-share-mount-via-net.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1021.002"]}
Query = (Process.Path like "%\\net.exe" or Process.Path like "%\\net1.exe" or Process.Name in ["net.exe", "net1.exe"]) and (Process.CommandLine like "% use %" or Process.CommandLine like "% \\\\%")


[ActivityMonitoringRule platform=Windows]
# Detects file access requests to files ending with either the ".hive"/".reg" extension, usually associated with Windows Registry backups.
# Author: frack113
RuleId = 337a31c6-46c4-46be-886a-260d7aa78cac
RuleName = Access To .Reg/.Hive Files By Uncommon Application
EventType = File.Read
Tag = access-to-.reg/.hive-files-by-uncommon-application
RiskScore = 25
Annotation = {"mitre_attack": ["T1112"]}
Query = (File.Path like "%.hive" or File.Path like "%.reg") and not (Process.Path like "%:\\Program Files (x86)\\%" or Process.Path like "%:\\Program Files\\%" or Process.Path like "%:\\Windows\\System32\\%" or Process.Path like "%:\\Windows\\SysWOW64\\%")
GenericProperty1 = File.Path


[ActivityMonitoringRule platform=Windows]
# Detects the stopping of a Windows service
# Author: Jakob Weinzettl, oscd.community, Nasreddine Bencherchali (Nextron Systems)
RuleId = c49c5062-0966-4170-9efd-9968c913a6cf
RuleName = Stop Windows Service Via PowerShell Stop-Service
EventType = Process.Start
Tag = proc-start-stop-windows-service-via-powershell-stop-service
RiskScore = 25
Annotation = {"mitre_attack": ["T1489"]}
Query = (Process.Name in ["PowerShell.EXE", "pwsh.dll"] or Process.Path like "%\\powershell.exe" or Process.Path like "%\\pwsh.exe") and Process.CommandLine like "%Stop-Service %"


[ActivityMonitoringRule platform=Windows]
# Detects attempts to enumerate file shares, printer shares and sessions using "net.exe" with the "view" flag.
# Author: Endgame, JHasenbusch (ported for oscd.community)
RuleId = 62510e69-616b-4078-b371-847da438cc03
RuleName = Share And Session Enumeration Using Net.EXE
EventType = Process.Start
Tag = proc-start-share-and-session-enumeration-using-net.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1018"]}
Query = (Process.Path like "%\\net.exe" or Process.Path like "%\\net1.exe" or Process.Name in ["net.exe", "net1.exe"]) and Process.CommandLine like "%view%" and not Process.CommandLine like "%\\\\%"


[ActivityMonitoringRule platform=Windows]
# Use of reg to get MachineGuid information
# Author: frack113
RuleId = f5240972-3938-4e56-8e4b-e33893176c1f
RuleName = Suspicious Query of MachineGUID
EventType = Process.Start
Tag = proc-start-suspicious-query-of-machineguid
RiskScore = 25
Annotation = {"mitre_attack": ["T1082"]}
Query = Process.Path like "%\\reg.exe" and Process.CommandLine like "%SOFTWARE\\Microsoft\\Cryptography%" and Process.CommandLine like "%/v %" and Process.CommandLine like "%MachineGuid%"


[ActivityMonitoringRule platform=Windows]
# Attackers may leverage fsutil to enumerated connected drives.
# Author: Christopher Peacock '@securepeacock', SCYTHE '@scythe_io'
RuleId = 63de06b9-a385-40b5-8b32-73f2b9ef84b6
RuleName = Fsutil Drive Enumeration
EventType = Process.Start
Tag = proc-start-fsutil-drive-enumeration
RiskScore = 25
Annotation = {"mitre_attack": ["T1120"]}
Query = (Process.Path like "%\\fsutil.exe" or Process.Name == "fsutil.exe") and Process.CommandLine like "%drives%"


[ActivityMonitoringRule platform=Windows]
# Detects the creation of scheduled tasks in user session
# Author: Florian Roth (Nextron Systems)
RuleId = 92626ddd-662c-49e3-ac59-f6535f12d189
RuleName = Scheduled Task Creation
EventType = Process.Start
Tag = proc-start-scheduled-task-creation
RiskScore = 25
Annotation = {"mitre_attack": ["T1053.005"]}
Query = Process.Path like "%\\schtasks.exe" and Process.CommandLine like "% /create %" and not (Process.User like "%AUTHORI%" or Process.User like "%AUTORI%")
GenericProperty1 = Process.User


[ActivityMonitoringRule platform=Windows]
# Detects the execution of regini.exe which can be used to modify registry keys, the changes are imported from one or more text files.
# Author: Eli Salem, Sander Wiebing, oscd.community
RuleId = 5f60740a-f57b-4e76-82a1-15b6ff2cb134
RuleName = Registry Modification Via Regini.EXE
EventType = Process.Start
Tag = proc-start-registry-modification-via-regini.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1112"]}
Query = (Process.Path like "%\\regini.exe" or Process.Name == "REGINI.EXE") and not regex_match(Process.CommandLine, ":[^ \\\\]")


[ActivityMonitoringRule platform=Windows]
# Detects usage of the "systeminfo" command to retrieve information
# Author: frack113
RuleId = 0ef56343-059e-4cb6-adc1-4c3c967c5e46
RuleName = Suspicious Execution of Systeminfo
EventType = Process.Start
Tag = proc-start-suspicious-execution-of-systeminfo
RiskScore = 25
Annotation = {"mitre_attack": ["T1082"]}
Query = Process.Path like "%\\systeminfo.exe" or Process.Name == "sysinfo.exe"


[ActivityMonitoringRule platform=Windows]
# Detects file association changes using the builtin "assoc" command.
# When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened.
# Author: Timur Zinniatullin, oscd.community
RuleId = 3d3aa6cd-6272-44d6-8afc-7e88dfef7061
RuleName = Change Default File Association Via Assoc
EventType = Process.Start
Tag = proc-start-change-default-file-association-via-assoc
RiskScore = 25
Annotation = {"mitre_attack": ["T1546.001"]}
Query = (Process.Path like "%\\cmd.exe" or Process.Name == "Cmd.Exe") and Process.CommandLine like "%assoc%"


[ActivityMonitoringRule platform=Windows]
# Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems
# Author: frack113, Christopher Peacock '@securepeacock', SCYTHE '@scythe_io'
RuleId = 0e4164da-94bc-450d-a7be-a4b176179f1f
RuleName = Suspicious Firewall Configuration Discovery Via Netsh.EXE
EventType = Process.Start
Tag = proc-start-suspicious-firewall-configuration-discovery-via-netsh.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1016"]}
Query = (Process.Path like "%\\netsh.exe" or Process.Name == "netsh.exe") and Process.CommandLine like "%netsh %" and Process.CommandLine like "%show %" and Process.CommandLine like "%firewall %" and (Process.CommandLine like "%config %" or Process.CommandLine like "%state %" or Process.CommandLine like "%rule %" or Process.CommandLine like "%name=all%")


[ActivityMonitoringRule platform=Windows]
# Detects the creation of a new PowerShell module ".psm1", ".psd1", ".dll", ".ps1", etc.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = e36941d0-c0f0-443f-bc6f-cb2952eb69ea
RuleName = PowerShell Module File Created
EventType = File.Create
Tag = powershell-module-file-created
RiskScore = 25
Query = (Process.Path like "%\\powershell.exe" or Process.Path like "%\\pwsh.exe") and (File.Path like "%\\WindowsPowerShell\\Modules\\%" or File.Path like "%\\PowerShell\\7\\Modules\\%")
GenericProperty1 = File.Path


[ActivityMonitoringRule platform=Windows]
# Detect suspicious parent processes of well-known Windows processes
# Author: vburov
RuleId = 96036718-71cc-4027-a538-d1587e0006a7
RuleName = Windows Processes Suspicious Parent Directory
EventType = Process.Start
Tag = proc-start-windows-processes-suspicious-parent-directory
RiskScore = 25
Annotation = {"mitre_attack": ["T1036.003", "T1036.005"]}
Query = (Process.Path like "%\\svchost.exe" or Process.Path like "%\\taskhost.exe" or Process.Path like "%\\lsm.exe" or Process.Path like "%\\lsass.exe" or Process.Path like "%\\services.exe" or Process.Path like "%\\lsaiso.exe" or Process.Path like "%\\csrss.exe" or Process.Path like "%\\wininit.exe" or Process.Path like "%\\winlogon.exe") and not (Parent.Path like "%\\SavService.exe" or Parent.Path like "%\\ngen.exe" or Parent.Path like "%\\System32\\%" or Parent.Path like "%\\SysWOW64\\%" or (Parent.Path like "%\\Windows Defender\\%" or Parent.Path like "%\\Microsoft Security Client\\%") and Parent.Path like "%\\MsMpEng.exe" or isnull(Parent.Path) or Parent.Path == "-")
GenericProperty1 = Parent.Path


[ActivityMonitoringRule platform=Windows]
# Detects creation of a file named "ntds.dit" (Active Directory Database)
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = 0b8baa3f-575c-46ee-8715-d6f28cc7d33c
RuleName = NTDS.DIT Created
EventType = File.Create
Tag = ntds.dit-created
RiskScore = 25
Annotation = {"mitre_attack": ["T1003.003"]}
Query = File.Path like "%ntds.dit"
GenericProperty1 = File.Path


[ActivityMonitoringRule platform=Windows]
# Detects execution of the builtin "del"/"erase" commands in order to delete files.
# Adversaries may delete files left behind by the actions of their intrusion activity.
# Malware, tools, or other non-native files dropped or created on a system by an adversary may leave traces to indicate to what was done within a network and how.
# Removal of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversary's footprint.
# Author: frack113
RuleId = 379fa130-190e-4c3f-b7bc-6c8e834485f3
RuleName = File Deletion Via Del
EventType = Process.Start
Tag = proc-start-file-deletion-via-del
RiskScore = 25
Annotation = {"mitre_attack": ["T1070.004"]}
Query = (Process.Path like "%\\cmd.exe" or Process.Name == "Cmd.Exe") and (Process.CommandLine like "%del %" or Process.CommandLine like "%erase %") and (Process.CommandLine like "% /f%" or Process.CommandLine like "% /s%" or Process.CommandLine like "% /q%")


[ActivityMonitoringRule platform=Windows]
# Detects non-interactive PowerShell activity by looking at the "powershell" process with a non-user GUI process such as "explorer.exe" as a parent.
# Author: Roberto Rodriguez @Cyb3rWard0g (rule), oscd.community (improvements)
RuleId = f4bbd493-b796-416e-bbf2-121235348529
RuleName = Non Interactive PowerShell Process Spawned
EventType = Process.Start
Tag = proc-start-non-interactive-powershell-process-spawned
RiskScore = 25
Annotation = {"mitre_attack": ["T1059.001"]}
Query = (Process.Path like "%\\powershell.exe" or Process.Path like "%\\pwsh.exe" or Process.Name in ["PowerShell.EXE", "pwsh.dll"]) and not (Parent.Path like "%:\\Windows\\explorer.exe" or Parent.Path like "%:\\Windows\\System32\\CompatTelRunner.exe" or Parent.Path like "%:\\Windows\\SysWOW64\\explorer.exe" or Parent.Path == ":\\$WINDOWS.~BT\\Sources\\SetupHost.exe") and not (Parent.Path like "%\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe" and Parent.CommandLine like "% --ms-enable-electron-run-as-node %" or Parent.Path like "%:\\Program Files\\WindowsApps\\Microsoft.WindowsTerminal\_%" and Parent.Path like "%\\WindowsTerminal.exe")
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine


[ActivityMonitoringRule platform=Windows]
# Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation
# Author: oscd.community, @redcanary, Zach Stanford @svch0st
RuleId = cb7c4a03-2871-43c0-9bbb-18bbdb079896
RuleName = Unmount Share Via Net.EXE
EventType = Process.Start
Tag = proc-start-unmount-share-via-net.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1070.005"]}
Query = (Process.Path like "%\\net.exe" or Process.Path like "%\\net1.exe" or Process.Name in ["net.exe", "net1.exe"]) and Process.CommandLine like "%share%" and Process.CommandLine like "%/delete%"


[ActivityMonitoringRule platform=Windows]
# Detects potential DLL sideloading of "7za.dll"
# Author: X__Junior
RuleId = 4f6edb78-5c21-42ab-a558-fd2a6fc1fd57
RuleName = Potential 7za.DLL Sideloading
EventType = Image.Load
Tag = potential-7za.dll-sideloading
RiskScore = 25
Annotation = {"mitre_attack": ["T1574.001", "T1574.002"]}
Query = Image.Path like "%\\7za.dll" and not ((Process.Path like "C:\\Program Files (x86)\\%" or Process.Path like "C:\\Program Files\\%") and (Image.Path like "C:\\Program Files (x86)\\%" or Image.Path like "C:\\Program Files\\%"))
GenericProperty1 = Image.Path


[ActivityMonitoringRule platform=Windows]
# Detects the execution of clip.exe in order to copy data to the clipboard. Adversaries may collect data stored in the clipboard from users copying information within or between applications.
# Author: frack113
RuleId = ddeff553-5233-4ae9-bbab-d64d2bd634be
RuleName = Data Copied To Clipboard Via Clip.EXE
EventType = Process.Start
Tag = proc-start-data-copied-to-clipboard-via-clip.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1115"]}
Query = Process.Path like "%\\clip.exe" or Process.Name == "clip.exe"


[ActivityMonitoringRule platform=Windows]
# Detects the stopping of a Windows service
# Author: Jakob Weinzettl, oscd.community, Nasreddine Bencherchali (Nextron Systems)
RuleId = 88872991-7445-4a22-90b2-a3adadb0e827
RuleName = Stop Windows Service Via Net.EXE
EventType = Process.Start
Tag = proc-start-stop-windows-service-via-net.exe
RiskScore = 25
Annotation = {"mitre_attack": ["T1489"]}
Query = (Process.Name in ["net.exe", "net1.exe"] or Process.Path like "%\\net.exe" or Process.Path like "%\\net1.exe") and Process.CommandLine like "% stop %"

