
#
# The rules are generated from the Sigma GitHub repository at https://github.com/SigmaHQ/sigma
# To generate the ruleset, please follow the instructions provided in the repository: https://github.com/vastlimits/pySigma-backend-uberAgent/
#
# The command used to generate the ruleset is:
#    sigma convert -s -f conf -p uberagent-develop -O backend_version=develop -t uberagent /home/runner/work/uberAgent-config/uberAgent-config/build/sigma-critical-windows >> uberAgent-ESA-am-sigma-critical-windows.conf
#

[ThreatDetectionRule platform=Windows]
# Detects activity observed by different researchers to be HAFNIUM group activity (or related) on Exchange servers
# Author: Florian Roth (Nextron Systems)
RuleId = bbb2dedd-a0e3-46ab-ba6c-6c82ae7a9aa7
RuleName = HAFNIUM Exchange Exploitation Activity
EventType = Process.Start
Tag = proc-start-hafnium-exchange-exploitation-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1546", "T1053"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.CommandLine like r"%attrib%" and Process.CommandLine like r"% +h %" and Process.CommandLine like r"% +s %" and Process.CommandLine like r"% +r %" and Process.CommandLine like r"%.aspx%" or Process.Path like r"%\\ProgramData\\VSPerfMon\\%" or Process.CommandLine like r"%schtasks%" and Process.CommandLine like r"%VSPerfMon%" or Process.Path like r"%Opera\_browser.exe" and (Parent.Path like r"%\\services.exe" or Parent.Path like r"%\\svchost.exe") or Process.Path like r"%Users\\Public\\opera\\Opera\_browser.exe" or Process.CommandLine like r"%vssadmin list shadows%" and Process.CommandLine like r"%Temp\\\_\_output%" or Process.Path like r"%\\makecab.exe" and Process.CommandLine like r"%inetpub\\wwwroot\\%" and Process.CommandLine like r"%.dmp.zip%" or Process.Path like r"%\\makecab.exe" and (Process.CommandLine like r"%Microsoft\\Exchange Server\\%" or Process.CommandLine like r"%compressionmemory%" or Process.CommandLine like r"%.gif%") or Process.CommandLine like r"% -t7z %" and Process.CommandLine like r"%C:\\Programdata\\pst%" and Process.CommandLine like r"%\\it.zip%" or Process.CommandLine like r"%\\comsvcs.dll%" and Process.CommandLine like r"%Minidump%" and Process.CommandLine like r"%full %" and Process.CommandLine like r"%\\inetpub\\wwwroot%" or Process.CommandLine like r"%Windows\\Temp\\xx.bat%" or Process.CommandLine like r"%Windows\\WwanSvcdcs%" or Process.CommandLine like r"%Windows\\Temp\\cw.exe%"
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects a program that invoked suspicious DNS queries known from Cobalt Strike beacons
# Author: Florian Roth (Nextron Systems)
RuleId = f356a9c4-effd-4608-bbf8-408afd5cd006
RuleName = Suspicious Cobalt Strike DNS Beaconing - Sysmon
EventType = Dns.Query
Tag = suspicious-cobalt-strike-dns-beaconing-sysmon
RiskScore = 100
Annotation = {"mitre_attack": ["T1071.004"], "author": "Florian Roth (Nextron Systems)"}
Query = Dns.QueryRequest like r"aaa.stage.%" or Dns.QueryRequest like r"post.1%" or Dns.QueryRequest like r"%.stage.123456.%"
GenericProperty1 = Dns.QueryRequest


[ThreatDetectionRule platform=Windows]
# Detects the presence and execution of Inveigh via dropped artefacts
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = bb09dd3e-2b78-4819-8e35-a7c1b874e449
RuleName = HackTool - Inveigh Execution Artefacts
EventType = File.Create
Tag = hacktool-inveigh-execution-artefacts
RiskScore = 100
Annotation = {"mitre_attack": ["T1219.002"], "author": "Nasreddine Bencherchali (Nextron Systems)"}
Query = File.Path like r"%\\Inveigh-Log.txt" or File.Path like r"%\\Inveigh-Cleartext.txt" or File.Path like r"%\\Inveigh-NTLMv1Users.txt" or File.Path like r"%\\Inveigh-NTLMv2Users.txt" or File.Path like r"%\\Inveigh-NTLMv1.txt" or File.Path like r"%\\Inveigh-NTLMv2.txt" or File.Path like r"%\\Inveigh-FormInput.txt" or File.Path like r"%\\Inveigh.dll" or File.Path like r"%\\Inveigh.exe" or File.Path like r"%\\Inveigh.ps1" or File.Path like r"%\\Inveigh-Relay.ps1"
GenericProperty1 = File.Path


[ThreatDetectionRule platform=Windows]
# Detects process command line patterns and locations used by REvil group in Kaseya incident (can also match on other malware)
# Author: Florian Roth (Nextron Systems)
RuleId = 5de632bc-7fbd-4c8a-944a-fce55c59eae5
RuleName = REvil Kaseya Incident Malware Patterns
EventType = Process.Start
Tag = proc-start-revil-kaseya-incident-malware-patterns
RiskScore = 100
Annotation = {"mitre_attack": ["T1059"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.CommandLine like r"%C:\\Windows\\cert.exe%" or Process.CommandLine like r"%del /q /f c:\\kworking\\agent.crt%" or Process.CommandLine like r"%Kaseya VSA Agent Hot-fix%" or Process.CommandLine like r"%\\AppData\\Local\\Temp\\MsMpEng.exe%" or Process.CommandLine like r"%rmdir /s /q \%SystemDrive\%\\inetpub\\logs%" or Process.CommandLine like r"%del /s /q /f \%SystemDrive\%\\%.log%" or Process.CommandLine like r"%c:\\kworking1\\agent.exe%" or Process.CommandLine like r"%c:\\kworking1\\agent.crt%" or Process.Path in ["C:\\Windows\\MsMpEng.exe", "C:\\Windows\\cert.exe", "C:\\kworking\\agent.exe", "C:\\kworking1\\agent.exe"] or Process.CommandLine like r"%del /s /q /f%" and Process.CommandLine like r"%WebPages\\Errors\\webErrorLog.txt%"


[ThreatDetectionRule platform=Windows]
# Detects specific process characteristics of Winnti malware noticed in Dec/Jan 2020 in a campaign against Honk Kong universities
# Author: Florian Roth (Nextron Systems), Markus Neis
RuleId = 3121461b-5aa0-4a41-b910-66d25524edbb
RuleName = Winnti Malware HK University Campaign
EventType = Process.Start
Tag = proc-start-winnti-malware-hk-university-campaign
RiskScore = 100
Annotation = {"mitre_attack": ["T1574.001"], "author": "Florian Roth (Nextron Systems), Markus Neis"}
Query = (Parent.Path like r"%C:\\Windows\\Temp%" or Parent.Path like r"%\\hpqhvind.exe%") and Process.Path like r"C:\\ProgramData\\DRM%" or Parent.Path like r"C:\\ProgramData\\DRM%" and Process.Path like r"%\\wmplayer.exe" or Parent.Path like r"%\\Test.exe" and Process.Path like r"%\\wmplayer.exe" or Process.Path == "C:\\ProgramData\\DRM\\CLR\\CLR.exe" or Parent.Path like r"C:\\ProgramData\\DRM\\Windows%" and Process.Path like r"%\\SearchFilterHost.exe"
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects specific process characteristics of Winnti Pipemon malware reported by ESET
# Author: Florian Roth (Nextron Systems), oscd.community
RuleId = 73d70463-75c9-4258-92c6-17500fe972f2
RuleName = Winnti Pipemon Characteristics
EventType = Process.Start
Tag = proc-start-winnti-pipemon-characteristics
RiskScore = 100
Annotation = {"mitre_attack": ["T1574.001"], "author": "Florian Roth (Nextron Systems), oscd.community"}
Query = Process.CommandLine like r"%setup0.exe -p%" or Process.CommandLine like r"%setup.exe%" and (Process.CommandLine like r"%-x:0" or Process.CommandLine like r"%-x:1" or Process.CommandLine like r"%-x:2")


[ThreatDetectionRule platform=Windows]
# Detects DLL load activity of known compromised DLLs used in by the compromised 3CXDesktopApp
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = d0b65ad3-e945-435e-a7a9-438e62dd48e9
RuleName = Malicious DLL Load By Compromised 3CXDesktopApp
EventType = Image.Load
Tag = malicious-dll-load-by-compromised-3cxdesktopapp
RiskScore = 100
Annotation = {"author": "Nasreddine Bencherchali (Nextron Systems)"}
Query = Image.Hashes like r"%SHA256=7986BBAEE8940DA11CE089383521AB420C443AB7B15ED42AED91FD31CE833896%" or Image.Hashes like r"%SHA1=BF939C9C261D27EE7BB92325CC588624FCA75429%" or Image.Hashes like r"%MD5=74BC2D0B6680FAA1A5A76B27E5479CBC%" or Image.Hashes like r"%SHA256=11BE1803E2E307B647A8A7E02D128335C448FF741BF06BF52B332E0BBF423B03%" or Image.Hashes like r"%SHA1=20D554A80D759C50D6537DD7097FED84DD258B3E%" or Image.Hashes like r"%MD5=82187AD3F0C6C225E2FBA0C867280CC9%" or Image.Hashes like r"%SHA256=F79C3B0ADB6EC7BCC8BC9AE955A1571AAED6755A28C8B17B1D7595EE86840952%" or Image.Hashes like r"%SHA1=894E7D4FFD764BB458809C7F0643694B036EAD30%" or Image.Hashes like r"%MD5=11BC82A9BD8297BD0823BCE5D6202082%" or Image.Hashes like r"%SHA256=8AB3A5EAAF8C296080FADF56B265194681D7DA5DA7C02562953A4CB60E147423%" or Image.Hashes like r"%SHA1=3B3E778B647371262120A523EB873C20BB82BEAF%" or Image.Hashes like r"%MD5=7FAEA2B01796B80D180399040BB69835%"
GenericProperty1 = Image.Hashes


[ThreatDetectionRule platform=Windows]
# Detects the creation of the default output filename used by the wmiexec tool
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = 8d5aca11-22b3-4f22-b7ba-90e60533e1fb
RuleName = Wmiexec Default Output File
EventType = File.Create
Tag = wmiexec-default-output-file
RiskScore = 100
Annotation = {"mitre_attack": ["T1047"], "author": "Nasreddine Bencherchali (Nextron Systems)"}
Query = File.Path regex "\\\\Windows\\\\__1\\d{9}\\.\\d{1,7}$" or File.Path regex "C:\\\\__1\\d{9}\\.\\d{1,7}$" or File.Path regex "D:\\\\__1\\d{9}\\.\\d{1,7}$"
GenericProperty1 = File.Path


[ThreatDetectionRule platform=Windows]
# Detects patterns as noticed in exploitation of Serv-U CVE-2021-35211 vulnerability by threat group DEV-0322
# Author: Florian Roth (Nextron Systems)
RuleId = 75578840-9526-4b2a-9462-af469a45e767
RuleName = Serv-U Exploitation CVE-2021-35211 by DEV-0322
EventType = Process.Start
Tag = proc-start-serv-u-exploitation-cve-2021-35211-by-dev-0322
RiskScore = 100
Annotation = {"mitre_attack": ["T1136.001"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.CommandLine like r"%whoami%" and (Process.CommandLine like r"%./Client/Common/%" or Process.CommandLine like r"%.\\Client\\Common\\%" or Process.CommandLine like r"%C:\\Windows\\Temp\\Serv-U.bat%")


[ThreatDetectionRule platform=Windows]
# Detects APT31 Judgement Panda activity as described in the Crowdstrike 2019 Global Threat Report
# Author: Florian Roth (Nextron Systems)
RuleId = 03e2746e-2b31-42f1-ab7a-eb39365b2422
RuleName = APT31 Judgement Panda Activity
EventType = Process.Start
Tag = proc-start-apt31-judgement-panda-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1003.001", "T1560.001"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.CommandLine like r"%ldifde%" and Process.CommandLine like r"%-f -n%" and Process.CommandLine like r"%eprod.ldf%" or Process.CommandLine like r"%copy \\\\%" and Process.CommandLine like r"%c$%" and (Process.CommandLine like r"%\\aaaa\\procdump64.exe%" or Process.CommandLine like r"%\\aaaa\\netsess.exe%" or Process.CommandLine like r"%\\aaaa\\7za.exe%" or Process.CommandLine like r"%\\c$\\aaaa\\%")


[ThreatDetectionRule platform=Windows]
# Detects the execution of different Windows based hacktools via their import hash (imphash) even if the files have been renamed
# Author: Florian Roth (Nextron Systems)
RuleId = 24e3e58a-646b-4b50-adef-02ef935b9fc8
RuleName = Hacktool Execution - Imphash
EventType = Process.Start
Tag = proc-start-hacktool-execution-imphash
RiskScore = 100
Annotation = {"mitre_attack": ["T1588.002", "T1003"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.Hashes like r"%IMPHASH=BCCA3C247B619DCD13C8CDFF5F123932%" or Process.Hashes like r"%IMPHASH=3A19059BD7688CB88E70005F18EFC439%" or Process.Hashes like r"%IMPHASH=bf6223a49e45d99094406777eb6004ba%" or Process.Hashes like r"%IMPHASH=23867A89C2B8FC733BE6CF5EF902F2D1%" or Process.Hashes like r"%IMPHASH=A37FF327F8D48E8A4D2F757E1B6E70BC%" or Process.Hashes like r"%IMPHASH=F9A28C458284584A93B14216308D31BD%" or Process.Hashes like r"%IMPHASH=6118619783FC175BC7EBECFF0769B46E%" or Process.Hashes like r"%IMPHASH=959A83047E80AB68B368FDB3F4C6E4EA%" or Process.Hashes like r"%IMPHASH=563233BFA169ACC7892451F71AD5850A%" or Process.Hashes like r"%IMPHASH=87575CB7A0E0700EB37F2E3668671A08%" or Process.Hashes like r"%IMPHASH=13F08707F759AF6003837A150A371BA1%" or Process.Hashes like r"%IMPHASH=1781F06048A7E58B323F0B9259BE798B%" or Process.Hashes like r"%IMPHASH=233F85F2D4BC9D6521A6CAAE11A1E7F5%" or Process.Hashes like r"%IMPHASH=24AF2584CBF4D60BBE5C6D1B31B3BE6D%" or Process.Hashes like r"%IMPHASH=632969DDF6DBF4E0F53424B75E4B91F2%" or Process.Hashes like r"%IMPHASH=713C29B396B907ED71A72482759ED757%" or Process.Hashes like r"%IMPHASH=749A7BB1F0B4C4455949C0B2BF7F9E9F%" or Process.Hashes like r"%IMPHASH=8628B2608957A6B0C6330AC3DE28CE2E%" or Process.Hashes like r"%IMPHASH=8B114550386E31895DFAB371E741123D%" or Process.Hashes like r"%IMPHASH=94CB940A1A6B65BED4D5A8F849CE9793%" or Process.Hashes like r"%IMPHASH=9D68781980370E00E0BD939EE5E6C141%" or Process.Hashes like r"%IMPHASH=B18A1401FF8F444056D29450FBC0A6CE%" or Process.Hashes like r"%IMPHASH=CB567F9498452721D77A451374955F5F%" or Process.Hashes like r"%IMPHASH=730073214094CD328547BF1F72289752%" or Process.Hashes like r"%IMPHASH=17B461A082950FC6332228572138B80C%" or Process.Hashes like r"%IMPHASH=DC25EE78E2EF4D36FAA0BADF1E7461C9%" or Process.Hashes like r"%IMPHASH=819B19D53CA6736448F9325A85736792%" or Process.Hashes like r"%IMPHASH=829DA329CE140D873B4A8BDE2CBFAA7E%" or Process.Hashes like r"%IMPHASH=C547F2E66061A8DFFB6F5A3FF63C0A74%" or Process.Hashes like r"%IMPHASH=0588081AB0E63BA785938467E1B10CCA%" or Process.Hashes like r"%IMPHASH=0D9EC08BAC6C07D9987DFD0F1506587C%" or Process.Hashes like r"%IMPHASH=BC129092B71C89B4D4C8CDF8EA590B29%" or Process.Hashes like r"%IMPHASH=4DA924CF622D039D58BCE71CDF05D242%" or Process.Hashes like r"%IMPHASH=E7A3A5C377E2D29324093377D7DB1C66%" or Process.Hashes like r"%IMPHASH=9A9DBEC5C62F0380B4FA5FD31DEFFEDF%" or Process.Hashes like r"%IMPHASH=AF8A3976AD71E5D5FDFB67DDB8DADFCE%" or Process.Hashes like r"%IMPHASH=0C477898BBF137BBD6F2A54E3B805FF4%" or Process.Hashes like r"%IMPHASH=0CA9F02B537BCEA20D4EA5EB1A9FE338%" or Process.Hashes like r"%IMPHASH=3AB3655E5A14D4EEFC547F4781BF7F9E%" or Process.Hashes like r"%IMPHASH=E6F9D5152DA699934B30DAAB206471F6%" or Process.Hashes like r"%IMPHASH=3AD59991CCF1D67339B319B15A41B35D%" or Process.Hashes like r"%IMPHASH=FFDD59E0318B85A3E480874D9796D872%" or Process.Hashes like r"%IMPHASH=0CF479628D7CC1EA25EC7998A92F5051%" or Process.Hashes like r"%IMPHASH=07A2D4DCBD6CB2C6A45E6B101F0B6D51%" or Process.Hashes like r"%IMPHASH=D6D0F80386E1380D05CB78E871BC72B1%" or Process.Hashes like r"%IMPHASH=38D9E015591BBFD4929E0D0F47FA0055%" or Process.Hashes like r"%IMPHASH=0E2216679CA6E1094D63322E3412D650%" or Process.Hashes like r"%IMPHASH=ADA161BF41B8E5E9132858CB54CAB5FB%" or Process.Hashes like r"%IMPHASH=2A1BC4913CD5ECB0434DF07CB675B798%" or Process.Hashes like r"%IMPHASH=11083E75553BAAE21DC89CE8F9A195E4%" or Process.Hashes like r"%IMPHASH=A23D29C9E566F2FA8FFBB79267F5DF80%" or Process.Hashes like r"%IMPHASH=4A07F944A83E8A7C2525EFA35DD30E2F%" or Process.Hashes like r"%IMPHASH=767637C23BB42CD5D7397CF58B0BE688%" or Process.Hashes like r"%IMPHASH=14C4E4C72BA075E9069EE67F39188AD8%" or Process.Hashes like r"%IMPHASH=3C782813D4AFCE07BBFC5A9772ACDBDC%" or Process.Hashes like r"%IMPHASH=7D010C6BB6A3726F327F7E239166D127%" or Process.Hashes like r"%IMPHASH=89159BA4DD04E4CE5559F132A9964EB3%" or Process.Hashes like r"%IMPHASH=6F33F4A5FC42B8CEC7314947BD13F30F%" or Process.Hashes like r"%IMPHASH=5834ED4291BDEB928270428EBBAF7604%" or Process.Hashes like r"%IMPHASH=5A8A8A43F25485E7EE1B201EDCBC7A38%" or Process.Hashes like r"%IMPHASH=DC7D30B90B2D8ABF664FBED2B1B59894%" or Process.Hashes like r"%IMPHASH=41923EA1F824FE63EA5BEB84DB7A3E74%" or Process.Hashes like r"%IMPHASH=3DE09703C8E79ED2CA3F01074719906B%" or Process.Hashes like r"%IMPHASH=A53A02B997935FD8EEDCB5F7ABAB9B9F%" or Process.Hashes like r"%IMPHASH=E96A73C7BF33A464C510EDE582318BF2%" or Process.Hashes like r"%IMPHASH=32089B8851BBF8BC2D014E9F37288C83%" or Process.Hashes like r"%IMPHASH=09D278F9DE118EF09163C6140255C690%" or Process.Hashes like r"%IMPHASH=03866661686829d806989e2fc5a72606%" or Process.Hashes like r"%IMPHASH=e57401fbdadcd4571ff385ab82bd5d6d%" or Process.Hashes like r"%IMPHASH=84B763C45C0E4A3E7CA5548C710DB4EE%" or Process.Hashes like r"%IMPHASH=19584675D94829987952432E018D5056%" or Process.Hashes like r"%IMPHASH=330768A4F172E10ACB6287B87289D83B%" or Process.Hashes like r"%IMPHASH=885C99CCFBE77D1CBFCB9C4E7C1A3313%" or Process.Hashes like r"%IMPHASH=22A22BC9E4E0D2F189F1EA01748816AC%" or Process.Hashes like r"%IMPHASH=7FA30E6BB7E8E8A69155636E50BF1B28%" or Process.Hashes like r"%IMPHASH=96DF3A3731912449521F6F8D183279B1%" or Process.Hashes like r"%IMPHASH=7E6CF3FF4576581271AC8A313B2AAB46%" or Process.Hashes like r"%IMPHASH=51791678F351C03A0EB4E2A7B05C6E17%" or Process.Hashes like r"%IMPHASH=25CE42B079282632708FC846129E98A5%" or Process.Hashes like r"%IMPHASH=021BCCA20BA3381B11BDDE26B4E62F20%" or Process.Hashes like r"%IMPHASH=59223B5F52D8799D38E0754855CBDF42%" or Process.Hashes like r"%IMPHASH=81E75D8F1D276C156653D3D8813E4A43%" or Process.Hashes like r"%IMPHASH=17244E8B6B8227E57FE709CCAD421420%" or Process.Hashes like r"%IMPHASH=5B76DA3ACDEDC8A5CDF23A798B5936B4%" or Process.Hashes like r"%IMPHASH=CB2B65BB77D995CC1C0E5DF1C860133C%" or Process.Hashes like r"%IMPHASH=40445337761D80CF465136FAFB1F63E6%" or Process.Hashes like r"%IMPHASH=8A790F401B29FA87BC1E56F7272B3AA6%" or Process.Hashes like r"%IMPHASH=B50199E952C875241B9CE06C971CE3C1%"
GenericProperty1 = Process.Hashes


[ThreatDetectionRule platform=Windows]
# Detects specific process tree behavior of a "rundll32" execution with exports linked with Qakbot activity.
# Author: X__Junior (Nextron Systems)
RuleId = 339ed3d6-5490-46d0-96a7-8abe33078f58
RuleName = Qakbot Rundll32 Exports Execution
EventType = Process.Start
Tag = proc-start-qakbot-rundll32-exports-execution
RiskScore = 100
Annotation = {"author": "X__Junior (Nextron Systems)"}
Query = (Parent.Path like r"%\\cmd.exe" or Parent.Path like r"%\\cscript.exe" or Parent.Path like r"%\\curl.exe" or Parent.Path like r"%\\mshta.exe" or Parent.Path like r"%\\powershell.exe" or Parent.Path like r"%\\pwsh.exe" or Parent.Path like r"%\\wscript.exe") and Process.Path like r"%\\rundll32.exe" and (Process.CommandLine like r"%:\\ProgramData\\%" or Process.CommandLine like r"%:\\Users\\Public\\%" or Process.CommandLine like r"%\\AppData\\Local\\Temp\\%" or Process.CommandLine like r"%\\AppData\\Roaming\\%") and (Process.CommandLine like r"%aslr" or Process.CommandLine like r"%bind" or Process.CommandLine like r"%DrawThemeIcon" or Process.CommandLine like r"%GG10" or Process.CommandLine like r"%GL70" or Process.CommandLine like r"%jhbvygftr" or Process.CommandLine like r"%kjhbhkjvydrt" or Process.CommandLine like r"%LS88" or Process.CommandLine like r"%Motd" or Process.CommandLine like r"%N115" or Process.CommandLine like r"%next" or Process.CommandLine like r"%Nikn" or Process.CommandLine like r"%print" or Process.CommandLine like r"%qqqb" or Process.CommandLine like r"%qqqq" or Process.CommandLine like r"%RS32" or Process.CommandLine like r"%Test" or Process.CommandLine like r"%Time" or Process.CommandLine like r"%Updt" or Process.CommandLine like r"%vips" or Process.CommandLine like r"%Wind" or Process.CommandLine like r"%WW50" or Process.CommandLine like r"%X555" or Process.CommandLine like r"%XL55" or Process.CommandLine like r"%xlAutoOpen" or Process.CommandLine like r"%XS88")
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects usage of the powerShell New-MailboxExportRequest Cmdlet to exports a mailbox to a remote or local share, as used in ProxyShell exploitations
# Author: Florian Roth (Nextron Systems)
RuleId = 889719ef-dd62-43df-86c3-768fb08dc7c0
RuleName = Suspicious PowerShell Mailbox Export to Share
EventType = Process.Start
Tag = proc-start-suspicious-powershell-mailbox-export-to-share
RiskScore = 100
Annotation = {"author": "Florian Roth (Nextron Systems)"}
Query = Process.CommandLine like r"%New-MailboxExportRequest%" and Process.CommandLine like r"% -Mailbox %" and Process.CommandLine like r"% -FilePath \\\\%"


[ThreatDetectionRule platform=Windows]
# Detects changes to the Registry in which a monitor program gets registered to dump the memory of the lsass.exe process
# Author: Florian Roth (Nextron Systems)
RuleId = 55e29995-75e7-451a-bef0-6225e2f13597
RuleName = Potential Credential Dumping Via LSASS SilentProcessExit Technique
EventType = Reg.Any
Tag = potential-credential-dumping-via-lsass-silentprocessexit-technique
RiskScore = 100
Annotation = {"mitre_attack": ["T1003.001"], "author": "Florian Roth (Nextron Systems)"}
Query = Reg.TargetObject like r"%Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\lsass.exe%"
Hive = HKLM,HKU
GenericProperty1 = Reg.TargetObject


[ThreatDetectionRule platform=Windows]
# Detects Rorschach ransomware execution activity
# Author: X__Junior (Nextron Systems)
RuleId = 0e9e6c63-1350-48c4-9fa1-7ccb235edc68
RuleName = Rorschach Ransomware Execution Activity
EventType = Process.Start
Tag = proc-start-rorschach-ransomware-execution-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1059.003", "T1059.001"], "author": "X__Junior (Nextron Systems)"}
Query = (Process.Path like r"%\\bcdedit.exe" or Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe" or Process.Path like r"%\\netsh.exe" or Process.Path like r"%\\wevtutil.exe" or Process.Path like r"%\\vssadmin.exe") and Process.CommandLine like r"%11111111%"


[ThreatDetectionRule platform=Windows]
# Detects the creation of the default dump file used by Outflank Dumpert tool. A process dumper, which dumps the lsass process memory
# Author: Florian Roth (Nextron Systems)
RuleId = 93d94efc-d7ad-4161-ad7d-1638c4f908d8
RuleName = HackTool - Dumpert Process Dumper Default File
EventType = File.Create
Tag = hacktool-dumpert-process-dumper-default-file
RiskScore = 100
Annotation = {"mitre_attack": ["T1003.001"], "author": "Florian Roth (Nextron Systems)"}
Query = File.Path like r"%dumpert.dmp"
GenericProperty1 = File.Path


[ThreatDetectionRule platform=Windows]
# Detects potential DLL hijack of "iertutil.dll" found in the DCOM InternetExplorer.Application Class
# Author: Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR), wagga
RuleId = f354eba5-623b-450f-b073-0b5b2773b6aa
RuleName = Potential DCOM InternetExplorer.Application DLL Hijack - Image Load
EventType = Image.Load
Tag = potential-dcom-internetexplorer.application-dll-hijack-image-load
RiskScore = 100
Annotation = {"mitre_attack": ["T1021.002", "T1021.003"], "author": "Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR), wagga"}
Query = Process.Path like r"%\\Internet Explorer\\iexplore.exe" and Image.Path like r"%\\Internet Explorer\\iertutil.dll"
GenericProperty1 = Image.Path


[ThreatDetectionRule platform=Windows]
# Detects a specific command used by the Conti ransomware group
# Author: frack113
RuleId = 689308fc-cfba-4f72-9897-796c1dc61487
RuleName = Potential Conti Ransomware Activity
EventType = Process.Start
Tag = proc-start-potential-conti-ransomware-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1486"], "author": "frack113"}
Query = Process.CommandLine like r"%-m %" and Process.CommandLine like r"%-net %" and Process.CommandLine like r"%-size %" and Process.CommandLine like r"%-nomutex %" and Process.CommandLine like r"%-p \\\\%" and Process.CommandLine like r"%$%"


[ThreatDetectionRule platform=Windows]
# Detects commands used by Turla group as reported by ESET in May 2020
# Author: Florian Roth (Nextron Systems)
RuleId = 9e2e51c5-c699-4794-ba5a-29f5da40ac0c
RuleName = Turla Group Commands May 2020
EventType = Process.Start
Tag = proc-start-turla-group-commands-may-2020
RiskScore = 100
Annotation = {"mitre_attack": ["T1059.001", "T1053.005", "T1027"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.CommandLine like r"%tracert -h 10 yahoo.com%" or Process.CommandLine like r"%.WSqmCons))|iex;%" or Process.CommandLine like r"%Fr`omBa`se6`4Str`ing%" or Process.CommandLine like r"%net use https://docs.live.net%" and Process.CommandLine like r"%@aol.co.uk%"


[ThreatDetectionRule platform=Windows]
# Detects the use of Windows Credential Editor (WCE), a popular post-exploitation tool used to extract plaintext passwords, hash, PIN code and Kerberos tickets from memory.
# It is often used by threat actors for credential dumping and lateral movement within compromised networks.
# Author: Florian Roth (Nextron Systems)
RuleId = 7aa7009a-28b9-4344-8c1f-159489a390df
RuleName = HackTool - Windows Credential Editor (WCE) Execution
EventType = Process.Start
Tag = proc-start-hacktool-windows-credential-editor-(wce)-execution
RiskScore = 100
Annotation = {"mitre_attack": ["T1003.001"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.Path like r"%\\WCE.exe" or Process.Path like r"%\\WCE64.exe" or Process.Hashes like r"%IMPHASH=136F0A8572C058A96436C82E541E4C41%" or Process.Hashes like r"%IMPHASH=589657C64DDE88533186C39F82FA1F50%" or Process.Hashes like r"%IMPHASH=6BFE09EFCB4FFDE061EBDBAFC4DB84CF%" or Process.Hashes like r"%IMPHASH=7D490037BF450877E6D0287BDCFF8D2E%" or Process.Hashes like r"%IMPHASH=8AB93B061287C79F3088C5BC7E7D97ED%" or Process.Hashes like r"%IMPHASH=A53A02B997935FD8EEDCB5F7ABAB9B9F%" or Process.Hashes like r"%IMPHASH=BA434A7A729EEC20E136CA4C32D6C740%" or Process.Hashes like r"%IMPHASH=BD1D1547DA13C0FCB6C15E86217D5EB8%" or Process.Hashes like r"%IMPHASH=E96A73C7BF33A464C510EDE582318BF2%"
GenericProperty1 = Process.Hashes


[ThreatDetectionRule platform=Windows]
# Detects an exploitation attempt of SystemNightmare in order to obtain a shell as LOCAL_SYSTEM
# Author: Florian Roth (Nextron Systems)
RuleId = c01f7bd6-0c1d-47aa-9c61-187b91273a16
RuleName = Potential SystemNightmare Exploitation Attempt
EventType = Process.Start
Tag = proc-start-potential-systemnightmare-exploitation-attempt
RiskScore = 100
Annotation = {"mitre_attack": ["T1068"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.CommandLine like r"%printnightmare.gentilkiwi.com%" or Process.CommandLine like r"% /user:gentilguest %" or Process.CommandLine like r"%Kiwi Legit Printer%"


[ThreatDetectionRule platform=Windows]
# Detects suspicious child processes of the Veeam service process. This could indicate potential RCE or SQL Injection.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = d55b793d-f847-4eea-b59a-5ab09908ac90
RuleName = Suspicious Child Process Of Veeam Dabatase
EventType = Process.Start
Tag = proc-start-suspicious-child-process-of-veeam-dabatase
RiskScore = 100
Annotation = {"author": "Nasreddine Bencherchali (Nextron Systems)"}
Query = Parent.Path like r"%\\sqlservr.exe" and Parent.CommandLine like r"%VEEAMSQL%" and ((Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\wsl.exe" or Process.Path like r"%\\wt.exe") and (Process.CommandLine like r"%-ex %" or Process.CommandLine like r"%bypass%" or Process.CommandLine like r"%cscript%" or Process.CommandLine like r"%DownloadString%" or Process.CommandLine like r"%http://%" or Process.CommandLine like r"%https://%" or Process.CommandLine like r"%mshta%" or Process.CommandLine like r"%regsvr32%" or Process.CommandLine like r"%rundll32%" or Process.CommandLine like r"%wscript%" or Process.CommandLine like r"%copy %") or Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe" or Process.Path like r"%\\netstat.exe" or Process.Path like r"%\\nltest.exe" or Process.Path like r"%\\ping.exe" or Process.Path like r"%\\tasklist.exe" or Process.Path like r"%\\whoami.exe")
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine


[ThreatDetectionRule platform=Windows]
# Detects patterns as noticed in exploitation of Windows CVE-2021-31979 CVE-2021-33771 vulnerability and DevilsTongue malware by threat group Sourgum
# Author: Sittikorn S
RuleId = ad7085ac-92e4-4b76-8ce2-276d2c0e68ef
RuleName = CVE-2021-31979 CVE-2021-33771 Exploits by Sourgum
EventType = File.Create
Tag = cve-2021-31979-cve-2021-33771-exploits-by-sourgum
RiskScore = 100
Annotation = {"mitre_attack": ["T1566", "T1203"], "author": "Sittikorn S"}
Query = File.Path like r"%C:\\Windows\\system32\\physmem.sys%" or File.Path like r"%C:\\Windows\\System32\\IME\\IMEJP\\imjpueact.dll%" or File.Path like r"%C:\\Windows\\system32\\ime\\IMETC\\IMTCPROT.DLL%" or File.Path like r"%C:\\Windows\\system32\\ime\\SHARED\\imecpmeid.dll%" or File.Path like r"%C:\\Windows\\system32\\config\\spp\\ServiceState\\Recovery\\pac.dat%" or File.Path like r"%C:\\Windows\\system32\\config\\cy-GB\\Setup\\SKB\\InputMethod\\TupTask.dat%" or File.Path like r"%C:\\Windows\\system32\\config\\config\\startwus.dat%" or File.Path like r"%C:\\Windows\\system32\\ime\\SHARED\\WimBootConfigurations.ini%" or File.Path like r"%C:\\Windows\\system32\\ime\\IMEJP\\WimBootConfigurations.ini%" or File.Path like r"%C:\\Windows\\system32\\ime\\IMETC\\WimBootConfigurations.ini%"
GenericProperty1 = File.Path


[ThreatDetectionRule platform=Windows]
# Detects Elise backdoor activity used by APT32
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleId = e507feb7-5f73-4ef6-a970-91bb6f6d744f
RuleName = Elise Backdoor Activity
EventType = Process.Start
Tag = proc-start-elise-backdoor-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1059.003"], "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)"}
Query = Process.Path like r"%\\Microsoft\\Network\\svchost.exe" or Process.CommandLine like r"%\\Windows\\Caches\\NavShExt.dll%" and Process.CommandLine like r"%/c del%" or (Process.CommandLine like r"%\\AppData\\Roaming\\MICROS~1\\Windows\\Caches\\NavShExt.dll" or Process.CommandLine like r"%\\AppData\\Roaming\\Microsoft\\Windows\\Caches\\NavShExt.dll") and Process.CommandLine like r"%,Setting%"


[ThreatDetectionRule platform=Windows]
# Detects process activity patterns as seen being used by Sliver C2 framework implants
# Author: Nasreddine Bencherchali (Nextron Systems), Florian Roth (Nextron Systems)
RuleId = 42333b2c-b425-441c-b70e-99404a17170f
RuleName = HackTool - Sliver C2 Implant Activity Pattern
EventType = Process.Start
Tag = proc-start-hacktool-sliver-c2-implant-activity-pattern
RiskScore = 100
Annotation = {"mitre_attack": ["T1059"], "author": "Nasreddine Bencherchali (Nextron Systems), Florian Roth (Nextron Systems)"}
Query = Process.CommandLine like r"%-NoExit -Command [Console]::OutputEncoding=[Text.UTF8Encoding]::UTF8%"


[ThreatDetectionRule platform=Windows]
# Detects a WMI backdoor in Exchange Transport Agents via WMI event filters
# Author: Florian Roth (Nextron Systems)
RuleId = 797011dc-44f4-4e6f-9f10-a8ceefbe566b
RuleName = WMI Backdoor Exchange Transport Agent
EventType = Process.Start
Tag = proc-start-wmi-backdoor-exchange-transport-agent
RiskScore = 100
Annotation = {"mitre_attack": ["T1546.003"], "author": "Florian Roth (Nextron Systems)"}
Query = Parent.Path like r"%\\EdgeTransport.exe" and not (Process.Path == "C:\\Windows\\System32\\conhost.exe" or Process.Path like r"C:\\Program Files\\Microsoft\\Exchange Server\\%" and Process.Path like r"%\\Bin\\OleConverter.exe")
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects Pandemic Windows Implant
# Author: Florian Roth (Nextron Systems)
RuleId = 47e0852a-cf81-4494-a8e6-31864f8c86ed
RuleName = Pandemic Registry Key
EventType = Reg.Any
Tag = pandemic-registry-key
RiskScore = 100
Annotation = {"mitre_attack": ["T1105"], "author": "Florian Roth (Nextron Systems)"}
Query = Reg.TargetObject like r"%\\SYSTEM\\CurrentControlSet\\services\\null\\Instance%"
Hive = HKLM,HKU
GenericProperty1 = Reg.TargetObject


[ThreatDetectionRule platform=Windows]
# Detects Russian group activity as described in Global Threat Report 2019 by Crowdstrike
# Author: Florian Roth (Nextron Systems)
RuleId = b83f5166-9237-4b5e-9cd4-7b5d52f4d8ee
RuleName = Potential Russian APT Credential Theft Activity
EventType = Process.Start
Tag = proc-start-potential-russian-apt-credential-theft-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1552.001", "T1003.003"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.CommandLine like r"%xcopy /S /E /C /Q /H \\\\%" and Process.CommandLine like r"%\\sysvol\\%" or Process.CommandLine like r"%adexplorer -snapshot \"\" c:\\users\\%" and Process.CommandLine like r"%\\downloads\\%" and Process.CommandLine like r"%.snp%"


[ThreatDetectionRule platform=Windows]
# Detects OilRig registry persistence as reported by Nyotron in their March 2018 report
# Author: Florian Roth (Nextron Systems), Markus Neis, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community
RuleId = 7bdf2a7c-3acc-4091-9581-0a77dad1c5b5
RuleName = OilRig APT Registry Persistence
EventType = Reg.Any
Tag = oilrig-apt-registry-persistence
RiskScore = 100
Annotation = {"mitre_attack": ["T1053.005", "T1543.003", "T1112", "T1071.004"], "author": "Florian Roth (Nextron Systems), Markus Neis, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community"}
Query = Reg.TargetObject like r"%SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\UMe" or Reg.TargetObject like r"%SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\UT"
Hive = HKLM,HKU
GenericProperty1 = Reg.TargetObject


[ThreatDetectionRule platform=Windows]
# Detects WannaCry ransomware activity
# Author: Florian Roth (Nextron Systems), Tom U. @c_APT_ure (collection), oscd.community, Jonhnathan Ribeiro
RuleId = 41d40bff-377a-43e2-8e1b-2e543069e079
RuleName = WannaCry Ransomware Activity
EventType = Process.Start
Tag = proc-start-wannacry-ransomware-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1210", "T1083", "T1222.001", "T1486", "T1490"], "author": "Florian Roth (Nextron Systems), Tom U. @c_APT_ure (collection), oscd.community, Jonhnathan Ribeiro"}
Query = Process.Path like r"%\\tasksche.exe" or Process.Path like r"%\\mssecsvc.exe" or Process.Path like r"%\\taskdl.exe" or Process.Path like r"%\\taskhsvc.exe" or Process.Path like r"%\\taskse.exe" or Process.Path like r"%\\111.exe" or Process.Path like r"%\\lhdfrgui.exe" or Process.Path like r"%\\linuxnew.exe" or Process.Path like r"%\\wannacry.exe" or Process.Path like r"%WanaDecryptor%" or Process.CommandLine like r"%@Please\_Read\_Me@.txt%"


[ThreatDetectionRule platform=Windows]
# Detecting Emotet DLL loading by looking for rundll32.exe processes with command lines ending in ,RunDLL or ,Control_RunDLL
# Author: FPT.EagleEye
RuleId = 54e57ce3-0672-46eb-a402-2c0948d5e3e9
RuleName = Potential Emotet Rundll32 Execution
EventType = Process.Start
Tag = proc-start-potential-emotet-rundll32-execution
RiskScore = 100
Annotation = {"mitre_attack": ["T1218.011"], "author": "FPT.EagleEye"}
Query = (Process.Path like r"%\\rundll32.exe" or Process.Name == "RUNDLL32.EXE") and (Process.CommandLine like r"%,RunDLL" or Process.CommandLine like r"%,Control\_RunDLL") and not (Process.CommandLine like r"%.dll,Control\_RunDLL" or Process.CommandLine like r"%.dll\",Control\_RunDLL" or Process.CommandLine like r"%.dll',Control\_RunDLL" or Parent.Path like r"%\\tracker.exe")
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects a specific export function name used by one of EquationGroup tools
# Author: Florian Roth (Nextron Systems)
RuleId = d465d1d8-27a2-4cca-9621-a800f37cf72e
RuleName = Equation Group DLL_U Export Function Load
EventType = Process.Start
Tag = proc-start-equation-group-dll_u-export-function-load
RiskScore = 100
Annotation = {"mitre_attack": ["T1218.011"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.CommandLine like r"%-export dll\_u%" or Process.CommandLine like r"%,dll\_u" or Process.CommandLine like r"% dll\_u"


[ThreatDetectionRule platform=Windows]
# Detects tools and process executions used by Greenbug in their May 2020 campaign as reported by Symantec
# Author: Florian Roth (Nextron Systems)
RuleId = 3711eee4-a808-4849-8a14-faf733da3612
RuleName = Greenbug Espionage Group Indicators
EventType = Process.Start
Tag = proc-start-greenbug-espionage-group-indicators
RiskScore = 100
Annotation = {"mitre_attack": ["T1059.001", "T1105", "T1036.005"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.Path like r"%:\\ProgramData\\adobe\\Adobe.exe" or Process.Path like r"%:\\ProgramData\\oracle\\local.exe" or Process.Path like r"%\\revshell.exe" or Process.Path like r"%\\infopagesbackup\\ncat.exe" or Process.Path like r"%:\\ProgramData\\comms\\comms.exe" or Process.CommandLine like r"%-ExecutionPolicy Bypass -File%" and Process.CommandLine like r"%\\msf.ps1%" or Process.CommandLine like r"%infopagesbackup%" and Process.CommandLine like r"%\\ncat%" and Process.CommandLine like r"%-e cmd.exe%" or Process.CommandLine like r"%system.Data.SqlClient.SqlDataAdapter($cmd); [void]$da.fill%" or Process.CommandLine like r"%-nop -w hidden -c $k=new-object%" or Process.CommandLine like r"%[Net.CredentialCache]::DefaultCredentials;IEX %" or Process.CommandLine like r"% -nop -w hidden -c $m=new-object net.webclient;$m%" or Process.CommandLine like r"%-noninteractive -executionpolicy bypass whoami%" or Process.CommandLine like r"%-noninteractive -executionpolicy bypass netstat -a%" or Process.CommandLine like r"%L3NlcnZlcj1%"


[ThreatDetectionRule platform=Windows]
# Detects the execution of DLL side-loading malware used by threat group Emissary Panda aka APT27
# Author: Florian Roth (Nextron Systems)
RuleId = 9aa01d62-7667-4d3b-acb8-8cb5103e2014
RuleName = APT27 - Emissary Panda Activity
EventType = Process.Start
Tag = proc-start-apt27-emissary-panda-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1574.001"], "author": "Florian Roth (Nextron Systems)"}
Query = Parent.Path like r"%\\sllauncher.exe" and Process.Path like r"%\\svchost.exe" or Parent.Path like r"%\\AppData\\Roaming\\%" and Process.Path like r"%\\svchost.exe" and Process.CommandLine like r"%-k%"
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects exploits that use CVE-2017-11882 to start EQNEDT32.EXE and other sub processes like mshta.exe
# Author: Florian Roth (Nextron Systems)
RuleId = 678eb5f4-8597-4be6-8be7-905e4234b53a
RuleName = Droppers Exploiting CVE-2017-11882
EventType = Process.Start
Tag = proc-start-droppers-exploiting-cve-2017-11882
RiskScore = 100
Annotation = {"mitre_attack": ["T1203", "T1204.002", "T1566.001"], "author": "Florian Roth (Nextron Systems)"}
Query = Parent.Path like r"%\\EQNEDT32.EXE"
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects registry key used by Leviathan APT in Malaysian focused campaign
# Author: Aidan Bracher
RuleId = 70d43542-cd2d-483c-8f30-f16b436fd7db
RuleName = Leviathan Registry Key Activity
EventType = Reg.Any
Tag = leviathan-registry-key-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1547.001"], "author": "Aidan Bracher"}
Query = Reg.TargetObject like r"%\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ntkd%"
Hive = HKLM,HKU
GenericProperty1 = Reg.TargetObject


[ThreatDetectionRule platform=Windows]
# Detects specific process characteristics of Maze ransomware word document droppers
# Author: Florian Roth (Nextron Systems)
RuleId = 29fd07fc-9cfd-4331-b7fd-cc18dfa21052
RuleName = Potential Maze Ransomware Activity
EventType = Process.Start
Tag = proc-start-potential-maze-ransomware-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1204.002", "T1047", "T1490"], "author": "Florian Roth (Nextron Systems)"}
Query = Parent.Path like r"%\\WINWORD.exe" and Process.Path like r"%.tmp" or Process.Path like r"%\\wmic.exe" and Parent.Path like r"%\\Temp\\%" and Process.CommandLine like r"%shadowcopy delete" or Process.CommandLine like r"%shadowcopy delete" and Process.CommandLine like r"%\\..\\..\\system32%"
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects signs of the exploitation of LPE CVE-2021-41379 that include an msiexec process that creates an elevation_service.exe file
# Author: Florian Roth (Nextron Systems)
RuleId = 3be82d5d-09fe-4d6a-a275-0d40d234d324
RuleName = InstallerFileTakeOver LPE CVE-2021-41379 File Create Event
EventType = File.Create
Tag = installerfiletakeover-lpe-cve-2021-41379-file-create-event
RiskScore = 100
Annotation = {"mitre_attack": ["T1068"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.Path like r"%\\msiexec.exe" and File.Path like r"C:\\Program Files (x86)\\Microsoft\\Edge\\Application%" and File.Path like r"%\\elevation\_service.exe"
GenericProperty1 = File.Path


[ThreatDetectionRule platform=Windows]
# Detects registry keys created in OceanLotus (also known as APT32) attacks
# Author: megan201296, Jonhnathan Ribeiro
RuleId = 4ac5fc44-a601-4c06-955b-309df8c4e9d4
RuleName = OceanLotus Registry Activity
EventType = Reg.Any
Tag = oceanlotus-registry-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1112"], "author": "megan201296, Jonhnathan Ribeiro"}
Query = Reg.TargetObject like r"%\\SOFTWARE\\Classes\\CLSID\\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\\Model%" or Reg.TargetObject like r"%Classes\\AppXc52346ec40fb4061ad96be0e6cb7d16a\\%" or Reg.TargetObject like r"%Classes\\AppX3bbba44c6cae4d9695755183472171e2\\%" or Reg.TargetObject like r"%Classes\\CLSID\\{E3517E26-8E93-458D-A6DF-8030BC80528B}\\%" or Reg.TargetObject like r"%Classes\\CLSID\\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\\Model%" or Reg.TargetObject like r"%\\SOFTWARE\\App\\%" and (Reg.TargetObject like r"%AppXbf13d4ea2945444d8b13e2121cb6b663\\%" or Reg.TargetObject like r"%AppX70162486c7554f7f80f481985d67586d\\%" or Reg.TargetObject like r"%AppX37cc7fdccd644b4f85f4b22d5a3f105a\\%") and (Reg.TargetObject like r"%Application" or Reg.TargetObject like r"%DefaultIcon")
Hive = HKLM,HKU
GenericProperty1 = Reg.TargetObject


[ThreatDetectionRule platform=Windows]
# Detects indicators of a UAC bypass method by mocking directories
# Author: Florian Roth (Nextron Systems)
RuleId = 4ac47ed3-44c2-4b1f-9d51-bf46e8914126
RuleName = TrustedPath UAC Bypass Pattern
EventType = Process.Start
Tag = proc-start-trustedpath-uac-bypass-pattern
RiskScore = 100
Annotation = {"mitre_attack": ["T1548.002"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.Path like r"%C:\\Windows \\System32\\%" or Process.Path like r"%C:\\Windows \\SysWOW64\\%"


[ThreatDetectionRule platform=Windows]
# Detects the creation of an "svchost" process with specific command line flags, that were seen present and used by ColdSteel RAT
# Author: X__Junior (Nextron Systems)
RuleId = 9f9cd389-cea0-4142-bf1a-a3fd424abedd
RuleName = COLDSTEEL RAT Service Persistence Execution
EventType = Process.Start
Tag = proc-start-coldsteel-rat-service-persistence-execution
RiskScore = 100
Annotation = {"author": "X__Junior (Nextron Systems)"}
Query = Process.Path like r"%\\svchost.exe" and (Process.CommandLine like r"% -k msupdate" or Process.CommandLine like r"% -k msupdate2" or Process.CommandLine like r"% -k alg")


[ThreatDetectionRule platform=Windows]
# Detects different hacktools used for relay attacks on Windows for privilege escalation
# Author: Florian Roth (Nextron Systems)
RuleId = 5589ab4f-a767-433c-961d-c91f3f704db1
RuleName = Potential SMB Relay Attack Tool Execution
EventType = Process.Start
Tag = proc-start-potential-smb-relay-attack-tool-execution
RiskScore = 100
Annotation = {"mitre_attack": ["T1557.001"], "author": "Florian Roth (Nextron Systems)"}
Query = (Process.Path like r"%PetitPotam%" or Process.Path like r"%RottenPotato%" or Process.Path like r"%HotPotato%" or Process.Path like r"%JuicyPotato%" or Process.Path like r"%\\just\_dce\_%" or Process.Path like r"%Juicy Potato%" or Process.Path like r"%\\temp\\rot.exe%" or Process.Path like r"%\\Potato.exe%" or Process.Path like r"%\\SpoolSample.exe%" or Process.Path like r"%\\Responder.exe%" or Process.Path like r"%\\smbrelayx%" or Process.Path like r"%\\ntlmrelayx%" or Process.Path like r"%\\LocalPotato%" or Process.CommandLine like r"%Invoke-Tater%" or Process.CommandLine like r"% smbrelay%" or Process.CommandLine like r"% ntlmrelay%" or Process.CommandLine like r"%cme smb %" or Process.CommandLine like r"% /ntlm:NTLMhash %" or Process.CommandLine like r"%Invoke-PetitPotam%" or Process.CommandLine like r"%.exe -t % -p %" or Process.CommandLine like r"%.exe -c \"{%" and Process.CommandLine like r"%}\" -z") and not (Process.Path like r"%HotPotatoes6%" or Process.Path like r"%HotPotatoes7%" or Process.Path like r"%HotPotatoes %")


[ThreatDetectionRule platform=Windows]
# Detects FlowCloud malware registry markers from threat group TA410.
# The malware stores its configuration in the registry alongside drivers utilized by the malware's keylogger components.
# Author: NVISO
RuleId = 5118765f-6657-4ddb-a487-d7bd673abbf1
RuleName = FlowCloud Registry Markers
EventType = Reg.Any
Tag = flowcloud-registry-markers
RiskScore = 100
Annotation = {"mitre_attack": ["T1112"], "author": "NVISO"}
Query = Reg.TargetObject like r"%\\HARDWARE\\{2DB80286-1784-48b5-A751-B6ED1F490303}%" or Reg.TargetObject like r"%\\HARDWARE\\{804423C2-F490-4ac3-BFA5-13DEDE63A71A}%" or Reg.TargetObject like r"%\\HARDWARE\\{A5124AF5-DF23-49bf-B0ED-A18ED3DEA027}%" or Reg.TargetObject like r"%\\SYSTEM\\Setup\\PrintResponsor\\%"
Hive = HKLM,HKU
GenericProperty1 = Reg.TargetObject


[ThreatDetectionRule platform=Windows]
# Detects a specific PowerShell command line pattern used by the UNC2452 actors as mentioned in Microsoft and Symantec reports
# Author: Florian Roth (Nextron Systems)
RuleId = b7155193-8a81-4d8f-805d-88de864ca50c
RuleName = UNC2452 PowerShell Pattern
EventType = Process.Start
Tag = proc-start-unc2452-powershell-pattern
RiskScore = 100
Annotation = {"mitre_attack": ["T1059.001", "T1047"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.CommandLine like r"%Invoke-WMIMethod win32\_process -name create -argumentlist%" and Process.CommandLine like r"%rundll32 c:\\windows%" or Process.CommandLine like r"%wmic /node:%" and Process.CommandLine like r"%process call create \"rundll32 c:\\windows%"


[ThreatDetectionRule platform=Windows]
# Detects suspicious execution from ManageEngine as seen used by Mint Sandstorm
# Author: Nasreddine Bencherchali (Nextron Systems), MSTIC (idea)
RuleId = 58d8341a-5849-44cd-8ac8-8b020413a31b
RuleName = Mint Sandstorm - ManageEngine Suspicious Process Execution
EventType = Process.Start
Tag = proc-start-mint-sandstorm-manageengine-suspicious-process-execution
RiskScore = 100
Annotation = {"author": "Nasreddine Bencherchali (Nextron Systems), MSTIC (idea)"}
Query = (Parent.Path like r"%manageengine%" or Parent.Path like r"%ServiceDesk%") and Parent.Path like r"%\\java%" and ((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\powershell\_ise.exe") and (Process.CommandLine like r"% echo %" or Process.CommandLine like r"%-dumpmode%" or Process.CommandLine like r"%-ssh%" or Process.CommandLine like r"%.dmp%" or Process.CommandLine like r"%add-MpPreference%" or Process.CommandLine like r"%adscredentials%" or Process.CommandLine like r"%bitsadmin%" or Process.CommandLine like r"%certutil%" or Process.CommandLine like r"%csvhost.exe%" or Process.CommandLine like r"%DownloadFile%" or Process.CommandLine like r"%DownloadString%" or Process.CommandLine like r"%dsquery%" or Process.CommandLine like r"%ekern.exe%" or Process.CommandLine like r"%FromBase64String%" or Process.CommandLine like r"%iex %" or Process.CommandLine like r"%iex(%" or Process.CommandLine like r"%Invoke-Expression%" or Process.CommandLine like r"%Invoke-WebRequest%" or Process.CommandLine like r"%localgroup administrators%" or Process.CommandLine like r"%net group%" or Process.CommandLine like r"%net user%" or Process.CommandLine like r"%o365accountconfiguration%" or Process.CommandLine like r"%query session%" or Process.CommandLine like r"%samaccountname=%" or Process.CommandLine like r"%set-MpPreference%" or Process.CommandLine like r"%svhost.exe%" or Process.CommandLine like r"%System.IO.Compression%" or Process.CommandLine like r"%System.IO.MemoryStream%" or Process.CommandLine like r"%usoprivate%" or Process.CommandLine like r"%usoshared%" or Process.CommandLine like r"%whoami%" or Process.CommandLine regex "[-/â€“][Ee^]{1,2}[ncodema^]*\\s[A-Za-z0-9+/=]{15,}") or Process.CommandLine like r"%lsass%" and (Process.CommandLine like r"%procdump%" or Process.CommandLine like r"%tasklist%" or Process.CommandLine like r"%findstr%") or Process.Path like r"%\\wget.exe" and Process.CommandLine like r"%http%" or Process.Path like r"%\\curl.exe" and Process.CommandLine like r"%http%" or Process.CommandLine like r"%E:jscript%" or Process.CommandLine like r"%e:vbscript%" or Process.CommandLine like r"%localgroup Administrators%" and Process.CommandLine like r"%/add%" or Process.CommandLine like r"%net%" and Process.CommandLine like r"%user%" and Process.CommandLine like r"%/add%" or Process.CommandLine like r"%reg add%" and Process.CommandLine like r"%DisableAntiSpyware%" and Process.CommandLine like r"%\\Microsoft\\Windows Defender%" or Process.CommandLine like r"%reg add%" and Process.CommandLine like r"%DisableRestrictedAdmin%" and Process.CommandLine like r"%CurrentControlSet\\Control\\Lsa%" or Process.CommandLine like r"%wmic%" and Process.CommandLine like r"%process call create%" or Process.CommandLine like r"%wmic%" and Process.CommandLine like r"%delete%" and Process.CommandLine like r"%shadowcopy%" or Process.CommandLine like r"%vssadmin%" and Process.CommandLine like r"%delete%" and Process.CommandLine like r"%shadows%" or Process.CommandLine like r"%wbadmin%" and Process.CommandLine like r"%delete%" and Process.CommandLine like r"%catalog%") and not (Process.CommandLine like r"%download.microsoft.com%" and Process.CommandLine like r"%manageengine.com%" and Process.CommandLine like r"%msiexec%")
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects the execution of the PurpleSharp adversary simulation tool
# Author: Florian Roth (Nextron Systems)
RuleId = ff23ffbc-3378-435e-992f-0624dcf93ab4
RuleName = HackTool - PurpleSharp Execution
EventType = Process.Start
Tag = proc-start-hacktool-purplesharp-execution
RiskScore = 100
Annotation = {"mitre_attack": ["T1587"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.Path like r"%\\purplesharp%" or Process.Name == "PurpleSharp.exe" or Process.CommandLine like r"%xyz123456.exe%" or Process.CommandLine like r"%PurpleSharp%"


[ThreatDetectionRule platform=Windows]
# Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\Windows\System32\wbem\` directory over the network and loading it for a WMI DLL Hijack scenario.
# Author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)
RuleId = 614a7e17-5643-4d89-b6fe-f9df1a79641c
RuleName = Wmiprvse Wbemcomn DLL Hijack - File
EventType = File.Create
Tag = wmiprvse-wbemcomn-dll-hijack-file
RiskScore = 100
Annotation = {"mitre_attack": ["T1047", "T1021.002"], "author": "Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)"}
Query = Process.Path == "System" and File.Path like r"%\\wbem\\wbemcomn.dll"
GenericProperty1 = File.Path


[ThreatDetectionRule platform=Windows]
# Detects Winword starting uncommon sub process MicroScMgmt.exe as used in exploits for CVE-2015-1641
# Author: Florian Roth (Nextron Systems)
RuleId = 7993792c-5ce2-4475-a3db-a3a5539827ef
RuleName = Exploit for CVE-2015-1641
EventType = Process.Start
Tag = proc-start-exploit-for-cve-2015-1641
RiskScore = 100
Annotation = {"mitre_attack": ["T1036.005"], "author": "Florian Roth (Nextron Systems)"}
Query = Parent.Path like r"%\\WINWORD.EXE" and Process.Path like r"%\\MicroScMgmt.exe"
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects DarkSide Ransomware and helpers
# Author: Florian Roth (Nextron Systems)
RuleId = 965fff6c-1d7e-4e25-91fd-cdccd75f7d2c
RuleName = DarkSide Ransomware Pattern
EventType = Process.Start
Tag = proc-start-darkside-ransomware-pattern
RiskScore = 100
Annotation = {"mitre_attack": ["T1204"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.CommandLine like r"%=[char][byte]('0x'+%" or Process.CommandLine like r"% -work worker0 -path %" or Parent.CommandLine like r"%DllHost.exe /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}%" and Process.Path like r"%\\AppData\\Local\\Temp\\%"
GenericProperty1 = Parent.CommandLine


[ThreatDetectionRule platform=Windows]
# Detects the use of the Dinject PowerShell cradle based on the specific flags
# Author: Florian Roth (Nextron Systems)
RuleId = d78b5d61-187d-44b6-bf02-93486a80de5a
RuleName = HackTool - DInjector PowerShell Cradle Execution
EventType = Process.Start
Tag = proc-start-hacktool-dinjector-powershell-cradle-execution
RiskScore = 100
Annotation = {"mitre_attack": ["T1055"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.CommandLine like r"% /am51%" and Process.CommandLine like r"% /password%"


[ThreatDetectionRule platform=Windows]
# Detects potential QBot activity by looking for process executions used previously by QBot
# Author: Florian Roth (Nextron Systems)
RuleId = 4fcac6eb-0287-4090-8eea-2602e4c20040
RuleName = Potential QBot Activity
EventType = Process.Start
Tag = proc-start-potential-qbot-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1059.005"], "author": "Florian Roth (Nextron Systems)"}
Query = Parent.Path like r"%\\WinRAR.exe" and Process.Path like r"%\\wscript.exe" or Process.CommandLine like r"% /c ping.exe -n 6 127.0.0.1 & type %" or Process.CommandLine like r"%regsvr32.exe%" and Process.CommandLine like r"%C:\\ProgramData%" and Process.CommandLine like r"%.tmp%"
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects potential DLL hijack of "iertutil.dll" found in the DCOM InternetExplorer.Application Class over the network
# Author: Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR), wagga
RuleId = 2f7979ae-f82b-45af-ac1d-2b10e93b0baa
RuleName = Potential DCOM InternetExplorer.Application DLL Hijack
EventType = File.Create
Tag = potential-dcom-internetexplorer.application-dll-hijack
RiskScore = 100
Annotation = {"mitre_attack": ["T1021.002", "T1021.003"], "author": "Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR), wagga"}
Query = Process.Path == "System" and File.Path like r"%\\Internet Explorer\\iertutil.dll"
GenericProperty1 = File.Path


[ThreatDetectionRule platform=Windows]
# By replacing the sticky keys executable with the local admins CMD executable, an attacker is able to access a privileged windows console session without authenticating to the system.
# When the sticky keys are "activated" the privilleged shell is launched.
# Author: Sreeman
RuleId = 1070db9a-3e5d-412e-8e7b-7183b616e1b3
RuleName = Persistence Via Sticky Key Backdoor
EventType = Process.Start
Tag = proc-start-persistence-via-sticky-key-backdoor
RiskScore = 100
Annotation = {"mitre_attack": ["T1546.008"], "author": "Sreeman"}
Query = Process.CommandLine like r"%copy %" and Process.CommandLine like r"%/y %" and Process.CommandLine like r"%C:\\windows\\system32\\cmd.exe C:\\windows\\system32\\sethc.exe%"


[ThreatDetectionRule platform=Windows]
# Detects process execution patterns related to Griffon malware as reported by Kaspersky
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = bcc6f179-11cd-4111-a9a6-0fab68515cf7
RuleName = Griffon Malware Attack Pattern
EventType = Process.Start
Tag = proc-start-griffon-malware-attack-pattern
RiskScore = 100
Annotation = {"author": "Nasreddine Bencherchali (Nextron Systems)"}
Query = Process.CommandLine like r"%\\local\\temp\\%" and Process.CommandLine like r"%//b /e:jscript%" and Process.CommandLine like r"%.txt%"


[ThreatDetectionRule platform=Windows]
# Detects indicators of APT 29 (Cozy Bear) phishing-campaign as reported by mandiant
# Author: Florian Roth (Nextron Systems), @41thexplorer
RuleId = 7453575c-a747-40b9-839b-125a0aae324b
RuleName = APT29 2018 Phishing Campaign CommandLine Indicators
EventType = Process.Start
Tag = proc-start-apt29-2018-phishing-campaign-commandline-indicators
RiskScore = 100
Annotation = {"mitre_attack": ["T1218.011"], "author": "Florian Roth (Nextron Systems), @41thexplorer"}
Query = Process.CommandLine like r"%-noni -ep bypass $%" or Process.CommandLine like r"%cyzfc.dat,%" and Process.CommandLine like r"%PointFunctionCall%"


[ThreatDetectionRule platform=Windows]
# Detects potential Dtrack RAT activity via specific process patterns
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleId = f1531fa4-5b84-4342-8f68-9cf3fdbd83d4
RuleName = Potential Dtrack RAT Activity
EventType = Process.Start
Tag = proc-start-potential-dtrack-rat-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1490"], "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)"}
Query = Process.CommandLine like r"%ping -n %" and Process.CommandLine like r"% echo EEEE > %" or Process.CommandLine like r"%ipconfig /all%" and Process.CommandLine like r"%\\temp\\res.ip%" or Process.CommandLine like r"%interface ip show config%" and Process.CommandLine like r"%\\temp\\netsh.res%"


[ThreatDetectionRule platform=Windows]
# Detects the execution of SecurityXploded Tools
# Author: Florian Roth (Nextron Systems)
RuleId = 7679d464-4f74-45e2-9e01-ac66c5eb041a
RuleName = HackTool - SecurityXploded Execution
EventType = Process.Start
Tag = proc-start-hacktool-securityxploded-execution
RiskScore = 100
Annotation = {"mitre_attack": ["T1555"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.Company == "SecurityXploded" or Process.Path like r"%PasswordDump.exe" or Process.Name like r"%PasswordDump.exe"
GenericProperty1 = Process.Company


[ThreatDetectionRule platform=Windows]
# Detects a suspicious LSASS process process clone that could be a sign of credential dumping activity
# Author: Florian Roth (Nextron Systems), Samir Bousseaden
RuleId = c8da0dfd-4ed0-4b68-962d-13c9c884384e
RuleName = Potential Credential Dumping Via LSASS Process Clone
EventType = Process.Start
Tag = proc-start-potential-credential-dumping-via-lsass-process-clone
RiskScore = 100
Annotation = {"mitre_attack": ["T1003", "T1003.001"], "author": "Florian Roth (Nextron Systems), Samir Bousseaden"}
Query = Parent.Path like r"%\\Windows\\System32\\lsass.exe" and Process.Path like r"%\\Windows\\System32\\lsass.exe"
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects the creation of a file named "MoriyaStreamWatchmen.sys" in a specific location. This filename was reported to be related to the Moriya rootkit as described in the securelist's Operation TunnelSnake report.
# Author: Bhabesh Raj
RuleId = a1507d71-0b60-44f6-b17c-bf53220fdd88
RuleName = Moriya Rootkit File Created
EventType = File.Create
Tag = moriya-rootkit-file-created
RiskScore = 100
Annotation = {"mitre_attack": ["T1543.003"], "author": "Bhabesh Raj"}
Query = File.Path == "C:\\Windows\\System32\\drivers\\MoriyaStreamWatchmen.sys"
GenericProperty1 = File.Path


[ThreatDetectionRule platform=Windows]
# Detects static QMS 810 and mimikatz driver name used by Mimikatz as exploited in CVE-2021-1675 and CVE-2021-34527
# Author: Markus Neis, @markus_neis, Florian Roth
RuleId = ba6b9e43-1d45-4d3c-a504-1043a64c8469
RuleName = PrinterNightmare Mimikatz Driver Name
EventType = Reg.Any
Tag = printernightmare-mimikatz-driver-name
RiskScore = 100
Annotation = {"mitre_attack": ["T1204"], "author": "Markus Neis, @markus_neis, Florian Roth"}
Query = Reg.TargetObject like r"%\\Control\\Print\\Environments\\Windows x64\\Drivers\\Version-3\\QMS 810\\%" or Reg.TargetObject like r"%\\Control\\Print\\Environments\\Windows x64\\Drivers\\Version-3\\mimikatz%" or Reg.TargetObject like r"%legitprinter%" and Reg.TargetObject like r"%\\Control\\Print\\Environments\\Windows%" or (Reg.TargetObject like r"%\\Control\\Print\\Environments%" or Reg.TargetObject like r"%\\CurrentVersion\\Print\\Printers%") and (Reg.TargetObject like r"%Gentil Kiwi%" or Reg.TargetObject like r"%mimikatz printer%" or Reg.TargetObject like r"%Kiwi Legit Printer%")
Hive = HKLM,HKU
GenericProperty1 = Reg.TargetObject


[ThreatDetectionRule platform=Windows]
# Detects OilRig activity as reported by Nyotron in their March 2018 report
# Author: Florian Roth (Nextron Systems), Markus Neis, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community
RuleId = ce6e34ca-966d-41c9-8d93-5b06c8b97a06
RuleName = OilRig APT Activity
EventType = Process.Start
Tag = proc-start-oilrig-apt-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1053.005", "T1543.003", "T1112", "T1071.004"], "author": "Florian Roth (Nextron Systems), Markus Neis, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community"}
Query = Process.CommandLine like r"%SC Scheduled Scan%" and Process.CommandLine like r"%\\microsoft\\Taskbar\\autoit3.exe%" or Process.Path like r"%\\Windows\\Temp\\DB\\%" and Process.Path like r"%.exe" or Process.Path == "C:\\Windows\\system32\\Service.exe" and (Process.CommandLine like r"%i%" or Process.CommandLine like r"%u%") or Parent.Path like r"%\\local\\microsoft\\Taskbar\\autoit3.exe" and Process.CommandLine like r"%nslookup.exe%" and Process.CommandLine like r"%-q=TXT%"
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects different process execution behaviors as described in various threat reports on Lazarus group activity
# Author: Florian Roth (Nextron Systems), wagga
RuleId = 24c4d154-05a4-4b99-b57d-9b977472443a
RuleName = Lazarus Group Activity
EventType = Process.Start
Tag = proc-start-lazarus-group-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1059"], "author": "Florian Roth (Nextron Systems), wagga"}
Query = Process.CommandLine like r"%reg.exe save hklm\\sam \%temp\%\\~reg\_sam.save%" or Process.CommandLine like r"%1q2w3e4r@#$@#$@#$%" or Process.CommandLine like r"% -hp1q2w3e4 %" or Process.CommandLine like r"%.dat data03 10000 -p %" or Process.CommandLine like r"%netstat -aon | find %" and Process.CommandLine like r"%ESTA%" and Process.CommandLine like r"% > \%temp\%\\~%" or Process.CommandLine like r"%.255 10 C:\\ProgramData\\IBM\\%" and Process.CommandLine like r"%.DAT%" or Process.CommandLine like r"% /c %" and Process.CommandLine like r"% -p 0x%" and (Process.CommandLine like r"%C:\\ProgramData\\%" or Process.CommandLine like r"%C:\\RECYCLER\\%") or Process.CommandLine like r"%rundll32 %" and Process.CommandLine like r"%C:\\ProgramData\\%" and (Process.CommandLine like r"%.bin,%" or Process.CommandLine like r"%.tmp,%" or Process.CommandLine like r"%.dat,%" or Process.CommandLine like r"%.io,%" or Process.CommandLine like r"%.ini,%" or Process.CommandLine like r"%.db,%")


[ThreatDetectionRule platform=Windows]
# Detects DLL hijacking technique used by NOBELIUM in their FoggyWeb backdoor. Which loads a malicious version of the expected "version.dll" dll
# Author: Florian Roth (Nextron Systems)
RuleId = 640dc51c-7713-4faa-8a0e-e7c0d9d4654c
RuleName = FoggyWeb Backdoor DLL Loading
EventType = Image.Load
Tag = foggyweb-backdoor-dll-loading
RiskScore = 100
Annotation = {"mitre_attack": ["T1587"], "author": "Florian Roth (Nextron Systems)"}
Query = Image.Path == "C:\\Windows\\ADFS\\version.dll"
GenericProperty1 = Image.Path


[ThreatDetectionRule platform=Windows]
# Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen
# Author: Florian Roth (Nextron Systems), @twjackomo, Jonhnathan Ribeiro, oscd.community
RuleId = 2fdefcb3-dbda-401e-ae23-f0db027628bc
RuleName = Sticky Key Like Backdoor Execution
EventType = Process.Start
Tag = proc-start-sticky-key-like-backdoor-execution
RiskScore = 100
Annotation = {"mitre_attack": ["T1546.008"], "author": "Florian Roth (Nextron Systems), @twjackomo, Jonhnathan Ribeiro, oscd.community"}
Query = Parent.Path like r"%\\winlogon.exe" and (Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\wt.exe") and (Process.CommandLine like r"%sethc.exe%" or Process.CommandLine like r"%utilman.exe%" or Process.CommandLine like r"%osk.exe%" or Process.CommandLine like r"%Magnify.exe%" or Process.CommandLine like r"%Narrator.exe%" or Process.CommandLine like r"%DisplaySwitch.exe%")
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects the creation of files created by mimikatz such as ".kirbi", "mimilsa.log", etc.
# Author: Florian Roth (Nextron Systems), David ANDRE
RuleId = 9e099d99-44c2-42b6-a6d8-54c3545cab29
RuleName = HackTool - Mimikatz Kirbi File Creation
EventType = File.Create
Tag = hacktool-mimikatz-kirbi-file-creation
RiskScore = 100
Annotation = {"mitre_attack": ["T1558"], "author": "Florian Roth (Nextron Systems), David ANDRE"}
Query = File.Path like r"%.kirbi" or File.Path like r"%mimilsa.log"
GenericProperty1 = File.Path


[ThreatDetectionRule platform=Windows]
# Detects specific process tree behavior of a "rundll32" execution where the DLL doesn't have the ".dll" extension. This is often linked with potential Qakbot activity.
# Author: X__Junior (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
RuleId = bfd34392-c591-4009-b938-9fd985a28b85
RuleName = Qakbot Rundll32 Fake DLL Extension Execution
EventType = Process.Start
Tag = proc-start-qakbot-rundll32-fake-dll-extension-execution
RiskScore = 100
Annotation = {"author": "X__Junior (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)"}
Query = (Parent.Path like r"%\\cmd.exe" or Parent.Path like r"%\\cscript.exe" or Parent.Path like r"%\\curl.exe" or Parent.Path like r"%\\mshta.exe" or Parent.Path like r"%\\powershell.exe" or Parent.Path like r"%\\pwsh.exe" or Parent.Path like r"%\\wscript.exe") and Process.Path like r"%\\rundll32.exe" and (Process.CommandLine like r"%:\\ProgramData\\%" or Process.CommandLine like r"%:\\Users\\Public\\%" or Process.CommandLine like r"%\\AppData\\Local\\Temp\\%" or Process.CommandLine like r"%\\AppData\\Roaming\\%") and not Process.CommandLine like r"%.dll%"
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects Golden Chickens deployment method as used by Evilnum and described in ESET July 2020 report
# Author: Florian Roth (Nextron Systems)
RuleId = 8acf3cfa-1e8c-4099-83de-a0c4038e18f0
RuleName = EvilNum APT Golden Chickens Deployment Via OCX Files
EventType = Process.Start
Tag = proc-start-evilnum-apt-golden-chickens-deployment-via-ocx-files
RiskScore = 100
Annotation = {"mitre_attack": ["T1218.011"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.CommandLine like r"%regsvr32%" and Process.CommandLine like r"%/s%" and Process.CommandLine like r"%/i%" and Process.CommandLine like r"%\\AppData\\Roaming\\%" and Process.CommandLine like r"%.ocx%"


[ThreatDetectionRule platform=Windows]
# Detects some Empire PowerShell UAC bypass methods
# Author: Ecco
RuleId = 3268b746-88d8-4cd3-bffc-30077d02c787
RuleName = HackTool - Empire PowerShell UAC Bypass
EventType = Process.Start
Tag = proc-start-hacktool-empire-powershell-uac-bypass
RiskScore = 100
Annotation = {"mitre_attack": ["T1548.002"], "author": "Ecco"}
Query = Process.CommandLine like r"% -NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update)%" or Process.CommandLine like r"% -NoP -NonI -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update);%"


[ThreatDetectionRule platform=Windows]
# Detects SNAKE malware kernel driver file indicator
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = d6d9d23f-69c1-41b5-8305-fa8250bd027f
RuleName = SNAKE Malware Kernel Driver File Indicator
EventType = File.Create
Tag = snake-malware-kernel-driver-file-indicator
RiskScore = 100
Annotation = {"author": "Nasreddine Bencherchali (Nextron Systems)"}
Query = File.Path == "C:\\Windows\\System32\\Com\\Comadmin.dat"
GenericProperty1 = File.Path


[ThreatDetectionRule platform=Windows]
# Detects a ZxShell start by the called and well-known function name
# Author: Florian Roth (Nextron Systems), oscd.community, Jonhnathan Ribeiro
RuleId = f0b70adb-0075-43b0-9745-e82a1c608fcc
RuleName = ZxShell Malware
EventType = Process.Start
Tag = proc-start-zxshell-malware
RiskScore = 100
Annotation = {"mitre_attack": ["T1059.003", "T1218.011"], "author": "Florian Roth (Nextron Systems), oscd.community, Jonhnathan Ribeiro"}
Query = Process.Path like r"%\\rundll32.exe" and (Process.CommandLine like r"%zxFunction%" or Process.CommandLine like r"%RemoteDiskXXXXX%")


[ThreatDetectionRule platform=Windows]
# Detects the creation of file such as spinstall0.aspx which may indicate successful exploitation of CVE-2025-53770.
# CVE-2025-53770 is a zero-day vulnerability in SharePoint that allows remote code execution.
# Author: Swachchhanda Shrawan Poudel (Nextron Systems)
RuleId = ba479447-721f-42a9-9af2-6dcd517bbdb3
RuleName = Potential SharePoint ToolShell CVE-2025-53770 Exploitation - File Create
EventType = File.Create
Tag = potential-sharepoint-toolshell-cve-2025-53770-exploitation-file-create
RiskScore = 100
Annotation = {"mitre_attack": ["T1190"], "author": "Swachchhanda Shrawan Poudel (Nextron Systems)"}
Query = (File.Path like r"C:\\Program Files\\Common Files\\Microsoft Shared\\Web Server Extensions\\%" or File.Path like r"C:\\Program Files (x86)\\Common Files\\Microsoft Shared\\Web Server Extensions\\%") and (File.Path like r"%\\15\\TEMPLATE\\LAYOUTS\\%" or File.Path like r"%\\16\\TEMPLATE\\LAYOUTS\\%") and (File.Path like r"%\\spinstall.aspx" or File.Path like r"%\\spinstall_.aspx" or File.Path like r"%\\debug\_dev.js")
GenericProperty1 = File.Path


[ThreatDetectionRule platform=Windows]
# Detects potential Dridex acitvity via specific process patterns
# Author: Florian Roth (Nextron Systems), oscd.community, Nasreddine Bencherchali (Nextron Systems)
RuleId = e6eb5a96-9e6f-4a18-9cdd-642cfda21c8e
RuleName = Potential Dridex Activity
EventType = Process.Start
Tag = proc-start-potential-dridex-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1055", "T1135", "T1033"], "author": "Florian Roth (Nextron Systems), oscd.community, Nasreddine Bencherchali (Nextron Systems)"}
Query = Process.Path like r"%\\svchost.exe" and Process.CommandLine like r"%C:\\Users\\%" and Process.CommandLine like r"%\\Desktop\\%" and not Parent.Path like r"C:\\Windows\\System32\\%" or Parent.Path like r"%\\excel.exe" and Process.Path like r"%\\regsvr32.exe" and (Process.CommandLine like r"% -s %" or Process.CommandLine like r"%\\AppData\\Local\\Temp\\%") and not Process.CommandLine like r"%.dll%" or Parent.Path like r"%\\svchost.exe" and (Process.Path like r"%\\whoami.exe" and Process.CommandLine like r"% /all%" or (Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") and Process.CommandLine like r"% view%")
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects patterns as noticed in exploitation of Windows CVE-2021-31979 CVE-2021-33771 vulnerability and DevilsTongue malware by threat group Sourgum
# Author: Sittikorn S, frack113
RuleId = 32b5db62-cb5f-4266-9639-0fa48376ac00
RuleName = CVE-2021-31979 CVE-2021-33771 Exploits
EventType = Reg.Any
Tag = cve-2021-31979-cve-2021-33771-exploits
RiskScore = 100
Annotation = {"mitre_attack": ["T1566", "T1203"], "author": "Sittikorn S, frack113"}
Query = (Reg.TargetObject like r"%CLSID\\{CF4CC405-E2C5-4DDD-B3CE-5E7582D8C9FA}\\InprocServer32\\(Default)" or Reg.TargetObject like r"%CLSID\\{7C857801-7381-11CF-884D-00AA004B2E24}\\InProcServer32\\(Default)") and not (Reg.Value.Data like r"%system32\\wbem\\wmiutils.dll" or Reg.Value.Data like r"%system32\\wbem\\wbemsvc.dll")
Hive = HKLM,HKU
GenericProperty1 = Reg.TargetObject
GenericProperty2 = Reg.Value.Data


[ThreatDetectionRule platform=Windows]
# Detects the creation of a "rundll32" process from the ColdSteel persistence service to initiate the cleanup command by calling one of its own exports. This functionality is not present in "MileStone2017" and some "MileStone2016" samples
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleId = 88516f06-ebe0-47ad-858e-ae9fd060ddea
RuleName = COLDSTEEL RAT Cleanup Command Execution
EventType = Process.Start
Tag = proc-start-coldsteel-rat-cleanup-command-execution
RiskScore = 100
Annotation = {"author": "Nasreddine Bencherchali (Nextron Systems)"}
Query = Parent.Path like r"%\\svchost.exe" and (Parent.CommandLine like r"% -k msupdate%" or Parent.CommandLine like r"% -k msupdate2%" or Parent.CommandLine like r"% -k alg%") and Process.Path like r"%\\rundll32.exe" and (Process.CommandLine like r"%UpdateDriverForPlugAndPlayDevicesW%" or Process.CommandLine like r"%ServiceMain%" or Process.CommandLine like r"%DiUninstallDevice%")
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine


[ThreatDetectionRule platform=Windows]
# Detects the use of Windows Credential Editor (WCE)
# Author: Florian Roth (Nextron Systems)
RuleId = a6b33c02-8305-488f-8585-03cb2a7763f2
RuleName = Windows Credential Editor Registry
EventType = Reg.Any
Tag = windows-credential-editor-registry
RiskScore = 100
Annotation = {"mitre_attack": ["T1003.001"], "author": "Florian Roth (Nextron Systems)"}
Query = Reg.TargetObject like r"%Services\\WCESERVICE\\Start%"
Hive = HKLM,HKU
GenericProperty1 = Reg.TargetObject


[ThreatDetectionRule platform=Windows]
# Detects automated lateral movement by Turla group
# Author: Markus Neis
RuleId = c601f20d-570a-4cde-a7d6-e17f99cb8e7f
RuleName = Turla Group Lateral Movement
EventType = Process.Start
Tag = proc-start-turla-group-lateral-movement
RiskScore = 100
Annotation = {"mitre_attack": ["T1059", "T1021.002", "T1083", "T1135"], "author": "Markus Neis"}
Query = Process.CommandLine like r"net use \\\\\%DomainController\%\\C$ \"P@ssw0rd\" %" or Process.CommandLine like r"dir c:\\%.doc% /s" or Process.CommandLine like r"dir \%TEMP\%\\%.exe"


[ThreatDetectionRule platform=Windows]
# Detects the execution of whoami that has been renamed to a different name to avoid detection
# Author: Florian Roth (Nextron Systems)
RuleId = f1086bf7-a0c4-4a37-9102-01e573caf4a0
RuleName = Renamed Whoami Execution
EventType = Process.Start
Tag = proc-start-renamed-whoami-execution
RiskScore = 100
Annotation = {"mitre_attack": ["T1033"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.Name == "whoami.exe" and not Process.Path like r"%\\whoami.exe"


[ThreatDetectionRule platform=Windows]
# Detects the use of the filename DumpStack.log to evade Microsoft Defender
# Author: Florian Roth (Nextron Systems)
RuleId = 4f647cfa-b598-4e12-ad69-c68dd16caef8
RuleName = DumpStack.log Defender Evasion
EventType = Process.Start
Tag = proc-start-dumpstack.log-defender-evasion
RiskScore = 100
Annotation = {"author": "Florian Roth (Nextron Systems)"}
Query = Process.Path like r"%\\DumpStack.log" or Process.CommandLine like r"% -o DumpStack.log%"


[ThreatDetectionRule platform=Windows]
# Detects Winword starting uncommon sub process csc.exe as used in exploits for CVE-2017-8759
# Author: Florian Roth (Nextron Systems)
RuleId = fdd84c68-a1f6-47c9-9477-920584f94905
RuleName = Exploit for CVE-2017-8759
EventType = Process.Start
Tag = proc-start-exploit-for-cve-2017-8759
RiskScore = 100
Annotation = {"mitre_attack": ["T1203", "T1204.002", "T1566.001"], "author": "Florian Roth (Nextron Systems)"}
Query = Parent.Path like r"%\\WINWORD.EXE" and Process.Path like r"%\\csc.exe"
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects indicators of APT 29 (Cozy Bear) phishing-campaign as reported by mandiant
# Author: @41thexplorer
RuleId = 3a3f81ca-652c-482b-adeb-b1c804727f74
RuleName = APT29 2018 Phishing Campaign File Indicators
EventType = File.Create
Tag = apt29-2018-phishing-campaign-file-indicators
RiskScore = 100
Annotation = {"mitre_attack": ["T1218.011"], "author": "@41thexplorer"}
Query = File.Path like r"%ds7002.lnk%" or File.Path like r"%ds7002.pdf%" or File.Path like r"%ds7002.zip%"
GenericProperty1 = File.Path


[ThreatDetectionRule platform=Windows]
# F-Secure C3 produces DLLs with a default exported StartNodeRelay function.
# Author: Alfie Champion (ajpc500)
RuleId = b18c9d4c-fac9-4708-bd06-dd5bfacf200f
RuleName = HackTool - F-Secure C3 Load by Rundll32
EventType = Process.Start
Tag = proc-start-hacktool-f-secure-c3-load-by-rundll32
RiskScore = 100
Annotation = {"mitre_attack": ["T1218.011"], "author": "Alfie Champion (ajpc500)"}
Query = Process.CommandLine like r"%rundll32.exe%" and Process.CommandLine like r"%.dll%" and Process.CommandLine like r"%StartNodeRelay%"


[ThreatDetectionRule platform=Windows]
# Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen
# Author: Florian Roth (Nextron Systems), @twjackomo, Jonhnathan Ribeiro, oscd.community
RuleId = baca5663-583c-45f9-b5dc-ea96a22ce542
RuleName = Sticky Key Like Backdoor Usage - Registry
EventType = Reg.Any
Tag = sticky-key-like-backdoor-usage-registry
RiskScore = 100
Annotation = {"mitre_attack": ["T1546.008"], "author": "Florian Roth (Nextron Systems), @twjackomo, Jonhnathan Ribeiro, oscd.community"}
Query = Reg.TargetObject like r"%\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe\\Debugger" or Reg.TargetObject like r"%\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\utilman.exe\\Debugger" or Reg.TargetObject like r"%\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\osk.exe\\Debugger" or Reg.TargetObject like r"%\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Magnify.exe\\Debugger" or Reg.TargetObject like r"%\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Narrator.exe\\Debugger" or Reg.TargetObject like r"%\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\DisplaySwitch.exe\\Debugger" or Reg.TargetObject like r"%\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\atbroker.exe\\Debugger" or Reg.TargetObject like r"%\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\HelpPane.exe\\Debugger"
Hive = HKLM,HKU
GenericProperty1 = Reg.TargetObject


[ThreatDetectionRule platform=Windows]
# Detects the default filename used in PoC code against print spooler vulnerability CVE-2021-1675
# Author: Florian Roth (Nextron Systems)
RuleId = 2131cfb3-8c12-45e8-8fa0-31f5924e9f07
RuleName = CVE-2021-1675 Print Spooler Exploitation Filename Pattern
EventType = File.Create
Tag = cve-2021-1675-print-spooler-exploitation-filename-pattern
RiskScore = 100
Annotation = {"mitre_attack": ["T1587"], "author": "Florian Roth (Nextron Systems)"}
Query = File.Path like r"%C:\\Windows\\System32\\spool\\drivers\\x64\\3\\old\\1\\123%"
GenericProperty1 = File.Path


[ThreatDetectionRule platform=Windows]
# Detects LockerGoga ransomware activity via specific command line.
# Author: Vasiliy Burov, oscd.community
RuleId = 74db3488-fd28-480a-95aa-b7af626de068
RuleName = LockerGoga Ransomware Activity
EventType = Process.Start
Tag = proc-start-lockergoga-ransomware-activity
RiskScore = 100
Annotation = {"mitre_attack": ["T1486"], "author": "Vasiliy Burov, oscd.community"}
Query = Process.CommandLine like r"%-i SM-tgytutrc -s%"


[ThreatDetectionRule platform=Windows]
# Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory
# Author: Florian Roth (Nextron Systems)
RuleId = 2704ab9e-afe2-4854-a3b1-0c0706d03578
RuleName = HackTool - Dumpert Process Dumper Execution
EventType = Process.Start
Tag = proc-start-hacktool-dumpert-process-dumper-execution
RiskScore = 100
Annotation = {"mitre_attack": ["T1003.001"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.Hashes like r"%MD5=09D278F9DE118EF09163C6140255C690%" or Process.CommandLine like r"%Dumpert.dll%"
GenericProperty1 = Process.Hashes


[ThreatDetectionRule platform=Windows]
# Detects the execution of the PoC that can be used to exploit Sysmon CVE-2022-41120
# Author: Florian Roth (Nextron Systems)
RuleId = 8a7e90c5-fe6e-45dc-889e-057fe4378bd9
RuleName = HackTool - SysmonEOP Execution
EventType = Process.Start
Tag = proc-start-hacktool-sysmoneop-execution
RiskScore = 100
Annotation = {"mitre_attack": ["T1068"], "author": "Florian Roth (Nextron Systems)"}
Query = Process.Path like r"%\\SysmonEOP.exe" or Process.Hashes like r"%IMPHASH=22F4089EB8ABA31E1BB162C6D9BF72E5%" or Process.Hashes like r"%IMPHASH=5123FA4C4384D431CD0D893EEB49BBEC%"
GenericProperty1 = Process.Hashes


[ThreatDetectionRule platform=Windows]
# Detects suspicious execution from AsperaFaspex as seen used by Mint Sandstorm
# Author: Nasreddine Bencherchali (Nextron Systems), MSTIC (idea)
RuleId = 91048c0d-5b81-4b85-a099-c9ee4fb87979
RuleName = Mint Sandstorm - AsperaFaspex Suspicious Process Execution
EventType = Process.Start
Tag = proc-start-mint-sandstorm-asperafaspex-suspicious-process-execution
RiskScore = 100
Annotation = {"author": "Nasreddine Bencherchali (Nextron Systems), MSTIC (idea)"}
Query = Parent.Path like r"%aspera%" and Parent.Path like r"%\\ruby%" and ((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\powershell\_ise.exe") and (Process.CommandLine like r"% echo %" or Process.CommandLine like r"%-dumpmode%" or Process.CommandLine like r"%-ssh%" or Process.CommandLine like r"%.dmp%" or Process.CommandLine like r"%add-MpPreference%" or Process.CommandLine like r"%adscredentials%" or Process.CommandLine like r"%bitsadmin%" or Process.CommandLine like r"%certutil%" or Process.CommandLine like r"%csvhost.exe%" or Process.CommandLine like r"%DownloadFile%" or Process.CommandLine like r"%DownloadString%" or Process.CommandLine like r"%dsquery%" or Process.CommandLine like r"%ekern.exe%" or Process.CommandLine like r"%FromBase64String%" or Process.CommandLine like r"%iex %" or Process.CommandLine like r"%iex(%" or Process.CommandLine like r"%Invoke-Expression%" or Process.CommandLine like r"%Invoke-WebRequest%" or Process.CommandLine like r"%localgroup administrators%" or Process.CommandLine like r"%net group%" or Process.CommandLine like r"%net user%" or Process.CommandLine like r"%o365accountconfiguration%" or Process.CommandLine like r"%query session%" or Process.CommandLine like r"%samaccountname=%" or Process.CommandLine like r"%set-MpPreference%" or Process.CommandLine like r"%svhost.exe%" or Process.CommandLine like r"%System.IO.Compression%" or Process.CommandLine like r"%System.IO.MemoryStream%" or Process.CommandLine like r"%usoprivate%" or Process.CommandLine like r"%usoshared%" or Process.CommandLine like r"%whoami%" or Process.CommandLine regex "[-/â€“][Ee^]{1,2}[ncodema^]*\\s[A-Za-z0-9+/=]{15,}") or Process.CommandLine like r"%lsass%" and (Process.CommandLine like r"%procdump%" or Process.CommandLine like r"%tasklist%" or Process.CommandLine like r"%findstr%") or Process.Path like r"%\\wget.exe" and Process.CommandLine like r"%http%" or Process.Path like r"%\\curl.exe" and Process.CommandLine like r"%http%" or Process.CommandLine like r"%E:jscript%" or Process.CommandLine like r"%e:vbscript%" or Process.CommandLine like r"%localgroup Administrators%" and Process.CommandLine like r"%/add%" or Process.CommandLine like r"%net%" and Process.CommandLine like r"%user%" and Process.CommandLine like r"%/add%" or Process.CommandLine like r"%reg add%" and Process.CommandLine like r"%DisableAntiSpyware%" and Process.CommandLine like r"%\\Microsoft\\Windows Defender%" or Process.CommandLine like r"%reg add%" and Process.CommandLine like r"%DisableRestrictedAdmin%" and Process.CommandLine like r"%CurrentControlSet\\Control\\Lsa%" or Process.CommandLine like r"%wmic%" and Process.CommandLine like r"%process call create%" or Process.CommandLine like r"%wmic%" and Process.CommandLine like r"%delete%" and Process.CommandLine like r"%shadowcopy%" or Process.CommandLine like r"%vssadmin%" and Process.CommandLine like r"%delete%" and Process.CommandLine like r"%shadows%" or Process.CommandLine like r"%wbadmin%" and Process.CommandLine like r"%delete%" and Process.CommandLine like r"%catalog%")
GenericProperty1 = Parent.Path


[ThreatDetectionRule platform=Windows]
# Detects a dump file written by QuarksPwDump password dumper
# Author: Florian Roth (Nextron Systems)
RuleId = 847def9e-924d-4e90-b7c4-5f581395a2b4
RuleName = HackTool - QuarksPwDump Dump File
EventType = File.Create
Tag = hacktool-quarkspwdump-dump-file
RiskScore = 100
Annotation = {"mitre_attack": ["T1003.002"], "author": "Florian Roth (Nextron Systems)"}
Query = File.Path like r"%\\AppData\\Local\\Temp\\SAM-%" and File.Path like r"%.dmp%"
GenericProperty1 = File.Path


[ThreatDetectionRule platform=Windows]
# Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process
# Author: Florian Roth (Nextron Systems)
RuleId = b5281f31-f9cc-4d0d-95d0-45b91c45b487
RuleName = DNS RCE CVE-2020-1350
EventType = Process.Start
Tag = proc-start-dns-rce-cve-2020-1350
RiskScore = 100
Annotation = {"mitre_attack": ["T1190", "T1569.002"], "author": "Florian Roth (Nextron Systems)"}
Query = Parent.Path like r"%\\System32\\dns.exe" and not (Process.Path like r"%\\System32\\werfault.exe" or Process.Path like r"%\\System32\\conhost.exe" or Process.Path like r"%\\System32\\dnscmd.exe" or Process.Path like r"%\\System32\\dns.exe")
GenericProperty1 = Parent.Path

