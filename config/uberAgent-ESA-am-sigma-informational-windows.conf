#
# The rules are generated from the Sigma GitHub repository at https://github.com/SigmaHQ/sigma
# Follow these steps to get the latest rules from the repository with Python
#    1. Clone the repository locally
#    2. Using a commandline, change working directory to the just cloned repository
#    3. Run sigmac -I --target uberagent -r rules/
#
# The rules in this file are marked with sigma-level: informational
#

[ActivityMonitoringRule platform=Windows]
# Adversaries may attempt to get information about running processes on a system. Information obtained could be used to gain an understanding of common software/applications running on systems within the network
# Author: frack113
RuleId = 63332011-f057-496c-ad8d-d2b6afb27f96
RuleName = Suspicious Tasklist Discovery Command
EventType = Process.Start
Tag = proc-start-suspicious-tasklist-discovery-command
RiskScore = 1
Annotation = {"mitre_attack": ["T1057"]}
Query = (Process.CommandLine like r"%tasklist%" or Process.Path like r"%\\tasklist.exe" or Process.Name == "tasklist.exe")

[ActivityMonitoringRule platform=Windows]
# Detect DLL Load from Spooler Service backup folder
# Author: FPT.EagleEye, Thomas Patzke (improvements)
RuleId = 02fb90de-c321-4e63-a6b9-25f4b03dfd14
RuleName = Windows Spooler Service Suspicious Binary Load
EventType = Image.Load
Tag = windows-spooler-service-suspicious-binary-load
RiskScore = 1
Annotation = {"mitre_attack": ["T1574"]}
Query = (Process.Path like r"%\\spoolsv.exe" and (Image.Path like r"%\\Windows\\System32\\spool\\drivers\\x64\\3\\%" or Image.Path like r"%\\Windows\\System32\\spool\\drivers\\x64\\4\\%") and Image.Path like r"%.dll")
GenericProperty1 = Image.Path

[ActivityMonitoringRule platform=Windows]
# Detects non wmiprvse loading WMI modules
# Author: Roberto Rodriguez @Cyb3rWard0g
RuleId = 671bb7e3-a020-4824-a00e-2ee5b55f385e
RuleName = WMI Modules Loaded
EventType = Image.Load
Tag = wmi-modules-loaded
RiskScore = 1
Annotation = {"mitre_attack": ["T1047"]}
Query = (((Image.Path like r"%\\wmiclnt.dll" or Image.Path like r"%\\WmiApRpl.dll" or Image.Path like r"%\\wmiprov.dll" or Image.Path like r"%\\wmiutils.dll" or Image.Path like r"%\\wbemcomn.dll" or Image.Path like r"%\\wbemprox.dll" or Image.Path like r"%\\WMINet\_Utils.dll" or Image.Path like r"%\\wbemsvc.dll" or Image.Path like r"%\\fastprox.dll") and not ((Process.Path like r"%\\WmiPrvSE.exe" or Process.Path like r"%\\WmiApSrv.exe" or Process.Path like r"%\\svchost.exe" or Process.Path like r"%\\DeviceCensus.exe" or Process.Path like r"%\\CompatTelRunner.exe" or Process.Path like r"%\\sdiagnhost.exe" or Process.Path like r"%\\SIHClient.exe" or Process.Path like r"%\\ngentask.exe" or Process.Path like r"%\\windows\\system32\\taskhostw.exe" or Process.Path like r"%\\windows\\system32\\MoUsoCoreWorker.exe" or Process.Path like r"%\\windows\\system32\\wbem\\WMIADAP.exe" or Process.Path like r"%C:\\Windows\\Sysmon64.exe" or Process.Path like r"%C:\\Windows\\Sysmon.exe" or Process.Path like r"%C:\\Windows\\System32\\wbem\\unsecapp.exe" or Process.Path like r"%\\logman.exe" or Process.Path like r"%\\systeminfo.exe" or Process.Path like r"%\\nvcontainer.exe" or Process.Path like r"%C:\\Windows\\System32\\wbem\\WMIC.exe" or Process.Path like r"%\\explorer.exe" or Process.Path like r"%\\opera\_autoupdate.exe" or Process.Path like r"%\\MsMpEng.exe" or Process.Path like r"%\\thor64.exe" or Process.Path like r"%\\thor.exe"))) and not ((Process.Path like r"C:\\Program Files\\%" or Process.Path like r"C:\\Program Files (x86)\\%")))
GenericProperty1 = Image.Path

