
#
# The rules are generated from the Sigma GitHub repository at https://github.com/SigmaHQ/sigma
# To generate the ruleset, please follow the instructions provided in the repository: https://github.com/vastlimits/pySigma-backend-uberAgent/
#
# The command used to generate the ruleset is:
#    sigma convert -s -f conf -p uberagent-6.2.0 -O backend_version=main -t uberagent /home/runner/work/uberAgent-config/uberAgent-config/build/sigma-critical >> uberAgent-ESA-am-sigma-critical.conf
#

[ActivityMonitoringRule]
# Detects the use of Windows Credential Editor (WCE)
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - Windows Credential Editor (WCE) Execution
EventType = Process.Start
Tag = proc-start-hacktool-windows-credential-editor-(wce)-execution
RiskScore = 100
Query = (Process.Hashes like r"%IMPHASH=a53a02b997935fd8eedcb5f7abab9b9f%" or Process.Hashes like r"%IMPHASH=e96a73c7bf33a464c510ede582318bf2%" or Process.CommandLine like r"%.exe -S" and Parent.Path like r"%\\services.exe") and not Process.Path like r"%\\clussvc.exe"
GenericProperty1 = Parent.Path
GenericProperty2 = Process.Hashes


[ActivityMonitoringRule]
# Detects a WMI backdoor in Exchange Transport Agents via WMI event filters
# Author: Florian Roth (Nextron Systems)
RuleName = WMI Backdoor Exchange Transport Agent
EventType = Process.Start
Tag = proc-start-wmi-backdoor-exchange-transport-agent
RiskScore = 100
Query = Parent.Path like r"%\\EdgeTransport.exe" and not (Process.Path == "C:\\Windows\\System32\\conhost.exe" or Process.Path like r"C:\\Program Files\\Microsoft\\Exchange Server\\%" and Process.Path like r"%\\Bin\\OleConverter.exe")
GenericProperty1 = Parent.Path


[ActivityMonitoringRule]
# Detects potential DLL hijack of "iertutil.dll" found in the DCOM InternetExplorer.Application Class
# Author: Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR), wagga
RuleName = Potential DCOM InternetExplorer.Application DLL Hijack - Image Load
EventType = Image.Load
Tag = potential-dcom-internetexplorer.application-dll-hijack-image-load
RiskScore = 100
Query = Process.Path like r"%\\Internet Explorer\\iexplore.exe" and Image.Path like r"%\\Internet Explorer\\iertutil.dll"
GenericProperty1 = Image.Path


[ActivityMonitoringRule]
# Detects the execution of the PoC that can be used to exploit Sysmon CVE-2022-41120
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - SysmonEOP Execution
EventType = Process.Start
Tag = proc-start-hacktool-sysmoneop-execution
RiskScore = 100
Query = Process.Path like r"%\\SysmonEOP.exe" or Process.Hashes like r"%IMPHASH=22F4089EB8ABA31E1BB162C6D9BF72E5%" or Process.Hashes like r"%IMPHASH=5123FA4C4384D431CD0D893EEB49BBEC%"
GenericProperty1 = Process.Hashes


[ActivityMonitoringRule]
# By replacing the sticky keys executable with the local admins CMD executable, an attacker is able to access a privileged windows console session without authenticating to the system.
# When the sticky keys are "activated" the privilleged shell is launched.
# Author: Sreeman
RuleName = Persistence Via Sticky Key Backdoor
EventType = Process.Start
Tag = proc-start-persistence-via-sticky-key-backdoor
RiskScore = 100
Query = Process.CommandLine like r"%copy %" and Process.CommandLine like r"%/y %" and Process.CommandLine like r"%C:\\windows\\system32\\cmd.exe C:\\windows\\system32\\sethc.exe%"


[ActivityMonitoringRule]
# Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen
# Author: Florian Roth (Nextron Systems), @twjackomo, Jonhnathan Ribeiro, oscd.community
RuleName = Sticky Key Like Backdoor Execution
EventType = Process.Start
Tag = proc-start-sticky-key-like-backdoor-execution
RiskScore = 100
Query = Parent.Path like r"%\\winlogon.exe" and (Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\cscript.exe" or Process.Path like r"%\\mshta.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\regsvr32.exe" or Process.Path like r"%\\rundll32.exe" or Process.Path like r"%\\wscript.exe" or Process.Path like r"%\\wt.exe") and (Process.CommandLine like r"%sethc.exe%" or Process.CommandLine like r"%utilman.exe%" or Process.CommandLine like r"%osk.exe%" or Process.CommandLine like r"%Magnify.exe%" or Process.CommandLine like r"%Narrator.exe%" or Process.CommandLine like r"%DisplaySwitch.exe%")
GenericProperty1 = Parent.Path


[ActivityMonitoringRule]
# Detects a program that invoked suspicious DNS queries known from Cobalt Strike beacons
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious Cobalt Strike DNS Beaconing - Sysmon
EventType = Dns.Query
Tag = suspicious-cobalt-strike-dns-beaconing-sysmon
RiskScore = 100
Query = Dns.QueryRequest like r"aaa.stage.%" or Dns.QueryRequest like r"post.1%" or Dns.QueryRequest like r"%.stage.123456.%"
GenericProperty1 = Dns.QueryRequest


[ActivityMonitoringRule]
# Detects the execution of the PurpleSharp adversary simulation tool
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - PurpleSharp Execution
EventType = Process.Start
Tag = proc-start-hacktool-purplesharp-execution
RiskScore = 100
Query = Process.Path like r"%\\purplesharp%" or Process.Name == "PurpleSharp.exe" or Process.CommandLine like r"%xyz123456.exe%" or Process.CommandLine like r"%PurpleSharp%"


[ActivityMonitoringRule]
# Detects the execution of different Windows based hacktools via their import hash (imphash) even if the files have been renamed
# Author: Florian Roth (Nextron Systems)
RuleName = Hacktool Execution - Imphash
EventType = Process.Start
Tag = proc-start-hacktool-execution-imphash
RiskScore = 100
Query = Process.Hashes like r"%IMPHASH=BCCA3C247B619DCD13C8CDFF5F123932%" or Process.Hashes like r"%IMPHASH=3A19059BD7688CB88E70005F18EFC439%" or Process.Hashes like r"%IMPHASH=bf6223a49e45d99094406777eb6004ba%" or Process.Hashes like r"%IMPHASH=23867A89C2B8FC733BE6CF5EF902F2D1%" or Process.Hashes like r"%IMPHASH=A37FF327F8D48E8A4D2F757E1B6E70BC%" or Process.Hashes like r"%IMPHASH=F9A28C458284584A93B14216308D31BD%" or Process.Hashes like r"%IMPHASH=6118619783FC175BC7EBECFF0769B46E%" or Process.Hashes like r"%IMPHASH=959A83047E80AB68B368FDB3F4C6E4EA%" or Process.Hashes like r"%IMPHASH=563233BFA169ACC7892451F71AD5850A%" or Process.Hashes like r"%IMPHASH=87575CB7A0E0700EB37F2E3668671A08%" or Process.Hashes like r"%IMPHASH=13F08707F759AF6003837A150A371BA1%" or Process.Hashes like r"%IMPHASH=1781F06048A7E58B323F0B9259BE798B%" or Process.Hashes like r"%IMPHASH=233F85F2D4BC9D6521A6CAAE11A1E7F5%" or Process.Hashes like r"%IMPHASH=24AF2584CBF4D60BBE5C6D1B31B3BE6D%" or Process.Hashes like r"%IMPHASH=632969DDF6DBF4E0F53424B75E4B91F2%" or Process.Hashes like r"%IMPHASH=713C29B396B907ED71A72482759ED757%" or Process.Hashes like r"%IMPHASH=749A7BB1F0B4C4455949C0B2BF7F9E9F%" or Process.Hashes like r"%IMPHASH=8628B2608957A6B0C6330AC3DE28CE2E%" or Process.Hashes like r"%IMPHASH=8B114550386E31895DFAB371E741123D%" or Process.Hashes like r"%IMPHASH=94CB940A1A6B65BED4D5A8F849CE9793%" or Process.Hashes like r"%IMPHASH=9D68781980370E00E0BD939EE5E6C141%" or Process.Hashes like r"%IMPHASH=B18A1401FF8F444056D29450FBC0A6CE%" or Process.Hashes like r"%IMPHASH=CB567F9498452721D77A451374955F5F%" or Process.Hashes like r"%IMPHASH=730073214094CD328547BF1F72289752%" or Process.Hashes like r"%IMPHASH=17B461A082950FC6332228572138B80C%" or Process.Hashes like r"%IMPHASH=DC25EE78E2EF4D36FAA0BADF1E7461C9%" or Process.Hashes like r"%IMPHASH=819B19D53CA6736448F9325A85736792%" or Process.Hashes like r"%IMPHASH=829DA329CE140D873B4A8BDE2CBFAA7E%" or Process.Hashes like r"%IMPHASH=C547F2E66061A8DFFB6F5A3FF63C0A74%" or Process.Hashes like r"%IMPHASH=0588081AB0E63BA785938467E1B10CCA%" or Process.Hashes like r"%IMPHASH=0D9EC08BAC6C07D9987DFD0F1506587C%" or Process.Hashes like r"%IMPHASH=BC129092B71C89B4D4C8CDF8EA590B29%" or Process.Hashes like r"%IMPHASH=4DA924CF622D039D58BCE71CDF05D242%" or Process.Hashes like r"%IMPHASH=E7A3A5C377E2D29324093377D7DB1C66%" or Process.Hashes like r"%IMPHASH=9A9DBEC5C62F0380B4FA5FD31DEFFEDF%" or Process.Hashes like r"%IMPHASH=AF8A3976AD71E5D5FDFB67DDB8DADFCE%" or Process.Hashes like r"%IMPHASH=0C477898BBF137BBD6F2A54E3B805FF4%" or Process.Hashes like r"%IMPHASH=0CA9F02B537BCEA20D4EA5EB1A9FE338%" or Process.Hashes like r"%IMPHASH=3AB3655E5A14D4EEFC547F4781BF7F9E%" or Process.Hashes like r"%IMPHASH=E6F9D5152DA699934B30DAAB206471F6%" or Process.Hashes like r"%IMPHASH=3AD59991CCF1D67339B319B15A41B35D%" or Process.Hashes like r"%IMPHASH=FFDD59E0318B85A3E480874D9796D872%" or Process.Hashes like r"%IMPHASH=0CF479628D7CC1EA25EC7998A92F5051%" or Process.Hashes like r"%IMPHASH=07A2D4DCBD6CB2C6A45E6B101F0B6D51%" or Process.Hashes like r"%IMPHASH=D6D0F80386E1380D05CB78E871BC72B1%" or Process.Hashes like r"%IMPHASH=38D9E015591BBFD4929E0D0F47FA0055%" or Process.Hashes like r"%IMPHASH=0E2216679CA6E1094D63322E3412D650%" or Process.Hashes like r"%IMPHASH=ADA161BF41B8E5E9132858CB54CAB5FB%" or Process.Hashes like r"%IMPHASH=2A1BC4913CD5ECB0434DF07CB675B798%" or Process.Hashes like r"%IMPHASH=11083E75553BAAE21DC89CE8F9A195E4%" or Process.Hashes like r"%IMPHASH=A23D29C9E566F2FA8FFBB79267F5DF80%" or Process.Hashes like r"%IMPHASH=4A07F944A83E8A7C2525EFA35DD30E2F%" or Process.Hashes like r"%IMPHASH=767637C23BB42CD5D7397CF58B0BE688%" or Process.Hashes like r"%IMPHASH=14C4E4C72BA075E9069EE67F39188AD8%" or Process.Hashes like r"%IMPHASH=3C782813D4AFCE07BBFC5A9772ACDBDC%" or Process.Hashes like r"%IMPHASH=7D010C6BB6A3726F327F7E239166D127%" or Process.Hashes like r"%IMPHASH=89159BA4DD04E4CE5559F132A9964EB3%" or Process.Hashes like r"%IMPHASH=6F33F4A5FC42B8CEC7314947BD13F30F%" or Process.Hashes like r"%IMPHASH=5834ED4291BDEB928270428EBBAF7604%" or Process.Hashes like r"%IMPHASH=5A8A8A43F25485E7EE1B201EDCBC7A38%" or Process.Hashes like r"%IMPHASH=DC7D30B90B2D8ABF664FBED2B1B59894%" or Process.Hashes like r"%IMPHASH=41923EA1F824FE63EA5BEB84DB7A3E74%" or Process.Hashes like r"%IMPHASH=3DE09703C8E79ED2CA3F01074719906B%" or Process.Hashes like r"%IMPHASH=A53A02B997935FD8EEDCB5F7ABAB9B9F%" or Process.Hashes like r"%IMPHASH=E96A73C7BF33A464C510EDE582318BF2%" or Process.Hashes like r"%IMPHASH=32089B8851BBF8BC2D014E9F37288C83%" or Process.Hashes like r"%IMPHASH=09D278F9DE118EF09163C6140255C690%" or Process.Hashes like r"%IMPHASH=03866661686829d806989e2fc5a72606%" or Process.Hashes like r"%IMPHASH=e57401fbdadcd4571ff385ab82bd5d6d%" or Process.Hashes like r"%IMPHASH=84B763C45C0E4A3E7CA5548C710DB4EE%" or Process.Hashes like r"%IMPHASH=19584675D94829987952432E018D5056%" or Process.Hashes like r"%IMPHASH=330768A4F172E10ACB6287B87289D83B%" or Process.Hashes like r"%IMPHASH=885C99CCFBE77D1CBFCB9C4E7C1A3313%" or Process.Hashes like r"%IMPHASH=22A22BC9E4E0D2F189F1EA01748816AC%" or Process.Hashes like r"%IMPHASH=7FA30E6BB7E8E8A69155636E50BF1B28%" or Process.Hashes like r"%IMPHASH=96DF3A3731912449521F6F8D183279B1%" or Process.Hashes like r"%IMPHASH=7E6CF3FF4576581271AC8A313B2AAB46%" or Process.Hashes like r"%IMPHASH=51791678F351C03A0EB4E2A7B05C6E17%" or Process.Hashes like r"%IMPHASH=25CE42B079282632708FC846129E98A5%" or Process.Hashes like r"%IMPHASH=021BCCA20BA3381B11BDDE26B4E62F20%" or Process.Hashes like r"%IMPHASH=59223B5F52D8799D38E0754855CBDF42%" or Process.Hashes like r"%IMPHASH=81E75D8F1D276C156653D3D8813E4A43%" or Process.Hashes like r"%IMPHASH=17244E8B6B8227E57FE709CCAD421420%" or Process.Hashes like r"%IMPHASH=5B76DA3ACDEDC8A5CDF23A798B5936B4%" or Process.Hashes like r"%IMPHASH=CB2B65BB77D995CC1C0E5DF1C860133C%" or Process.Hashes like r"%IMPHASH=40445337761D80CF465136FAFB1F63E6%" or Process.Hashes like r"%IMPHASH=8A790F401B29FA87BC1E56F7272B3AA6%" or Process.Hashes like r"%IMPHASH=B50199E952C875241B9CE06C971CE3C1%"
GenericProperty1 = Process.Hashes


[ActivityMonitoringRule]
# Detects the execution of SecurityXploded Tools
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - SecurityXploded Execution
EventType = Process.Start
Tag = proc-start-hacktool-securityxploded-execution
RiskScore = 100
Query = Process.Company == "SecurityXploded" or Process.Path like r"%PasswordDump.exe" or Process.Name like r"%PasswordDump.exe"
GenericProperty1 = Process.Company


[ActivityMonitoringRule]
# Detects the execution of whoami that has been renamed to a different name to avoid detection
# Author: Florian Roth (Nextron Systems)
RuleName = Renamed Whoami Execution
EventType = Process.Start
Tag = proc-start-renamed-whoami-execution
RiskScore = 100
Query = Process.Name == "whoami.exe" and not Process.Path like r"%\\whoami.exe"


[ActivityMonitoringRule]
# Detects process activity patterns as seen being used by Sliver C2 framework implants
# Author: Nasreddine Bencherchali (Nextron Systems), Florian Roth (Nextron Systems)
RuleName = HackTool - Sliver C2 Implant Activity Pattern
EventType = Process.Start
Tag = proc-start-hacktool-sliver-c2-implant-activity-pattern
RiskScore = 100
Query = Process.CommandLine like r"%-NoExit -Command [Console]::OutputEncoding=[Text.UTF8Encoding]::UTF8%"


[ActivityMonitoringRule]
# Detects the use of the Dinject PowerShell cradle based on the specific flags
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - DInjector PowerShell Cradle Execution
EventType = Process.Start
Tag = proc-start-hacktool-dinjector-powershell-cradle-execution
RiskScore = 100
Query = Process.CommandLine like r"% /am51%" and Process.CommandLine like r"% /password%"


[ActivityMonitoringRule]
# Detects different hacktools used for relay attacks on Windows for privilege escalation
# Author: Florian Roth (Nextron Systems)
RuleName = Potential SMB Relay Attack Tool Execution
EventType = Process.Start
Tag = proc-start-potential-smb-relay-attack-tool-execution
RiskScore = 100
Query = (Process.Path like r"%PetitPotam%" or Process.Path like r"%RottenPotato%" or Process.Path like r"%HotPotato%" or Process.Path like r"%JuicyPotato%" or Process.Path like r"%\\just\_dce\_%" or Process.Path like r"%Juicy Potato%" or Process.Path like r"%\\temp\\rot.exe%" or Process.Path like r"%\\Potato.exe%" or Process.Path like r"%\\SpoolSample.exe%" or Process.Path like r"%\\Responder.exe%" or Process.Path like r"%\\smbrelayx%" or Process.Path like r"%\\ntlmrelayx%" or Process.Path like r"%\\LocalPotato%" or Process.CommandLine like r"%Invoke-Tater%" or Process.CommandLine like r"% smbrelay%" or Process.CommandLine like r"% ntlmrelay%" or Process.CommandLine like r"%cme smb %" or Process.CommandLine like r"% /ntlm:NTLMhash %" or Process.CommandLine like r"%Invoke-PetitPotam%" or Process.CommandLine like r"%.exe -t % -p %" or Process.CommandLine like r"%.exe -c \"{%" and Process.CommandLine like r"%}\" -z") and not (Process.Path like r"%HotPotatoes6%" or Process.Path like r"%HotPotatoes7%" or Process.Path like r"%HotPotatoes %")


[ActivityMonitoringRule]
# Detects suspicious use of an .exe extension after a non-executable file extension like .pdf.exe, a set of spaces or underlines to cloak the executable file in spear phishing campaigns
# Author: Florian Roth (Nextron Systems), @blu3_team (idea), Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Double Extension File Execution
EventType = Process.Start
Tag = proc-start-suspicious-double-extension-file-execution
RiskScore = 100
Query = (Process.Path like r"%.doc.exe" or Process.Path like r"%.docx.exe" or Process.Path like r"%.xls.exe" or Process.Path like r"%.xlsx.exe" or Process.Path like r"%.ppt.exe" or Process.Path like r"%.pptx.exe" or Process.Path like r"%.rtf.exe" or Process.Path like r"%.pdf.exe" or Process.Path like r"%.txt.exe" or Process.Path like r"%      .exe" or Process.Path like r"%\_\_\_\_\_\_.exe" or Process.Path like r"%.doc.js" or Process.Path like r"%.docx.js" or Process.Path like r"%.xls.js" or Process.Path like r"%.xlsx.js" or Process.Path like r"%.ppt.js" or Process.Path like r"%.pptx.js" or Process.Path like r"%.rtf.js" or Process.Path like r"%.pdf.js" or Process.Path like r"%.txt.js") and (Process.CommandLine like r"%.doc.exe%" or Process.CommandLine like r"%.docx.exe%" or Process.CommandLine like r"%.xls.exe%" or Process.CommandLine like r"%.xlsx.exe%" or Process.CommandLine like r"%.ppt.exe%" or Process.CommandLine like r"%.pptx.exe%" or Process.CommandLine like r"%.rtf.exe%" or Process.CommandLine like r"%.pdf.exe%" or Process.CommandLine like r"%.txt.exe%" or Process.CommandLine like r"%      .exe%" or Process.CommandLine like r"%\_\_\_\_\_\_.exe%" or Process.CommandLine like r"%.doc.js%" or Process.CommandLine like r"%.docx.js%" or Process.CommandLine like r"%.xls.js%" or Process.CommandLine like r"%.xlsx.js%" or Process.CommandLine like r"%.ppt.js%" or Process.CommandLine like r"%.pptx.js%" or Process.CommandLine like r"%.rtf.js%" or Process.CommandLine like r"%.pdf.js%" or Process.CommandLine like r"%.txt.js%")


[ActivityMonitoringRule]
# Detects some Empire PowerShell UAC bypass methods
# Author: Ecco
RuleName = HackTool - Empire PowerShell UAC Bypass
EventType = Process.Start
Tag = proc-start-hacktool-empire-powershell-uac-bypass
RiskScore = 100
Query = Process.CommandLine like r"% -NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update)%" or Process.CommandLine like r"% -NoP -NonI -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update);%"


[ActivityMonitoringRule]
# Detects suspicious child processes of the Veeam service process. This could indicate potential RCE or SQL Injection.
# Author: Nasreddine Bencherchali (Nextron Systems)
RuleName = Suspicious Child Process Of Veeam Dabatase
EventType = Process.Start
Tag = proc-start-suspicious-child-process-of-veeam-dabatase
RiskScore = 100
Query = Parent.Path like r"%\\sqlservr.exe" and Parent.CommandLine like r"%VEEAMSQL%" and ((Process.Path like r"%\\cmd.exe" or Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe" or Process.Path like r"%\\wsl.exe" or Process.Path like r"%\\wt.exe") and (Process.CommandLine like r"%-ex %" or Process.CommandLine like r"%bypass%" or Process.CommandLine like r"%cscript%" or Process.CommandLine like r"%DownloadString%" or Process.CommandLine like r"%http://%" or Process.CommandLine like r"%https://%" or Process.CommandLine like r"%mshta%" or Process.CommandLine like r"%regsvr32%" or Process.CommandLine like r"%rundll32%" or Process.CommandLine like r"%wscript%" or Process.CommandLine like r"%copy %") or Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe" or Process.Path like r"%\\netstat.exe" or Process.Path like r"%\\nltest.exe" or Process.Path like r"%\\ping.exe" or Process.Path like r"%\\tasklist.exe" or Process.Path like r"%\\whoami.exe")
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine


[ActivityMonitoringRule]
# F-Secure C3 produces DLLs with a default exported StartNodeRelay function.
# Author: Alfie Champion (ajpc500)
RuleName = HackTool - F-Secure C3 Load by Rundll32
EventType = Process.Start
Tag = proc-start-hacktool-f-secure-c3-load-by-rundll32
RiskScore = 100
Query = Process.CommandLine like r"%rundll32.exe%" and Process.CommandLine like r"%.dll%" and Process.CommandLine like r"%StartNodeRelay%"


[ActivityMonitoringRule]
# Detects a suspicious LSASS process process clone that could be a sign of credential dumping activity
# Author: Florian Roth (Nextron Systems), Samir Bousseaden
RuleName = Potential Credential Dumping Via LSASS Process Clone
EventType = Process.Start
Tag = proc-start-potential-credential-dumping-via-lsass-process-clone
RiskScore = 100
Query = Parent.Path like r"%\\Windows\\System32\\lsass.exe" and Process.Path like r"%\\Windows\\System32\\lsass.exe"
GenericProperty1 = Parent.Path


[ActivityMonitoringRule]
# Detects usage of the powerShell New-MailboxExportRequest Cmdlet to exports a mailbox to a remote or local share, as used in ProxyShell exploitations
# Author: Florian Roth (Nextron Systems)
RuleName = Suspicious PowerShell Mailbox Export to Share
EventType = Process.Start
Tag = proc-start-suspicious-powershell-mailbox-export-to-share
RiskScore = 100
Query = Process.CommandLine like r"%New-MailboxExportRequest%" and Process.CommandLine like r"% -Mailbox %" and Process.CommandLine like r"% -FilePath \\\\%"


[ActivityMonitoringRule]
# Detects the use of the filename DumpStack.log to evade Microsoft Defender
# Author: Florian Roth (Nextron Systems)
RuleName = DumpStack.log Defender Evasion
EventType = Process.Start
Tag = proc-start-dumpstack.log-defender-evasion
RiskScore = 100
Query = Process.Path like r"%\\DumpStack.log" or Process.CommandLine like r"% -o DumpStack.log%"


[ActivityMonitoringRule]
# Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory
# Author: Florian Roth (Nextron Systems)
RuleName = HackTool - Dumpert Process Dumper Execution
EventType = Process.Start
Tag = proc-start-hacktool-dumpert-process-dumper-execution
RiskScore = 100
Query = Process.Hashes like r"%09D278F9DE118EF09163C6140255C690%" or Process.CommandLine like r"%Dumpert.dll%"
GenericProperty1 = Process.Hashes


[ActivityMonitoringRule]
# Detects indicators of a UAC bypass method by mocking directories
# Author: Florian Roth (Nextron Systems)
RuleName = TrustedPath UAC Bypass Pattern
EventType = Process.Start
Tag = proc-start-trustedpath-uac-bypass-pattern
RiskScore = 100
Query = Process.Path like r"%C:\\Windows \\System32\\%"

