
#
# The rules are generated from the Sigma GitHub repository at https://github.com/SigmaHQ/sigma
# To generate the ruleset, please follow the instructions provided in the repository: https://github.com/vastlimits/pySigma-backend-uberAgent/
#
# The command used to generate the ruleset is:
#    sigma convert -s -f conf -p uberagent-7.1.0 -t uberagent /home/runner/work/uberAgent-config/uberAgent-config/build/sigma-informational-macos >> uberAgent-ESA-am-sigma-informational-macos.conf
#

[ActivityMonitoringRule platform=MacOS]
# Detects the usage of tooling to sniff network traffic.
# An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.
# Author: Alejandro Ortuno, oscd.community
RuleId = adc9bcc4-c39c-4f6b-a711-1884017bf043
RuleName = Network Sniffing - MacOs
EventType = Process.Start
Tag = proc-start-network-sniffing-macos
RiskScore = 1
Annotation = {"mitre_attack": ["T1040"]}
Query = iendswith(Process.Path, "/tcpdump") or iendswith(Process.Path, "/tshark")


[ActivityMonitoringRule platform=MacOS]
# Detects usage of system utilities to discover files and directories
# Author: Daniil Yugoslavskiy, oscd.community
RuleId = 089dbdf6-b960-4bcc-90e3-ffc3480c20f6
RuleName = File and Directory Discovery - MacOS
EventType = Process.Start
Tag = proc-start-file-and-directory-discovery-macos
RiskScore = 1
Annotation = {"mitre_attack": ["T1083"]}
Query = Process.Path == "/usr/bin/file" and regex_match(Process.CommandLine, r"(.){200,}") or Process.Path == "/bin/ls" and icontains(Process.CommandLine, "-R") or Process.Path == "/usr/bin/find" or Process.Path == "/usr/bin/mdfind" or Process.Path == "/tree"


[ActivityMonitoringRule platform=MacOS]
# Adversaries may shutdown/reboot systems to interrupt access to, or aid in the destruction of, those systems.
# Author: Igor Fits, Mikhail Larin, oscd.community
RuleId = 40b1fbe2-18ea-4ee7-be47-0294285811de
RuleName = System Shutdown/Reboot - MacOs
EventType = Process.Start
Tag = proc-start-system-shutdown/reboot-macos
RiskScore = 1
Annotation = {"mitre_attack": ["T1529"]}
Query = iendswith(Process.Path, "/shutdown") or iendswith(Process.Path, "/reboot") or iendswith(Process.Path, "/halt")


[ActivityMonitoringRule platform=MacOS]
# Detects enumeration of local system groups
# Author: Ömer Günal, Alejandro Ortuno, oscd.community
RuleId = 89bb1f97-c7b9-40e8-b52b-7d6afbd67276
RuleName = Local Groups Discovery - MacOs
EventType = Process.Start
Tag = proc-start-local-groups-discovery-macos
RiskScore = 1
Annotation = {"mitre_attack": ["T1069.001"]}
Query = iendswith(Process.Path, "/dscacheutil") and icontains(Process.CommandLine, "-q") and icontains(Process.CommandLine, "group") or iendswith(Process.Path, "/cat") and icontains(Process.CommandLine, "/etc/group") or iendswith(Process.Path, "/dscl") and icontains(Process.CommandLine, "-list") and icontains(Process.CommandLine, "/groups")


[ActivityMonitoringRule platform=MacOS]
# Detects the enumeration of other remote systems.
# Author: Alejandro Ortuno, oscd.community
RuleId = 10227522-8429-47e6-a301-f2b2d014e7ad
RuleName = Macos Remote System Discovery
EventType = Process.Start
Tag = proc-start-macos-remote-system-discovery
RiskScore = 1
Annotation = {"mitre_attack": ["T1018"]}
Query = iendswith(Process.Path, "/arp") and icontains(Process.CommandLine, "-a") or iendswith(Process.Path, "/ping") and (icontains(Process.CommandLine, " 10.") or icontains(Process.CommandLine, " 192.168.") or icontains(Process.CommandLine, " 172.16.") or icontains(Process.CommandLine, " 172.17.") or icontains(Process.CommandLine, " 172.18.") or icontains(Process.CommandLine, " 172.19.") or icontains(Process.CommandLine, " 172.20.") or icontains(Process.CommandLine, " 172.21.") or icontains(Process.CommandLine, " 172.22.") or icontains(Process.CommandLine, " 172.23.") or icontains(Process.CommandLine, " 172.24.") or icontains(Process.CommandLine, " 172.25.") or icontains(Process.CommandLine, " 172.26.") or icontains(Process.CommandLine, " 172.27.") or icontains(Process.CommandLine, " 172.28.") or icontains(Process.CommandLine, " 172.29.") or icontains(Process.CommandLine, " 172.30.") or icontains(Process.CommandLine, " 172.31.") or icontains(Process.CommandLine, " 127.") or icontains(Process.CommandLine, " 169.254."))


[ActivityMonitoringRule platform=MacOS]
# Detects usage of system utilities to discover system network connections
# Author: Daniil Yugoslavskiy, oscd.community
RuleId = 9a7a0393-2144-4626-9bf1-7c2f5a7321db
RuleName = System Network Connections Discovery - MacOs
EventType = Process.Start
Tag = proc-start-system-network-connections-discovery-macos
RiskScore = 1
Annotation = {"mitre_attack": ["T1049"]}
Query = iendswith(Process.Path, "/who") or iendswith(Process.Path, "/w") or iendswith(Process.Path, "/last") or iendswith(Process.Path, "/lsof") or iendswith(Process.Path, "/netstat")


[ActivityMonitoringRule platform=MacOS]
# Detects enumeration of local network configuration
# Author: remotephone, oscd.community
RuleId = 58800443-f9fc-4d55-ae0c-98a3966dfb97
RuleName = System Network Discovery - macOS
EventType = Process.Start
Tag = proc-start-system-network-discovery-macos
RiskScore = 1
Annotation = {"mitre_attack": ["T1016"]}
Query = iendswith(Process.Path, "/netstat") or iendswith(Process.Path, "/ifconfig") or iendswith(Process.Path, "/socketfilterfw") or iendswith(Process.Path, "/networksetup") or iendswith(Process.Path, "/arp") or Process.Path == "/usr/bin/defaults" and icontains(Process.CommandLine, "read") and icontains(Process.CommandLine, "/Library/Preferences/com.apple.alf")

