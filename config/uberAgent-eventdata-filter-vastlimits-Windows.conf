##############################################################
#
# DnsQuery exclusions by originating process
#
##############################################################

[EventDataFilter]
# Ignore DNS queries from browsers.
Action = deny
Sourcetype = Process:DnsQuery
Query = ProcName in ["chrome.exe", "iexplore.exe", "firefox.exe", "msedge.exe", "opera.exe"]

[EventDataFilter]
# Ignore DNS queries from uberAgent because it performs reverse lookups to assign IP addresses to hostnames.
Action = deny
Sourcetype = Process:DnsQuery
Query = ProcName == "uberagent.exe"

[EventDataFilter]
# Ignore DNS queries with empty responses from svchost (DNS cache service). These are performed for various domains immediately after the machine resumes from suspend/hibernation.
Action = deny
Sourcetype = Process:DnsQuery
Query = ProcName == "svchost.exe" AND DnsRiskEmptyResponse==true

##############################################################
#
# ProcessStartup and ProcessStop exclusions
#
##############################################################

[EventDataFilter]
# Exclude "conhost.exe" (typically started from the path: \??\C:\WINDOWS\system32\conhost.exe).
Action = deny
Sourcetype = Process:ProcessStartup
Sourcetype = Process:ProcessStop
Query = regex_match_path(ProcPath, r"^(\\\?\?\\)?%SystemRoot%\\System32\\conhost\.exe$")

##############################################################
#
# ProcessDetail and ProcessStatistics exclusions
#
##############################################################

[EventDataFilter]
# Exclude processes whose name is exactly one of the given names.
Action = deny
Sourcetype = Process:ProcessDetail
Sourcetype = Process:ProcessStatistics
Query = ProcName in ["cmd.exe", "conhost.exe", "csrss.exe", "lsm.exe", "smss.exe", "wininit.exe", "winlogon.exe", "System Idle Process"]

##############################################################
#
# Exclude uberAgent.exe and WindowsConfiguration-User.ps1 from all TDE events
#
##############################################################

[EventDataFilter]
Action = deny
Sourcetype = ActivityMonitoring:ProcessTagging
Query = (ProcName == "uberAgent.exe" OR ProcParentName == "uberAgent.exe") OR (ProcName == "mshta.exe" AND ( (GenericProperty1Name == "Parent.CommandLine" and icontains(GenericProperty1Data, "\\WindowsConfiguration\\WindowsConfiguration-User.ps1\" uberAgent-SCI")) OR (GenericProperty2Name == "Parent.CommandLine" and icontains(GenericProperty2Data, "\\WindowsConfiguration\\WindowsConfiguration-User.ps1\" uberAgent-SCI")) OR (GenericProperty3Name == "Parent.CommandLine" and icontains(GenericProperty3Data, "\\WindowsConfiguration\\WindowsConfiguration-User.ps1\" uberAgent-SCI")) OR (GenericProperty4Name == "Parent.CommandLine" and icontains(GenericProperty4Data, "\\WindowsConfiguration\\WindowsConfiguration-User.ps1\" uberAgent-SCI")) OR (GenericProperty5Name == "Parent.CommandLine" and icontains(GenericProperty5Data, "\\WindowsConfiguration\\WindowsConfiguration-User.ps1\" uberAgent-SCI")) OR (GenericProperty6Name == "Parent.CommandLine" and icontains(GenericProperty6Data, "\\WindowsConfiguration\\WindowsConfiguration-User.ps1\" uberAgent-SCI")) OR (GenericProperty7Name == "Parent.CommandLine" and icontains(GenericProperty7Data, "\\WindowsConfiguration\\WindowsConfiguration-User.ps1\" uberAgent-SCI")) OR (GenericProperty8Name == "Parent.CommandLine" and icontains(GenericProperty8Data, "\\WindowsConfiguration\\WindowsConfiguration-User.ps1\" uberAgent-SCI")) OR (GenericProperty9Name == "Parent.CommandLine" and icontains(GenericProperty9Data, "\\WindowsConfiguration\\WindowsConfiguration-User.ps1\" uberAgent-SCI")) OR (GenericProperty10Name == "Parent.CommandLine" and icontains(GenericProperty10Data, "\\WindowsConfiguration\\WindowsConfiguration-User.ps1\" uberAgent-SCI")) ))


##############################################################
#
# Make sure, the field AppId is always filled.
# Happens mostly for virtual Windows processes like "System",
# Ensures correct results, when working with backend queries,
# that rely on the presence of AppId.
#
##############################################################

[EventDataFilter]
Action = allow
Sourcetype = ActivityMonitoring:ProcessTagging
Sourcetype = Application:Errors
Sourcetype = Process:LogoffProcesses
Sourcetype = Process:LogonProcesses
Sourcetype = Process:NetworkTargetPerformance
Sourcetype = Process:ProcessDetail
Sourcetype = Process:ProcessStartup
Sourcetype = Process:ProcessStatistics
Sourcetype = Process:ProcessStop
Query = (isnull_or_empty(AppId) and ProcName in ["Memory Compression", "Registry", "System", "Secure System"] and set(AppId, "MsWnOS")) or (isnull_or_empty(AppId) and set(AppId, "Unknwn")) or true

[EventDataFilter]
Action = allow
Sourcetype = Application:NetworkConnectFailure
Sourcetype = Application:UIDelay
Query = (isnull_or_empty(AppId) and ProcessName in ["Memory Compression", "Registry", "System", "Secure System"] and set(AppId, "MsWnOS")) or (isnull_or_empty(AppId) and set(AppId, "Unknwn")) or true
