##############################################################
#
# DnsQuery exclusions by originating process
#
##############################################################

[EventDataFilter]
# Ignore DNS queries from browsers.
Action = deny
Sourcetype = Process:DnsQuery
Query = ProcName in ["chrome.exe", "iexplore.exe", "firefox.exe", "msedge.exe", "opera.exe"]

[EventDataFilter]
# Ignore DNS queries from uberAgent because it performs reverse lookups to assign IP addresses to hostnames.
Action = deny
Sourcetype = Process:DnsQuery
Query = ProcName == "uberagent.exe"

[EventDataFilter]
# Ignore DNS queries with empty responses from svchost (DNS cache service). These are performed for various domains immediately after the machine resumes from suspend/hibernation.
Action = deny
Sourcetype = Process:DnsQuery
Query = ProcName == "svchost.exe" AND DnsRiskEmptyResponse==true

##############################################################
#
# ProcessStartup and ProcessStop exclusions
#
##############################################################

[EventDataFilter]
# Exclude "conhost.exe" (typically started from the path: \??\C:\WINDOWS\system32\conhost.exe).
Action = deny
Sourcetype = Process:ProcessStartup
Sourcetype = Process:ProcessStop
Query = regex_match_path(ProcPath, r"^(\\\?\?\\)?%SystemRoot%\\System32\\conhost\.exe$")

##############################################################
#
# ProcessDetail and ProcessStatistics exclusions
#
##############################################################

[EventDataFilter]
# Exclude processes whose name is exactly one of the given names.
Action = deny
Sourcetype = Process:ProcessDetail
Sourcetype = Process:ProcessStatistics
Query = ProcName in ["cmd.exe", "conhost.exe", "csrss.exe", "lsm.exe", "smss.exe", "wininit.exe", "winlogon.exe", "System Idle Process"]

##############################################################
#
# Make sure, the field AppId is always filled.
# Happens mostly for virtual Windows processes like "System",
# Ensures correct results, when working with backend queries,
# that rely on the presence of AppId. 
#
##############################################################

[EventDataFilter]
Action = allow
Sourcetype = ActivityMonitoring:ProcessTagging
Sourcetype = Application:Errors
Sourcetype = Process:LogoffProcesses
Sourcetype = Process:LogonProcesses
Sourcetype = Process:NetworkTargetPerformance
Sourcetype = Process:ProcessDetail
Sourcetype = Process:ProcessStartup
Sourcetype = Process:ProcessStatistics
Sourcetype = Process:ProcessStop
Query = (isnull_or_empty(AppId) and ProcName in ["Memory Compression", "Registry", "System", "Secure System"] and set(AppId, "MsWnOS")) or (isnull_or_empty(AppId) and set(AppId, "Unknwn")) or true

[EventDataFilter]
Action = allow
Sourcetype = Application:NetworkConnectFailure
Sourcetype = Application:UIDelay
Query = (isnull_or_empty(AppId) and ProcessName in ["Memory Compression", "Registry", "System", "Secure System"] and set(AppId, "MsWnOS")) or (isnull_or_empty(AppId) and set(AppId, "Unknwn")) or true
